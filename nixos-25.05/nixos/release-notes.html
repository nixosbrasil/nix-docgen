<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
 <title>Appendix B. Release Notes</title>
<link rel="stylesheet" type="text/css" href="style.css" /><link rel="stylesheet" type="text/css" href="highlightjs/mono-blue.css" />
<script src="./highlightjs/highlight.pack.js" type="text/javascript"></script><script src="./highlightjs/loader.js" type="text/javascript"></script><script src="./anchor.min.js" type="text/javascript"></script><script src="./anchor-use.js" type="text/javascript"></script><script src="/nix/store/9v77l71ihdq2fz626fv8r9l6bafgqk4n-nixos-manual-html/share/doc/nixos/index-redirects.js" type="text/javascript"></script><script src="/nix/store/9v77l71ihdq2fz626fv8r9l6bafgqk4n-nixos-manual-html/share/doc/nixos/options-redirects.js" type="text/javascript"></script><script src="/nix/store/9v77l71ihdq2fz626fv8r9l6bafgqk4n-nixos-manual-html/share/doc/nixos/release-notes-redirects.js" type="text/javascript"></script>
 <meta name="generator" content="nixos-render-docs 25.05pre-git" />
 <link rel="home" href="index.html" title="NixOS Manual" />
 <link rel="up" href="index.html" title="NixOS Manual" /><link rel="prev" href="options.html" title="Appendix A. Configuration Options" />
 </head>
 <body>
  <div class="navheader">
   <table width="100%" summary="Navigation header">
    <tr>
    <th colspan="3" align="center">Appendix B. Release Notes</th>
    </tr>
    <tr>
    <td width="20%" align="left"><a accesskey="p" href="options.html">Prev</a>&nbsp;</td>
    <th width="60%" align="center">&nbsp;</th>
    <td width="20%" align="right">&nbsp;</td>
    </tr>
   </table>
   <hr />
  </div><div class="appendix"> <div class="titlepage">  <div>   <div>    <h1 id="ch-release-notes" class="title" >Appendix B. Release Notes   </h1>  </div> </div></div><div class="toc"> <p><strong>Table of Contents</strong></p> <dl class="toc">  <dt> <span class="section">  <a href="release-notes.html#sec-release-25.05">Release 25.05 (“Warbler”, 2025.05/23)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-24.11">Release 24.11 (“Vicuña”, 2024.11/28)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-24.05">Release 24.05 (“Uakari”, 2024.05/31)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-23.11">Release 23.11 (“Tapir”, 2023.11/29)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-23.05">Release 23.05 (“Stoat”, 2023.05/31)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-22.11">Release 22.11 (“Raccoon”, 2022.11/30)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-22.05">Release 22.05 (“Quokka”, 2022.05/30)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-21.11">Release 21.11 (“Porcupine”, 2021/11/30)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-21.05">Release 21.05 (“Okapi”, 2021.05/31)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-20.09">Release 20.09 (“Nightingale”, 2020.10/27)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-20.03">Release 20.03 (“Markhor”, 2020.04/20)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-19.09">Release 19.09 (“Loris”, 2019/10/09)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-19.03">Release 19.03 (“Koi”, 2019/04/11)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-18.09">Release 18.09 (“Jellyfish”, 2018/10/05)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-18.03">Release 18.03 (“Impala”, 2018/04/04)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-17.09">Release 17.09 (“Hummingbird”, 2017/09/??)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-17.03">Release 17.03 (“Gorilla”, 2017/03/31)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-16.09">Release 16.09 (“Flounder”, 2016/09/30)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-16.03">Release 16.03 (“Emu”, 2016/03/31)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-15.09">Release 15.09 (“Dingo”, 2015/09/30)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-14.12">Release 14.12 (“Caterpillar”, 2014/12/30)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-14.04">Release 14.04 (“Baboon”, 2014/04/30)</a> </span></dt><dt> <span class="section">  <a href="release-notes.html#sec-release-13.10">Release 13.10 (“Aardvark”, 2013/10/31)</a> </span></dt> </dl></div><p>This section lists the release notes for each stable version of NixOS and current unstable revision.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-25.05" class="title" style="clear: both">Release 25.05 (“Warbler”, 2025.05/23)   </h2>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-25.05-highlights" class="title" >Highlights   </h3>  </div> </div></div><p>Alongside many enhancements to NixOS modules and general system improvements, this release features the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>NixOS now has initial support for the <a class="link" href="https://system76.com/cosmic"  target="_top"><span class="strong"><strong>COSMIC DE</strong></span></a> which is currently at <span class="strong"><strong>Alpha 7</strong></span>. COSMIC is a Rust-based Desktop Environment by System76, makers of Pop!_OS. You can use COSMIC by enabling the greeter (login manager) with <a class="xref" href="options.html#opt-services.displayManager.cosmic-greeter.enable"  ><code class="option">services.displayManager.cosmic-greeter.enable</code></a>, and the DE itself by enabling <a class="xref" href="options.html#opt-services.desktopManager.cosmic.enable"  ><code class="option">services.desktopManager.cosmic.enable</code></a>. The support in NixOS/Nixpkgs is stable but still considered experimental because of the recent the addition. The COSMIC maintainers will be waiting for one more release of NixOS to determine if the experimental tag should be removed or not. Until then, please report any issues to the <a class="link" href="https://github.com/NixOS/nixpkgs/issues/259641"  target="_top">COSMIC DE tracker in Nixpkgs</a> instead of upstream.</p></li><li class="listitem"><p><code class="literal">nixos-rebuild-ng</code>, a full rewrite of <code class="literal">nixos-rebuild</code> in Python, is available for testing. You can enable it by setting <a class="xref" href="options.html#opt-system.rebuild.enableNg"  ><code class="option">system.rebuild.enableNg</code></a> in your configuration (this will replace the old <code class="literal">nixos-rebuild</code>), or by adding <code class="literal">nixos-rebuild-ng</code> to your <code class="literal">environment.systemPackages</code> (in this case, it will live side-by-side with <code class="literal">nixos-rebuild</code> as <code class="literal">nixos-rebuild-ng</code>). It is expected that the next major version of NixOS (25.11) will enable <code class="literal">system.rebuild.enableNg</code> by default.</p></li><li class="listitem"><p>A <code class="literal">nixos-rebuild build-image</code> sub-command has been added.
It allows users to build platform-specific (disk) images from their NixOS configurations. <code class="literal">nixos-rebuild build-image</code> works similar to the popular <a class="link" href="https://github.com/nix-community/nixos-generators"  target="_top">nix-community/nixos-generators</a> project. See new <a class="link" href="index.html#sec-image-nixos-rebuild-build-image" title="Building Images with nixos-rebuild build-image" >section on image building in the NixOS manual</a>. It is also available for <code class="literal">nixos-rebuild-ng</code>.</p></li><li class="listitem"><p><code class="literal">nixos-option</code> has been rewritten to a Nix expression called by a simple bash script. This lowers our maintenance threshold, makes eval errors less verbose, adds support for flake-based configurations, descending into <code class="literal">attrsOf</code> and <code class="literal">listOf</code> submodule options, and <code class="literal">--show-trace</code>.</p></li><li class="listitem"><p>The global Mesa version can now be managed without a mass rebuild by setting <a class="xref" href="options.html#opt-hardware.graphics.package"  ><code class="option">hardware.graphics.package</code></a>.</p></li><li class="listitem"><p>GNOME has been updated to version 48.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">decibels</code> music player is now installed by default. You can disable it using <a class="xref" href="options.html#opt-environment.gnome.excludePackages"  ><code class="option">environment.gnome.excludePackages</code></a>.</p></li><li class="listitem"><p><code class="literal">gnome-shell-extensions</code> extension collection (which included GNOME Classic extensions, Apps Menu, and User Themes, among others) are no longer installed by default. You can install them again with <a class="xref" href="options.html#opt-services.xserver.desktopManager.gnome.sessionPath"  ><code class="option">services.xserver.desktopManager.gnome.sessionPath</code></a>.</p></li><li class="listitem"><p>Option <a class="xref" href="options.html#opt-services.gnome.core-developer-tools.enable"  ><code class="option">services.gnome.core-developer-tools.enable</code></a> now also installs <code class="literal">sysprof</code> and <code class="literal">d-spy</code>.</p></li><li class="listitem"><p>Option <code class="literal">services.gnome.core-utilities.enable</code> has been renamed to <a class="xref" href="options.html#opt-services.gnome.core-apps.enable"  ><code class="option">services.gnome.core-apps.enable</code></a>.</p></li><li class="listitem"><p><code class="literal">cantarell-fonts</code>, <code class="literal">source-code-pro</code> and <code class="literal">source-sans</code> fonts are no longer installed by default. They have been replaced by <code class="literal">adwaita-fonts</code>.</p></li></ul></div><p>Refer to the <a class="link" href="https://release.gnome.org/48/"  target="_top">GNOME release notes</a> for more details.</p></li><li class="listitem"><p><a class="link" href="https://channels.nixos.org"  target="_top">channels.nixos.org</a> now supports the Lockable HTTP Tarball Protocol. This allows using the channel <code class="literal">nixexprs.tar</code> as Nix Flake input, e.g.:</p><pre><code class="programlisting">inputs.nixpkgs.url = &quot;https://channels.nixos.org/nixos-25.05/nixexprs.tar.xz&quot;;
</code></pre></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-25.05-new-modules" class="title" >New Modules   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://amnezia.org/en"  target="_top">AmneziaVPN</a>, a self-hostable open-source VPN client, is available in two variants:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><a class="link" href="options.html#opt-programs.amnezia-vpn.enable"  >programs.amnezia-vpn</a>: a GUI client which can also deploy a VPN endpoint to a remote server</p></li><li class="listitem"><p><code class="option">networking.wireguard</code> adds support for the <a class="link" href="https://docs.amnezia.org/documentation/amnezia-wg/"  target="_top">AmneziaWG</a> variant of the protocol, featuring better masking against Deep Packet Inspection. The variant to be used is set per interface as <code class="literal">networking.wireguard.interfaces.&lt;name&gt;.type</code>, defaulting to wireguard.</p></li></ul></div></li><li class="listitem"><p><a class="link" href="https://github.com/Dygmalab/Bazecor"  target="_top">Bazecor</a>, the graphical configurator for Dygma Products. Available as <a class="link" href="options.html#opt-programs.bazecor.enable"  >programs.bazecor</a>.</p></li><li class="listitem"><p><a class="link" href="https://git.sr.ht/~stacyharper/bonsai"  target="_top">Bonsai</a>, a general-purpose event mapper/state machine primarily used to create complex key shortcuts, and as part of the <a class="link" href="https://sxmo.org/"  target="_top">SXMO</a> desktop environment. Available as <a class="link" href="options.html#opt-services.bonsaid.enable"  >services.bonsaid</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/sbs20/scanservjs/"  target="_top">scanservjs</a>, a web UI for SANE scanners. Available at <a class="link" href="options.html#opt-services.scanservjs.enable"  >services.scanservjs</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.kimai.org/"  target="_top">Kimai</a>, a web-based multi-user time-tracking application. Available as <a class="link" href="options.html#opt-services.kimai"  target="_top">services.kimai</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.kismetwireless.net/"  target="_top">Kismet</a>, a Wi-Fi, Bluetooth, and RF monitoring application supporting a wide range of hardware. Available as <a class="link" href="options.html#opt-services.kismet.enable"  >services.kismet</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/Raizo62/vwifi"  target="_top">vwifi</a>, a Wi-Fi simulator daemon leveraging the <code class="literal">mac80211_hwsim</code> and <code class="literal">vhost_vsock</code> kernel modules for efficient simulation of multi-node Wi-Fi networks. Available as <a class="link" href="options.html#opt-services.vwifi.client.enable"  >services.vwifi</a>.</p></li><li class="listitem"><p><a class="link" href="https://oncall.tools"  target="_top">Oncall</a>, a web-based calendar tool designed for scheduling and managing on-call shifts. Available as <a class="link" href="options.html#opt-services.oncall"  target="_top">services.oncall</a>.</p></li><li class="listitem"><p><a class="link" href="https://homer-demo.netlify.app/"  target="_top">Homer</a>, a very simple static homepage for your server. Available as <a class="link" href="options.html#opt-services.homer"  target="_top">services.homer</a>.</p></li><li class="listitem"><p><a class="link" href="https://ghidra-sre.org/"  target="_top">Ghidra</a>, a software reverse engineering (SRE) suite of tools. Available as <a class="link" href="options.html#opt-programs.ghidra"  target="_top">programs.ghidra</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/asciimoo/omnom"  target="_top">Omnom</a>, a webpage bookmarking and snapshotting service. Available as <a class="link" href="options.html#opt-services.omnom.enable"  target="_top">services.omnom</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/one-d-wide/yggdrasil-jumper"  target="_top">Yggdrasil-Jumper</a>, an independent project that aims to transparently reduce latency of a connection over Yggdrasil network, utilizing NAT traversal to automatically bypass intermediary nodes. Available as <a class="link" href="options.html#opt-services.yggdrasil-jumper.enable"  >services.yggdrasil-jumper</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/medusalix/xpad-noone"  target="_top">xpad-noone</a> is the original upstream xpad driver from the Linux kernel with support for Xbox One controllers removed — especially useful for people who want to use an XBox One controller under the <code class="literal">xone</code> driver and an Xbox 360 controller under the <code class="literal">xpad</code> driver at the same time. Available as <a class="link" href="options.html#hardware.xpad-noone"  target="_top">hardware.xpad-noone</a>.</p></li><li class="listitem"><p><a class="link" href="https://umurmur.net"  target="_top">uMurmur</a>, minimalistic Mumble server primarily targeted to run on embedded computers. Available as <a class="link" href="options.html#opt-services.umurmur"  target="_top">services.umurmur</a>.</p></li><li class="listitem"><p><a class="link" href="https://zenoh.io/"  target="_top">Zenoh</a>, a pub/sub/query protocol with low overhead. The Zenoh router daemon is available as <a class="link" href="options.html#opt-services.zenohd.enable"  target="_top">services.zenohd</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/jmbannon/ytdl-sub"  target="_top">ytdl-sub</a>, a tool that downloads media via yt-dlp and prepares it for your favorite media player, including Kodi, Jellyfin, Plex, Emby, and modern music players. Available as <a class="link" href="options.html#opt-services.ytdl-sub.instances"  target="_top">services.ytdl-sub</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/marytts/marytts"  target="_top">MaryTTS</a>, an open-source, multilingual text-to-speech synthesis system written in pure Java. Available as <a class="link" href="options.html#opt-services.marytts"  target="_top">services.marytts</a>.</p></li><li class="listitem"><p><a class="link" href="https://continuwuity.org/"  target="_top">Continuwuity</a>, a federated chat server implementing the Matrix protocol, forked from Conduwuit. Available as <a class="link" href="options.html#opt-services.matrix-continuwuity.enable"  >services.matrix-continuwuity</a>.</p></li><li class="listitem"><p><a class="link" href="https://reposilite.com"  target="_top">Reposilite</a>, a lightweight and easy-to-use repository manager for Maven-based artifacts in the JVM ecosystem. Available as <a class="link" href="options.html#opt-services.reposilite"  target="_top">services.reposilite</a>.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-networking.modemmanager"  target="_top">networking.modemmanager</a> has been split out of <a class="link" href="options.html#opt-networking.networkmanager"  target="_top">networking.networkmanager</a>. NetworkManager still enables ModemManager by default, but options exist now to run NetworkManager without ModemManager.</p></li><li class="listitem"><p><a class="link" href="https://nlnetlabs.nl/projects/routing/routinator/"  target="_top">Routinator 3000</a>, a full-featured RPKI Relying Party software package that runs as a service which periodically downloads and verifies RPKI data.</p></li><li class="listitem"><p><a class="link" href="https://github.com/m13253/dns-over-https"  target="_top">doh-server</a>, a high performance DNS over HTTPS server. Available as <a class="link" href="options.html#opt-services.doh-server.enable"  target="_top">services.doh-server</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/kalbasit/ncps"  target="_top">ncps</a>, a Nix binary cache proxy service implemented in Go using <a class="link" href="https://github.com/nix-community/go-nix"  target="_top">go-nix</a>. Available as <a class="link" href="options.html#opt-services.ncps.enable"  target="_top">services.ncps</a>.</p></li><li class="listitem"><p><a class="link" href="https://readeck.org/"  target="_top">Readeck</a>, a read-it later web-application. Available as <a class="link" href="options.html#opt-services.readeck.enable"  >services.readeck</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.traccar.org/"  target="_top">Traccar</a>, a modern GPS Tracking Platform. Available as <a class="link" href="options.html#opt-services.traccar.enable"  >services.traccar</a>.</p></li><li class="listitem"><p><a class="link" href="https://codeberg.org/shelter/reschroot"  target="_top">Schroot</a>, a lightweight virtualisation tool. Securely enter a chroot and run a command or login shell. Available as <a class="link" href="options.html#opt-programs.schroot.enable"  >programs.schroot</a>.</p></li><li class="listitem"><p><a class="link" href="https://firezone.dev"  target="_top">Firezone</a>, an enterprise-ready zero-trust access platform built on WireGuard. This includes the server stack as <a class="link" href="options.html#opt-services.firezone.server.enable"  >services.firezone.server.enable</a>, a TURN/STUN relay service as <a class="link" href="options.html#opt-services.firezone.relay.enable"  >services.firezone.relay.enable</a>, a gateway service as <a class="link" href="options.html#opt-services.firezone.gateway.enable"  >services.firezone.gateway.enable</a>, a headless client as <a class="link" href="options.html#opt-services.firezone.headless-client.enable"  >services.firezone.headless-client.enable</a> and a GUI client as <a class="link" href="options.html#opt-services.firezone.gui-client.enable"  >services.firezone.gui-client.enable</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/LuckyTurtleDev/crab-hole"  target="_top">crab-hole</a>, a cross platform Pi-hole clone written in Rust using hickory-dns/trust-dns. Available as <a class="link" href="options.html#opt-services.crab-hole.enable"  >services.crab-hole</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/krtab/agnos"  target="_top">agnos</a>, a program that obtains TLS certificates from an ACME provider via the DNS-01 challenge without using third-party DNS provider APIs. Available as <a class="link" href="options.html#opt-security.agnos.enable"  >security.agnos</a>.</p></li><li class="listitem"><p><a class="link" href="https://zwave-js.github.io/zwave-js-ui/"  target="_top">zwave-js-ui</a>, a full featured Z-Wave Control Panel and MQTT Gateway. Available as <a class="link" href="options.html#opt-services.zwave-js-ui.enable"  >services.zwave-js-ui</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/kieraneglin/pinchflat"  target="_top">Pinchflat</a>, a selfhosted YouTube media manager used to track channels and download videos on release. Available as <a class="link" href="options.html#opt-services.pinchflat.enable"  >services.pinchflat</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/aws/amazon-cloudwatch-agent"  target="_top">Amazon CloudWatch Agent</a>, the official telemetry collector for AWS CloudWatch and AWS X-Ray. Available as <a class="link" href="options.html#opt-services.amazon-cloudwatch-agent.enable"  target="_top">services.amazon-cloudwatch-agent</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/fluent/fluent-bit"  target="_top">Fluent Bit</a>, a fast Log, Metrics and Traces Processor and Forwarder. Available as <a class="link" href="options.html#opt-services.fluent-bit.enable"  >services.fluent-bit</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/sharkdp/bat"  target="_top">Bat</a>, a <a class="link" href="https://www.gnu.org/software/coreutils/manual/html_node/cat-invocation.html" target="_top"><span class="citerefentry"><span class="refentrytitle">cat</span>(1)</span></a> clone with wings. Available as <a class="link" href="options.html#opt-programs.bat"  target="_top">programs.bat</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/45Drives/autotier"  target="_top">Autotier</a>, a passthrough FUSE filesystem. Available as <a class="link" href="options.html#opt-services.autotierfs.enable"  target="_top">services.autotierfs</a>.</p></li><li class="listitem"><p><a class="link" href="https://postgrest.org"  target="_top">PostgREST</a>, a standalone web server that turns your PostgreSQL database directly into a RESTful API. Available as <a class="link" href="options.html#opt-services.postgrest.enable"  target="_top">services.postgrest</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/diogob/postgres-websockets"  target="_top">postgres-websockets</a>, a middleware that adds websockets capabilities on top of PostgreSQL’s asynchronous notifications using LISTEN and NOTIFY commands. Available as <a class="link" href="options.html#opt-services.postgres-websockets.enable"  target="_top">services.postgres-websockets</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/pikvm/ustreamer"  target="_top">µStreamer</a>, a lightweight MJPEG-HTTP streamer. Available as <a class="link" href="options.html#opt-services.ustreamer"  target="_top">services.ustreamer</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/benbusby/whoogle-search"  target="_top">Whoogle Search</a>, a self-hosted, ad-free, privacy-respecting metasearch engine. Available as <a class="link" href="options.html#opt-services.whoogle-search.enable"  target="_top">services.whoogle-search</a>.</p></li><li class="listitem"><p><a class="link" href="https://autobrr.com"  target="_top">autobrr</a>, a modern download automation tool for torrents and usenets. Available as <a class="link" href="options.html#opt-services.autobrr.enable"  >services.autobrr</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.cross-seed.org"  target="_top">cross-seed</a>, a tool to set-up fully automatic cross-seeding of torrents. Available as <a class="link" href="options.html#opt-services.cross-seed.enable"  >services.cross-seed</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/okfde/froide-govplan"  target="_top">Froide-Govplan</a>, a web application government planer. Available as <a class="link" href="options.html#opt-services.froide-govplan.enable"  >services.froide-govplan</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/agorakit/agorakit"  target="_top">agorakit</a>, an organization tool for citizens’ collectives. Available with <a class="link" href="options.html#opt-services.agorakit.enable"  target="_top">services.agorakit</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/sharkdp/vivid"  target="_top">vivid</a>, a generator for <code class="literal">LS_COLOR</code>. Available as <a class="link" href="options.html#opt-programs.vivid.enable"  >programs.vivid</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/jaywink/matrix-alertmanager"  target="_top">matrix-alertmanager</a>, a bot to receive Alertmanager webhook events and forward them to chosen Matrix rooms. Available as <a class="link" href="options.html#opt-services.matrix-alertmanager.enable"  target="_top">services.matrix-alertmanager</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/Azure/WALinuxAgent"  target="_top">waagent</a>, the Microsoft Azure Linux Agent (waagent) manages Linux provisioning and VM interaction with the Azure Fabric Controller. Available with <a class="link" href="options.html#opt-services.waagent.enable"  target="_top">services.waagent</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/StarGate01/ifdnfc-nci"  target="_top">nfc-nci</a>, an alternative NFC stack and PC/SC driver for the NXP PN54x chipset, commonly found in Lenovo systems as NXP1001 (NPC300). Available as <a class="link" href="options.html#opt-hardware.nfc-nci.enable"  >hardware.nfc-nci</a>.</p></li><li class="listitem"><p><a class="link" href="https://getgrav.org/"  target="_top">grav</a>, a modern flat-file CMS. Available with <a class="link" href="options.html#opt-services.grav.enable"  target="_top">services.grav</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.duckdns.org"  target="_top">duckdns</a>, free dynamic DNS. Available with <a class="link" href="options.html#opt-services.duckdns.enable"  target="_top">services.duckdns</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/ajeetdsouza/zoxide"  target="_top">Zoxide</a>, a smarter cd command, inspired by z and autojump. Available as <a class="link" href="options.html#opt-programs.zoxide.enable"  target="_top">programs.zoxide</a>.</p></li><li class="listitem"><p><a class="link" href="https://docs.victoriametrics.com/victorialogs/"  target="_top">victorialogs</a>, log database from VictoriaMetrics. Available as <a class="link" href="options.html#opt-services.victorialogs.enable"  >services.victorialogs</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/Forceu/Gokapi"  target="_top">gokapi</a>, Lightweight selfhosted Firefox Send alternative without public upload. AWS S3 supported. Available with <a class="link" href="options.html#opt-services.gokapi.enable"  target="_top">services.gokapi</a>.</p></li><li class="listitem"><p><a class="link" href="https://git.sr.ht/~gheartsfield/nostr-rs-relay/"  target="_top">nostr-rs-relay</a>, This is a nostr relay, written in Rust. Available as <a class="link" href="options.html#opt-services.nostr-rs-relay.enable"  target="_top">services.nostr-rs-relay</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/bitvora/haven"  target="_top">haven</a>, is a high availability vault for events on nostr. Available as <a class="link" href="options.html#opt-services.haven.enable"  target="_top">services.haven</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/hoytech/strfry"  target="_top">strfry</a>, a relay for the nostr protocol. Available as <a class="link" href="options.html#opt-services.strfry.enable"  target="_top">services.strfry</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/amimof/node-cert-exporter"  target="_top">Prometheus Node Cert Exporter</a>, a prometheus exporter to check for SSL cert expiry. Available as <a class="link" href="options.html#opt-services.prometheus.exporters.node-cert.enable"  >services.prometheus.exporters.node-cert</a>.</p></li><li class="listitem"><p><a class="link" href="https://actualbudget.org/"  target="_top">Actual Budget</a>, a local-first personal finance app. Available as <a class="link" href="options.html#opt-services.actual.enable"  >services.actual</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/alangrainger/immich-public-proxy"  target="_top">immich-public-proxy</a>, a proxy for sharing Immich albums without exposing the Immich API. Available as <a class="link" href="options.html#opt-services.immich-public-proxy.enable"  >services.immich-public-proxy</a>.</p></li><li class="listitem"><p><a class="link" href="https://zipline.diced.sh/"  target="_top">Zipline</a>, a ShareX/file upload server that is easy to use, packed with features, and with an easy setup. Available as <a class="link" href="options.html#opt-services.zipline.enable"  >services.zipline</a>.</p></li><li class="listitem"><p><a class="link" href="https://glitchtip.com/"  target="_top">GlitchTip</a>, an open source Sentry API compatible error tracking platform. Available as <a class="link" href="options.html#opt-services.glitchtip.enable"  >services.glitchtip</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/nkanaev/yarr"  target="_top"><code class="literal">yarr</code></a>, a small, web-based feed aggregator and RSS reader. Available as <a class="link" href="options.html#opt-services.yarr.enable"  >services.yarr</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.olivetin.app/"  target="_top">OliveTin</a>, gives safe and simple access to predefined shell commands from a web interface. Available as <a class="link" href="options.html#opt-services.olivetin.enable"  >services.olivetin</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/alexbakker/alertmanager-ntfy"  target="_top">alertmanager-ntfy</a>, forwards Prometheus Alertmanager notifications to ntfy.sh. Available as <a class="link" href="options.html#opt-services.prometheus.alertmanager-ntfy.enable"  >services.prometheus.alertmanager-ntfy</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/stashapp/stash"  target="_top">Stash</a>, an organizer for your adult videos/images, written in Go. Available as <a class="link" href="options.html#opt-services.stash.enable"  >services.stash</a>.</p></li><li class="listitem"><p><a class="link" href="https://frankmorgner.github.io/vsmartcard/virtualsmartcard/README.html"  target="_top">vsmartcard-vpcd</a>, a virtual smart card driver. Available as <a class="link" href="options.html#opt-services.vsmartcard-vpcd.enable"  >services.vsmartcard-vpcd</a>.</p></li><li class="listitem"><p><a class="link" href="https://fider.io/"  target="_top">Fider</a>, an open platform to collect and prioritize feedback. Available as <a class="link" href="options.html#opt-services.fider.enable"  >services.fider</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/bluesky-social/pds"  target="_top">PDS</a>, Personal Data Server for <a class="link" href="https://bsky.social/"  target="_top">bsky</a>. Available as <a class="link" href="option.html#opt-services.pds"  target="_top">services.pds</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/TecharoHQ/anubis"  target="_top">Anubis</a>, a scraper defense software. Available as <a class="link" href="options.html#opt-services.anubis"  target="_top">services.anubis</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/matrix-org/rust-synapse-compress-state?tab=readme-ov-file#automated-tool-synapse_auto_compressor"  target="_top">synapse-auto-compressor</a>, a rust-based matrix-synapse state compressor for postgresql. Available as <a class="link" href="options.html#opt-services.synapse-auto-compressor.enable"  >services.synapse-auto-compressor</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/kpetremann/mqtt-exporter/"  target="_top">mqtt-exporter</a>, a Prometheus exporter for exposing messages from MQTT. Available as <a class="link" href="options.html#opt-services.prometheus.exporters.mqtt.enable"  >services.prometheus.exporters.mqtt</a>.</p></li><li class="listitem"><p><a class="link" href="https://pocket-id.org/"  target="_top">pocket-id</a>, an OIDC provider with passkeys support. Available as <a class="link" href="options.html#opt-services.pocket-id.enable"  >services.pocket-id</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/utkuozdemir/nvidia_gpu_exporter"  target="_top">nvidia-gpu</a>, a Prometheus exporter that scrapes <code class="literal">nvidia-smi</code> for GPU metrics. Available as <a class="link" href="options.html#opt-services.prometheus.exporters.nvidia-gpu.enable"  >services.prometheus.exporters.nvidia-gpu</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/lavalink-devs/Lavalink"  target="_top">Lavalink</a>, a standalone audio sending node based on Lavaplayer and Koe. Available as <a class="link" href="options.html#opt-services.lavalink.enable"  >services.lavalink</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/ShadowBlip/OpenGamepadUI/"  target="_top">OpenGamepadUI</a>, an open source gamepad-native game launcher and overlay for Linux. Available as <a class="link" href="options.html#opt-programs.opengamepadui.enable"  >programs.opengamepadui</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/ShadowBlip/InputPlumber/"  target="_top">InputPlumber</a>, an open source input router and remapper daemon for Linux. Available as <a class="link" href="options.html#opt-services.inputplumber.enable"  >services.inputplumber</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/flightaware/dump1090"  target="_top"><code class="literal">dump1090-fa</code></a>, a simple Mode S decoder for RTLSDR devices with a web interface. Available as <a class="link" href="options.html#opt-services.dump1090-fa.enable"  >services.dump1090-fa</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/ShadowBlip/PowerStation/"  target="_top">PowerStation</a>, an open source TDP control and performance daemon with DBus interface for Linux. Available as <a class="link" href="options.html#opt-services.powerstation.enable"  >services.powerstation</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/bytedance/g3"  target="_top"><code class="literal">g3proxy</code></a>, an open source enterprise forward proxy from ByteDance, similar to Squid or tinyproxy. Available as <a class="link" href="options.html#opt-services.g3proxy.enable"  >services.g3proxy</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/mpolden/echoip"  target="_top">echoip</a>, a simple service for looking up your IP address. Available as <a class="link" href="options.html#opt-services.echoip.enable"  >services.echoip</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/traefik/whoami"  target="_top">whoami</a>, a tiny Go server that prints OS information and HTTP request to output. Available as <a class="link" href="options.html#opt-services.whoami.enable"  >services.whoami</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/BerriAI/litellm"  target="_top">LiteLLM</a>, a LLM Gateway to provide model access, fallbacks and spend tracking across 100+ LLMs. All in the OpenAI format. Available as <a class="link" href="options.html#opt-services.litellm.enable"  >services.litellm</a>.</p></li><li class="listitem"><p><a class="link" href="https://gitlab.postmarketos.org/postmarketOS/buffybox/-/tree/master/buffyboard"  target="_top">Buffyboard</a>, a framebuffer on-screen keyboard. Available as <a class="link" href="option.html#opt-services.buffyboard"  target="_top">services.buffyboard</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/kanboard/kanboard"  target="_top">KanBoard</a>, a project management tool that focuses on the Kanban methodology. Available as <a class="link" href="options.html#opt-services.kanboard.enable"  >services.kanboard</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/mateusauler/git-worktree-switcher"  target="_top">git-worktree-switcher</a>, switch between git worktrees with speed. Available as <a class="link" href="options.html#opt-programs.git-worktree-switcher.enable"  >programs.git-worktree-switcher</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/glpi-project/glpi-agent"  target="_top">GLPI-Agent</a>, GLPI Agent. Available as <a class="link" href="options.html#opt-services.glpiAgent.enable"  target="_top">services.glpiAgent</a>.</p></li><li class="listitem"><p><a class="link" href="https://pgbackrest.org"  target="_top">pgBackRest</a>, a reliable backup and restore solution for PostgreSQL. Available as <a class="link" href="options.html#opt-services.pgbackrest.enable"  target="_top">services.pgbackrest</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/recyclarr/recyclarr"  target="_top">Recyclarr</a> a TRaSH Guides synchronizer for Sonarr and Radarr. Available as <a class="link" href="options.html#opt-services.recyclarr.enable"  >services.recyclarr</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/kpcyrd/rebuilderd"  target="_top">Rebuilderd</a> an independent verification of binary packages - Reproducible Builds. Available as <a class="link" href="options.html#opt-services.rebuilderd.enable"  >services.rebuilderd</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/limine-bootloader/limine"  target="_top">Limine</a> a modern, advanced, portable, multiprotocol bootloader and boot manager. Available as <a class="link" href="options.html#opt-boot.loader.limine.enable"  >boot.loader.limine</a>.</p></li><li class="listitem"><p><a class="link" href="https://orthanc.uclouvain.be/"  target="_top">Orthanc</a> a lightweight, RESTful DICOM server for healthcare and medical research. Available as <a class="link" href="options.html#opt-services.orthanc.enable"  >services.orthanc</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/docling-project/docling-serve"  target="_top">Docling Serve</a> running <a class="link" href="https://github.com/docling-project/docling"  target="_top">Docling</a> as an API service. Available as <a class="link" href="options.html#opt-services.docling-serve.enable"  >services.docling-serve</a>.</p></li><li class="listitem"><p><a class="link" href="https://paretosecurity.com/"  target="_top">Pareto Security</a> is an alternative to corporate compliance solutions for companies that care about security but know it doesn’t have to be invasive. Available as <a class="link" href="options.html#opt-services.paretosecurity.enable"  >services.paretosecurity</a>.</p></li><li class="listitem"><p><a class="link" href="https://gnu.org/software/rush/"  target="_top">GNU Rush</a> is a Restricted User Shell, designed for systems providing limited remote access to their resources. Available as <a class="link" href="options.html#opt-programs.rush.enable"  >programs.rush</a>.</p></li><li class="listitem"><p><a class="link" href="https://ipfscluster.io/"  target="_top">ipfs-cluster</a>, Pinset orchestration for IPFS. Available as <a class="link" href="options.html#opt-services.ipfs-cluster.enable"  >services.ipfs-cluster</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/BitBoxSwiss/bitbox-bridge"  target="_top">bitbox-bridge</a>, a bridge software that connects BitBox hardware wallets to computers &amp; web wallets like <a class="link" href="https://rabby.io/"  target="_top">Rabby</a>. Allows one to interact &amp; transact with smart contracts, Web3 websites &amp; financial services without storing private keys anywhere other than the hardware wallet. Available as <a class="link" href="options.html#opt-services.bitbox-bridge.enable"  >services.bitbox-bridge</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/TimothyYe/godns"  target="_top">GoDNS</a>, a dynamic DNS client written in Go, which supports multiple DNS providers. Available as <a class="link" href="option.html#opt-services.godns.enable"  target="_top">services.godns</a>.</p></li><li class="listitem"><p><a class="link" href="https://cooklang.org/cli/"  target="_top">CookCLI</a> Server, a web UI for cooklang recipes. Available as <a class="link" href="options.html#opt-services.cook-cli.enable"  >services.cook-cli</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/cloudflare/ebpf_exporter"  target="_top">Prometheus eBPF Exporter</a>,
Prometheus exporter for custom eBPF metrics. Available as
<a class="link" href="options.html#opt-services.prometheus.exporters.ebpf.enable"  >services.prometheus.exporters.ebpf</a>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-25.05-incompatibilities" class="title" >Backward Incompatibilities   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">services.rippled</code> has been removed, as <code class="literal">rippled</code> was broken and had not been updated since 2022.</p></li><li class="listitem"><p><code class="literal">services.rippleDataApi</code> has been removed, as <code class="literal">ripple-data-api</code> was broken and had not been updated since 2022.</p></li><li class="listitem"><p>The <code class="literal">nixos/modules/virtualisation/amazon-ec2-amis.nix</code> file is not supported anymore since 24.05. It will throw
and error starting 25.05 with instructions the following instructions:
The canonical source for NixOS AMIs is the AWS API. Please see https://nixos.org/download/#nixos-amazon or  https://nixos.github.io/amis/ for instructions.</p></li><li class="listitem"><p>The latest available version of Nextcloud is v31 (available as <code class="literal">pkgs.nextcloud31</code>). The installation logic is as follows:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>If <a class="link" href="options.html#opt-services.nextcloud.package"  ><code class="literal">services.nextcloud.package</code></a> is specified explicitly, this package will be installed (<span class="strong"><strong>recommended</strong></span>)</p></li><li class="listitem"><p>If <a class="link" href="options.html#opt-system.stateVersion"  ><code class="literal">system.stateVersion</code></a> is &gt;=24.11, <code class="literal">pkgs.nextcloud30</code> will be installed by default.</p></li><li class="listitem"><p>If <a class="link" href="options.html#opt-system.stateVersion"  ><code class="literal">system.stateVersion</code></a> is &gt;=24.05, <code class="literal">pkgs.nextcloud31</code> will be installed by default.</p></li><li class="listitem"><p>Please note that an upgrade from v29 (or older) to v31 directly is not possible. Please upgrade to <code class="literal">nextcloud30</code> (or earlier) first. Nextcloud prohibits skipping major versions while upgrading. You can upgrade by declaring <a class="link" href="options.html#opt-services.nextcloud.package"  target="_top"><code class="literal">services.nextcloud.package = pkgs.nextcloud30;</code></a>.</p></li></ul></div></li><li class="listitem"><p><code class="literal">services.cloudflare-dyndns.apiTokenFile</code> now must be just your Cloudflare api token. Previously it was supposed to be a file of the form <code class="literal">CLOUDFLARE_API_TOKEN=...</code>.</p></li><li class="listitem"><p><a class="xref" href="options.html#opt-services.nextcloud.config.dbtype"  ><code class="option">services.nextcloud.config.dbtype</code></a> is unset by default, the previous default was <code class="literal">sqlite</code>.
This was done because <code class="literal">sqlite</code> is not a reasonable default since it’s
<a class="link" href="https://docs.nextcloud.com/server/30/admin_manual/installation/system_requirements.html"  target="_top">not recommended by upstream</a>
and thus doesn’t qualify as default.</p></li><li class="listitem"><p>PowerDNS Recursor has been updated to version 5.1.2, which comes with a new YAML configuration format (<code class="literal">recursor.yml</code>)
and deprecates the previous format (<code class="literal">recursor.conf</code>). Accordingly, the NixOS option <code class="literal">services.pdns-recursor.settings</code>
has been renamed to <a class="link" href="options.html#opt-services.pdns-recursor.old-settings"  >old-settings</a> and will be provided for backward compatibility
until the next NixOS release. Users are asked to migrate their settings to the new <a class="link" href="options.html#opt-services.pdns-recursor.old-settings"  >yaml-settings</a>
option following this <a class="link" href="https://doc.powerdns.com/recursor/appendices/yamlconversion.html"  target="_top">guide</a>.
Note that options other than <code class="literal">services.pdns-recursor.settings</code> are unaffacted by this change.</p></li><li class="listitem"><p>The <code class="literal">virtualisation.hypervGuest.videoMode</code> option has been removed. Standard tooling can now be used to configure display modes for Hyper-V VMs.</p></li><li class="listitem"><p>Nextcloud’s default FPM pool settings have been increased according to upstream recommentations. It’s advised
to review the new defaults and description of
<a class="xref" href="options.html#opt-services.nextcloud.poolSettings"  ><code class="option">services.nextcloud.poolSettings</code></a>.</p></li><li class="listitem"><p>In <code class="literal">users.users</code> subuid allocation on systems with multiple users it could happen that some users’ allocated subuid ranges collided with others. Now these users get new subuid ranges assigned. When this happens, a warning is issued on the first activation. If the subuids were used (e.g. with rootless container managers like podman), please change the ownership of affected files accordingly.</p></li><li class="listitem"><p>The <code class="literal">services.locate</code> module does no longer support findutil’s <code class="literal">locate</code> due to its inferior performance compared to <code class="literal">mlocate</code> and <code class="literal">plocate</code>. The new default is <code class="literal">plocate</code>.
As the <code class="literal">service.locate.localuser</code> option only applied when using findutil’s <code class="literal">locate</code>, it has also been removed.</p></li><li class="listitem"><p><code class="literal">services.paperless</code> now installs <code class="literal">paperless-manage</code> as a normal system package instead of creating a symlink in <code class="literal">/var/lib/paperless</code>.
<code class="literal">paperless-manage</code> now also changes to the appropriate user when being executed.</p></li><li class="listitem"><p><code class="literal">asusd</code> has been upgraded to version 6 which supports multiple aura devices. To account for this, the single <code class="literal">auraConfig</code> configuration option has been replaced with <code class="literal">auraConfigs</code> which is an attribute set of config options per each device. The config files may also be now specified as either source files or text strings; to account for this you will need to specify that <code class="literal">text</code> is used for your existing configs, e.g.:</p><pre><code class="programlisting diff">-services.asusd.asusdConfig = &#x27;&#x27;&#x27;file contents&#x27;&#x27;&#x27;
+services.asusd.asusdConfig.text = &#x27;&#x27;&#x27;file contents&#x27;&#x27;&#x27;
</code></pre></li><li class="listitem"><p><code class="literal">linuxPackages.nvidiaPackages.stable</code> now defaults to the <code class="literal">production</code> variant instead of <code class="literal">latest</code>.</p></li><li class="listitem"><p><code class="literal">services.paperless.address</code> no longer accepts a domain name or Unix domain socket.</p></li><li class="listitem"><p><code class="literal">networking.wireguard.enable = true</code> does not always add <code class="literal">wireguard-tools</code> to system packages anymore. Only when wireguard interfaces are configured, the backing implementation packages are added to system PATH.</p></li><li class="listitem"><p><code class="literal">virtualisation/azure-common.nix</code>’s filesystem and grub configurations have been moved to <code class="literal">virtualisation/azure-image.nix</code>. This makes <code class="literal">azure-common.nix</code> more generic so it could be used for users who generate Azure image using other methods (e.g. nixos-generators and disko). For existing users depending on these configurations, please also import <code class="literal">azure-image.nix</code>.</p></li><li class="listitem"><p><code class="literal">services.signald</code> has been removed as <code class="literal">signald</code> is unmaintained upstream and has been incompatible to official Signal servers for a long while.</p></li><li class="listitem"><p>The <code class="literal">earlyoom</code> service is now using upstream systemd service, which enables
hardening and filesystem isolation by default. If you need filesystem write
access or want to access home directory via <code class="literal">killHook</code>, hardening setting can
be changed via, e.g. <code class="literal">systemd.services.earlyoom.serviceConfig.ProtectSystem</code>.</p><p><code class="literal">services.earlyoom.extraArgs</code> is now shell-escaped for each element without
word-breaking. So you want to write <code class="literal">extraArgs = [ &quot;--prefer&quot; &quot;spaced pat&quot; ]</code>
rather than previous <code class="literal">extraArgs = [ &quot;--prefer &#x27;spaced pat&#x27;&quot; ]</code>.</p></li><li class="listitem"><p><code class="literal">programs.less.lessopen</code> is now null by default. To restore the previous behaviour, set it to <code class="literal">&#x27;&#x27;|${lib.getExe&#x27; pkgs.lesspipe &quot;lesspipe.sh&quot;} %s&#x27;&#x27;</code>.</p></li><li class="listitem"><p><code class="literal">hardware.pulseaudio</code> has been renamed to <code class="literal">services.pulseaudio</code>.  The deprecated option names will continue to work, but causes a warning.</p></li><li class="listitem"><p><code class="literal">services.nextcloud</code> now uses systemd’s credential mechanism to read in secret files. The <code class="literal">nextcloud-occ</code> wrapper script implements this using <code class="literal">systemd-run</code>, as such it now also requires root privileges or <code class="literal">$CREDENTIALS_DIRECTORY</code> set where running it as user <code class="literal">nextcloud</code> was enough previously.</p></li><li class="listitem"><p><code class="literal">services.mongodb.initialRootPassword</code> has been replaced with the more secure option <a class="link" href="options.html#opt-services.mongodb.initialRootPasswordFile"  ><code class="literal">services.mongodb.initialRootPasswordFile</code></a></p></li><li class="listitem"><p><code class="literal">services.bird2</code> has been renamed to <code class="literal">services.bird</code> and the default bird package has been switched to <code class="literal">bird3</code>. <code class="literal">bird2</code> can still be chosen via the <code class="literal">services.bird.package</code> option.</p></li><li class="listitem"><p>The behavior of the <code class="literal">networking.nat.externalIP</code> and <code class="literal">networking.nat.externalIPv6</code> options has been changed. <code class="literal">networking.nat.forwardPorts</code> now only forwards packets destined for the specified IP addresses.</p></li><li class="listitem"><p><code class="literal">gitlab</code> has been updated from 17.x to 18.x and requires <code class="literal">postgresql</code> &gt;= 16, as stated in the <a class="link" href="https://docs.gitlab.com/18.0/install/requirements/#postgresql"  target="_top">documentation</a>. Check the <a class="link" href="index.html#module-services-postgres-upgrading" title="Upgrading" >upgrade guide</a> in the NixOS manual on how to upgrade your PostgreSQL installation.</p></li><li class="listitem"><p><code class="literal">services.gitlab</code> now requires the setting of <code class="literal">activeRecordPrimaryKeyFile</code>, <code class="literal">activeRecordDeterministicKeyFile</code>, <code class="literal">activeRecordSaltFile</code> as GitLab introduced Rails ActiveRecord encryption.</p></li><li class="listitem"><p>The Mattermost module (<a class="link" href="options.html#opt-services.mattermost.enable"  ><code class="literal">services.mattermost</code></a>) and packages (<code class="literal">mattermost</code> and <code class="literal">mmctl</code>) have been substantially updated:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">services.mattermost.listenAddress</code> has been split into <a class="xref" href="options.html#opt-services.mattermost.host"  ><code class="option">services.mattermost.host</code></a> and <a class="xref" href="options.html#opt-services.mattermost.port"  ><code class="option">services.mattermost.port</code></a>. If your <code class="literal">listenAddress</code> contained a port, you will need to edit your configuration. This will be the only truly breaking change in this release for most configurations.</p></li><li class="listitem"><p><a class="xref" href="options.html#opt-services.mattermost.preferNixConfig"  ><code class="option">services.mattermost.preferNixConfig</code></a> now defaults to true if you advance <a class="xref" href="options.html#opt-system.stateVersion"  ><code class="option">system.stateVersion</code></a> to 25.05. This means that if you have <a class="xref" href="options.html#opt-services.mattermost.mutableConfig"  ><code class="option">services.mattermost.mutableConfig</code></a> set, NixOS will override settings set in the Admin Console to those that you define in the module configuration. It is recommended to leave this at the default, even if you used a fully mutable configuration before, because it will ensure that your Mattermost data directories are correct. If you moved your data directories, you may want to review the module changes before upgrading.</p></li><li class="listitem"><p>Mattermost now supports peer authentication on both MySQL and Postgres database backends. Updating <a class="xref" href="options.html#opt-system.stateVersion"  ><code class="option">system.stateVersion</code></a> to 25.05 or later will result in peer authentication being used by default if the Mattermost server would otherwise be connecting to localhost. This is the recommended configuration.</p></li><li class="listitem"><p>Note that the Mattermost module will create an account <span class="emphasis"><em>without</em></span> a well-known UID if the username differs from the default (<code class="literal">mattermost</code>). If you used Mattermost with a nonstandard username, you may want to review the module changes before upgrading.</p></li></ul></div></li><li class="listitem"><p>DokuWiki with the Caddy webserver (<code class="literal">services.dokuwiki.webserver = &quot;caddy&quot;</code>) now sets up sites with Caddy’s automatic HTTPS instead of HTTP-only.
To keep the old behavior for a site <code class="literal">example.com</code>, set <code class="literal">services.caddy.virtualHosts.&quot;example.com&quot;.hostName = &quot;http://example.com&quot;</code>.
If you set custom Caddy options for a DokuWiki site, migrate these options by removing <code class="literal">http://</code> from <code class="literal">services.caddy.virtualHosts.&quot;http://example.com&quot;</code>.</p></li><li class="listitem"><p>Wordpress with the Caddy webserver (<code class="literal">services.wordpress.webserver = &quot;caddy&quot;</code>) now sets up sites with Caddy’s automatic HTTPS instead of HTTP-only.
Given a site example.com, http://example.com now 301 redirects to https://example.com.
To keep the old behavior for a site <code class="literal">example.com</code>, set <code class="literal">services.caddy.virtualHosts.&quot;example.com&quot;.hostName = &quot;http://example.com&quot;</code>.</p></li><li class="listitem"><p>The behavior of <code class="literal">services.hostapd.radios.&lt;name&gt;.networks.&lt;name&gt;.authentication.enableRecommendedPairwiseCiphers</code> was changed to not include <code class="literal">CCMP-256</code> anymore.
Since all configured pairwise ciphers have to be supported by the radio, this caused startup failures on many devices which is hard to debug in hostapd.</p></li><li class="listitem"><p>The <code class="literal">hardware.gkraken</code> module has been removed. The recommended alternative is <a class="link" href="options.html#opt-programs.coolercontrol.enable"  ><code class="literal">programs.coolercontrol</code></a>.</p></li><li class="listitem"><p>To avoid delaying user logins unnecessarily the <code class="literal">multi-user.target</code> is no longer ordered after <code class="literal">network-online.target</code>.
System services requiring a connection to start correctly must explicitly state so, i.e.</p><pre><code class="programlisting nix">systemd.services.&lt;name&gt; = {
  wants = [ &quot;network-online.target&quot; ];
  after = [ &quot;network-online.target&quot; ];
};
</code></pre><p>This changed follows a deprecation period of one year started in NixOS 24.05 (see <a class="link" href="https://github.com/NixOS/nixpkgs/pull/283818"  target="_top">PR #283818</a>).</p></li><li class="listitem"><p>The values of <code class="literal">services.borgbackup.jobs.*.extraArgs</code> and other <code class="literal">extra*Args</code> options are now represented as Bash arrays. If these arguments were modified using <code class="literal">services.borgbackup.jobs.*.preHook</code>, they will need to be adjusted to append to these arrays, i.e.</p><pre><code class="programlisting diff">-extraCreateArgs=&quot;$extraCreateArgs --exclude /some/path&quot;
+extraCreateArgs+=(&quot;--exclude&quot; &quot;/some/path&quot;)
</code></pre></li><li class="listitem"><p><code class="literal">programs.xonsh.package</code> now gets overridden internally with <code class="literal">extraPackages</code> to support <code class="literal">programs.xonsh.extraPackages</code>. See <code class="literal">programs.xonsh.extraPackages</code> for more details.</p></li><li class="listitem"><p><code class="literal">services.nitter.guestAccounts</code> has been renamed to <code class="literal">services.nitter.sessionsFile</code>, for consistency with upstream. The file format is unchanged.</p></li><li class="listitem"><p><code class="literal">virtualisation.azure.agent</code> option provided by <code class="literal">azure-agent.nix</code> is replaced by <code class="literal">services.waagent</code>, and will be removed in a future release.</p></li><li class="listitem"><p>The ZFS import service now respects <code class="literal">fileSystems.*.options = [ &quot;noauto&quot; ];</code> and does not add that pool’s import service to <code class="literal">zfs-import.target</code>, meaning it will not be automatically imported at boot.</p></li><li class="listitem"><p>Default file names of images generated by several builders in <code class="literal">system.build</code> have been changed as outlined in the table below.</p><p>Names are now known at evaluation time and customizable via the new options <code class="literal">image.baseName</code>, <code class="literal">image.extension</code>, <code class="literal">image.fileName</code> and <code class="literal">image.filePath</code> with the latter returning a path relative to the derivations out path (e.g. <code class="literal">iso/${image.fileName</code> for iso images).</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col align="left" /><col align="left" /><col align="left" /></colgroup><thead><tr><th align="left"><code class="literal">system.build</code> Option</th><th align="left">Old Filename</th><th align="left">New Filename</th></tr></thead><tbody><tr><td align="left">amazonImage</td><td align="left">nixos-amazon-image-25.05pre-git-x86_64-linux.vhd</td><td align="left">nixos-image-amazon-25.05pre-git-x86_64-linux.vhd</td></tr><tr><td align="left">azureImage</td><td align="left">disk.vhd</td><td align="left">nixos-image-azure-25.05pre-git-x86_64-linux.vhd</td></tr><tr><td align="left">digitalOceanImage</td><td align="left">nixos.qcow2.gz</td><td align="left">nixos-image-digital-ocean-25.05pre-git-x86_64-linux.qcow2.gz</td></tr><tr><td align="left">googleComputeImage</td><td align="left">nixos-image-25.05pre-git-x86_64-linux.raw.tar.gz</td><td align="left">nixos-image-google-compute-25.05pre-git-x86_64-linux.raw.tar.gz</td></tr><tr><td align="left">hypervImage</td><td align="left">nixos-25.05pre-git-x86_64-linux.vhdx</td><td align="left">nixos-image-hyperv-25.05pre-git-x86_64-linux.vhdx</td></tr><tr><td align="left">isoImage (installer)</td><td align="left">nixos-25.05pre-git-x86_64-linux.iso</td><td align="left">nixos-image-25.05pre-git-x86_64-linux.iso</td></tr><tr><td align="left">isoImage</td><td align="left">nixos.iso</td><td align="left">nixos-image-25.05pre-git-x86_64-linux.iso</td></tr><tr><td align="left">kubevirtImage</td><td align="left">nixos.qcow2</td><td align="left">nixos-image-kubevirt-25.05pre-git-x86_64-linux.qcow2</td></tr><tr><td align="left">linodeImage</td><td align="left">nixos-image-25.05pre-git-x86_64-linux.img.gz</td><td align="left">nixos-image-linode-25.05pre-git-x86_64-linux.img.gz</td></tr><tr><td align="left">metadata (lxc-container)</td><td align="left">nixos-system-x86_64-linux.tar.xz</td><td align="left">nixos-image-lxc-metadata-25.05pre-git-x86_64-linux.tar.xz</td></tr><tr><td align="left">OCIImage</td><td align="left">nixos.qcow2</td><td align="left">nixos-image-oci-25.05pre-git-x86_64-linux.qcow2</td></tr><tr><td align="left">openstackImage (zfs)</td><td align="left">nixos-openstack-image-25.05pre-git-x86_64-linux.root.qcow2</td><td align="left">nixos-image-openstack-zfs-25.05pre-git-x86_64-linux.root.qcow2</td></tr><tr><td align="left">openstackImage</td><td align="left">nixos.qcow2</td><td align="left">nixos-image-openstack-25.05pre-git-x86_64-linux.qcow2</td></tr><tr><td align="left">sdImage</td><td align="left">nixos-sd-image-25.05pre-git-x86_64-linux.img.zst</td><td align="left">nixos-image-sd-card-25.05pre-git-x86_64-linux.img.zst</td></tr><tr><td align="left">tarball (lxc-container)</td><td align="left">nixos-system-x86_64-linux.tar.xz</td><td align="left">nixos-image-lxc-25.05pre-git-x86_64-linux.tar.xz</td></tr><tr><td align="left">tarball (proxmox-lxc)</td><td align="left">nixos-system-x86_64-linux.tar.xz</td><td align="left">nixos-image-lxc-proxmox-25.05pre-git-x86_64-linux.tar.xz</td></tr><tr><td align="left">vagrantVirtualbox</td><td align="left">nixos-25.05pre-git-x86_64-linux.ova</td><td align="left">nixos-image-virtualbox-25.05pre-git-x86_64-linux.ova</td></tr><tr><td align="left">virtualBoxOVA</td><td align="left">virtualbox-vagrant.box</td><td align="left">nixos-image-vagrant-virtualbox-25.05pre-git-x86_64-linux.ova</td></tr><tr><td align="left">vmwareImage</td><td align="left">nixos-25.05pre-git-x86_64-linux.vmdk</td><td align="left">nixos-image-vmware-25.05pre-git-x86_64-linux.vmdk</td></tr></tbody></table></div></li><li class="listitem"><p><code class="literal">security.apparmor.policies.&lt;name&gt;.enforce</code> and <code class="literal">security.apparmor.policies.&lt;name&gt;.enable</code> were removed.
Configuring the state of apparmor policies must now be done using <code class="literal">security.apparmor.policies.&lt;name&gt;.state</code> tristate option.</p></li><li class="listitem"><p><code class="literal">services.graylog.package</code> now defaults to <code class="literal">graylog-6_0</code> as previous default <code class="literal">graylog-5_1</code> is EOL and therefore removed.
Check the migration guides on <a class="link" href="https://go2docs.graylog.org/5-2/upgrading_graylog/upgrading_to_graylog_5.2.x.htm"  target="_top">5.1→5.2</a> and <a class="link" href="https://go2docs.graylog.org/6-0/upgrading_graylog/upgrading_to_graylog_6.0.x.html"  target="_top">5.2→6.0</a> for breaking changes.</p></li><li class="listitem"><p><code class="literal">programs.clash-verge.tunMode</code> was deprecated and removed because now service mode is necessary to start program. Without <code class="literal">programs.clash-verge.enable</code>, clash-verge-rev will refuse to start.</p></li><li class="listitem"><p><code class="literal">services.discourse</code> now requires PostgreSQL 15 per default. Please update before upgrading.</p></li><li class="listitem"><p><code class="literal">services.homepage-dashboard</code> now requires the <code class="literal">allowedHosts</code> option to be set in accordance with the <a class="link" href="https://gethomepage.dev/installation/#homepage_allowed_hosts"  target="_top">documentation</a>.</p></li><li class="listitem"><p><code class="literal">luakit</code> has been updated to 2.4.0. If you use any website which uses IndexedDB or local storage and wish to retain the saved information, <a class="link" href="https://luakit.github.io/news/luakit-2.4.0.html"  target="_top">some manual intervention may be required</a></p></li><li class="listitem"><p><code class="literal">services.netbird.tunnels</code> was renamed to <a class="link" href="options.html#opt-services.netbird.clients"  ><code class="literal">services.netbird.clients</code></a>,
hardened (using dedicated less-privileged users) and significantly extended.</p></li><li class="listitem"><p><code class="literal">services.rsyncd.settings</code> now supports only two attributes <code class="literal">sections</code> and <code class="literal">globalSection</code>.
As a result, all sections previously defined under <code class="literal">services.rsyncd.settings</code> must now be put in <code class="literal">services.rsyncd.settings.sections</code>.
Global settings must now be placed in <code class="literal">services.rsyncd.settings.globalSection</code> instead of <code class="literal">services.rsyncd.settings.global</code>.</p></li><li class="listitem"><p>The non-LTS Forgejo package (<code class="literal">forgejo</code>) has been updated to 12.0.0. This release contains breaking changes, see the <a class="link" href="https://forgejo.org/2025-07-release-v12-0/"  target="_top">release blog post</a>
for all the details and how to ensure smooth upgrades.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-25.05-notable-changes" class="title" >Other Notable Changes   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">virtualisation.containers</code> with backend “podman” now supports rootless containers and <code class="literal">sd_notify(3)</code>-integration
based on container healthchecks.</p></li><li class="listitem"><p>Cinnamon has been updated to 6.4, please check the <a class="link" href="https://www.linuxmint.com/rel_xia_whatsnew.php"  target="_top">upstream announcement</a> for more details.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Following <a class="link" href="https://github.com/linuxmint/mintupgrade/commit/f239cde908288b8c250f938e7311c7ffbc16bd59"  target="_top">changes in Mint 22</a> we are no longer overriding Qt application styles. You can still restore the previous default with <code class="literal">qt.style = &quot;gtk2&quot;</code> and <code class="literal">qt.platformTheme = &quot;gtk2&quot;</code>.</p></li><li class="listitem"><p>Following <a class="link" href="https://github.com/linuxmint/mintupgrade-legacy/commit/ce15d946ed9a8cb8444abd25088edd824bfb18f6"  target="_top">changes in Mint 20</a> we are replacing xplayer with celluloid since xplayer is no longer maintained.</p></li></ul></div></li><li class="listitem"><p>Pantheon has been updated to 8, please check the <a class="link" href="https://blog.elementary.io/os-8-available-now/"  target="_top">upstream announcement</a> for more details.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Same as elementary OS, the X11 session is named “Classic Session” and the Wayland session is named “Secure Session”.</p></li><li class="listitem"><p>The dock has been rewritten, you need to manually migrate the dock items on update. You can check <code class="literal">~/.config/plank/dock1/launchers/</code> for your previous settings.</p></li></ul></div></li><li class="listitem"><p>Xfce has been updated to 4.20, please check the <a class="link" href="https://www.xfce.org/about/tour420"  target="_top">upstream feature tour</a> for more details.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Wayland session is still <a class="link" href="https://wiki.xfce.org/releng/wayland_roadmap"  target="_top">experimental</a> and requires opt-in using <code class="literal">enableWaylandSession</code> option.</p></li><li class="listitem"><p>Overriding Wayland compositor is possible using <code class="literal">waylandSessionCompositor</code> option, but you might need to take care <a class="link" href="https://gitlab.xfce.org/xfce/xfce4-session/-/merge_requests/49"  target="_top"><code class="literal">xfce4-session</code></a>, <a class="link" href="https://github.com/labwc/labwc/blob/eaf11face68ee1f1bcc7ce1498304ca8c108c8ba/src/config/session.c#L234"  target="_top"><code class="literal">dbus-update-activation-environment</code></a> and <a class="link" href="https://github.com/labwc/labwc/blob/eaf11face68ee1f1bcc7ce1498304ca8c108c8ba/src/config/session.c#L239"  target="_top"><code class="literal">systemctl --user import-environment</code></a> on startup.</p></li><li class="listitem"><p>For new Xfce installations, default panel layout has <a class="link" href="https://gitlab.xfce.org/xfce/xfce4-panel/-/merge_requests/158/diffs"  target="_top">changed</a> to not include external panel plugins by default. You can still add them yourself using the “Panel Preferences” dialog.</p></li></ul></div></li><li class="listitem"><p>PAM services for <code class="literal">i3lock</code>/<code class="literal">i3lock-color</code>, <code class="literal">vlock</code>, <code class="literal">xlock</code>, and <code class="literal">xscreensaver</code> now default to disabled unless other corresponding NixOS options are set (<code class="literal">programs.i3lock.enable</code>, <code class="literal">console.enable</code>, <code class="literal">services.xserver.enable</code>, and <code class="literal">services.xscreensaver.enable</code>, respectively). If for some reason you want one of them back without setting the corresponding option, set, e.g., <code class="literal">security.pam.services.xlock.enable = true</code>.</p></li><li class="listitem"><p>The <code class="literal">nixos-generate-config</code> command now supports a optional <code class="literal">--flake</code> option, which will generate a flake.nix file alongside the <code class="literal">configuration.nix</code> and <code class="literal">hardware-configuration.nix</code>, providing an easy introduction into flake-based system configurations.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-system.stateVersion"  ><code class="literal">system.stateVersion</code></a> is now validated and must be in the <code class="literal">&quot;YY.MM&quot;</code> format, ideally corresponding to a prior NixOS release.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-hardware.xone.enable"  target="_top"><code class="literal">hardware.xone</code></a> will also enable <a class="link" href="options.html#opt-hardware.xpad-noone.enable"  target="_top"><code class="literal">hardware.xpad-noone</code></a> to provide Xbox 360 driver by default.</p></li><li class="listitem"><p><code class="literal">services.mysql</code> now supports easy cluster setup via <a class="link" href="options.html#opt-services.mysql.galeraCluster.enable"  ><code class="literal">services.mysql.galeraCluster</code></a> option.</p><p>Example:</p><pre><code class="programlisting nix">services.mysql = {
  enable = true;
  galeraCluster = {
    enable = true;
    localName = &quot;Node 1&quot;;
    localAddress = &quot;galera_01&quot;;
    nodeAddresses = [ &quot;galera_01&quot; &quot;galera_02&quot; &quot;galera_03&quot;];
  };
};
</code></pre></li><li class="listitem"><p>systemd’s <a class="link" href="https://www.freedesktop.org/software/systemd/man/systemd-ssh-generator.html" target="_top"><span class="citerefentry"><span class="refentrytitle">systemd-ssh-generator</span>(8)</span></a> now works out of the box on NixOS.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>You can ssh into VMs without any networking configuration if your hypervisor configures the vm to support AF_VSOCK.
It still requires the usual ssh authentication methods.</p></li><li class="listitem"><p>An SSH key for the root user can be provisioned using the <code class="literal">ssh.authorized_keys.root</code> systemd credential.
This can be useful for booting an installation image and providing the SSH key with an smbios string.</p></li><li class="listitem"><p>SSH can be used for suid-less privilege escalation on the local system without having to rely on networking:</p><pre><code class="programlisting shell">ssh root@.host
</code></pre></li><li class="listitem"><p>systemd’s <a class="link" href="https://www.freedesktop.org/software/systemd/man/systemd-ssh-proxy.html" target="_top"><span class="citerefentry"><span class="refentrytitle">systemd-ssh-proxy</span>(1)</span></a> is enabled by default. It can be disabled using <a class="link" href="options.html#opt-programs.ssh.systemd-ssh-proxy.enable"  ><code class="literal">programs.ssh.systemd-ssh-proxy.enable</code></a>.</p></li></ul></div></li><li class="listitem"><p>SSH host key generation has been separated into the dedicated systemd service sshd-keygen.service.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.dex.enable"  ><code class="literal">services.dex</code></a> now restarts upon changes to the <a class="link" href="options.html#opt-services.dex.environmentFile"  ><code class="literal">.environmentFile</code></a> option or <code class="literal">path</code> type entries in <code class="literal">.settings.staticClients[].secretFile</code>.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.geoclue2.enable"  ><code class="literal">services.geoclue2</code></a> now has an <code class="literal">enableStatic</code> option, which allows the NixOS configuration to specify a fixed location for GeoClue to use.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.mongodb.enable"  ><code class="literal">services.mongodb</code></a> is now compatible with the <code class="literal">mongodb-ce</code> binary package. To make use of it, set <a class="link" href="options.html#opt-services.mongodb.package"  ><code class="literal">services.mongodb.package</code></a> to <code class="literal">pkgs.mongodb-ce</code>.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.jupyter.enable"  ><code class="literal">services.jupyter</code></a> is now compatible with <code class="literal">Jupyter Notebook 7</code>. See <a class="link" href="https://jupyter-notebook.readthedocs.io/en/latest/migrate_to_notebook7.html"  target="_top">the migration guide</a> for details.</p></li><li class="listitem"><p><code class="literal">networking.wireguard</code> now has an optional networkd backend. It is enabled by default when <code class="literal">networking.useNetworkd</code> is enabled, and it can be enabled alongside scripted networking with <code class="literal">networking.wireguard.useNetworkd</code>. Some <code class="literal">networking.wireguard</code> options have slightly different behavior with the networkd and script-based backends, documented in each option.</p></li><li class="listitem"><p><code class="literal">services.rss-bridge</code> now has a <code class="literal">package</code> option as well as support for <code class="literal">caddy</code> as reverse proxy.</p></li><li class="listitem"><p><code class="literal">services.avahi.ipv6</code> now defaults to true.</p></li><li class="listitem"><p>In the <code class="literal">services.xserver.displayManager.startx</code> module, two new options <a class="link" href="options.html#opt-services.xserver.displayManager.startx.generateScript"  >generateScript</a> and <a class="link" href="options.html#opt-services.xserver.displayManager.startx.extraCommands"  >extraCommands</a> have been added to to declaratively configure the .xinitrc script.</p></li><li class="listitem"><p>All services that require a root certificate bundle now use the value of a new read-only option, <code class="literal">security.pki.caBundle</code>.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.hddfancontrol.enable"  ><code class="literal">services.hddfancontrol</code></a> has been modified to use an attribute set for settings, enabling configurations with multiple instances of the daemon running at once (e.g., for two separate drive bays).</p></li><li class="listitem"><p><code class="literal">services.cloudflared</code> now uses a dynamic user, and its <code class="literal">user</code> and <code class="literal">group</code> options have been removed. If the user or group is still necessary, they can be created manually.</p></li><li class="listitem"><p>The Home Assistant module has new options <code class="option">services.home-assistant.blueprints.automation</code>, <code class="literal">services.home-assistant.blueprints.script</code>, and <code class="option">services.home-assistant.blueprints.template</code> that allow for the declarative installation of <a class="link" href="https://www.home-assistant.io/docs/blueprint/"  target="_top">blueprints</a> into the appropriate configuration directories.</p></li><li class="listitem"><p><code class="literal">services.dovecot2.modules</code> have been removed, now need to use <code class="literal">environment.systemPackages</code> to load additional Dovecot modules.</p></li><li class="listitem"><p><code class="literal">services.kmonad</code> now creates a determinate symlink (in <code class="literal">/dev/input/by-id/</code>) to each of KMonad virtual devices.</p></li><li class="listitem"><p><code class="literal">services.searx</code> now supports configuration of the favicons cache and other options available in SearXNG’s <code class="literal">favicons.toml</code> file</p></li><li class="listitem"><p><code class="literal">services.gitea</code> now supports CAPTCHA usage through the <code class="literal">services.gitea.captcha</code> variable.</p></li><li class="listitem"><p><code class="literal">services.soft-serve</code> now restarts upon config change.</p></li><li class="listitem"><p><code class="literal">services.keycloak</code> now provides a <code class="literal">realmFiles</code> option that allows to import realms during startup. See https://www.keycloak.org/server/importExport</p></li><li class="listitem"><p><code class="literal">bind.cacheNetworks</code> now only controls access for recursive queries, where it previously controlled access for all queries.</p></li><li class="listitem"><p>The <a class="link" href="https://starship.rs"  target="_top">Starship</a> module now automatically loads the starship prompt when using <a class="link" href="https://xon.sh"  target="_top"><code class="literal">xonsh</code></a>.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.mongodb.enableAuth"  ><code class="literal">services.mongodb.enableAuth</code></a> now uses the newer <a class="link" href="https://github.com/mongodb-js/mongosh"  target="_top">mongosh</a> shell instead of the legacy shell to configure the initial superuser. You can configure the mongosh package to use through the <a class="link" href="options.html#opt-services.mongodb.mongoshPackage"  ><code class="literal">services.mongodb.mongoshPackage</code></a> option.</p></li><li class="listitem"><p>There is a new set of NixOS test tools for testing virtual Wi-Fi networks in many different topologies. See the <code class="option">services.vwifi</code> module, <code class="option">services.kismet</code> NixOS test, and <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#sec-nixos-test-wifi"  target="_top">manual</a> for documentation and examples.</p></li><li class="listitem"><p>The paperless module now has an option for regular automatic export of documents data using the integrated document exporter.</p></li><li class="listitem"><p>Exposed the <code class="literal">paperless-manage</code> script package via the <code class="literal">services.paperless.manage</code> read-only option.</p></li><li class="listitem"><p>New options for the declarative configuration of the user space part of ALSA have been introduced under <a class="link" href="options.html#opt-hardware.alsa.enable"  target="_top">hardware.alsa</a>, including setting the default capture and playback device, defining sound card aliases and volume controls.
Note: these are intended for users not running a sound server like PulseAudio or PipeWire, but having ALSA as their only sound system.</p></li><li class="listitem"><p><code class="literal">services.k3s</code> now provides the <code class="literal">autoDeployCharts</code> option that allows to automatically deploy Helm charts via the k3s Helm controller.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.mattermost.enable"  >Mattermost</a>, a self-hosted chat collaboration platform supporting calls, playbooks, and boards, has been updated. It now has multiple versions, disabled telemetry, and a native frontend build in nixpkgs, removing all upstream prebuilt blobs.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Mattermost telemetry reporting is now disabled by default, though security update notifications are enabled. Look at <a class="link" href="options.html#opt-services.mattermost.telemetry.enableDiagnostics"  ><code class="literal">services.mattermost.telemetry</code></a> for options to control this behavior.</p></li><li class="listitem"><p>The Mattermost module will produce eval warnings if a database password would end up in the Nix store, and recommend alternatives such as peer authentication or using the environment file.</p></li><li class="listitem"><p>We now support <code class="literal">mmctl</code> for Mattermost administration if both <a class="xref" href="options.html#opt-services.mattermost.socket.enable"  ><code class="option">services.mattermost.socket.enable</code></a> and <a class="xref" href="options.html#opt-services.mattermost.socket.export"  ><code class="option">services.mattermost.socket.export</code></a> are set, which export the Mattermost control socket path into the system environment.</p></li></ul></div></li><li class="listitem"><p><code class="literal">services.geoclue2</code> now uses <a class="link" href="https://beacondb.net/"  target="_top">beaconDB</a> as a default geolocation service, replacing Mozilla Location Services which was <a class="link" href="https://github.com/mozilla/ichnaea/issues/2065"  target="_top">retired in June 2024</a>.</p></li><li class="listitem"><p><code class="literal">security.acme</code> now supports renewal using CSRs (Certificate Signing Request) through the options <code class="literal">security.acme.*.csr</code> and <code class="literal">security.acme.*.csrKey</code>.</p></li><li class="listitem"><p><code class="literal">programs.fzf.keybindings</code> now supports the fish shell.</p></li><li class="listitem"><p>A toggle has been added under <code class="literal">users.users.&lt;name&gt;.enable</code> to allow toggling individual users conditionally. If set to false, the user account will not be created.</p></li><li class="listitem"><p><code class="literal">amdgpu</code> kernel driver overdrive mode can now be enabled by setting <a class="link" href="options.html#opt-hardware.amdgpu.overdrive.enable"  >hardware.amdgpu.overdrive.enable</a> and customized through <a class="link" href="options.html#opt-hardware.amdgpu.overdrive.ppfeaturemask"  >hardware.amdgpu.overdrive.ppfeaturemask</a>.
This allows for fine-grained control over the GPU’s performance and maybe required by overclocking softwares like Corectrl and Lact. These new options replace old options such as <code class="option">programs.corectrl.gpuOverclock.enable</code> and <code class="option">programs.tuxclocker.enableAMD</code>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-25.05-wiki" class="title" >NixOS Wiki   </h3>  </div> </div></div><p>The official NixOS Wiki at <a class="link" href="https://wiki.nixos.org"  target="_top">wiki.nixos.org</a> has new and improved articles, new contributors and some improvements in its dark theme and mobile readability.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-nixpkgs-release-25.05" class="title" >Nixpkgs 25.05 (2025.05/23)   </h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="sec-nixpkgs-release-25.05-highlights" class="title" >Highlights   </h5>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><span class="strong"><strong>This release of Nixpkgs requires macOS Big Sur 11.3 or newer, as announced in the 24.11 release notes.</strong></span>
We cannot guarantee that packages will continue to work on older versions of macOS.
Future Nixpkgs releases will only support <a class="link" href="https://endoflife.date/macos"  target="_top">macOS versions supported by Apple</a>; this means that <span class="strong"><strong>Nixpkgs 25.11 will require macOS Sonoma 14 or newer</strong></span>.
Users on old macOS versions should consider upgrading to a supported version (potentially using <a class="link" href="https://dortania.github.io/OpenCore-Legacy-Patcher/"  target="_top">OpenCore Legacy Patcher</a> for old hardware) or installing NixOS.
If neither of those options are viable and you require new versions of software, <a class="link" href="https://www.macports.org/"  target="_top">MacPorts</a> supports versions back to Mac OS X Snow Leopard 10.6.</p></li><li class="listitem"><p>The default kernel package has been updated from 6.6 to 6.12. All supported kernels remain available.</p></li><li class="listitem"><p>GCC has been updated from GCC 13 to GCC 14.
This introduces some backwards‐incompatible changes; see the <a class="link" href="https://gcc.gnu.org/gcc-14/porting_to.html"  target="_top">upstream porting guide</a> for details.</p></li><li class="listitem"><p>The default GHC version has been updated from 9.6 to 9.8.
<code class="literal">haskellPackages</code> also uses Stackage LTS 23 (instead of LTS 22) as a baseline.
We aim to remove the old GHC versions 8.10, 9.0 and 9.2 in the next release in accordance with <a class="link" href="https://discourse.nixos.org/t/nixpkgs-ghc-deprecation-policy-user-feedback-necessary/64153"  target="_top">the new GHC deprecation policy</a>.</p></li><li class="listitem"><p>LLVM has been updated from LLVM 16 (on Darwin) and LLVM 18 (on other platforms) to LLVM 19.
This introduces some backwards‐incompatible changes; see the <a class="link" href="https://releases.llvm.org/"  target="_top">upstream release notes</a> for details.</p></li><li class="listitem"><p>The Factor programming language packages were reworked. <code class="literal">factor-lang-scope</code> is now named <code class="literal">factorPackages</code> and provides a <code class="literal">buildFactorApplication</code> function to deploy Factor programs as binaries. It has also received proper documentation in the Nixpkgs manual.</p></li><li class="listitem"><p>The packaging of Mesa graphics drivers has been significantly reworked, in particular:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Applications linked against different Mesa versions than installed on the system should now work correctly going forward (however, applications against older Mesa, e.g. from Nixpkgs releases before 25.05, remain broken)</p></li><li class="listitem"><p>Packages that used to depend on Mesa for libgbm or libdri should use <code class="literal">libgbm</code> or <code class="literal">dri-pkgconfig-stub</code> as inputs, respectively</p></li></ul></div></li><li class="listitem"><p>GNU Taler has been updated to version 1.0.
This marks a significant milestone as the GNU Taler payment system is now available in Swiss Francs for individuals and businesses in Switzerland.
For more details, see the <a class="link" href="https://www.taler.net/en/news/2025-01.html"  target="_top">upstream release notes</a>.</p></li><li class="listitem"><p>OpenSSH has been updated from 9.9p2 to 10.0p2, dropping support for DSA keys and adding a new <code class="literal">ssh-auth</code> binary to handle user authentication in a different address space from unauthenticated sessions. See the <a class="link" href="https://www.openwall.com/lists/oss-security/2025/04/09/1"  target="_top">full changelog</a> for more details.</p></li><li class="listitem"><p>Emacs has been updated to 30.1.
This introduces some backwards‐incompatible changes; see the NEWS for details.
NEWS can been viewed from Emacs by typing <code class="literal">C-h n</code>, or by clicking <code class="literal">Help-&gt;Emacs News</code> from the menu bar.
It can also be browsed <a class="link" href="https://git.savannah.gnu.org/cgit/emacs.git/tree/etc/NEWS?h=emacs-30"  target="_top">online</a>.</p></li><li class="listitem"><p>The <code class="literal">intel</code> video driver for X.org (from the xf86-video-intel package, which was previously removed because it was non-functional) has been fixed and the driver has been re-introduced.</p></li><li class="listitem"><p>The default openexr version has been updated to 3.2.4.</p></li><li class="listitem"><p>The default PHP version has been updated to 8.4.</p></li><li class="listitem"><p>The default Erlang OTP version has been updated to 27.</p></li><li class="listitem"><p>The default Elixir version has been updated to 1.18.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="sec-nixpkgs-release-25.05-incompatibilities" class="title" >Backward Incompatibilities   </h5>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">apptainer</code> and <code class="literal">singularity</code> deprecate the workaround of overriding <code class="literal">vendorHash</code> and related attributes via <code class="literal">&lt;pkg&gt;.override</code>,
in favour of the unified overriding of the same group of attributes via <code class="literal">&lt;pkg&gt;.overrideAttrs</code>.
The compatibility layer will be removed in future releases.</p></li><li class="listitem"><p><code class="literal">squid</code> has been updated to version 7, this release includes multiple breaking changes, like ESI removal.
For more information, <a class="link" href="https://github.com/squid-cache/squid/releases/tag/SQUID_7_0_1"  target="_top">check the release notes</a>.</p></li><li class="listitem"><p><code class="literal">postgresql</code> and <code class="literal">libpq</code> don’t provide <code class="literal">pg_config</code> by default anymore. Instead, <code class="literal">pg_config</code> is available via <code class="literal">postgresql.pg_config</code> or <code class="literal">libpq.pg_config</code>. This allowed implementing it as a shell script, which can be built for both the build and host systems when cross-compiling. If your build fails to find <code class="literal">pg_config</code>, add <code class="literal">postgresql.pg_config</code> or <code class="literal">libpq.pg_config</code> to <code class="literal">nativeBuildInputs</code>.</p></li><li class="listitem"><p>The <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#no-broken-symlinks.sh"  target="_top"><code class="literal">no-broken-symlinks</code> hook</a> was added to catch builds containing dangling or reflexive symlinks, as these are indicative of problems with packaging.
The hook can be disabled by providing <code class="literal">dontCheckForBrokenSymlinks = true;</code> as an argument to <code class="literal">mkDerivation</code>.
For more information, <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#no-broken-symlinks.sh"  target="_top">check the docs</a> or <a class="link" href="https://github.com/NixOS/nixpkgs/pull/370750"  target="_top">see this PR</a>.</p></li><li class="listitem"><p><code class="literal">gkraken</code> has been removed. The recommended alternative is <code class="literal">coolercontrol</code>.</p></li><li class="listitem"><p><code class="literal">opensmtpd-extras</code> has been deprecated by upstream and is not compatible with
OpenSMTPD 7.6.0 or later. The package has been removed in favor of a set of new
<code class="literal">opensmtpd-table-*</code> packages.</p></li><li class="listitem"><p><code class="literal">postsrsd</code> upgraded to <code class="literal">&gt;= 2.0.0</code>, with some different behaviors and
configuration settings. Notably, it now defaults to listening on a socket
rather than a port. See <a class="link" href="https://github.com/roehling/postsrsd/blob/2.0.10/README.rst#migrating-from-version-1x"  target="_top">Migrating from version 1.x</a> and <a class="link" href="https://github.com/roehling/postsrsd?tab=readme-ov-file#postfix-setup"  target="_top">Postfix Setup</a> for details.</p></li><li class="listitem"><p><code class="literal">renovate</code> was updated to v39. See the <a class="link" href="https://github.com/renovatebot/renovate/releases/tag/39.0.0"  target="_top">upstream release notes</a> for breaking changes.
Like upstream’s docker images, renovate now runs on NodeJS 22.</p></li><li class="listitem"><p>The hand written <code class="literal">perlPackages.SearchXapian</code> bindings have been dropped in favor of the (mostly compatible)
<code class="literal">perlPackages.Xapian</code>.</p></li><li class="listitem"><p><code class="literal">varnish</code> was updated from 7.5.0 to 7.7.0, see <a class="link" href="https://varnish-cache.org/docs/7.6/whats-new/upgrading-7.6.html"  target="_top">Varnish 7.6.0 upgrade guide</a> and
<a class="link" href="https://varnish-cache.org/docs/7.7/whats-new/upgrading-7.7.html#whatsnew-upgrading-7-7"  target="_top">Varnish 7.7.0 upgrade guide</a>.</p></li><li class="listitem"><p>The <code class="literal">config</code> triple for <code class="literal">aarch64-darwin</code> has been changed from <code class="literal">aarch64-apple-darwin</code> to <code class="literal">arm64-apple-darwin</code> to match the Apple toolchain and LLVM’s expectations.</p></li><li class="listitem"><p>The <code class="literal">electron</code> packages will now provide their headers (available via <code class="literal">electron.headers</code>) in extracted form instead of in a tarball.</p></li><li class="listitem"><p>The udev rules of the <code class="literal">libjaylink</code> package require users to be in the <code class="literal">jlink</code> instead of <code class="literal">plugdev</code> group now, since the <code class="literal">plugdev</code> group is very uncommon for NixOS. Alternatively, access is granted to seat sessions.</p></li><li class="listitem"><p>The <code class="literal">ephemeral</code> package was removed due to upstream archival in early 2022.</p></li><li class="listitem"><p>The <code class="literal">gotenberg</code> package has been updated to 8.16.0, which brings breaking changes to the configuration from version 8.13.0. See the <a class="link" href="https://github.com/gotenberg/gotenberg/releases/tag/v8.13.0"  target="_top">upstream release notes</a> for that release to get all the details.</p></li><li class="listitem"><p><code class="literal">zammad</code> has had its support for MySQL removed, since it was never working correctly and is now deprecated upstream. Check the <a class="link" href="https://docs.zammad.org/en/latest/appendix/migrate-to-postgresql.html"  target="_top">migration guide</a> for how to convert your database to PostgreSQL.</p></li><li class="listitem"><p>The <code class="literal">vocal</code> package was removed due to upstream archival. The upstream developer suggests using <code class="literal">gnome-podcasts</code> or <code class="literal">kasts</code> instead.</p></li><li class="listitem"><p><code class="literal">timescaledb</code> requires manual upgrade steps.
After you run ALTER EXTENSION, you must run <a class="link" href="https://github.com/timescale/timescaledb-extras/blob/master/utils/2.15.X-fix_hypertable_foreign_keys.sql"  target="_top">this SQL script</a>. For more details, see the following pull requests <a class="link" href="https://github.com/timescale/timescaledb/pull/6797"  target="_top">#6797</a>.
PostgreSQL 13 is no longer supported in TimescaleDB v2.16.</p></li><li class="listitem"><p><code class="literal">paperless-ngx</code> has been updated to minor version 2.15 which switched the web server from Gunicorn to Granian. If you set Gunicorn specific envs (usually contain GUNICORN) they must be updated.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#tester-shellcheck"  target="_top">testers.shellcheck</a> now warns when <code class="literal">name</code> is not provided.
The <code class="literal">name</code> argument will become mandatory in a future release.</p></li><li class="listitem"><p><code class="literal">tauon</code> 7.9.0+ when launched for the first time, migrates its database to a new schema that is not backwards compatible. Older versions will refuse to start at all with that database afterwards. If you need to still use older tauon versions, make sure to back up <code class="literal">~/.local/share/TauonMusicBox</code>.</p></li><li class="listitem"><p><code class="literal">aws-workspaces</code> has dropped support for PCoiP networking.</p></li><li class="listitem"><p><a class="link" href="https://www.gimp.org/news/2025/03/16/gimp-3-0-released/"  target="_top">GIMP 3.0</a> available as <code class="literal">gimp3</code>.</p></li><li class="listitem"><p><code class="literal">grafana-agent</code> and <code class="literal">services.grafana-agent</code> have been removed in favor of
Grafana Alloy (<code class="literal">grafana-alloy</code> and <code class="literal">services.alloy</code>), as they depend on an EOL compiler version
and will become EOL during the 25.05 lifecycle.
Grafana recommends migrating to <code class="literal">grafana-alloy</code> (<code class="literal">services.alloy</code>).
See https://grafana.com/docs/alloy/latest/set-up/migrate/ for details.</p></li><li class="listitem"><p><code class="literal">slskd</code> has been updated to v0.22.3, which includes breaking changes to <code class="literal">script</code> integrations. Please review the <a class="link" href="https://github.com/slskd/slskd/releases/tag/0.22.3"  target="_top">changelog</a>
and the accompanying <a class="link" href="https://github.com/slskd/slskd/pull/1292"  target="_top">pull request</a>.</p></li><li class="listitem"><p><code class="literal">forgejo</code> and <code class="literal">forgejo-lts</code> have been updated to v11.
See upstreams <a class="link" href="https://forgejo.org/2025-04-release-v11-0/"  target="_top">release blog post</a> for more information.</p></li><li class="listitem"><p><code class="literal">unifi</code> has been updated to v9.1.
This version should be backward compatible with v8.x, however as a result, <code class="literal">unifi8</code> package has been removed.</p></li><li class="listitem"><p><code class="literal">xdragon</code> package has been renamed to <code class="literal">dragon-drop</code>.
<code class="literal">xdragon</code> is an alias to <code class="literal">dragon-drop</code> and the package still provides <code class="literal">bin/xdragon</code>.
<code class="literal">bin/dragon</code> is no longer supplied.</p></li><li class="listitem"><p><code class="literal">python3Packages.bpycv</code> has been removed due to being incompatible with Blender 4 and unmaintained.</p></li><li class="listitem"><p><code class="literal">python3Packages.jaeger-client</code> was removed because it was deprecated upstream. <a class="link" href="https://opentelemetry.io"  target="_top">OpenTelemetry</a> is the recommended replacement.</p></li><li class="listitem"><p><code class="literal">rocmPackages_6</code> has been updated to ROCm 6.3.</p></li><li class="listitem"><p><code class="literal">rocmPackages_5</code> has been removed.</p></li><li class="listitem"><p><code class="literal">rocmPackages.rocm-thunk</code> has been removed and its functionality has been integrated with the ROCm CLR. Use <code class="literal">rocmPackages.clr</code> instead.</p></li><li class="listitem"><p><code class="literal">rocmPackages.clang-ocl</code> has been removed. <a class="link" href="https://github.com/ROCm/clang-ocl"  target="_top">It was deprecated by AMD in 2023.</a></p></li><li class="listitem"><p><code class="literal">nodePackages.meshcommander</code> has been removed, as the package was deprecated by Intel.</p></li><li class="listitem"><p>The default version of <code class="literal">z3</code> has been updated from 4.8 to 4.13. There are still a few packages that need specific older versions; those will continue to be maintained as long as other packages depend on them but may be removed in the future.</p></li><li class="listitem"><p>The <code class="literal">nixLog*</code> family of functions made available through the standard environment have been rewritten to prefix messages with both the debug level and the function name of the caller.
The <code class="literal">nixLog</code> function, which logs unconditionally, was also re-introduced and modified to prefix messages with the function name of the caller.
For more information, <a class="link" href="https://github.com/NixOS/nixpkgs/pull/370742"  target="_top">see this PR</a>.</p></li><li class="listitem"><p><code class="literal">postgresql</code>’s <code class="literal">pythonSupport</code> argument has been changed. It is now enabled by default, but to use PL/Python the extension needs to be added explicitly with <code class="literal">postgresql.withPackages</code>. If you were using <code class="literal">postgresql.override { pythonSupport = true; }</code> before, change it to <code class="literal">postgresql.withPackages (ps: [ ps.plpython3 ])</code>. The same applies to <code class="literal">perlSupport</code>/<code class="literal">plperl</code> and <code class="literal">tclSupport</code>/<code class="literal">pltcl</code> respectively.</p></li><li class="listitem"><p>Rust packages will need to regenerate their <code class="literal">cargoHash</code>.
Cargo 1.84.0 changed the format of <code class="literal">cargo vendor</code> output, which invalidated all existing <code class="literal">rustPlatform.fetchCargoTarball</code> hashes.
To preserve Nix’s invariants, it has been replaced with <code class="literal">rustPlatform.fetchCargoVendor</code>, an independent implementation prioritizing format stability.
<code class="literal">rustPlatform.buildRustPackage</code> now uses <code class="literal">rustPlatform.fetchCargoVendor</code> by default; a hash mismatch error is expected in third‐party Rust packages when updating to Nixpkgs 25.05.
Packages wishing to maintain compatibility with Nixpkgs 24.11 must set <code class="literal">useFetchCargoVendor</code> to <code class="literal">true</code> explicitly.
<code class="literal">rustPlatform.importCargoLock</code> may also be appropriate in some circumstances.</p></li><li class="listitem"><p><code class="literal">cassandra_3_0</code> and <code class="literal">cassandra_3_11</code> have been removed as they have reached end-of-life. Please update to <code class="literal">cassandra_4</code>. See the <a class="link" href="https://github.com/apache/cassandra/blob/cassandra-4.0.17/NEWS.txt"  target="_top">changelog</a> for more information about the upgrade process.</p></li><li class="listitem"><p><code class="literal">mariadb_105</code> has been removed as it has reached end-of-life in 2025-06. Please update to <code class="literal">mariadb_106</code>.</p></li><li class="listitem"><p>NetBox was updated to <code class="literal">&gt;= 4.2.0</code>. Have a look at the breaking changes
of the <a class="link" href="https://github.com/netbox-community/netbox/releases/tag/v4.1.0"  target="_top">4.1 release</a>
and the <a class="link" href="https://github.com/netbox-community/netbox/releases/tag/v4.2.0"  target="_top">4.2 release</a>,
make the required changes to your database, if needed, then upgrade by setting <code class="literal">services.netbox.package = pkgs.netbox_4_2;</code> in your configuration.</p></li><li class="listitem"><p><code class="literal">nodePackages.expo-cli</code> has been removed, as it was deprecated by upstream. The suggested replacement is the <code class="literal">npx expo</code> command.</p></li><li class="listitem"><p>The <code class="literal">conduwuit</code> matrix server implementation has officially been discontinued by upstream and the package has thus been marked as vulnerable, as it is a security-sensitive package that has reached EOL.</p></li><li class="listitem"><p>NetBox version 4.0.X available as <code class="literal">netbox_4_0</code> was removed. Please upgrade to <code class="literal">4.2</code>.</p></li><li class="listitem"><p><code class="literal">golangci-lint</code> has reached <code class="literal">v2</code>. Please read the changes and view the migration guide <a class="link" href="https://golangci-lint.run/product/changelog/#200"  target="_top">here</a>.</p></li><li class="listitem"><p><code class="literal">i3status-rust</code>-package no longer enables <code class="literal">notmuch</code> by default. It can be enabled via <code class="literal">withNotmuch</code>.</p></li><li class="listitem"><p><code class="literal">ocis-bin</code> has been renamed to <code class="literal">ocis_5-bin</code>. Future versions will have the major version suffix.</p></li><li class="listitem"><p>All support for 32‐bit Darwin systems has been dropped.</p></li><li class="listitem"><p><code class="literal">substituteAll</code> and <code class="literal">substituteAllFiles</code> have been deprecated in favor of <code class="literal">replaceVars</code> and will be removed in the next release.</p></li><li class="listitem"><p>Default ICU version updated from 74 to 76</p></li><li class="listitem"><p>The packages <code class="literal">signald</code>, <code class="literal">signaldctl</code> and <code class="literal">purple-signald</code> have been dropped as they are unmaintained upstream and have been incompatible with the official Signal servers for a long while.</p></li><li class="listitem"><p>Apache Kafka was updated to <code class="literal">&gt;= 4.0.0</code>. Please note that this is the first release which operates
entirely without Apache ZooKeeper support, and all clusters need to be migrated to KRaft mode. See
the <a class="link" href="https://kafka.apache.org/blog#apache_kafka_400_release_announcement"  target="_top">release announcement</a>
for more details.</p></li><li class="listitem"><p><code class="literal">ast-grep</code> remove <code class="literal">sg</code> command to prevent conflict with <code class="literal">sg</code> command from shadow-utils. If you need legacy sg command compatibility with old code, you can use <code class="literal">ast-grep.override { enableLegacySg = true; }</code></p></li><li class="listitem"><p>rename package <code class="literal">wtf</code> to <code class="literal">wtfutil</code>.</p></li><li class="listitem"><p><code class="literal">python3Packages.beancount</code> was updated to 3.1.0. Previous major version remains available as <code class="literal">python3Packages.beancount_2</code>.</p></li><li class="listitem"><p><code class="literal">wastebin</code> has been updated to 3.0.0. See the <a class="link" href="https://github.com/matze/wastebin/blob/master/CHANGELOG.md#300"  target="_top">Changelog</a> for breaking changes to the configuration.</p></li><li class="listitem"><p><code class="literal">binwalk</code> was updated to 3.1.0, which has been rewritten in rust. The python module is no longer available.
See the release notes of <a class="link" href="https://github.com/ReFirmLabs/binwalk/releases/tag/v3.1.0"  target="_top">3.1.0</a> for more information.</p></li><li class="listitem"><p><code class="literal">pkgs.nextcloud28</code> and <code class="literal">pkgs.nextcloud29</code> have been removed since they are out of support upstream.</p></li><li class="listitem"><p><code class="literal">centrifugo</code> was updated to v6, which uses a new config format. See <a class="link" href="https://centrifugal.dev/docs/getting-started/migration_v6"  target="_top">upstream documentation</a> for migration.</p></li><li class="listitem"><p><code class="literal">teleport</code> has been upgraded from major version 16 to major version 17.
Refer to <a class="link" href="https://goteleport.com/docs/upgrading/overview/"  target="_top">upstream upgrade instructions</a>
and <a class="link" href="https://goteleport.com/docs/changelog/#1701-11152024"  target="_top">release notes for v17</a>.</p></li><li class="listitem"><p>Emacs lisp build helpers, such as <code class="literal">emacs.pkgs.melpaBuild</code>, now enables <code class="literal">__structuredAttrs</code> by default.
Environment variables have to be passed via the <code class="literal">env</code> attribute.</p></li><li class="listitem"><p><code class="literal">buildGoModule</code> now passes environment variables via the <code class="literal">env</code> attribute. <code class="literal">CGO_ENABLED</code> should now be specified with <code class="literal">env.CGO_ENABLED</code> when passing to buildGoModule. Direct specification of <code class="literal">CGO_ENABLED</code> is now redirected by a compatibility layer with a warning, but will become an error in future releases.</p><p>Go-related environment variables previously shadowed by <code class="literal">buildGoModule</code> now results in errors when specified directly. Such variables include <code class="literal">GOOS</code> and <code class="literal">GOARCH</code>.</p><p>Third-party projects supporting both stable and unstable channels could detect this change through the absence of the <code class="literal">CGO_ENABLED</code> function argument in <code class="literal">buildGoModule</code> (<code class="literal">!((lib.functionArgs buildGoModule) ? CGO_ENABLED)</code>).</p></li><li class="listitem"><p><code class="literal">buildGoPackage</code> has been removed. Use <code class="literal">buildGoModule</code> instead. See the <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#sec-language-go"  target="_top">Go section in the nixpkgs manual</a> for details.</p></li><li class="listitem"><p><code class="literal">buildGoModule</code> now supports a <code class="literal">goSum</code> attribute (<code class="literal">null</code> by default) to optionally provide a path to <code class="literal">go.sum</code> and correctly enabling rebuilds when the file changes.</p></li><li class="listitem"><p>top-level <code class="literal">playwright</code> now refers to the github Microsoft/playwright package
instead of the python tester launcher. You can still refer to the python
launcher via <code class="literal">python3Packages.toPythonApplication python3Packages.playwright</code></p></li><li class="listitem"><p>The representation of the flags attributes as shell/environment variables for most Python building setup hooks are now the same as <code class="literal">stdenv.mkDerivation</code> and other build helpers – they are space-separated environment variables when <code class="literal">__structuredAttrs = false</code> and Bash arrays when <code class="literal">__structuredAttrs = true</code>, and are concatenated to the command without Bash-evaluation. The following behaviour changes are introduced during the conversion:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>The following flags are no longer Bash-expanded before concatenated to the command:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square;"><li class="listitem"><p><code class="literal">disabledTests</code> and <code class="literal">disabledTestPaths</code> for <code class="literal">pytestCheckHook</code>. (<code class="literal">disabledTestPaths</code> used to be expanded twice before concatenation.)</p></li><li class="listitem"><p><code class="literal">setupPyBuildFlags</code> and <code class="literal">setupPyGlobalFlags</code> for <code class="literal">setuptoolsBuildHook</code>.</p></li></ul></div></li><li class="listitem"><p><code class="literal">pytestFlags</code> and <code class="literal">unittestFlags</code> replace <code class="literal">pytestFlagsArray</code> and <code class="literal">unittestFlagsArray</code> and become the new and conforming interface.</p></li><li class="listitem"><p><code class="literal">pytestFlagsArray</code> and <code class="literal">unittestFlagsArray</code> are kept for compatibility purposes. They continue to be Bash-expanded before concatenated. This compatibility layer will be removed in future releases.</p></li></ul></div></li><li class="listitem"><p>The <code class="literal">haka</code> package and module has been removed because the package was broken and unmaintained for 9 years.</p></li><li class="listitem"><p>The <code class="literal">gsignond</code> package, plugins and module have been removed because they were unmaintained for 6 years.</p></li><li class="listitem"><p><code class="literal">strawberry</code> has been updated to 1.2, which drops support for the VLC backend and Qt 5. The <code class="literal">strawberry-qt5</code> package
and <code class="literal">withGstreamer</code>/<code class="literal">withVlc</code> override options have been removed due to this.</p></li><li class="listitem"><p><code class="literal">nexusmods-app</code> has been upgraded from version 0.6.3. If you were running a version older than 0.7.0, then before upgrading, you <span class="strong"><strong>must reset all app state</strong></span> (mods, games, settings, etc). Otherwise, NexusMods.App will crash due to app state files incompatibility.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Typically, you can can reset to a clean state by running <code class="literal">NexusMods.App uninstall-app</code>. See Nexus Mod’s <a class="link" href="https://nexus-mods.github.io/NexusMods.App/users/Uninstall"  target="_top">how to uninstall the app</a> documentation for more detail and alternative methods.</p></li><li class="listitem"><p>This should not be necessary going forward, because loading app state from 0.7.0 or newer is now supported. This is documented in the <a class="link" href="https://github.com/Nexus-Mods/NexusMods.App/releases/tag/v0.7.1"  target="_top">0.7.1 changelog</a>.</p></li></ul></div></li><li class="listitem"><p><code class="literal">nezha</code> and its agent <code class="literal">nezha-agent</code> have been updated to v1, which contains breaking changes. See the <a class="link" href="https://nezha.wiki/en_US/"  target="_top">official wiki</a> for more details.</p></li><li class="listitem"><p><code class="literal">ps3-disc-dumper</code> was updated to 4.2.5, which removed the CLI project and now exclusively offers the GUI</p></li><li class="listitem"><p><code class="literal">kmonad</code> is now hardened by default using common <code class="literal">systemd</code> settings.
If KMonad is used to execute shell commands, hardening may make some of them fail.  In that case, you can disable hardening using <code class="option">services.kmonad.keyboards.&lt;name&gt;.enableHardening</code> option.</p></li><li class="listitem"><p><code class="literal">isd</code> was updated from 0.2.0 to 0.5.1, the new version may crash with a previously generated config, try moving or deleting <code class="literal">~/.config/isd/schema.json</code>.</p></li><li class="listitem"><p><code class="literal">uwsgi</code> no longer supports Python 2 plugins.</p></li><li class="listitem"><p>Support for CUDA 10 has been dropped, as announced in the 24.11 release notes.</p></li><li class="listitem"><p><code class="literal">mepo</code> was updated to version 1.3.3.  The manual page was removed,
a new JSON API was introduced to replace Mepolang for configuration,
and a few default key bindings were changed.
See the <a class="link" href="https://git.sr.ht/~mil/mepo/refs/1.3.0"  target="_top">1.3.0 changelog</a>
for more details.</p></li><li class="listitem"><p><code class="literal">mkBinaryCache</code> now defaults to using <code class="literal">zstd</code> compression for the binary caches it creates. The previous <code class="literal">xz</code> compression method can be used by passing <code class="literal">compression = &quot;xz&quot;;</code>.</p></li><li class="listitem"><p><code class="literal">nodejs_latest</code> was updated from 23.x to 24.x. <code class="literal">nodejs_23</code> has been removed in favor of <code class="literal">nodejs_24</code>.</p></li><li class="listitem"><p><code class="literal">nodejs_18</code> package was removed due to upstream End-of-Life in April 2025.</p></li><li class="listitem"><p><code class="literal">nodePackages.&quot;@commitlint/config-conventional&quot;</code> has been removed, as it is a library, and projects should depend on it instead.</p></li><li class="listitem"><p>zigbee2mqtt is now available in version 2.x as <code class="literal">zigbee2mqtt_2</code>. In NixOS 25.11 we’ll remove <code class="literal">zigbee2mqtt_1</code> and default to <code class="literal">zigbee2mqtt_2</code>. See the <a class="link" href="https://github.com/Koenkk/zigbee2mqtt/discussions/24198"  target="_top">breaking changes</a> announcement for 2.0.0.</p></li><li class="listitem"><p><code class="literal">nodePackages.vls</code> has been deprecated, as the upstream consumer of it, vetur, has been deprecated by upstream. Upstream suggests migrating to Volar for Vue LSP tooling instead.</p></li><li class="listitem"><p><code class="literal">nodePackages.create-react-native-app</code> has been removed, as it is deprecated. Upstream suggests using a framework for React Native apps instead.</p></li><li class="listitem"><p><code class="literal">nodePackages.insect</code> has been removed, as it’s deprecated by upstream. The suggested replacement is <code class="literal">numbat</code>.</p></li><li class="listitem"><p><code class="literal">nodePackages.webpack-dev-server</code> has been removed, as it should be installed in projects that use it instead.</p></li><li class="listitem"><p><code class="literal">nodePackages.copy-webpack-plugin</code> has been removed, as it should be installed in projects that use it instead.</p></li><li class="listitem"><p><code class="literal">himalaya</code> has been updated from <code class="literal">v1.0.0-beta.4</code> to <code class="literal">v1.1.0</code>, which introduces breaking changes. Check out the <a class="link" href="https://github.com/pimalaya/himalaya/releases"  target="_top">release notes</a> for details.</p></li><li class="listitem"><p><code class="literal">linuxPackages.nvidiaPackages.dc_520</code> has been removed since it is marked broken and there are better newer alternatives.</p></li><li class="listitem"><p><code class="literal">pnpm</code> was updated to version 10. If your project is incompatible, you can install the previous version from the package attribute <code class="literal">pnpm_9</code>.</p></li><li class="listitem"><p><code class="literal">dwarf-fortress-packages</code> now only contains one minor version for each major version since version 0.44. Saves should still be compatible, but you may have to change which minor version you were using if it was one other than the newest.</p></li><li class="listitem"><p><code class="literal">tpm2-pkcs11</code> now is compiled without abrmd (Access Broker and Resource Manager Daemon) support by default, preferring the kernel resource manager. Use <code class="literal">tpm2-pkcs11.abrmd</code> if you would like a version with abrmd support. Note that the NixOS module picks the correct one automatically based on <code class="literal">security.tpm2.abrmd</code>.</p></li><li class="listitem"><p><code class="literal">zig_0_9</code> and <code class="literal">zig_0_10</code> have been removed, you should upgrade to <code class="literal">zig_0_13</code> (also available as just <code class="literal">zig</code>), <code class="literal">zig_0_12</code> or <code class="literal">zig_0_11</code> instead.</p></li><li class="listitem"><p><code class="literal">webpack-cli</code> was updated to major version 6, which has breaking changes from the previous version 5.1.4. See the <a class="link" href="https://github.com/webpack/webpack-cli/releases/tag/webpack-cli%406.0.0"  target="_top">upstream release notes</a> for details on these changes.</p></li><li class="listitem"><p><code class="literal">minetest</code> has been renamed to <code class="literal">luanti</code> to match the upstream name change but aliases have been added. The new name hasn’t resulted in many changes as of yet but older references to minetest should be sunset. See the <a class="link" href="https://blog.minetest.net/2024/10/13/Introducing-Our-New-Name/"  target="_top">new name announcement</a> for more details.</p></li><li class="listitem"><p><code class="literal">poac</code> has been renamed to <code class="literal">cabinpkg</code> to match the upstream name change but an alias has been added. See the <a class="link" href="https://github.com/orgs/cabinpkg/discussions/1052"  target="_top">new name announcement</a> for more details.</p></li><li class="listitem"><p><code class="literal">serious-sans</code> has been removed because upstream changed its name to Serious Shanns, which is not currently packaged.</p></li><li class="listitem"><p><code class="literal">racket_7_9</code> has been removed, as it is insecure. It is recommended to use Racket 8 instead.</p></li><li class="listitem"><p><code class="literal">rofi</code> has been updated from 1.7.5 to 1.7.6 which introduces some breaking changes to binary plugins, and also contains a lot of new features and bug fixes. This is highlighted because the patch version bump does not indicate the volume of changes by itself. See the <a class="link" href="https://github.com/davatorium/rofi/releases/tag/1.7.6"  target="_top">upstream release notes</a> for the full list of changes.</p></li><li class="listitem"><p><code class="literal">ente-auth</code> now uses the name <code class="literal">enteauth</code> for its binary. The previous name was <code class="literal">ente_auth</code>.</p></li><li class="listitem"><p><code class="literal">foundationdb</code> was upgraded to 7.3.</p></li><li class="listitem"><p><code class="literal">fluxus</code> has been removed, as it depends on <code class="literal">racket_7_9</code> and had no updates in 9 years.</p></li><li class="listitem"><p><code class="literal">meilisearch</code> has been upgraded from 1.11.3 to 1.14.0, which requires manually dumping and importing the data.
See Meilisearch’s <a class="link" href="https://www.meilisearch.com/docs/learn/update_and_migration/updating"  target="_top">upgrade guide</a> for more information.</p></li><li class="listitem"><p><code class="literal">sm64ex-coop</code> has been removed as it was archived upstream. Consider migrating to <code class="literal">sm64coopdx</code>.</p></li><li class="listitem"><p><code class="literal">tldr</code> now uses <a class="link" href="https://github.com/tldr-pages/tldr-python-client"  target="_top"><code class="literal">tldr-python-client</code></a> instead of <a class="link" href="https://github.com/tldr-pages/tldr-c-client"  target="_top"><code class="literal">tldr-c-client</code></a> which is unmaintained.</p></li><li class="listitem"><p>The behavior of the <code class="literal">networking.nat.externalIP</code> and <code class="literal">networking.nat.externalIPv6</code> options has been changed. <code class="literal">networking.nat.forwardPorts</code> now only forwards packets destined for the specified IP addresses.</p></li><li class="listitem"><p><code class="literal">python3Packages.bpycv</code> has been removed due to being incompatible with Blender 4 and unmaintained.</p></li><li class="listitem"><p><code class="literal">python3Packages.jaeger-client</code> was removed because it was deprecated upstream. <a class="link" href="https://opentelemetry.io"  target="_top">OpenTelemetry</a> is the recommended replacement.</p></li><li class="listitem"><p><code class="literal">nodePackages.meshcommander</code> has been removed, as the package was deprecated by Intel.</p></li><li class="listitem"><p>The default version of <code class="literal">z3</code> has been updated from 4.8 to 4.15, and all old versions have been dropped. Note that <code class="literal">fstar</code> still depends on specific versions, and maintains them as overrides.</p></li><li class="listitem"><p><code class="literal">prometheus</code> has been updated from 2.55.0 to 3.1.0.
Read the <a class="link" href="https://prometheus.io/blog/2024/11/14/prometheus-3-0/"  target="_top">release blog post</a> and
<a class="link" href="https://prometheus.io/docs/prometheus/3.1/migration/"  target="_top">migration guide</a>.</p></li><li class="listitem"><p><code class="literal">kanata</code> was updated to v1.8.0, which introduces several breaking changes.
See the release notes of
<a class="link" href="https://github.com/jtroo/kanata/releases/tag/v1.7.0"  target="_top">v1.7.0</a> and
<a class="link" href="https://github.com/jtroo/kanata/releases/tag/v1.8.0"  target="_top">v1.8.0</a>
for more information.</p></li><li class="listitem"><p><code class="literal">authelia</code> version 4.39.0 has made changes on the default claims for ID Tokens, to mirror the standard claims from the specification.
This change may affect some clients in unexpected ways, so manual intervention may be required.
Read the <a class="link" href="https://www.authelia.com/blog/4.39-release-notes/"  target="_top">release notes</a>, along with <a class="link" href="https://www.authelia.com/integration/openid-connect/openid-connect-1.0-claims/#restore-functionality-prior-to-claims-parameter"  target="_top">the guide</a> to work around issues that may be encountered.</p></li><li class="listitem"><p><code class="literal">ags</code> was updated to v2, which is just a CLI for Astal now. Components are available as a different package set <code class="literal">astal.*</code>.
If you want to use v1, it is available as <code class="literal">ags_1</code> package.</p><p>See the release notes of
<a class="link" href="https://github.com/Aylur/ags/releases/tag/v2.0.0"  target="_top">v2.0.0</a>
for more information.</p></li><li class="listitem"><p><code class="literal">nodePackages.expo-cli</code> has been removed, as it was deprecated by upstream. The suggested replacement is the <code class="literal">npx expo</code> command.</p></li><li class="listitem"><p><code class="literal">open-policy-agent</code> has has been updated to 1.0.0+.
This major release makes the <code class="literal">rego.v1</code> syntax the default.
This is a breaking change for those using v0 Rego.
See the <a class="link" href="https://www.openpolicyagent.org/docs/v1.0.1/v0-upgrade/"  target="_top">upgrade documentation</a> for more details.
For those unable to upgrade yet, there is a <a class="link" href="https://www.openpolicyagent.org/docs/v1.0.1/v0-compatibility/"  target="_top">v0 compatibility mode</a>
available too.</p></li><li class="listitem"><p><code class="literal">helmfile</code> was updated to v1.0.0, which introduces several breaking changes.
See the release notes of
<a class="link" href="https://github.com/helmfile/helmfile/releases/v1.0.0"  target="_top">v1.0.0</a> for more
information.</p></li><li class="listitem"><p><code class="literal">vscode-utils.buildVscodeExtension</code> now requires pname as an argument</p></li><li class="listitem"><p><code class="literal">nerdfonts</code> has been separated into individual font packages under the namespace <code class="literal">nerd-fonts</code>. The directories for font
files have changed from <code class="literal">$out/share/fonts/{opentype,truetype}/NerdFonts</code> to
<code class="literal">$out/share/fonts/{opentype,truetype}/NerdFonts/&lt;fontDirName&gt;</code>, where <code class="literal">&lt;fontDirName&gt;</code> can be found in the
<a class="link" href="https://www.nerdfonts.com/font-downloads"  target="_top">official website</a> as the titles in preview images, with the “Nerd Font”
suffix and any whitespaces trimmed. Configuration changes are required, see build output.</p></li><li class="listitem"><p><code class="literal">retroarch</code> has been refactored and the older <code class="literal">retroarch.override { cores = [ ... ]; }</code> to create a RetroArch derivation with custom cores doesn’t work anymore, use <code class="literal">retroarch.withCores (cores: [ ... ])</code> instead. If you need more customization (e.g.: custom settings), use <code class="literal">wrapRetroArch</code> instead.</p></li><li class="listitem"><p><code class="literal">borgmatic</code> has been updated from 1.8.14 to 1.9.5, please check the <a class="link" href="https://projects.torsion.org/borgmatic-collective/borgmatic/releases"  target="_top">upstream changelog</a> for more details, especially for a few possibly breaking changes noted in the <a class="link" href="https://projects.torsion.org/borgmatic-collective/borgmatic/releases/tag/1.9.0"  target="_top">1.9.0 changelog</a>.</p></li><li class="listitem"><p><code class="literal">nodePackages.ganache</code> has been removed, as the package has been deprecated by upstream.</p></li><li class="listitem"><p><code class="literal">matomo</code> now defaults to version 5 (previously available as <code class="literal">matomo_5</code>). Version 4 has been removed as it reached EOL on December 19, 2024.</p></li><li class="listitem"><p><code class="literal">matomo-beta</code> has been removed as the version of the <code class="literal">matomo</code> package can now be easily overridden through <code class="literal">overrideAttrs</code> (see <a class="link" href="https://github.com/NixOS/nixpkgs/pull/374022"  target="_top">PR #374022</a>)</p></li><li class="listitem"><p><code class="literal">docker_24</code> has been removed, as it was EOL with vulnerabilities since June 08, 2024.</p></li><li class="listitem"><p>Emacs 28 and 29 have been removed.</p></li><li class="listitem"><p>Emacs 28 Macport has been removed, while CVEs of Emacs 29 Macport are patched.</p></li><li class="listitem"><p><code class="literal">containerd</code> has been updated to v2, which contains breaking changes. See the <a class="link" href="https://github.com/containerd/containerd/blob/main/docs/containerd-2.0.md"  target="_top">containerd
2.0</a> documentation for more
details.</p></li><li class="listitem"><p>The <code class="literal">tinycc</code> package now has the <code class="literal">dev</code>, <code class="literal">doc</code> and <code class="literal">lib</code> outputs, thus,
<code class="literal">tinycc.out</code> may now only provide the tcc and cross compilers binaries.</p></li><li class="listitem"><p>The <code class="literal">testTarget</code> argument of <code class="literal">haskellPackages.mkDerivation</code> has been deprecated in favour of <code class="literal">testTargets</code>.
<code class="literal">testTarget</code> took a space separated string of targets, whereas the new <code class="literal">testTargets</code> argument takes a list of targets.
For instance, <code class="literal">testTarget = &quot;foo bar baz&quot;</code> should become <code class="literal">testTargets = [ &quot;foo&quot; &quot;bar&quot; &quot;baz&quot; ]</code>.</p></li><li class="listitem"><p><code class="literal">rustPlatform.buildRustPackage</code> stops handling the deprecated argument <code class="literal">cargoSha256</code>. Out-of-tree packages that haven’t migrated from <code class="literal">cargoSha256</code> to <code class="literal">cargoHash</code> now receive errors.</p></li><li class="listitem"><p><code class="literal">nodePackages.stackdriver-statsd-backend</code> has been removed, as the StackDriver service has been discontinued by Google, and therefore the package no longer works.</p></li><li class="listitem"><p><code class="literal">python3Packages.opentracing</code> has been removed due to being unmaintained upstream. <a class="link" href="https://opentelemetry.io/"  target="_top">OpenTelemetry</a> is the recommended replacement.</p></li><li class="listitem"><p>the notmuch vim plugin now lives in a separate output of the <code class="literal">notmuch</code>
package. Installing <code class="literal">notmuch</code> will not bring the notmuch vim package anymore,
add <code class="literal">vimPlugins.notmuch-vim</code> to your (Neo)vim configuration if you want the
vim plugin.</p></li><li class="listitem"><p><code class="literal">prisma</code> and <code class="literal">prisma-engines</code> have been updated to version 6.7.0, which
introduces several breaking changes. See the
<a class="link" href="https://www.prisma.io/docs/orm/more/upgrade-guides/upgrading-versions/upgrading-to-prisma-6"  target="_top">Prisma ORM upgrade guide</a>
for more information.</p></li><li class="listitem"><p><code class="literal">dependency-track</code> no longer bundes the UI inside the jar. This bundling
functionality is deprecated by upstream and causes UI assets not being served
after weeks of runtime.</p></li><li class="listitem"><p><code class="literal">nq</code> was updated to 1.0, which renames the <code class="literal">fq</code> and <code class="literal">tq</code> utilities to <code class="literal">nqtail</code> and <code class="literal">nqterm</code> respectively.</p></li><li class="listitem"><p><code class="literal">zf</code> was updated to 0.10.2, which includes breaking changes from the <a class="link" href="https://github.com/natecraddock/zf/releases/tag/0.10.0"  target="_top">0.10.0 release</a>.
<code class="literal">zf</code> no longer does Unicode normalization of the input and no longer supports terminal escape sequences in the <code class="literal">ZF_PROMPT</code> environment variable.</p></li><li class="listitem"><p><code class="literal">confluent-cli</code> was updated from 3.60.0 to 4.16.0, which includes several breaking changes as detailed in <a class="link" href="https://docs.confluent.io/confluent-cli/current/release-notes.html"  target="_top">Confluent’s release notes</a>.</p></li><li class="listitem"><p><code class="literal">siduck76-st</code> has been renamed to <code class="literal">st-snazzy</code>, like the project’s <a class="link" href="https://github.com/siduck/st/blob/main/flake.nix"  target="_top">flake</a>.</p></li><li class="listitem"><p><code class="literal">python3Packages.jax</code> now directly depends on <code class="literal">python3Packages.jaxlib</code>.
As a result, packages that depend on jax no longer need to include jaxlib to their dependencies.
There is also a breaking change in the handling of CUDA. Instead of using a CUDA compatible jaxlib
as before, you can use plugins like <code class="literal">python3Packages.jax-cuda12-plugin</code>.</p></li><li class="listitem"><p>Added <code class="literal">allowVariants</code> to gate availability of package sets like <code class="literal">pkgsLLVM</code>, <code class="literal">pkgsMusl</code>, <code class="literal">pkgsZig</code>, etc. This was done in an effort to
decrease evaluation times by limiting the number of instances of nixpkgs to evaluate. The option will be removed in the future as a
new mechanism is in the works for handling cross compilation.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="sec-nixpkgs-release-25.05-notable-changes" class="title" >Other Notable Changes   </h5>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">i18n</code> module improvements:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">i18n.extraLocales</code> should now be the preferred way to install additional locales.</p></li><li class="listitem"><p><code class="literal">i18n.supportedLocales</code> is now considered an implementation detail and will be hidden from the documentation. But the option will still continue to work.</p></li><li class="listitem"><p><code class="literal">i18n.supportedLocales</code> will now trigger a warning when it omits any locale set in <code class="literal">i18n.defaultLocale</code>, <code class="literal">i18n.extraLocales</code> or <code class="literal">i18n.extraLocaleSettings</code>.</p></li><li class="listitem"><p>The options <code class="literal">i18n.defaultCharset</code> &amp; <code class="literal">i18n.localeCharsets</code> were added, and they complement <code class="literal">i18n.defaultLocale</code> &amp; <code class="literal">i18n.extraLocaleSettings</code> respectively - allowing to control the character set used per locale setting.</p></li></ul></div></li><li class="listitem"><p>Plasma 5 and Qt 5 based versions of associated software are deprecated in NixOS 25.05, and will be removed in NixOS 25.11. Users are encouraged to upgrade to Plasma 6.</p></li><li class="listitem"><p><code class="literal">titaniumenv</code>, <code class="literal">titanium</code>, and <code class="literal">titanium-alloy</code> have been removed due to lack of maintenance in Nixpkgs <span id="sec-nixpkgs-release-25.05-incompatibilities-titanium-removed"></span>.</p></li><li class="listitem"><p><a class="link" href="https://cursor.com/"  target="_top">Cursor</a> — a vscode-based editor that uses AI to help you write code faster — has been packaged as <code class="literal">cursor</code>.</p></li><li class="listitem"><p><code class="literal">octave</code> (and <code class="literal">octaveFull</code>) was updated to version <code class="literal">10.x</code>. The update broke a few <code class="literal">octavePackages</code>, and <code class="literal">librsb</code>. See <a class="link" href="https://github.com/NixOS/nixpkgs/pull/394495/commits"  target="_top">the PR’s commits</a> for more details.</p></li><li class="listitem"><p>androidenv has been improved:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>All versions specified in composeAndroidPackages now track the latest. Android packages are automatically updated on unstable, and run the androidenv test suite on every update.</p></li><li class="listitem"><p>Many androidenv packages are now searchable on <a class="link" href="https://search.nixos.org"  target="_top">search.nixos.org</a>.</p></li><li class="listitem"><p>We now use the latest Google repositories, which should improve aarch64-darwin compatibility. The SDK now additionally evaluates on aarch64-linux, though not all packages are functional.</p></li></ul></div></li><li class="listitem"><p><code class="literal">dwarf-fortress</code> audio now works again. Additionally, the <code class="literal">dfhack</code> and <code class="literal">dwarf-fortress-full</code> packages are now exposed at toplevel, making it easier to install and play Dwarf Fortress. Note that <code class="literal">dwarf-fortress-full</code> is the Nixpkgs equivalent of the Dwarf Fortress Lazy Pack.</p></li><li class="listitem"><p><code class="literal">gerbera</code> now has wavpack support.</p></li><li class="listitem"><p><code class="literal">buildPythonPackage</code>, <code class="literal">buildPythonApplication</code> and the Python building setup hooks now support both <code class="literal">__structuredAttrs = true</code> and <code class="literal">__structuredAttrs = false</code>.</p></li><li class="listitem"><p><code class="literal">buildGoModule</code> now supports a self-referencing <code class="literal">finalAttrs:</code> parameter
containing the final arguments including overrides.
This allows packaging configuration to be overridden in a consistent manner by
providing an alternative to <code class="literal">rec {}</code> syntax.</p></li><li class="listitem"><p>Caddy can now be built with plugins by using <code class="literal">caddy.withPlugins</code>, a <code class="literal">passthru</code> function that accepts an attribute set as a parameter. The <code class="literal">plugins</code> argument represents a list of Caddy plugins, with each Caddy plugin being a versioned module. The <code class="literal">hash</code> argument represents the <code class="literal">vendorHash</code> of the resulting Caddy source code with the plugins added.</p><p>Example:</p><pre><code class="programlisting nix">let
  pkgs = import &lt;nixpkgs&gt; { };
in

pkgs.caddy.withPlugins {
  plugins = [
    # tagged upstream
    &quot;github.com/caddy-dns/powerdns@v1.0.1&quot;
    # pseudo-version number generated by Go
    &quot;github.com/caddy-dns/cloudflare@v0.0.0-20240703190432-89f16b99c18e&quot;
    &quot;github.com/mholt/caddy-webdav@v0.0.0-20241008162340-42168ba04c9d&quot;
  ];
  hash = &quot;sha256-wqXSd1Ep9TVpQi570TTb96LwzNYvWL5EBJXMJfYWCAk=&quot;;
}
</code></pre><p>To get the necessary hash of the vendored dependencies, omit <code class="literal">hash</code>. The build will fail and tell you the correct value.</p><p>Note that all provided plugins must have versions/tags (string after <code class="literal">@</code>), even if upstream repo does not tag each release. For untagged plugins, you can either create an empty Go project and run <code class="literal">go get &lt;plugin&gt;</code> and see changes in <code class="literal">go.mod</code> to get the pseudo-version number, or provide a commit hash in place of version/tag for the first run, and update the plugin string based on the error output.</p></li><li class="listitem"><p>The <code class="literal">godot-export-templates</code> package now has its content at <code class="literal">share/godot/export_templates/$version</code> instead of the output root. This makes it more convenient for for symlinking into <code class="literal">~/.local</code>, but scripts expecting the old layout will need to be changed.</p></li><li class="listitem"><p>GOverlay has been updated to 1.2, please check the <a class="link" href="https://github.com/benjamimgois/goverlay/releases"  target="_top">upstream changelog</a> for more details.</p></li><li class="listitem"><p><code class="literal">tpm2-pkcs11</code> now has the variant <code class="literal">tpm2-pkcs11-fapi</code>, which has been patched to default to the Feature API backend. It has also been split into <code class="literal">tpm2-pkcs11-esapi</code>, which <span class="emphasis"><em>only</em></span> supports the older Enhanced System API backend. Note the <a class="link" href="https://github.com/tpm2-software/tpm2-pkcs11/blob/1.9.1/docs/FAPI.md"  target="_top">differences</a>, and that <code class="literal">tpm2-pkcs11</code> itself still needs <code class="literal">TPM2_PKCS11_BACKEND=fapi</code> exported in order to use the Feature API, whereas <code class="literal">tpm2-pkcs11-fapi</code> does not, and <code class="literal">tpm2-pkcs11-esapi</code> just does not support fapi entirely.</p></li><li class="listitem"><p>For matrix homeserver Synapse we are now following the upstream recommendation to enable jemalloc as the memory allocator by default.</p></li><li class="listitem"><p>Mattermost, a self-hosted chat collaboration platform supporting calls, playbooks, and boards, has been updated. It now has multiple versions, disabled telemetry, and a native frontend build in nixpkgs, removing all upstream prebuilt blobs.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>A new <code class="literal">pkgs.mattermost.buildPlugin</code> function has been added, which allows plugins to be built from source, including webapp frontends with a supported package-lock.json. See the Mattermost NixOS test and <a class="link" href="https://nixos.org/manual/nixos/unstable#sec-mattermost-plugins-build"  target="_top">manual</a> for an example.</p></li><li class="listitem"><p>The Mattermost frontend is now built from source and can be overridden. Note that the Mattermost derivation containing both the webapp and server is now wrapped to allow them to be built independently, so overrides to both webapp and server look like <code class="literal">mattermost.overrideAttrs (prev: { webapp = prev.webapp.override { ... }; server = prev.server.override { ... }; })</code> now.</p></li><li class="listitem"><p><code class="literal">pkgs.mattermost</code> has been updated from 9.11 to 10.5 to track the latest extended support release, since 9.11 will become end-of-life during the lifetime of NixOS 25.05.</p></li><li class="listitem"><p><code class="literal">pkgs.mattermostLatest</code> is now an option to track the latest (non-prerelease) Mattermost release. We test upgrade migrations from ESR releases (<code class="literal">pkgs.mattermost</code>) to <code class="literal">pkgs.mattermostLatest</code>.</p></li></ul></div></li><li class="listitem"><p>A new hardening flag, <code class="literal">nostrictaliasing</code> was made available, corresponding to the gcc/clang option <code class="literal">-fno-strict-aliasing</code>.</p></li><li class="listitem"><p>The <code class="literal">stackclashprotection</code> hardening flag has been enabled by default on compilers that support it.</p></li><li class="listitem"><p>In <code class="literal">dovecot</code> package removed hard coding path to module directory.</p></li><li class="listitem"><p><code class="literal">authelia</code> version 4.39.0 has made some changes which deprecate older configurations.
They are still expected to be working until future version 5.0.0, but will generate warnings in logs.
Read the <a class="link" href="https://www.authelia.com/blog/4.39-release-notes/"  target="_top">release notes</a> for human readable summaries of the changes.</p></li><li class="listitem"><p><code class="literal">hddfancontrol</code> has been updated to major release 2. See the <a class="link" href="https://github.com/desbma/hddfancontrol/tree/master?tab=readme-ov-file#migrating-from-v1x"  target="_top">migration guide</a>, as there are breaking changes.</p></li><li class="listitem"><p><code class="literal">nextcloud-news-updater</code> is unmaintained and was removed from nixpkgs.</p></li><li class="listitem"><p>KDE Partition Manager <code class="literal">partitionmanager</code>’s support for ReiserFS is removed.
ReiserFS has not been actively maintained for many years. It has been marked as obsolete since Linux 6.6, and
<a class="link" href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=c01f664e4ca210823b7594b50669bbd9b0a3c3b0"  target="_top">is removed</a>
in Linux 6.13.</p></li><li class="listitem"><p><code class="literal">gerbera</code> now has wavpack support.</p></li><li class="listitem"><p><code class="literal">signal-desktop</code> has been migrated to a from source build. No state migration is necessary. In case there’s no working source build available (like on Darwin), the the binary build is still available at <code class="literal">signal-desktop-bin</code>.</p></li><li class="listitem"><p><code class="literal">ddclient</code> was updated from 3.11.2 to 4.0.0 <a class="link" href="https://github.com/ddclient/ddclient/releases/tag/v4.0.0"  target="_top">Release notes</a></p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="sec-nixpkgs-release-25.05-lib" class="title" >Nixpkgs Library   </h5>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="sec-nixpkgs-release-25.05-lib-breaking" class="title" >Breaking changes   </h6>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Structure of the <code class="literal">functor</code> of some types has changed. <code class="literal">functor</code> is an implementation detail and should not be relied upon. If you did rely on it let us know in this <a class="link" href="https://github.com/NixOS/nixpkgs/pull/363565"  target="_top">PR</a>.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixos/unstable/#sec-option-types-basic"  target="_top"><code class="literal">lib.types.enum</code></a>: Previously the <code class="literal">functor.payload</code> was the list of enum values directly. Now it is an attribute set containing the values in the <code class="literal">values</code> attribute.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixos/unstable/#sec-option-types-string"  target="_top"><code class="literal">lib.types.separatedString</code></a>: Previously the <code class="literal">functor.payload</code> was the separator directly. Now it is an attribute set containing the separator in the <code class="literal">sep</code> attribute.</p></li></ul></div></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.filesystem.packagesFromDirectoryRecursive"  target="_top"><code class="literal">lib.packagesFromDirectoryRecursive</code></a> now rejects unknown arguments.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="sec-nixpkgs-release-25.05-lib-deprecations" class="title" >Deprecations   </h6>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">functor</code> is an implementation detail and should not be relied upon, but since its status wasn’t clear and it has had some use cases without alternatives, changes are being handled as gracefully as possible. Deprecations within functor:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">functor.wrapped</code> is now deprecated for some types and using it will give a warning with migration instructions. It is deprecated for these types:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square;"><li class="listitem"><p><code class="literal">lib.types.attrsWith</code></p></li><li class="listitem"><p><code class="literal">lib.types.listOf</code></p></li><li class="listitem"><p><code class="literal">lib.types.unique</code> and <code class="literal">lib.types.uniq</code></p></li><li class="listitem"><p><code class="literal">lib.types.nullOr</code></p></li><li class="listitem"><p><code class="literal">lib.types.functionTo</code></p></li><li class="listitem"><p><code class="literal">lib.types.coercedTo</code></p></li><li class="listitem"><p><code class="literal">lib.types.either</code></p></li></ul></div></li></ul></div></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h6 id="sec-nixpkgs-release-25.05-lib-additions-improvements" class="title" >Additions and Improvements   </h6>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.filesystem.packagesFromDirectoryRecursive"  target="_top"><code class="literal">lib.packagesFromDirectoryRecursive</code></a> can now construct nested scopes matching the directory tree passed as input.</p></li></ul></div>
</div>

</div>

</div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-24.11" class="title" style="clear: both">Release 24.11 (“Vicuña”, 2024.11/28)   </h2>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-24.11-highlights" class="title" >Highlights   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Nix was updated to 2.24, which brings a lot of improvements and fixes. See the release notes for
<a class="link" href="https://nix.dev/manual/nix/latest/release-notes/rl-2.19"  target="_top">2.19</a>,
<a class="link" href="https://nix.dev/manual/nix/latest/release-notes/rl-2.20"  target="_top">2.20</a>,
<a class="link" href="https://nix.dev/manual/nix/latest/release-notes/rl-2.21"  target="_top">2.21</a>,
<a class="link" href="https://nix.dev/manual/nix/latest/release-notes/rl-2.22"  target="_top">2.22</a>,
<a class="link" href="https://nix.dev/manual/nix/latest/release-notes/rl-2.23"  target="_top">2.23</a>,
<a class="link" href="https://nix.dev/manual/nix/latest/release-notes/rl-2.24"  target="_top">2.24</a>.
Notable changes include improvements to Git fetching, documentation comment support in <code class="literal">nix-repl&gt; :doc</code>, as well as many quality of life additions.</p></li><li class="listitem"><p>There have been significant changes to macOS support.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>The build environment has been redesigned to be closer to a native Xcode toolchain, enabling us to provide all SDKs from macOS Sierra 10.12 to macOS Sequoia 15, simplify build definitions, and build more software without hacks or patching.
Although compatibility shims for the old SDK scheme are provided, some builds may break, and the old mechanisms will be removed by 25.11 at the latest.
See the <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-darwin"  target="_top">Darwin section</a> of the Nixpkgs manual for details of the new scheme and how to use it, and <a class="link" href="https://discourse.nixos.org/t/the-darwin-sdks-have-been-updated/55295"  target="_top">the announcement on Discourse</a> for more information on the changes and benefits.</p></li><li class="listitem"><p><span class="strong"><strong>This will be the last release of Nixpkgs to support macOS Sierra 10.12 to macOS Catalina 10.15.</strong></span>
Starting with release 25.05, the minimum supported version will be macOS Big Sur 11, and we cannot guarantee that packages will continue to work on older versions of macOS.
Users on old macOS versions should consider upgrading to a supported version (potentially using <a class="link" href="https://dortania.github.io/OpenCore-Legacy-Patcher/"  target="_top">OpenCore Legacy Patcher</a> for old hardware) or installing NixOS.
If neither of those options are viable and you require new versions of software, <a class="link" href="https://www.macports.org/"  target="_top">MacPorts</a> supports versions back to Mac OS X Snow Leopard 10.6.</p></li></ul></div></li><li class="listitem"><p>This will be the last release of Nixpkgs to support versions of CUDA prior to CUDA 12.0.
These versions only work with old compiler versions that will be unsupported by the time of the Nixpkgs 25.05 release.
In the future, users should expect CUDA versions to be dropped as the compiler versions they require leave upstream support windows.</p></li><li class="listitem"><p>Convenience options for <code class="literal">amdgpu</code>, the open source driver for Radeon cards, are now available under <a class="link" href="options.html#opt-hardware.amdgpu.initrd.enable"  ><code class="literal">hardware.amdgpu</code></a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/GPUOpen-Drivers/AMDVLK"  target="_top">AMDVLK</a>, AMD’s open source Vulkan driver, is now available to be configured under the <a class="link" href="options.html#opt-hardware.amdgpu.amdvlk.enable"  ><code class="literal">hardware.amdgpu.amdvlk</code></a> option.
This also allows configuring runtime settings for AMDVLK, including enabling experimental features.</p></li><li class="listitem"><p>The <code class="literal">moonlight-qt</code> package (for <a class="link" href="https://moonlight-stream.org/"  target="_top">Moonlight game streaming</a>) now has HDR support on Linux systems.</p></li><li class="listitem"><p><a class="link" href="https://github.com/sched-ext/scx"  target="_top">Sched-ext</a>, a Linux kernel feature to run schedulers in userspace, is now available <a class="link" href="options.html#opt-services.scx.enable"  target="_top"><code class="literal">services.scx</code></a>.
Requires Linux kernel version 6.12 or later.</p></li><li class="listitem"><p>PostgreSQL now defaults to major version 16.</p></li><li class="listitem"><p>GNOME has been updated to version 47. Refer to the <a class="link" href="https://release.gnome.org/47/"  target="_top">release notes</a> for more details.</p></li><li class="listitem"><p><code class="literal">authelia</code> has been upgraded to version 4.38. This version brings several features and improvements which are detailed in the <a class="link" href="https://www.authelia.com/blog/4.38-release-notes/"  target="_top">release blog post</a>.
This release also deprecates some configuration keys which are likely to be removed in version 5.0.0.</p></li><li class="listitem"><p><code class="literal">netbird</code> has been updated to 0.31.1. This adds a built-in relay server which is not yet supported by the NixOS module, as well as a metrics endpoint for both the management and signal services. The default metrics port for the <code class="literal">signal</code> service has been changed from <code class="literal">9090</code> to <code class="literal">9091</code> to prevent a port conflict with the management server. This can be changed with their respective <code class="literal">metricsPort</code> as needed. Refer to the <a class="link" href="https://github.com/netbirdio/netbird/releases/tag/v0.31.1"  target="_top">release notes</a> and <a class="link" href="https://github.com/NixOS/nixpkgs/pull/354032#issuecomment-2480925927"  target="_top">this pull request</a> for more information.</p></li><li class="listitem"><p><code class="literal">compressDrv</code> can compress selected files in a derivation. <code class="literal">compressDrvWeb</code> compresses files for common web server usage (<code class="literal">.gz</code> with <code class="literal">zopfli</code>, <code class="literal">.br</code> with <code class="literal">brotli</code>).</p></li><li class="listitem"><p><a class="link" href="options.html#opt-hardware.display.edid.enable"  ><code class="literal">hardware.display</code></a> is a new module implementing workarounds for misbehaving monitors
by setting up custom EDID files and forcing kernel/framebuffer modes.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.displayManager.ly.enable"  ><code class="literal">services.displayManager.ly</code></a> is a new module for configuring the display manager <a class="link" href="https://github.com/fairyglade/ly"  target="_top">ly</a>,
a TUI-based replacement for SDDM and LightDM meant for window manager users.</p></li><li class="listitem"><p><code class="literal">srcOnly</code> was rewritten to be more readable, have additional warnings in the event that something is probably wrong, use the <code class="literal">stdenv</code> provided by the derivation, and Noogle-compatible documentation was added.</p></li><li class="listitem"><p>The default sound server for most graphical sessions has been switched from PulseAudio to PipeWire.
Users that want to keep using PulseAudio will want to set <code class="literal">services.pipewire.enable = false;</code> and <code class="literal">hardware.pulseaudio.enable = true;</code>.
There is currently no plan to fully deprecate and remove PulseAudio, however, PipeWire should generally be preferred for new installs.</p></li><li class="listitem"><p>The Rust rewrite of the <code class="literal">switch-to-configuration</code> program is now used for system activation by default.
If you experience any issues, please report them.
The original Perl script is deprecated and is planned for removal in the 25.05 release. It will remain accessible until then by setting <code class="literal">system.switch.enableNg</code> to <code class="literal">false</code>.</p></li><li class="listitem"><p>Support for mounting filesystems from block devices protected with <a class="link" href="https://docs.kernel.org/admin-guide/device-mapper/verity.html"  target="_top">dm-verity</a>
was added through the <a class="link" href="options.html#opt-boot.initrd.systemd.dmVerity.enable"  ><code class="literal">boot.initrd.systemd.dmVerity</code></a> option.</p></li><li class="listitem"><p>The <a class="link" href="https://xenproject.org"  target="_top">Xen Project Hypervisor</a> is once again available as a virtualisation option under <a class="link" href="options.html#opt-virtualisation.xen.enable"  ><code class="literal">virtualisation.xen</code></a>.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>This release includes Xen <a class="link" href="https://wiki.xenproject.org/wiki/Xen_Project_4.19_Release_Notes"  target="_top">4.19.0</a> and support for booting the hypervisor on EFI systems.</p></li></ul></div><div class="warning"><h3 class="title">Warning</h3><p>Booting into the Xen Project Hypervisor through a legacy BIOS bootloader or with the legacy script-based Stage 1 initrd have been <span class="strong"><strong>deprecated</strong></span>. Only EFI booting and the new systemd-based Stage 1 initrd are supported.</p></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>The <code class="literal">qemu-xen-traditional</code> component has been deprecated by the upstream Xen Project, and is no longer included in the Xen build.</p></li><li class="listitem"><p>The OCaml-based Xen Store can now be configured using  <a class="link" href="options.html#opt-virtualisation.xen.store.settings"  ><code class="literal">virtualisation.xen.store.settings</code></a>.</p></li><li class="listitem"><p>The <code class="literal">virtualisation.xen.bridge</code> options have been deprecated in this release cycle. Users who need network bridges are encouraged to set up their own networking configurations.</p></li></ul></div></li><li class="listitem"><p>A new option <a class="link" href="options.html#opt-systemd.enableStrictShellChecks"  ><code class="literal">systemd.enableStrictShellChecks</code></a> has been added. When enabled, all systemd scripts generated by NixOS will
be checked with <a class="link" href="https://www.shellcheck.net"  target="_top">shellcheck</a> and any errors or warnings will cause the build to fail.
This affects all scripts that have been created through the <code class="literal">script</code>, <code class="literal">reload</code>, <code class="literal">preStart</code>, <code class="literal">postStart</code>, <code class="literal">preStop</code> and <code class="literal">postStop</code> options for systemd services.
This does not affect commandlines passed directly to <code class="literal">ExecStart</code>, <code class="literal">ExecReload</code>, <code class="literal">ExecStartPre</code>, <code class="literal">ExecStartPost</code>, <code class="literal">ExecStop</code> or <code class="literal">ExecStopPost</code>.
It therefore also does not affect systemd units that are coming from packages and that are not defined through the NixOS config.
This option is disabled by default, and although some services have already been fixed, it is still likely that you will encounter build failures when enabling this.
We encourage people to enable this option when they are willing and able to submit fixes for potential build failures to nixpkgs.
The option can also be enabled or disabled for individual services using the <code class="literal">enableStrictShellChecks</code> option on the service itself, which will take precedence over the global setting.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-24.11-new-modules" class="title" >New Modules   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="options.html#hardware-block.defaultScheduler"  target="_top">hardware.block</a> allows configuration of I/O schedulers for block devices.</p></li><li class="listitem"><p><a class="link" href="https://github.com/kmonad/kmonad"  target="_top">KMonad</a>, an advanced keyboard remapping utility. Available as <a class="link" href="options.html#opt-services.kmonad.enable"  >services.kmonad</a>.</p></li><li class="listitem"><p><a class="link" href="https://coral.ai/"  target="_top">Coral</a>, hardware support for Coral.ai Edge TPU devices. Available as <a class="link" href="options.html#opt-hardware.coral.usb.enable"  >hardware.coral.usb.enable</a> and <a class="link" href="options.html#opt-hardware.coral.pcie.enable"  >hardware.coral.pcie.enable</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/cyrusimap/cyrus-imapd"  target="_top">Cyrus IMAP</a>, an email, contacts and calendar server. Available as <a class="link" href="options.html#opt-services.cyrus-imap.enable"  >services.cyrus-imap</a> service.</p></li><li class="listitem"><p><a class="link" href="https://github.com/GothenburgBitFactory/taskchampion-sync-server"  target="_top">TaskChampion Sync-Server</a>, a <a class="link" href="https://taskwarrior.org/docs/upgrade-3/"  target="_top">Taskwarrior 3</a> sync server. Available as <a class="link" href="options.html#opt-services.taskchampion-sync-server.enable"  >services.taskchampion-sync-server</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/FlareSolverr/FlareSolverr"  target="_top">FlareSolverr</a>, a proxy server to bypass Cloudflare protection. Available as <a class="link" href="options.html#opt-services.flaresolverr.enable"  >services.flaresolverr</a>.</p></li><li class="listitem"><p><a class="link" href="https://wiki.servarr.com/en/whisparr"  target="_top">Whisparr</a>, an adult movie collection manager for Usenet and BitTorrent users. Available as <a class="link" href="options.html#opt-services.whisparr.enable"  >services.whisparr</a>.</p></li><li class="listitem"><p><a class="link" href="https://gancio.org/"  target="_top">Gancio</a>, a shared agenda for local communities. Available as <a class="link" href="options.html#opt-services.gancio.enable"  >services.gancio</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.goatcounter.com/"  target="_top">Goatcounter</a>, an easy web analytics platform with no tracking of personal data. Available as <a class="link" href="options.html#opt-services.goatcounter.enable"  target="_top">services.goatcounter</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/PrivateBin/PrivateBin/"  target="_top">Privatebin</a>, a minimalist, open source online pastebin where the server has zero knowledge of pasted data. Available as <a class="link" href="options.html#opt-services.privatebin.enable"  >services.privatebin</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/Vladimir-csp/uwsm"  target="_top">UWSM</a>, a wayland session manager to wrap Wayland compositors into useful systemd units such as <code class="literal">graphical-session.target</code>. Available as <a class="link" href="options.html#opt-programs.uwsm.enable"  >programs.uwsm</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/open-webui/open-webui"  target="_top">Open-WebUI</a>, a user-friendly WebUI for LLMs. Available as <a class="link" href="options.html#opt-services.open-webui.enable"  >services.open-webui</a>.</p></li><li class="listitem"><p><a class="link" href="https://quickwit.io"  target="_top">Quickwit</a>, a sub-second search &amp; analytics engine on cloud storage. Available as <a class="link" href="options.html#opt-services.quickwit.enable"  target="_top">services.quickwit</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/nikstur/userborn"  target="_top">Userborn</a>, a service for declarative
user management. This can be used instead of the <code class="literal">update-users-groups.pl</code>
Perl script and/or systemd-sysusers. This is now recommended over
systemd-sysusers to achieve a system without Perl, as it can create normal
users and change passwords. Available as <a class="link" href="options.html#opt-services.userborn.enable"  >services.userborn</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/MatMoul/g810-led"  target="_top">g810-led</a>, a LED controller for Logitech G keyboards. Available as <a class="link" href="options.html#opt-services.g810-led.enable"  target="_top">services.g810-led</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/importantimport/hatsu"  target="_top">Hatsu</a>, a self-hosted bridge that interacts with Fediverse on behalf of your static site. Available as <a class="link" href="options.html#opt-services.hatsu.enable"  target="_top">services.hatsu</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/ImVaskel/soteria"  target="_top">Soteria</a>, a polkit authentication agent to handle elevated prompts for any desktop environment. Normally this should only be used on DEs or WMs that do not provide a graphical polkit frontend on their own. Available as <a class="link" href="options.html#opt-security.soteria.enable"  ><code class="literal">security.soteria</code></a>.</p></li><li class="listitem"><p><a class="link" href="https://flood.js.org/"  target="_top">Flood</a>, a beautiful WebUI for various torrent clients. Available as <a class="link" href="options.html#opt-services.flood.enable"  target="_top">services.flood</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/YaLTeR/niri"  target="_top">Niri</a>, a scrollable-tiling Wayland compositor. Available as <a class="link" href="options.html#opt-programs.niri.enable"  target="_top">programs.niri</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/firefly-iii/data-importer"  target="_top">Firefly-iii Data Importer</a>, a data importer for Firefly-III. Available as <a class="link" href="options.html#opt-services.firefly-iii-data-importer.enable"  target="_top">services.firefly-iii-data-importer</a>.</p></li><li class="listitem"><p><a class="link" href="https://dashy.to"  target="_top">Dashy</a>, an open source, highly customizable, easy to use, privacy-respecting dashboard app. Available as <a class="link" href="options.html#opt-services.dashy"  target="_top">services.dashy</a>.</p></li><li class="listitem"><p>[QGroundControl], a ground station support and configuration manager for the PX4 and APM Flight Stacks. Available as <a class="link" href="options.html#opt-programs.qgroundcontrol.enable"  target="_top">programs.qgroundcontrol</a>.</p></li><li class="listitem"><p><a class="link" href="https://eintopf.info"  target="_top">Eintopf</a>, a community event and calendar web application. Available as <a class="link" href="options.html#opt-services.eintopf.enable"  target="_top">services.eintopf</a>.</p></li><li class="listitem"><p><a class="link" href="https://codeberg.org/iff/pay-respects"  target="_top"><code class="literal">pay-respects</code></a>, a terminal command correction program, alternative to <code class="literal">thefuck</code>, written in Rust. Available as <a class="link" href="options.html#opt-programs.pay-respects"  target="_top">programs.pay-respects</a>.</p></li><li class="listitem"><p><a class="link" href="https://radicle.xyz"  target="_top">Radicle</a>, an open source, peer-to-peer code collaboration stack built on Git. Available as <a class="link" href="options.html#opt-services.radicle.enable"  >services.radicle</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/snu-sf/Ordinal"  target="_top">Ordinal</a>, A library for ordinal numbers in the Coq proof assistant.</p></li><li class="listitem"><p><a class="link" href="https://github.com/qdm12/ddns-updater"  target="_top">ddns-updater</a>, a service with a WebUI to update DNS records periodically for many providers. Available as <a class="link" href="options.html#opt-services.ddns-updater.enable"  >services.ddns-updater</a>.</p></li><li class="listitem"><p><a class="link" href="https://immersed.com/"  target="_top">Immersed</a>, a closed-source coworking platform. Available as <a class="link" href="options.html#opt-programs.immersed.enable"  >programs.immersed</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/sysadminsmedia/homebox"  target="_top">HomeBox</a>, an inventory and organization system built for the home user. Available as <a class="link" href="options.html#opt-services.homebox.enable"  >services.homebox</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/wez/evremap"  target="_top">evremap</a>, a keyboard input remapper for Linux/Wayland systems. Available as <a class="link" href="options.html#opt-services.evremap"  target="_top">services.evremap</a>.</p></li><li class="listitem"><p><a class="link" href="https://matrix-org.github.io/matrix-hookshot"  target="_top">matrix-hookshot</a>, a Matrix bot for connecting to external services. Available as <a class="link" href="options.html#opt-services.matrix-hookshot.enable"  >services.matrix-hookshot</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/renovatebot/renovate"  target="_top">Renovate</a>, a dependency updating tool for various Git forges and language ecosystems. Available as <a class="link" href="options.html#opt-services.renovate.enable"  >services.renovate</a>.</p></li><li class="listitem"><p><a class="link" href="https://music-assistant.io/"  target="_top">Music Assistant</a>, a music library manager for your offline and online music sources that can stream to a wide range of supported players. Available as <a class="link" href="options.html#opt-services.music-assistant.enable"  >services.music-assistant</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/zerotier/zeronsd"  target="_top">zeronsd</a>, a DNS server for ZeroTier users. Available with <a class="link" href="options.html#opt-services.zeronsd.servedNetworks"  >services.zeronsd.servedNetworks</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.collaboraonline.com/"  target="_top">Collabora Online</a>, a collaborative online office suite based on LibreOffice technology. Available as <a class="link" href="options.html#opt-services.collabora-online.enable"  target="_top">services.collabora-online</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/freifunkMUC/wg-access-server/"  target="_top">wg-access-server</a>, an all-in-one WireGuard VPN solution with a WebUI for connecting devices. Available as <a class="link" href="options.html#opt-services.wg-access-server.enable"  >services.wg-access-server</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/stonith404/pingvin-share"  target="_top">Pingvin Share</a>, a self-hosted file sharing platform and an alternative for WeTransfer. Available as <a class="link" href="options.html#opt-services.pingvin-share.enable"  >services.pingvin-share</a>.</p></li><li class="listitem"><p><a class="link" href="https://gitlab.com/gabmus/envision"  target="_top">Envision</a>, a UI for building, configuring and running Monado, the open source OpenXR runtime. Available as <a class="link" href="options.html#opt-programs.envision.enable"  >programs.envision</a>.</p></li><li class="listitem"><p><a class="link" href="https://localsend.org/"  target="_top">Localsend</a>, an open source cross-platform alternative to AirDrop. Available as <a class="link" href="options.html#opt-programs.localsend.enable"  >programs.localsend</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/TwiN/gatus"  target="_top">Gatus</a>, an automated developer-oriented status page. Available as <a class="link" href="options.html#opt-services.gatus.enable"  >services.gatus</a>.</p></li><li class="listitem"><p><a class="link" href="https://cryptpad.org/"  target="_top">cryptpad</a>, a privacy-oriented collaborative office suite, has been added back. Available as <a class="link" href="options.html#opt-services.cryptpad.enable"  >services.cryptpad</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/zhboner/realm"  target="_top">realm</a>, a simple, high performance relay server written in Rust. Available as <a class="link" href="options.html#opt-services.realm.enable"  >services.realm</a>.</p></li><li class="listitem"><p><a class="link" href="https://gotenberg.dev"  target="_top">Gotenberg</a>, an API server for converting files to PDFs that can be used alongside Paperless-ngx. Available as <a class="link" href="options.html#opt-services.gotenberg.enable"  target="_top">services.gotenberg</a>.</p></li><li class="listitem"><p><a class="link" href="https://suricata.io/"  target="_top">Suricata</a>, a free and open source, mature, fast and robust network threat detection engine. Available as <a class="link" href="options.html#opt-services.suricata.enable"  target="_top">services.suricata</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/altdesktop/playerctl"  target="_top">Playerctld</a>, a daemon to track media player activity. Available as <a class="link" href="options.html#opt-services.playerctld.enable"  target="_top">services.playerctld</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/glanceapp/glance"  target="_top">Glance</a>, a self-hosted dashboard that puts all your feeds in one place. Available as <a class="link" href="options.html#opt-services.glance.enable"  target="_top">services.glance</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/apache/tika"  target="_top">Apache Tika</a>, a toolkit that detects and extracts metadata and text from over a thousand different file types. Available as <a class="link" href="options.html#opt-services.tika.enable"  target="_top">services.tika</a>.</p></li><li class="listitem"><p><a class="link" href="https://misskey-hub.net/en/"  target="_top">Misskey</a>, an interplanetary microblogging platform. Available as <a class="link" href="options.html#opt-services.misskey.enable"  target="_top">services.misskey</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/misterunknown/ifm"  target="_top">Improved File Manager (IFM)</a>, a single-file web-based file manager. Available as <a class="link" href="options.html#opt-services.ifm.enable"  target="_top">services.ifm</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/apernet/OpenGFW"  target="_top">OpenGFW</a>, an implementation of the Great Firewall on Linux. Available as <a class="link" href="options.html#opt-services.opengfw.enable"  >services.opengfw</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/rapiz1/rathole"  target="_top">Rathole</a>, a lightweight and high-performance reverse proxy for NAT traversal. Available as <a class="link" href="options.html#opt-services.rathole.enable"  >services.rathole</a>.</p></li><li class="listitem"><p><a class="link" href="https://proton.me/mail/bridge"  target="_top">Proton Mail bridge</a>, a desktop application that runs in the background, encrypting and decrypting messages as they enter and leave your computer. Available as <a class="link" href="options.html#opt-services.protonmail-bridge.enable"  >services.protonmail-bridge</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.trychroma.com/"  target="_top">chromadb</a>, an open-source AI application database with batteries included. Available as <a class="link" href="options.html#opt-services.chromadb.enable"  target="_top">services.chromadb</a>.</p></li><li class="listitem"><p><a class="link" href="https://bitmagnet.io/"  target="_top">bitmagnet</a>, a self-hosted BitTorrent indexer, DHT crawler, content classifier and torrent search engine with WebUI, GraphQL API and Servarr stack integration. Available as <a class="link" href="options.html#opt-services.bitmagnet.enable"  target="_top">services.bitmagnet</a>.</p></li><li class="listitem"><p><a class="link" href="https://wakapi.dev/"  target="_top">Wakapi</a>, a time tracking software for programmers. Available as <a class="link" href="options.html#opt-services.wakapi.enable"  >services.wakapi</a>.</p></li><li class="listitem"><p><a class="link" href="https://codeberg.org/dnkl/foot"  target="_top">foot</a>, a fast, lightweight and minimalistic Wayland terminal emulator. Available as <a class="link" href="options.html#opt-programs.foot.enable"  >programs.foot</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.todesk.com/linux.html"  target="_top">ToDesk</a>, a remote desktop application. Available as <a class="link" href="options.html#opt-services.todesk.enable"  >services.todesk</a>.</p></li><li class="listitem"><p><a class="link" href="https://dependencytrack.org/"  target="_top">Dependency Track</a>, an intelligent Component Analysis platform that allows organizations to identify and reduce risk in the software supply chain. Available as <a class="link" href="options.html#opt-services.dependency-track.enable"  target="_top">services.dependency-track</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/immich-app/immich"  target="_top">Immich</a>, a self-hosted photo and video backup solution. Available as <a class="link" href="options.html#opt-services.immich.enable"  >services.immich</a>.</p></li><li class="listitem"><p><a class="link" href="https://saunafs.com"  target="_top">saunafs</a>, a distributed POSIX file system. Available as <a class="link" href="options.html#opt-services.saunafs.enable"  target="_top">services.saunafs</a>.</p></li><li class="listitem"><p><a class="link" href="https://obsproject.com/"  target="_top">obs-studio</a>, a free and open source software for video recording and live streaming. Available as <a class="link" href="options.html#opt-programs.obs-studio.enable"  >programs.obs-studio</a>.</p></li><li class="listitem"><p><a class="link" href="https://veilid.com"  target="_top">Veilid</a>, a privacy-focused, headless server for data sharing and messaging on a peer-to-peer network. Available as <a class="link" href="options.html#opt-services.veilid.enable"  >services.veilid</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/fedimint/fedimint"  target="_top">Fedimint</a>, a module based system for building federated applications (Federated E-Cash Mint). Available as <a class="link" href="options.html#opt-services.fedimintd"  >services.fedimintd</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/WhatAmISupposedToPutHere/tiny-dfr"  target="_top">tiny-dfr</a>, a dynamic function row daemon for the Touch Bar found on some Apple laptops. Available as <a class="link" href="options.html#opt-hardware.apple.touchBar.enable"  target="_top">hardware.apple.touchBar.enable</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/Tookmund/Swapspace"  target="_top">Swapspace</a>, a dynamic swap space manager that turns your unused free space into swap automatically. Available as <a class="link" href="options.html#opt-services.swapspace.enable"  >services.swapspace</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/bol-van/zapret"  target="_top">Zapret</a>, a DPI bypass tool. Available as <a class="link" href="options.html#opt-services.zapret.enable"  target="_top">services.zapret</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/nicolargo/glances"  target="_top">Glances</a>, an open-source system cross-platform monitoring tool. Available as <a class="link" href="options.html#opt-services.glances"  target="_top">services.glances</a>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-24.11-incompatibilities" class="title" >Backward Incompatibilities   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Nixpkgs now requires Nix 2.3.17 or newer to allow for zstd compressed binary artifacts.</p></li><li class="listitem"><p>The <code class="literal">sound</code> options have been removed or renamed, as they had a lot of unintended side effects. See <a class="link" href="release-notes.html#sec-release-24.11-migration-sound" title="sound options removal" >below</a> for details.</p></li><li class="listitem"><p>The NVIDIA driver no longer defaults to the proprietary kernel module with versions &gt;= 560. You will need to manually set <code class="literal">hardware.nvidia.open</code> to select the proprietary or open modules.</p></li><li class="listitem"><p>The <code class="literal">intel</code> driver for the X server (<code class="literal">services.xserver.videoDrives = [ &quot;intel&quot; ]</code>) is no longer functional due to incompatibilities with the latest Mesa version.
All users are strongly encouraged to switch to the generic <code class="literal">modesetting</code> driver (the default one) whenever possible, for more information see the manual chapter on <a class="link" href="index.html#sec-x11--graphics-cards-intel" title="Intel Graphics drivers" >Intel Graphics</a> and issue <a class="link" href="https://github.com/NixOS/nixpkgs/issues/342763"  target="_top">#342763</a>.</p></li><li class="listitem"><p>The <code class="literal">intel-compute-runtime</code> package dropped support for older GPUs, and only supports 12th Gen and newer from now on.
Intel GPUs from Gen 8,9 and 11 need to use the <code class="literal">intel-compute-runtime-legacy1</code> package in <code class="literal">hardware.graphics.extraPackages</code>.</p></li><li class="listitem"><p>The <code class="literal">(buildPythonPackage { ... }).override</code> and <code class="literal">(buildPythonPackage { ... }).overrideDerivation</code> attributes is now deprecated and removed in favour of <code class="literal">overridePythonAttrs</code> and <code class="literal">lib.overrideDerivation</code>.
This change does not affect the override interface of most Python packages, as <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#sec-pkg-override"  target="_top"><code class="literal">&lt;pkg&gt;.override</code></a> provided by <code class="literal">callPackage</code> shadows such a locally-defined <code class="literal">override</code> attribute.
The <code class="literal">&lt;pkg&gt;.overrideDerivation</code> attribute of Python packages called with <code class="literal">callPackage</code> will also remain available after this change.</p></li><li class="listitem"><p>All Cinnamon and XApp packages have been moved to top-level (i.e., <code class="literal">cinnamon.nemo</code> is now <code class="literal">nemo</code>).</p></li><li class="listitem"><p>All GNOME packages have been moved to top-level (i.e., <code class="literal">gnome.nautilus</code> is now <code class="literal">nautilus</code>).</p></li><li class="listitem"><p><code class="literal">transmission</code> has been aliased with a <code class="literal">trace</code> warning to <code class="literal">transmission_3</code>, since <a class="link" href="https://github.com/transmission/transmission/releases/tag/4.0.0"  target="_top">Transmission 4 has been released last year</a> and Transmission 3 will eventually go away – this is meant to make people aware of the new version. <code class="literal">services.transmission.package</code> now also defaults to <code class="literal">transmission_3</code>, as the upgrade can cause data loss in some cases (examples: <a class="link" href="https://github.com/transmission/transmission/issues/5153"  target="_top">#5153</a>, <a class="link" href="https://github.com/transmission/transmission/issues/6796"  target="_top">#6796</a>). Please make sure to back up to your data directory if you may be affected:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">transmission-gtk</code>: <code class="literal">~/.config/transmission</code></p></li><li class="listitem"><p><code class="literal">transmission-daemon</code> using NixOS module: <code class="literal">${config.services.transmission.home}/.config/transmission-daemon</code> (defaults to <code class="literal">/var/lib/transmission/.config/transmission-daemon</code>)</p></li></ul></div></li><li class="listitem"><p>The default <code class="literal">mongodb</code> version has been updated from 5.0 to 7.0.
For more information, see the compatibility changes for MongoDB <a class="link" href="https://www.mongodb.com/docs/manual/release-notes/6.0-compatibility/"  target="_top">6.0</a> and <a class="link" href="https://www.mongodb.com/docs/manual/release-notes/7.0-compatibility/"  target="_top">7.0</a>.</p></li><li class="listitem"><p><code class="literal">unifi</code> has been updated to UniFi 8.
<code class="literal">unifi7</code> was removed as it is vulnerable to CVE-2024-42025 and required a version of MongoDB that has reached end of life.</p></li><li class="listitem"><p><code class="literal">androidenv.androidPkgs_9_0</code> has been removed. It is replaced with <code class="literal">androidenv.androidPkgs</code> for a more complete Android SDK, including support for Android 9 and later.</p></li><li class="listitem"><p>The VirtualBox demo installer appliance has been removed.
Please use the standard installer ISOs instead.</p></li><li class="listitem"><p><code class="literal">grafana</code> has been updated to version 11.3. This version doesn’t support setting <code class="literal">http_addr</code> to a hostname anymore, an IP address is expected.</p></li><li class="listitem"><p><code class="literal">deno</code> has been updated to Deno 2, which has breaking changes.
See the <a class="link" href="https://docs.deno.com/runtime/reference/migration_guide/"  target="_top">migration guide</a> for details.</p></li><li class="listitem"><p><code class="literal">gogs</code> has been removed. Upstream development has stalled and it has several
<a class="link" href="https://github.com/gogs/gogs/issues/7777"  target="_top">critical vulnerabilities</a> that weren’t addressed
within a year. Consider migrating to <code class="literal">forgejo</code> or <code class="literal">gitea</code>.</p></li><li class="listitem"><p><code class="literal">knot-dns</code> has been updated to version 3.4.x. Check the <a class="link" href="https://www.knot-dns.cz/docs/latest/html/migration.html#upgrade-3-3-x-to-3-4-x"  target="_top">migration guide</a> for breaking changes.</p></li><li class="listitem"><p><code class="literal">mutmut</code> has been updated to version 3.0.5.</p></li><li class="listitem"><p><code class="literal">services.kubernetes.kubelet.clusterDns</code> now accepts a list of DNS resolvers rather than a single string, bringing the module more in line with the upstream Kubelet configuration schema.</p></li><li class="listitem"><p><code class="literal">bluemap</code> has changed the format used to store map tiles, and the database layout has been heavily modified. Upstream recommends a clean reinstallation: <a class="link" href="https://github.com/BlueMap-Minecraft/BlueMap/releases/tag/v5.2"  target="_top">https://github.com/BlueMap-Minecraft/BlueMap/releases/tag/v5.2</a>. Unless you are using an SQL storage backend, this should only entail deleting the contents of <code class="literal">config.services.bluemap.coreSettings.data</code> (defaults to <code class="literal">/var/lib/bluemap</code>) and <code class="literal">config.services.bluemap.webRoot</code> (defaults to <code class="literal">/var/lib/bluemap/web</code>).</p></li><li class="listitem"><p><code class="literal">wstunnel</code> has had a major version upgrade that entailed rewriting the program in Rust.
The module was updated to accommodate for breaking changes and breaking changes to the
module options were minimised as much as possible. Nonetheless, some were inevitable due
to changes in the upstream CLI. Certain options were moved from separate CLI arguments into
the forward specifications, and those options were also removed from the module’s options.
Please consult the wstunnel man page for more details.
Also be aware that if you have set additional options in <code class="literal">services.wstunnel.{clients,servers}.&lt;name&gt;.extraArgs</code>,
they may have been modified or removed upstream.</p></li><li class="listitem"><p><code class="literal">gnat</code> and <code class="literal">gnatPackages</code> now use GNAT 13 instead of GNAT 12. This matches
the default <code class="literal">gcc</code> version.</p></li><li class="listitem"><p><code class="literal">percona-server_8_4</code> and <code class="literal">mysql84</code> now have password authentication via the deprecated <code class="literal">mysql_native_password</code> disabled by default. This authentication plugin can be enabled via a CLI argument again, for detailed instructions and alternative authentication methods <a class="link" href="https://dev.mysql.com/doc/refman/8.4/en/native-pluggable-authentication.html"  target="_top">see upstream documentation</a>. The config file directive <code class="literal">default_authentication_plugin</code> has been removed.</p></li><li class="listitem"><p>Percona has decided not to follow the LTS/ Innovation release scheme of upstream MySQL and thus <a class="link" href="https://www.percona.com/blog/no-mysql-9-x-innovation-releases-from-percona/"  target="_top">will only create releases for MySQL LTS versions</a>. Hence, the package names <code class="literal">percona-server_lts</code>, <code class="literal">percona-server_innovation</code>, <code class="literal">percona-xtrabackup_lts</code> and <code class="literal">percona-xtrabackup_innovation</code> are deprecated.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">percona-server</code> and <code class="literal">percona-server_lts</code> now point towards the new LTS release <code class="literal">percona-server_8_4</code>. The previous LTS continues to be supported and is available as <code class="literal">percona-server_8_0</code>. The same is true for the supporting <code class="literal">percona-xtrabackup</code> tooling.</p></li></ul></div></li><li class="listitem"><p><code class="literal">clang-tools_&lt;version&gt;</code> packages have been moved into <code class="literal">llvmPackages_&lt;version&gt;</code> (i.e. <code class="literal">clang-tools_18</code> is now <code class="literal">llvmPackages_18.clang-tools</code>).</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>For convenience, the top-level <code class="literal">clang-tools</code> attribute remains and is now bound to <code class="literal">llvmPackages.clang-tools</code>.</p></li><li class="listitem"><p>Top-level <code class="literal">clang_tools_&lt;version&gt;</code> attributes are now aliases; these will be removed in a future release.</p></li></ul></div></li><li class="listitem"><p><code class="literal">buildbot</code> was updated to 4.0 and the AngularJS frontend replaced by a React frontend. See the <a class="link" href="https://docs.buildbot.net/current/manual/upgrading/4.0-upgrade.html"  target="_top">upstream release notes</a>.</p></li><li class="listitem"><p><code class="literal">headscale</code> has been updated to version 0.23.0 which reworked large parts of the configuration, including DNS, Magic DNS prefixes and ACL policy files. See the <a class="link" href="https://github.com/juanfont/headscale/releases/tag/v0.23.0"  target="_top">upstream changelog</a> for details.</p></li><li class="listitem"><p><code class="literal">nginx</code> package no longer includes the <code class="literal">gd</code> and <code class="literal">geoip</code> dependencies. To re-enable them, override <code class="literal">nginx</code> with the options <code class="literal">withImageFilter = true;</code> and <code class="literal">withGeoIP = true;</code>.</p></li><li class="listitem"><p><code class="literal">systemd.enableUnifiedCgroupHierarchy</code> has been removed.
In systemd 256, support for cgroup v1 (‘legacy’ and ‘hybrid’ hierarchies) is now considered obsolete and systemd will refuse to boot under it by default.
To forcibly re-enable cgroup v1 support, you can set <code class="literal">boot.kernelParams = [ &quot;systemd.unified_cgroup_hierarchy=0&quot; &quot;SYSTEMD_CGROUP_ENABLE_LEGACY_FORCE=1&quot; ]</code>.
This is not an officially supported configuration and might cause your system to become unbootable in future versions. You are on your own.</p></li><li class="listitem"><p><code class="literal">nrfutil</code> – which previously pointed to the now-deprecated <code class="literal">pc-nrfutil</code> Python package – has been repackaged under the same name with the new nrfutil tool.</p></li><li class="listitem"><p><code class="literal">openssh</code> and <code class="literal">openssh_hpn</code> are now compiled without Kerberos 5 / GSSAPI support in an effort to reduce the attack surface of the components. Users needing this support can
use the new <code class="literal">opensshWithKerberos</code> and <code class="literal">openssh_hpnWithKerberos</code> package flavors (e.g. <code class="literal">programs.ssh.package = pkgs.openssh_gssapi</code>).</p></li><li class="listitem"><p><code class="literal">security.ipa.ipaHostname</code> now defaults to the value of <code class="literal">networking.fqdn</code> if
it is set, instead of the previous hardcoded default of
<code class="literal">${networking.hostName}.${security.ipa.domain}</code>.</p></li><li class="listitem"><p>The <code class="literal">MSMTP_QUEUE</code> and <code class="literal">MSMTP_LOG</code> environment variables accepted by <code class="literal">msmtpq</code> have been renamed to <code class="literal">MSMTPQ_Q</code> and <code class="literal">MSMTPQ_LOG</code> respectively.</p></li><li class="listitem"><p>The logrotate service has been hardened and now requires enabling <code class="literal">allowNetworking</code> if network access is required.</p></li><li class="listitem"><p><code class="literal">mautrix-whatsapp</code> has been updated to version 0.11.0, which is a major rewrite of the bridge. Config file changes are required.</p></li><li class="listitem"><p>qBittorrent has been updated to major version 5, which drops support for Qt 5.
The <code class="literal">qbittorrent-qt5</code> package has been removed.</p></li><li class="listitem"><p>The fcgiwrap module now allows multiple instances running as distinct users.
The option <code class="literal">services.fgciwrap</code> now takes an attribute set of the
configuration of each individual instance.
This requires migrating any previous configuration keys from
<code class="literal">services.fcgiwrap.*</code> to <code class="literal">services.fcgiwrap.instances.some-instance.*</code>.
The ownership and mode of the UNIX sockets created by this service are now
configurable and private by default.
Processes also now run as a dynamically allocated user by default instead of
root.</p></li><li class="listitem"><p>The <code class="literal">mautrix-signal</code> module was adapted to incorporate the configuration changes that resulted from the update to the mautrix bridgev2 architecture. Pre-0.7.0 configurations should continue to work.
In case you want to update your configuration, make sure to check the NixOS manual.</p></li><li class="listitem"><p><code class="literal">cargo-tauri</code> has been updated to major version 2. Please review <a class="link" href="https://tauri.app/start/migrate/from-tauri-1/"  target="_top">the migration guide</a>.
v1 of <code class="literal">cargo-tauri</code> is still available as <code class="literal">cargo-tauri_1</code>, but will be removed in future releases.</p></li><li class="listitem"><p>The nvidia driver no longer defaults to the proprietary driver starting with version 560. You will need to manually set <code class="literal">hardware.nvidia.open</code> to select the proprietary or open driver.</p></li><li class="listitem"><p><code class="literal">postgresql_12</code> has been removed since it reached its end of life.</p></li><li class="listitem"><p><code class="literal">postgresql</code> no longer accepts the <code class="literal">enableSystemd</code> override. Use <code class="literal">systemdSupport</code> instead.</p></li><li class="listitem"><p><code class="literal">postgresql</code> was split into default and -dev outputs. To make this work without circular dependencies, the output of the <code class="literal">pg_config</code> system view has been removed. The <code class="literal">pg_config</code> binary is provided in the -dev output and still works as expected.</p></li><li class="listitem"><p>The arguments from <a class="xref" href="options.html#opt-services.postgresql.initdbArgs"  ><code class="option">services.postgresql.initdbArgs</code></a> now get shell-escaped.</p></li><li class="listitem"><p><code class="literal">postgresql</code> is now <a class="link" href="index.html#module-services-postgres-hardening" title="Service hardening" >hardened by default</a> using the common <code class="literal">systemd</code> settings for that.</p></li><li class="listitem"><p>The dhcpcd service (<code class="literal">networking.useDHCP</code>) has been hardened and now runs exclusively as the “dhcpcd” user.
Users that were relying on the root privileges in <code class="literal">networking.dhcpcd.runHook</code> will have to write specific <a class="link" href="security.sudo.extraRules"  target="_top">sudo</a> or <a class="link" href="security.polkit.extraConfig"  target="_top">polkit</a> rules to allow dhcpcd to perform privileged actions.</p><p>As part of these changes, the DHCP lease files directory has also been moved from <code class="literal">/var/db/dhcpcd</code> to <code class="literal">/var/lib/dhcpcd</code>. This migration is performed automatically, but users may have to update their backup configuration.</p></li><li class="listitem"><p><code class="literal">singularity-tools</code> have the <code class="literal">storeDir</code> argument removed from its override interface and use <code class="literal">builtins.storeDir</code> instead.</p></li><li class="listitem"><p>The <code class="literal">mkLayer</code> and <code class="literal">shellScript</code> build helpers in <code class="literal">singularity-tools</code> are deprecated, as they are no longer involved in image-building. Maintainers will remove them in future releases.</p></li><li class="listitem"><p>The <code class="literal">rust.toTargetArch</code>, <code class="literal">rust.toTargetOs</code>, <code class="literal">rust.toTargetFamily</code>, <code class="literal">rust.toTargetVendor</code>, <code class="literal">rust.toRustTarget</code>, <code class="literal">rust.toRustTargetSpec</code>, <code class="literal">rust.toRustTargetSpecShort</code>, and <code class="literal">rust.IsNoStdTarget</code> functions are deprecated in favour of the <code class="literal">rust.platform.arch</code>, <code class="literal">rust.platform.os</code>, <code class="literal">rust.platform.target-family</code>, <code class="literal">rust.platform.vendor</code>, <code class="literal">rust.rustcTarget</code>, <code class="literal">rust.rustcTargetSpec</code>, <code class="literal">rust.cargoShortTarget</code>, <code class="literal">rust.cargoEnvVarTarget</code>, and <code class="literal">rust.isNoStdTarget</code> platform attributes respectively.</p></li><li class="listitem"><p>All Budgie and <code class="literal">budgiePlugins</code> packages have been moved to top-level (i.e.,
<code class="literal">budgie.budgie-desktop</code> is now <code class="literal">budgie-desktop</code> and <code class="literal">budgiePlugins.budgie-media-player-applet</code>
is now <code class="literal">budgie-media-player-applet</code>).</p></li><li class="listitem"><p>The method of safely handling secrets in the <code class="literal">networking.wireless</code> module has been changed to benefit from a <a class="link" href="https://w1.fi/cgit/hostap/commit/?id=e680a51e94a33591f61edb210926bcb71217a21a"  target="_top">new feature</a> of <code class="literal">wpa_supplicant</code>.
The syntax to refer to secrets has changed slightly and the option <code class="literal">networking.wireless.environmentFile</code> has been replaced by <code class="literal">networking.wireless.secretsFile</code>; see the description of the latter for how to upgrade.</p></li><li class="listitem"><p>NetBox was updated to <code class="literal">&gt;= 4.1.0</code>.
Have a look at the breaking changes
of the <a class="link" href="https://github.com/netbox-community/netbox/releases/tag/v4.0.0"  target="_top">4.0 release</a>
and the <a class="link" href="https://github.com/netbox-community/netbox/releases/tag/v4.1.0"  target="_top">4.1 release</a>,
make the required changes to your database, if needed,
then upgrade by setting <code class="literal">services.netbox.package = pkgs.netbox_4_1;</code>
in your configuration.</p></li><li class="listitem"><p><code class="literal">services.cgit</code> now runs as the cgit user by default instead of root.
This change requires granting access to the repositories to this user or
setting the appropriate one through <code class="literal">services.cgit.some-instance.user</code>.</p></li><li class="listitem"><p>All Oracle JDKs and JREs (<code class="literal">oraclejdk</code>, <code class="literal">oraclejdk8</code>, <code class="literal">oraclejre</code>, <code class="literal">oraclejre8</code>,
<code class="literal">jrePlugin</code>, <code class="literal">jre8Plugin</code>, <code class="literal">jdkdistro</code>, <code class="literal">oraclejdk8distro</code>, and <code class="literal">oraclejdk11</code>)
were dropped due to being unmaintained and heavily insecure. OpenJDK provides
compatible replacements for JDKs and JREs.</p></li><li class="listitem"><p><code class="literal">gradle_6</code> was removed due to being <a class="link" href="https://endoflife.date/gradle"  target="_top">unsupported upstream as of 10 Feb 2023</a>.
Additionally, it had numerous security vulnerabilities that were only patched
in later versions, such as <a class="link" href="https://nvd.nist.gov/vuln/detail/CVE-2021-32751"  target="_top">CVE-2021-29429</a>,
<a class="link" href="https://nvd.nist.gov/vuln/detail/CVE-2021-29427"  target="_top">CVE-2021-29427</a>, <a class="link" href="https://nvd.nist.gov/vuln/detail/CVE-2021-29428"  target="_top">CVE-2021-29428</a>, and <a class="link" href="https://nvd.nist.gov/vuln/detail/CVE-2021-32751"  target="_top">CVE-2021-32751</a>.</p></li><li class="listitem"><p><code class="literal">nvimpager</code> was updated to version 0.13.0, which changes the order of user and
nvimpager settings: user commands in <code class="literal">-c</code> and <code class="literal">--cmd</code> now override the
respective default settings because they are executed later.</p></li><li class="listitem"><p><code class="literal">javacard-devkit</code> was dropped due to having a dependency on the Oracle JDK,
as well as being several years out-of-date.</p></li><li class="listitem"><p>Kubernetes <code class="literal">featureGates</code> have changed from a <code class="literal">listOf str</code> to <code class="literal">attrsOf bool</code>.
This refactor makes it possible to also disable feature gates, without having
to use <code class="literal">extraOpts</code> flags.</p><p>A previous configuration may have looked like this:</p><pre><code class="programlisting nix">{
  featureGates = [ &quot;EphemeralContainers&quot; ];
  extraOpts = pkgs.lib.concatStringsSep &quot; &quot; (
    [
      &#x27;&#x27;--feature-gates=&quot;CSIMigration=false&quot;&#x27;&#x27;
    ]
  );
}
</code></pre><p>Using an attribute set instead, the new configuration would be:</p><pre><code class="programlisting nix">{
  featureGates = {
    EphemeralContainers = true;
    CSIMigration=false;
  };
}
</code></pre></li><li class="listitem"><p><code class="literal">pkgs.nextcloud27</code> has been removed as it has reached EOL.</p></li><li class="listitem"><p>The <code class="literal">environment.noXlibs</code> option has been removed. It was a common source of unexpected rebuilds and breakage that was often hard to diagnose.
If you need to disable certain libraries, you’re encouraged to add your own overlay to your configuration that targets the packages you care about.</p></li><li class="listitem"><p><code class="literal">frigate</code> was updated past 0.14.0. This release includes various breaking changes, so please review the <a class="link" href="https://github.com/blakeblackshear/frigate/releases/tag/v0.14.0"  target="_top">release notes</a>.
Most prominently, access to the web interface and API are now protected by authentication. Retrieve the auto-created
admin account from the <code class="literal">frigate.service</code> journal after upgrading.</p></li><li class="listitem"><p><code class="literal">nodePackages.coc-python</code> was dropped, as <a class="link" href="https://github.com/neoclide/coc-python"  target="_top">its upstream is unmaintained</a>. The associated <code class="literal">vimPlugins.coc-python</code> was also dropped.
The upstream project recommends using <code class="literal">coc-pyright</code> or <code class="literal">coc-jedi</code> as replacements.</p></li><li class="listitem"><p><code class="literal">forgejo</code> has been upgraded from version 7.0 to version 9.0, see the release notes for <a class="link" href="https://codeberg.org/forgejo/forgejo/src/branch/forgejo/RELEASE-NOTES.md#8-0-0"  target="_top">8.0</a> and <a class="link" href="https://codeberg.org/forgejo/forgejo/milestone/7235"  target="_top">9.0</a>.</p></li><li class="listitem"><p><code class="literal">services.forgejo.mailerPasswordFile</code> has been deprecated by the drop-in replacement <code class="literal">services.forgejo.secrets.mailer.PASSWD</code>,
which is part of the new free-form <code class="literal">services.forgejo.secrets</code> option.
<code class="literal">services.forgejo.secrets</code> is a small wrapper over systemd’s <code class="literal">LoadCredential=</code>. It has the same structure (sections/keys) as
<code class="literal">services.forgejo.settings</code> but takes file paths that will be read before service startup instead of some plaintext value.
<code class="literal">services.forgejo.package</code> now defaults to <code class="literal">forgejo-lts</code>, the Long Term Support version of Forgejo.</p></li><li class="listitem"><p><code class="literal">forgejo</code> and <code class="literal">forgejo-lts</code> no longer support the opt-in feature <a class="link" href="https://forgejo.org/docs/latest/user/authentication/#pam-pluggable-authentication-module"  target="_top">PAM (Pluggable Authentication Module)</a>.</p></li><li class="listitem"><p><code class="literal">gitea</code> no longer supports the opt-in feature <a class="link" href="https://docs.gitea.com/usage/authentication#pam-pluggable-authentication-module"  target="_top">PAM (Pluggable Authentication Module)</a>.</p></li><li class="listitem"><p><code class="literal">vuze</code> was removed because it is unmaintained upstream and insecure (CVE-2018-13417).
BiglyBT is a maintained fork.</p></li><li class="listitem"><p><code class="literal">services.ddclient.use</code> has been deprecated: <code class="literal">ddclient</code> now supports separate IPv4 and IPv6 configuration. Use <code class="literal">services.ddclient.usev4</code> and <code class="literal">services.ddclient.usev6</code> instead.</p></li><li class="listitem"><p><code class="literal">services.pgbouncer</code> systemd service is now configured with <code class="literal">Type=notify-reload</code> and allows reloading configuration without process restart. PgBouncer configuration options were moved to the freeform type option under <a class="link" href="options.html#opt-services.pgbouncer.settings"  ><code class="literal">services.pgbouncer.settings</code></a>.</p></li><li class="listitem"><p>Docear was removed because it was unmaintained upstream.
JabRef, Zotero, or Mendeley are potential replacements.</p></li><li class="listitem"><p><code class="literal">nodePackages.coc-metals</code> was removed due to being deprecated upstream.
<code class="literal">vimPlugins.nvim-metals</code> is its official replacement.</p></li><li class="listitem"><p><code class="literal">matrix-sliding-sync</code> was removed because it has been replaced by the simplified sliding sync functionality introduced in matrix-synapse 114.0.</p></li><li class="listitem"><p><code class="literal">nodePackages.coc-tslint</code>, <code class="literal">vimPlugins.coc-tslint</code>, <code class="literal">nodePackages.coc-tslint-plugin</code>,
and <code class="literal">vimPlugins.coc-tslint-plugin</code> were removed due to being deprecated upstream. The
<code class="literal">nodePackages.coc-eslint</code> and <code class="literal">vimPlugins.coc-eslint</code> packages offer comparable
features for <code class="literal">eslint</code>, which replaced <code class="literal">tslint</code>.</p></li><li class="listitem"><p>Tcl packages have been moved into the <code class="literal">tclPackages</code> scope.</p></li><li class="listitem"><p><code class="literal">teleport</code> has been upgraded from major version 15 to major version 16.
Refer to upstream <a class="link" href="https://goteleport.com/docs/management/operations/upgrading/"  target="_top">upgrade instructions</a>
and <a class="link" href="https://goteleport.com/docs/changelog/#1600-061324"  target="_top">release notes for v16</a>.</p></li><li class="listitem"><p><code class="literal">tests.overriding</code>’s <code class="literal">passthru.tests</code> has been restructured as an attribute set instead of a list, making individual tests accessible by their names.</p></li><li class="listitem"><p><code class="literal">skk-dict</code> was split into multiple packages under <code class="literal">skkDictionaries</code>.
If in doubt of what to use, try <code class="literal">skkDictionaries.l</code>. As part of this change, the dictionaries
were moved from <code class="literal">$out/share</code> to <code class="literal">$out/share/skk</code>. The dictionaries also won’t
be converted to UTF-8 unless the <code class="literal">useUtf8</code> package option is enabled; UTF-8
converted dictionaries will have the .utf8 suffix appended to its filename.</p></li><li class="listitem"><p><code class="literal">vaultwarden</code> lost the capability to bind to privileged ports. If you rely on
this behavior, override the systemd unit to allow <code class="literal">CAP_NET_BIND_SERVICE</code> in
your configuration.</p></li><li class="listitem"><p><code class="literal">services.invoiceplane.sites.&lt;name&gt;.extraConfig</code> was removed. Configuration must now be done
through the structured <code class="literal">services.invoiceplane.sites.&lt;name&gt;.settings</code> option.</p></li><li class="listitem"><p><code class="literal">services.ollama.sandbox</code> has been replaced with options to configure
a static <code class="literal">user</code> and <code class="literal">group</code>. The <code class="literal">writablePaths</code> option has also been removed and
the models directory is now always exempt from sandboxing.</p></li><li class="listitem"><p>The <code class="literal">gns3-server</code> service now runs under the <code class="literal">gns3</code> system user
instead of a dynamically created one via <code class="literal">DynamicUser</code>.
The use of SUID wrappers is incompatible with SystemD’s <code class="literal">DynamicUser</code> setting,
and GNS3 requires calling ubridge through its SUID wrapper to function properly.
This change requires to manually move the following directories:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>from <code class="literal">/var/lib/private/gns3</code> to <code class="literal">/var/lib/gns3</code></p></li><li class="listitem"><p>from <code class="literal">/var/log/private/gns3</code> to <code class="literal">/var/log/gns3</code>
and to change the ownership of these directories and their contents to <code class="literal">gns3</code> (including <code class="literal">/etc/gns3</code>).</p></li></ul></div></li><li class="listitem"><p>Legacy package <code class="literal">stalwart-mail_0_6</code> was dropped, please note the
<a class="link" href="https://github.com/stalwartlabs/mail-server/blob/main/UPGRADING.md"  target="_top">manual upgrade process</a>
before changing the package to <code class="literal">pkgs.stalwart-mail</code> in
<a class="link" href="options.html#opt-services.stalwart-mail.package"  ><code class="literal">services.stalwart-mail.package</code></a>.</p></li><li class="listitem"><p><code class="literal">nomad_1_5</code> and <code class="literal">nomad_1_6</code> were dropped, as <a class="link" href="https://support.hashicorp.com/hc/en-us/articles/360021185113-Support-Period-and-End-of-Life-EOL-Policy"  target="_top">they have reached end-of-life upstream</a>. Evaluating them will throw an error.</p></li><li class="listitem"><p>The default <code class="literal">nomad</code> package has been updated to 1.8.x. For more information, see <a class="link" href="https://developer.hashicorp.com/nomad/docs/upgrade/upgrade-specific#nomad-1-8-0"  target="_top">breaking changes for Nomad 1.8</a></p></li><li class="listitem"><p><code class="literal">androidndkPkgs</code> has been updated to <code class="literal">androidndkPkgs_26</code>.</p></li><li class="listitem"><p>Android NDK version 26 and SDK version 33 are now the default versions used for cross compilation to android.</p></li><li class="listitem"><p><code class="literal">ankisyncd</code> package and its <code class="literal">services.ankisyncd</code> have been removed. Use <a class="link" href="options.html#opt-services.anki-sync-server.enable"  ><code class="literal">services.anki-sync-server</code></a> instead.</p></li><li class="listitem"><p><code class="literal">nodePackages.vscode-css-languageserver-bin</code>, <code class="literal">nodePackages.vscode-html-languageserver-bin</code>,
and <code class="literal">nodePackages.vscode-json-languageserver-bin</code> were dropped due to an unmaintained upstream.
The <code class="literal">vscode-langservers-extracted</code> package is a maintained drop-in replacement.</p></li><li class="listitem"><p><code class="literal">nodePackages.prisma</code> has been replaced by <code class="literal">prisma</code>.</p></li><li class="listitem"><p><code class="literal">fetchNextcloudApp</code> has been rewritten to use <code class="literal">fetchurl</code> rather than
<code class="literal">fetchzip</code>. This invalidates all existing hashes, but you can restore the old
behavior by passing it <code class="literal">unpack = true</code>.</p></li><li class="listitem"><p><code class="literal">haskell.lib.compose.justStaticExecutables</code> now disallows references to GHC in its
output by default to alert users to closure size issues caused by
<a class="link" href="https://github.com/NixOS/nixpkgs/issues/164630"  target="_top">#164630</a>. See <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#haskell-packaging-helpers"  target="_top">“Packaging
Helpers” in the Haskell section of the Nixpkgs
manual</a>
for information on working around <code class="literal">output &#x27;...&#x27; is not allowed to refer to the following paths</code> errors caused by this change.</p></li><li class="listitem"><p><code class="literal">services.stalwart-mail</code> now runs under the <code class="literal">stalwart-mail</code> system user
instead of a dynamic one via <code class="literal">DynamicUser</code> in order to avoid automatic
ownership changes on its large file store on service restart.
This change requires to manually move the state directory from
<code class="literal">/var/lib/private/stalwart-mail</code> to <code class="literal">/var/lib/stalwart-mail</code>, and to
change the ownership of the directory and its content to <code class="literal">stalwart-mail</code>.</p></li><li class="listitem"><p><code class="literal">services.stalwart-mail</code> now uses RocksDB as the default storage backend
for <code class="literal">stateVersion</code> ≥ 24.11. It was previously using SQLite for structured
data and the filesystem for blobs.</p></li><li class="listitem"><p><code class="literal">services.stargazer</code> has been hardened to improve security, but these
changes make break certain setups, particularly around traditional CGI.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">services.stargazer.allowCgiUser</code> has been added, enabling
Stargazer’s <code class="literal">cgi-user</code> option to work, which was previously broken.</p></li></ul></div></li><li class="listitem"><p><code class="literal">services.shiori</code> now requires the HTTP secret value <code class="literal">SHIORI_HTTP_SECRET_KEY</code> to be provided as an environment variable. <code class="literal">services.shiori.environmentFile</code> has been introduced to handle this:</p><pre><code class="programlisting"># This is how a environment file can be generated:
# $ printf &quot;SHIORI_HTTP_SECRET_KEY=%s\n&quot; &quot;$(openssl rand -hex 16)&quot; &gt; /path/to/env-file
services.shiori.environmentFile = &quot;/path/to/env-file&quot;;
</code></pre></li><li class="listitem"><p><code class="literal">/share/nano</code> is now only linked when <code class="literal">programs.nano.enable</code> is enabled.</p></li><li class="listitem"><p>PPD files for Utax printers were renamed (spaces replaced by underscores) in the newest <code class="literal">foomatic-db</code> package. Users of Utax printers might need to adapt their <code class="literal">hardware.printers.ensurePrinters.*.model</code> value to account for this.</p></li><li class="listitem"><p><code class="literal">sqldeveloper</code> was dropped due to being severely out-of-date and having a dependency on
JavaFX for Java 8, which we do not support.</p></li><li class="listitem"><p>The <code class="literal">kvdo</code> kernel module package was removed as it was upstreamed in kernel version 6.9, where it is now called <code class="literal">dm-vdo</code>.</p></li><li class="listitem"><p><code class="literal">libe57format</code> has been updated to <code class="literal">&gt;= 3.0.0</code>, which contains some backward-incompatible API changes. See the <a class="link" href="https://github.com/asmaloney/libE57Format/releases/tag/v3.0.0"  target="_top">release note</a> for more details.</p></li><li class="listitem"><p><code class="literal">gitlab</code> deprecated support for <span class="emphasis"><em>runner registration tokens</em></span> in GitLab 16.0, disabled their support in GitLab 17.0 and will
ultimately remove it in GitLab 18.0 (as outlined in the
<a class="link" href="https://docs.gitlab.com/17.0/ee/ci/runners/new_creation_workflow.html#estimated-time-frame-for-planned-changes"  target="_top">documentation</a>).
After upgrading to GitLab &gt;= 17.0, it is possible to re-enable support for registration tokens in the UI until GitLab 18.0.
Refer to the manual on <a class="link" href="https://docs.gitlab.com/17.0/ee/ci/runners/new_creation_workflow.html#using-registration-tokens-after-gitlab-170"  target="_top">using registration tokens after GitLab 17.0</a>.
GitLab administrators should migrate to the <a class="link" href="https://docs.gitlab.com/17.0/ee/ci/runners/new_creation_workflow.html#using-registration-tokens-after-gitlab-170"  target="_top">new runner registration workflow</a>
with <span class="emphasis"><em>runner authentication tokens</em></span> until the release of GitLab 18.0.</p></li><li class="listitem"><p><code class="literal">gitlab</code> has been updated from 16.x to 17.x and requires <code class="literal">postgresql</code> &gt;= 14.9, as stated in the <a class="link" href="https://docs.gitlab.com/17.1/ee/install/requirements.html#postgresql-requirements"  target="_top">documentation</a>. Check the <a class="link" href="index.html#module-services-postgres-upgrading" title="Upgrading" >upgrade guide</a> in the NixOS manual on how to upgrade your PostgreSQL installation.</p></li><li class="listitem"><p><code class="literal">gitaly</code> (part of <code class="literal">gitlab</code>) is now using the bundled <code class="literal">git</code> package instead of <code class="literal">pkgs.git</code>, to maintain compatibility with GitLab.</p></li><li class="listitem"><p><code class="literal">nixos/gitlab</code> no longer adds <code class="literal">pkgs.git</code> to <code class="literal">environment.systemPackages</code> by default.</p></li><li class="listitem"><p>The <code class="literal">replay-sorcery</code> package and module was removed as it unmaintained upstream. Consider using <code class="literal">gpu-screen-recorder</code> or <code class="literal">obs-studio</code> instead.</p></li><li class="listitem"><p>A few options of <code class="literal">services.samba</code> have been moved from <code class="literal">extraConfig</code> and <code class="literal">configText</code> to the new freeform option <code class="literal">settings</code> and renamed, e.g.:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">services.samba.invalidUsers</code> to <code class="literal">services.samba.settings.global.&quot;invalid users&quot;</code></p></li><li class="listitem"><p><code class="literal">services.samba.securityType</code> to <code class="literal">services.samba.settings.global.&quot;security type&quot;</code></p></li><li class="listitem"><p><code class="literal">services.samba.shares</code> to <code class="literal">services.samba.settings</code></p></li><li class="listitem"><p><code class="literal">services.samba.enableWinbindd</code> to <code class="literal">services.samba.winbindd.enable</code></p></li><li class="listitem"><p><code class="literal">services.samba.enableNmbd</code> to <code class="literal">services.samba.nmbd.enable</code></p></li></ul></div></li><li class="listitem"><p><code class="literal">zx</code> was updated to v8, which introduces several breaking changes.
See the <a class="link" href="https://github.com/google/zx/releases/tag/8.0.0"  target="_top">v8 changelog</a> for more information.</p></li><li class="listitem"><p><code class="literal">feishin</code> removed support for Navidrome <code class="literal">&lt; v0.53.2</code> due to an API change. See the <a class="link" href="https://github.com/jeffvli/feishin/releases/tag/v0.10.0"  target="_top">v0.10.0 release notes</a> for more information.</p></li><li class="listitem"><p><code class="literal">services.dnscrypt-wrapper</code> was removed, as the project has been effectively unmaintained since 2018. Moreover, the NixOS module had to rely on an abandoned version of <code class="literal">dnscrypt-proxy</code> v1 for the rotation of keys.
To wrap a resolver with DNSCrypt, you can instead use <code class="literal">dnsdist</code>. See <code class="literal">services.dnsdist.dnscrypt</code></p></li><li class="listitem"><p>The <code class="literal">portunus</code> package and service do not support weak password hashes anymore.
If you installed Portunus on NixOS 23.11 or earlier, upgrade to NixOS 24.05 first to get support for strong password hashing.
Then, follow the instructions on the <a class="link" href="https://github.com/majewsky/portunus/releases/tag/v2.0.0"  target="_top">upstream release notes</a> to upgrade all existing user accounts to strong password hashes.
If you need to upgrade to 24.11 without having completed the migration, consider the security implications of weak password hashes on your user accounts, and add the following to your configuration:</p><pre><code class="programlisting nix">services.portunus.package      = pkgs.portunus.override { libxcrypt = pkgs.libxcrypt-legacy; };
services.portunus.ldap.package = pkgs.openldap.override { libxcrypt = pkgs.libxcrypt-legacy; };
</code></pre></li><li class="listitem"><p>The default value of <code class="literal">services.kubernetes.kubelet.hostname</code> is now lowercased.
Explicitly set <code class="literal">kubelet.hostname</code> to <code class="literal">networking.fqdnOrHostName</code> to get back
the old default behavior.</p></li><li class="listitem"><p>Docker now defaults to 27.x, as version 24.x stopped receiving security updates and bug fixes after <a class="link" href="https://github.com/moby/moby/pull/46772#discussion_r1686464084"  target="_top">February 1, 2024</a>.</p></li><li class="listitem"><p><code class="literal">keycloak</code> was updated to version 25, which introduces new hostname related options.
See <a class="link" href="https://www.keycloak.org/docs/25.0.1/upgrading/#migrating-to-25-0-0"  target="_top">Upgrading Guide</a> for instructions.</p></li><li class="listitem"><p><code class="literal">programs.vim.defaultEditor</code> now only works if <code class="literal">programs.vim.enable</code> is enabled.</p></li><li class="listitem"><p><code class="literal">services.mautrix-meta</code> was updated to <a class="link" href="https://github.com/mautrix/meta/releases/tag/v0.4.0"  target="_top">0.4</a>. This release makes significant changes to the settings format. If you have custom settings you should migrate them to the new format. Unfortunately upstream provides little guidance for how to do this, but <a class="link" href="https://github.com/mautrix/meta/blob/f5440b05aac125b4c95b1af85635a717cbc6dd0e/cmd/mautrix-meta/legacymigrate.go#L23"  target="_top">the auto-migration code</a> may serve as a useful reference. The NixOS module should warn you if you still have any old settings configured.</p></li><li class="listitem"><p>The <code class="literal">nodePackages.shout</code> package has been removed because it was deprecated upstream in favor of <code class="literal">thelounge</code>.
The <code class="literal">shout</code> top-level attribute was an alias to this package.
The associated <code class="literal">services.shout</code> module has also been removed.</p></li><li class="listitem"><p><code class="literal">prometheus-openldap-exporter</code> was removed, as it was unmaintained both upstream and in nixpkgs.</p></li><li class="listitem"><p>The <code class="literal">indi-full</code> package no longer contains non-free drivers.
To get the old collection of drivers use <code class="literal">indi-full-nonfree</code> or create your own collection of drivers by overriding indi-with-drivers.
E.g.: <code class="literal">pkgs.indi-with-drivers.override {extraDrivers = with pkgs.indi-3rdparty; [indi-gphoto];}</code></p></li><li class="listitem"><p><code class="literal">/share/vim-plugins</code> now only gets linked if <code class="literal">programs.vim.enable</code> is enabled</p></li><li class="listitem"><p>The <code class="literal">services.guix</code> module now manages trusted substitute servers
declaratively. Instead of <code class="literal">guix archive --authorize</code>, list keys with
<code class="literal">services.guix.substituters.authorizedKeys</code>. Default substitute servers can be
set via <code class="literal">services.guix.substituters.urls</code>.</p></li><li class="listitem"><p>The <code class="literal">tracy</code> package no longer works on X11, since it’s moved to Wayland
support, which is the intended default behavior by Tracy maintainers.
X11 users have to switch to the new package <code class="literal">tracy-x11</code>.</p></li><li class="listitem"><p><code class="literal">gollum</code> has been upgraded to major version 6. Please review their <a class="link" href="https://github.com/gollum/gollum/wiki/6.0-Release-Notes"  target="_top">migration notes</a>.</p></li><li class="listitem"><p><code class="literal">services.prometheus.exporters.minio</code> option has been removed, as it’s upstream implementation was broken and unmaintained.
Minio now has built-in <a class="link" href="https://min.io/docs/minio/linux/operations/monitoring/collect-minio-metrics-using-prometheus.html"  target="_top">Prometheus metrics exposure</a>, which can be used instead.</p></li><li class="listitem"><p>The <code class="literal">services.prometheus.exporters.tor</code> option has been removed, as its upstream implementation was broken and unmaintained.</p></li><li class="listitem"><p><code class="literal">services.patroni.raft</code> has been removed, as Raft has been <a class="link" href="https://github.com/patroni/patroni/blob/master/docs/releases.rst#version-300"  target="_top">deprecated by upstream since 3.0.0</a>.</p></li><li class="listitem"><p>The <code class="literal">jd-cli</code> package was removed due to an inactive upstream and a dependency on the shut down
JCenter JAR repository.
Java decompilers already packaged in Nixpkgs include <code class="literal">bytecode-viewer</code> (GUI), <code class="literal">cfr</code> (CLI), and <code class="literal">procyon</code> (CLI).</p></li><li class="listitem"><p>The <code class="literal">jd-gui</code> package was removed due to an inactive upstream and a dependency on the end-of-life Gradle 6.
Java decompilers already packaged in Nixpkgs include <code class="literal">bytecode-viewer</code> (GUI), <code class="literal">cfr</code> (CLI), and <code class="literal">procyon</code> (CLI).</p></li><li class="listitem"><p><code class="literal">services.roundcube.maxAttachmentSize</code> will multiply the value set with <code class="literal">1.37</code> to offset overhead introduced by the base64 encoding applied to attachments.</p></li><li class="listitem"><p><code class="literal">services.mxisd</code> has been removed as both <a class="link" href="https://github.com/kamax-matrix/mxisd"  target="_top">mxisd</a> and <a class="link" href="https://github.com/ma1uta/ma1sd"  target="_top">ma1sd</a> are no longer maintained.
Consequently, the package <code class="literal">ma1sd</code> has also been removed.</p></li><li class="listitem"><p>The <code class="literal">rss-bridge</code> service drops the support to load a configuration file from <code class="literal">${config.services.rss-bridge.dataDir}/config.ini.php</code>.
Consider using the <code class="literal">services.rss-bridge.config</code> option instead.</p></li><li class="listitem"><p><code class="literal">mikutter</code> has been removed, as the package was broken and had no maintainers in nixpkgs.</p></li><li class="listitem"><p><code class="literal">xdg.portal.gtkUsePortal</code> has been removed, as it had been deprecated for over 2 years. Using the <code class="literal">GTK_USE_PORTAL</code> environment variable in this manner is not intended nor encouraged by the GTK developers, but can still be done manually via <code class="literal">environment.sessionVariables</code>.</p></li><li class="listitem"><p>Support for the legacy CUPS browsing and LDAP have been removed from <code class="literal">services.printing</code>. If <code class="literal">cups</code> or <code class="literal">ldap</code> are in the <code class="literal">BrowseRemoteProtocols</code> setting in <code class="literal">services.printing.browsedConf</code>, it needs to be removed.</p></li><li class="listitem"><p><code class="literal">services.trust-dns</code> has been renamed to <code class="literal">services.hickory-dns</code>.</p></li><li class="listitem"><p><code class="literal">services.prometheus.exporters.pgbouncer.connectionStringFile</code> has been removed since
it leaked the connection string (and thus potentially the DB password) into the cmdline
of process making it effectively world-readable.</p><p>Use <a class="link" href="options.html#opt-services.prometheus.exporters.pgbouncer.connectionEnvFile"  ><code class="literal">services.prometheus.exporters.pgbouncer.connectionEnvFile</code></a> instead.</p></li><li class="listitem"><p><code class="literal">lsh</code> and <code class="literal">services.lshd</code> have been removed as they had no maintainer in Nixpkgs and no upstream release in over a decade. It is recommended to migrate to <code class="literal">openssh</code> and <code class="literal">services.openssh</code>.</p></li><li class="listitem"><p><code class="literal">ceph</code> has been upgraded to v19. See the <a class="link" href="https://docs.ceph.com/en/latest/releases/squid/#v19-2-0-squid"  target="_top">Ceph “squid” release notes</a> for details and recommended upgrade procedure.</p></li><li class="listitem"><p><code class="literal">services.frr</code> has been refactored to use upstream service scripts. The per-daemon configurations
have been removed in favour of an <code class="literal">integrated-vtysh-config</code> style config. The daemon submodules
now use the daemon name (e.g. <code class="literal">ospfd</code>) instead of the protocol name (<code class="literal">ospf</code>). The daemons <code class="literal">zebra</code>,
<code class="literal">mgmtd</code> and <code class="literal">staticd</code> are always enabled if a config is present. The <code class="literal">vtyListenAddress</code> and
<code class="literal">vtyListenPort</code> options have been removed; use <code class="literal">options</code> or <code class="literal">extraOptions</code> instead, respectively.</p></li><li class="listitem"><p><code class="literal">opencv2</code> and <code class="literal">opencv3</code> have been removed, as they are obsolete and
were not used by any other package. External users are encouraged to
migrate to OpenCV 4.</p></li><li class="listitem"><p><code class="literal">tvheadend</code> package and the <code class="literal">services.tvheadend</code> module have been
removed due to lack of maintenance in Nixpkgs and being stuck on
an unmaintained version that required FFmpeg 4. Please see the related <a class="link" href="https://github.com/NixOS/nixpkgs/pull/332259"  target="_top">pull
request #332259</a> if you
are interested in maintaining a newer version.</p></li><li class="listitem"><p><code class="literal">antennas</code> and <code class="literal">services.antennas</code> have been removed as they only work with <code class="literal">tvheadend</code> (see above).</p></li><li class="listitem"><p><code class="literal">system.build.brightboxImage</code> has been removed as it no longer built and has not seen any maintenance in over 7 years (excluding tree-wide changes).</p></li><li class="listitem"><p><code class="literal">services.syncplay</code> now exposes all currently available command-line arguments for <code class="literal">syncplay-server</code> as options, as well as a <code class="literal">useACMEHost</code> option for easy TLS setup.
The systemd service now uses <code class="literal">DynamicUser</code>/<code class="literal">StateDirectory</code> and the <code class="literal">user</code> and <code class="literal">group</code> options have been deprecated.</p></li><li class="listitem"><p><code class="literal">openlens</code> was removed. It is recommended to use <code class="literal">lens-desktop</code> instead.</p></li><li class="listitem"><p><code class="literal">services.dnsmasq.extraConfig</code> has been removed, as it had been deprecated for over 2 years. This option has been replaced by <code class="literal">services.dnsmasq.settings</code>.</p></li><li class="listitem"><p>The NixOS installation media no longer support the ReiserFS or JFS file systems by default.</p></li><li class="listitem"><p>Minimal installer ISOs are no longer built on the small channel.
Please obtain installer images from the full release channels.</p></li><li class="listitem"><p>The default FFmpeg version is now 7.1, and FFmpeg 5 has been removed.
Please prefer using the package variants without a version suffix,
or pin FFmpeg 6 or 4 if necessary for compatibility.
Note that we keep old versions around only as required
to support packages in the tree,
and FFmpeg 4 especially should be avoided in favour of newer versions
as it may be removed soon.</p></li><li class="listitem"><p><code class="literal">openssl</code> now defaults to the latest version line <code class="literal">3.3.x</code>, instead of <code class="literal">3.0.x</code> before. While there should be no major code incompatibilities, newer OpenSSL versions typically strengthen the default security level. This means that you may have to explicitly allow weak ciphers, hashes and key lengths if necessary. See: <a class="link" href="https://docs.openssl.org/3.3/man3/SSL_CTX_set_security_level/"  target="_top">OpenSSL security level documentation</a>.</p></li><li class="listitem"><p><code class="literal">isync</code> has been updated to version <code class="literal">1.5.0</code>, which introduces some breaking changes. See the <a class="link" href="https://sourceforge.net/projects/isync/files/isync/1.5.0/"  target="_top">compatibility concerns</a> for more details.</p></li><li class="listitem"><p>Two new packages – <code class="literal">gpauth</code> and <code class="literal">gpclient</code> from the 2.x version of the
GlobalProtect-openconnect project – are added in parallel to
<code class="literal">globalprotect-openconnect</code>. The GUI components related to the project are
non-free and not packaged.</p></li><li class="listitem"><p>Compatible string matching for <code class="literal">hardware.deviceTree.overlays</code> has been changed to a more correct behavior. See <a class="link" href="release-notes.html#sec-release-24.11-migration-dto-compatible" title="hardware.deviceTree.overlays compatible string matching" >below</a> for details.</p></li><li class="listitem"><p><code class="literal">rustic</code> was upgraded to <code class="literal">0.9.0</code>, which contains <a class="link" href="https://github.com/rustic-rs/rustic/releases/tag/v0.9.0"  target="_top">breaking changes to the config file format</a>.</p></li><li class="listitem"><p><code class="literal">pkgs.formats.ini</code> and <code class="literal">pkgs.formats.iniWithGlobalSection</code> with
<code class="literal">listsAsDuplicateKeys</code> or <code class="literal">listToValue</code> no longer merge non-list values into
lists by default. Backwards-compatible behavior can be enabled with
<code class="literal">atomsCoercedToLists</code>.</p></li><li class="listitem"><p>Atlassian Server products have been removed, as support for the Atlassian Server
products ended in February 2024 and there was insufficient interest in
maintaining the Atlassian Data Center replacements:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>The <code class="literal">atlassian-bamboo</code> package</p></li><li class="listitem"><p>The <code class="literal">atlassian-confluence</code> package and its <code class="literal">services.confluence</code> NixOS module</p></li><li class="listitem"><p>The <code class="literal">atlassian-crowd</code> package and its <code class="literal">services.crowd</code> NixOS module</p></li><li class="listitem"><p>The <code class="literal">atlassian-jira</code> package and its <code class="literal">services.jira</code> NixOS module</p></li></ul></div></li><li class="listitem"><p><code class="literal">python3Packages.nose</code> has been removed, as it has been deprecated and unmaintained for almost a decade and does not work on Python 3.12.
Please switch to <code class="literal">pytest</code> or another test runner/framework.</p></li><li class="listitem"><p><code class="literal">dotnet-sdk</code>, <code class="literal">dotnet-runtime</code>, and all other dotnet packages now use a
wrapper package containing <code class="literal">bin/dotnet</code>, build hooks, etc. If you need to
reference the underlying dotnet distribution (DOTNET_ROOT) you should use e.g.
<code class="literal">dotnet-runtime.unwrapped</code>.</p></li><li class="listitem"><p>The root of dotnet distribution packages (DOTNET_ROOT) is now under e.g.
<code class="literal">${dotnet-sdk.unwrapped}/share/dotnet</code> instead of directly in the package
root. This is consistent with packaging guidelines and more friendly for FHS
environments.</p></li><li class="listitem"><p><code class="literal">dotnet-sdk</code>, <code class="literal">dotnet-runtime</code>, and <code class="literal">dotnet-aspnetcore</code> now point to dotnet 8
rather than dotnet 6. For packages that still need dotnet 6, use
<code class="literal">dotnet-sdk_6</code>, etc.</p></li><li class="listitem"><p>torq has been removed because upstreamed went closed source.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-24.11-notable-changes" class="title" >Other Notable Changes   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The <code class="literal">zerocallusedregs</code> hardening flag is enabled by default on compilers that support it.</p></li><li class="listitem"><p>The <code class="literal">stackclashprotection</code> hardening flag has been added, though disabled by default.</p></li><li class="listitem"><p>The <code class="literal">pacret</code> hardening flag has been added, though disabled by default.</p></li><li class="listitem"><p><code class="literal">cargoSha256</code> in <code class="literal">rustPlatform.buildRustPackage</code> has been deprecated in favor
of <code class="literal">cargoHash</code> which supports SRI hashes. See
<a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#compiling-rust-applications-with-cargo"  target="_top">buildRustPackage: Compiling Rust applications with Cargo</a>
for more information.</p></li><li class="listitem"><p>The <code class="literal">vendorHash</code> of Go packages built with <code class="literal">buildGoModule</code> can now be overridden with <code class="literal">overrideAttrs</code>.
<code class="literal">goModules</code>, <code class="literal">modRoot</code>, <code class="literal">vendorHash</code>, <code class="literal">deleteVendor</code>, and <code class="literal">proxyVendor</code> are now passed as derivation attributes.
<code class="literal">goModules</code> and <code class="literal">vendorHash</code> are no longer placed under <code class="literal">passthru</code>.</p></li><li class="listitem"><p><code class="literal">buildFlags</code>/<code class="literal">buildFlagsArray</code> on <code class="literal">buildGoModule</code> have been deprecated. 24.11 is the last release where <code class="literal">buildGoModule</code> accepts these flags (while throwing a warning).
Use the <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#var-go-ldflags"  target="_top"><code class="literal">ldflags</code></a> and/or <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#var-go-tags"  target="_top"><code class="literal">tags</code></a> attributes or
<a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#ssec-go-environment"  target="_top">the environment</a> instead.</p></li><li class="listitem"><p><code class="literal">buildGoPackage</code> has been deprecated. 24.11 is the last release with <code class="literal">buildGoPackage</code> available.</p></li><li class="listitem"><p><code class="literal">hareHook</code> has been added as the language framework for Hare. From now on, it,
not the <code class="literal">hare</code> package, should be added to <code class="literal">nativeBuildInputs</code> when building
Hare programs.</p></li><li class="listitem"><p><code class="literal">virtualisation.docker.liveRestore</code> has been renamed to <code class="literal">virtualisation.docker.daemon.settings.&quot;live-restore&quot;</code> and turned off by default for state versions of at least 24.11.</p></li><li class="listitem"><p>Tailscale’s <code class="literal">authKeyFile</code> can now have its corresponding parameters set through <code class="literal">config.services.tailscale.authKeyParameters</code>, allowing for non-ephemeral unsupervised deployment and more.
See <a class="link" href="https://tailscale.com/kb/1215/oauth-clients#registering-new-nodes-using-oauth-credentials"  target="_top">Registering new nodes using OAuth credentials</a> for the supported options.</p></li><li class="listitem"><p><code class="literal">nixosTests</code> now provide a working IPv6 setup for VLAN 1 by default.</p></li><li class="listitem"><p>Kanidm can now be provisioned using the new [<code class="literal">services.kanidm.provision</code>] option, but requires using a patched version available via <code class="literal">pkgs.kanidm.withSecretProvisioning</code>.</p></li><li class="listitem"><p>Kanidm previously had an incorrect systemd service type, causing dependent units with an <code class="literal">after</code> and <code class="literal">requires</code> directive to start before <code class="literal">kanidm*</code> finished startup. The module has now been updated in line with upstream recommendations.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.jupyter.enable"  ><code class="literal">services.jupyter</code></a> is now compatible with <code class="literal">Jupyter Notebook 7</code>. See <a class="link" href="https://jupyter-notebook.readthedocs.io/en/latest/migrate_to_notebook7.html"  target="_top">the migration guide</a> for details.</p></li><li class="listitem"><p>The kubelet configuration file can now be amended with arbitrary additional content using the <code class="literal">services.kubernetes.kubelet.extraConfig</code> option.</p></li><li class="listitem"><p>The <code class="literal">services.seafile</code> module was updated to major version 11.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>As part of this upgrade, the database backend will be migrated to MySQL.
This process should be automatic, but in case of a botched migration,
old sqlite files are not removed and can be used to manually migrate the database.</p></li><li class="listitem"><p>Additionally, the updated CSRF protection may prevent some users from logging in.
Specific origin addresses can be whitelisted using the <code class="literal">services.seafile.seahubExtraConf</code> option
(e.g. <code class="literal">services.seafile.seahubExtraConf = &#x27;&#x27;CSRF_TRUSTED_ORIGINS = [&quot;https://example.com&quot;]&#x27;&#x27;;</code>).
Note that first solution of the <a class="link" href="https://cloud.seatable.io/dtable/external-links/7b976c85f504491cbe8e/?tid=0000&amp;vid=0000&amp;row-id=BQhH-2HSQs68Nq2EW91DBA"  target="_top">official FAQ answer</a>
is not allowed by the <code class="literal">services.nginx</code> module’s config-checker.</p></li></ul></div></li><li class="listitem"><p>The new option <code class="literal">boot.binfmt.addEmulatedSystemsToNixSandbox</code> allows you to skip adding the emulated systems to <code class="literal">nix.settings.extra-platforms</code>. Now you can emulate foreign binaries locally while only building them on native remote builders.</p></li><li class="listitem"><p>The latest available version of Nextcloud is v30 (available as <code class="literal">pkgs.nextcloud30</code>). The installation logic is as follows:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>If <a class="link" href="options.html#opt-services.nextcloud.package"  ><code class="literal">services.nextcloud.package</code></a> is specified explicitly, this package will be installed (<span class="strong"><strong>recommended</strong></span>)</p></li><li class="listitem"><p>If <a class="link" href="options.html#opt-system.stateVersion"  ><code class="literal">system.stateVersion</code></a> is &gt;=24.05, <code class="literal">pkgs.nextcloud29</code> will be installed by default.</p></li><li class="listitem"><p>If <a class="link" href="options.html#opt-system.stateVersion"  ><code class="literal">system.stateVersion</code></a> is &gt;=24.11, <code class="literal">pkgs.nextcloud30</code> will be installed by default.</p></li><li class="listitem"><p>Please note that an upgrade from v28 (or older) to v30 directly is not possible. Please upgrade to <code class="literal">nextcloud29</code> (or earlier) first. Nextcloud prohibits skipping major versions while upgrading. You can upgrade by declaring <a class="link" href="options.html#opt-services.nextcloud.package"  target="_top"><code class="literal">services.nextcloud.package = pkgs.nextcloud29;</code></a>.</p></li></ul></div></li><li class="listitem"><p>To facilitate dependency injection, the <code class="literal">imgui</code> package now builds a static archive using vcpkg’ CMake rules.
The derivation now installs “impl” headers selectively instead of by a wildcard.
Use <code class="literal">imgui.src</code> if you just want to access the unpacked sources.</p></li><li class="listitem"><p>The new <code class="literal">boot.loader.systemd-boot.windows</code> option makes setting up dual-booting with Windows on a different drive easier.</p></li><li class="listitem"><p>The <code class="literal">boot.loader.raspberryPi</code> options were marked as deprecated in 23.11 and have now been removed.</p></li><li class="listitem"><p>Linux 4.19 has been removed because it will reach its end of life within the lifespan of 24.11.</p></li><li class="listitem"><p>Unprivileged access to the kernel syslog via <code class="literal">dmesg</code> is now restricted by default. Users wanting to keep an
unrestricted access to it can set <code class="literal">boot.kernel.sysctl.&quot;kernel.dmesg_restrict&quot; = false</code>.</p></li><li class="listitem"><p>The <code class="literal">i18n.inputMethod</code> module introduces two new properties:
<code class="literal">enable</code> and <code class="literal">type</code>, for declaring whether to enable an alternative input method and defining which input method respectfully. The options available in <code class="literal">type</code> are the same as the existing <code class="literal">enabled</code> option. <code class="literal">enabled</code> is now deprecated, and will be removed in a future release.</p></li><li class="listitem"><p><code class="literal">security.pam.u2f</code> now uses freeform options; all module options are now configurable through <code class="literal">security.pam.u2f.settings</code>.</p></li><li class="listitem"><p><code class="literal">mikutter</code> was removed as the package was broken and had no maintainers.</p></li><li class="listitem"><p><code class="literal">services.getty.autologinOnce</code> was added to limit the automatic login to once per boot and on the first tty only.
When using full disk encryption, this option allows to unlock the system without retyping the passphrase while keeping the other ttys protected.</p></li><li class="listitem"><p>Gollum was upgraded to major version 6. Read their <a class="link" href="https://github.com/gollum/gollum/wiki/6.0-Release-Notes"  target="_top">migration notes</a>.</p></li><li class="listitem"><p>The hooks <code class="literal">yarnConfigHook</code> and <code class="literal">yarnBuildHook</code> were added. These should replace <code class="literal">yarn2nix.mkYarnPackage</code> and other <code class="literal">yarn2nix</code> related tools. The motivation to get rid of <code class="literal">yarn2nix</code> tools is the fact that they are too complex and hard to maintain, and they rely upon too much Nix evaluation which is problematic if import-from-derivation is not allowed (see more details at <a class="link" href="https://github.com/NixOS/nixpkgs/issues/296856"  target="_top">#296856</a>. The transition from <code class="literal">mkYarnPackage</code> to <code class="literal">yarn{Config,Build}Hook</code> is tracked at <a class="link" href="https://github.com/NixOS/nixpkgs/issues/324246"  target="_top">#324246</a>.</p></li><li class="listitem"><p><code class="literal">services.timesyncd.servers</code> now defaults to <code class="literal">null</code>, allowing systemd-timesyncd to use NTP servers advertised by DHCP.</p></li><li class="listitem"><p><code class="literal">services.timesyncd.fallbackServers</code> was added and defaults to <code class="literal">networking.timeServers</code>.</p></li><li class="listitem"><p>Cinnamon has been updated to 6.2. Please check <a class="link" href="https://www.linuxmint.com/rel_wilma_whatsnew.php"  target="_top">upstream announcement</a> for more details.
Following Mint 22 defaults, the Cinnamon module no longer ships <code class="literal">geary</code> and <code class="literal">hexchat</code> by default.</p></li><li class="listitem"><p><code class="literal">zfs.latestCompatibleLinuxPackages</code> is deprecated and is now pointing at the default kernel. If using the stable LTS kernel (default <code class="literal">linuxPackages</code> is not possible then you must explicitly pin a specific kernel release. For example, <code class="literal">boot.kernelPackages = pkgs.linuxPackages_6_6</code>. Please be aware that non-LTS kernels are likely to go EOL before ZFS supports the latest supported non-LTS release, requiring manual intervention.</p></li><li class="listitem"><p>The <code class="literal">shadowstack</code> hardening flag has been added, though disabled by default.</p></li><li class="listitem"><p><code class="literal">writeReferencesToFile</code> has been removed after its deprecation in 24.05. Use the trivial build helper <code class="literal">writeClosure</code> instead.</p></li><li class="listitem"><p><code class="literal">xxd</code> is now provided by the <code class="literal">tinyxxd</code> package rather than <code class="literal">vim.xxd</code> to reduce closure size and vulnerability impact. Since it has the same options and semantics as Vim’s <code class="literal">xxd</code> utility, there is no user impact. Vim’s <code class="literal">xxd</code> remains available as the <code class="literal">vim.xxd</code> package.</p></li><li class="listitem"><p><code class="literal">restic</code> module now has an option for inhibiting system sleep while backups are running, defaulting to off (not inhibiting sleep). Available as <a class="link" href="options.html#opt-services.restic.backups._name_.inhibitsSleep"  ><code class="literal">services.restic.backups.&lt;name&gt;.inhibitsSleep</code></a>.</p></li><li class="listitem"><p>Mattermost has been updated from 9.5 to 9.11 ESR. See the <a class="link" href="https://docs.mattermost.com/about/mattermost-v9-changelog.html#release-v9-11-extended-support-release"  target="_top">changelog</a> for more details.</p></li><li class="listitem"><p><code class="literal">cargo-tauri.hook</code> was introduced to help users build <a class="link" href="https://tauri.app/"  target="_top">Tauri</a> projects. It is meant to be used alongside
<code class="literal">rustPlatform.buildRustPackage</code> and Node hooks such as <code class="literal">npmConfigHook</code>, <code class="literal">pnpm.configHook</code>, and the new <code class="literal">yarnConfig</code></p></li><li class="listitem"><p><code class="literal">power.ups</code> now powers off UPSs during a power outage event.
This saves UPS battery and ensures that host(s) get back up again when power comes back, even in the scenario when the UPS would have had enough capacity to keep power on during the whole power outage.
If you like the old behaviour of keeping the UPSs on (and emptying the battery) after the host(s) have shut down, and risk not getting a power cycle event to get the host(s) back up, set <code class="literal">power.ups.upsmon.settings.POWERDOWNFLAG = null;</code>.</p></li><li class="listitem"><p><code class="literal">nixos-firewall-tool</code> now supports nftables in addition to iptables and is installed by default when NixOS firewall is enabled.</p></li><li class="listitem"><p>Support for <span class="emphasis"><em>runner registration tokens</em></span> has been <a class="link" href="https://gitlab.com/gitlab-org/gitlab/-/issues/380872"  target="_top">deprecated</a>
in <code class="literal">gitlab-runner</code> 15.6 and is expected to be removed in <code class="literal">gitlab-runner</code> 18.0. Configuration of existing runners
should be changed to using <span class="emphasis"><em>runner authentication tokens</em></span> by configuring
<code class="option">services.gitlab-runner.services.&lt;name&gt;.authenticationTokenConfigFile</code> instead of the former
<code class="option">services.gitlab-runner.services.&lt;name&gt;.registrationConfigFile</code> option.</p></li><li class="listitem"><p><code class="literal">iproute2</code> now has libbpf support.</p><p>If you use extensions that are not packaged in nixpkgs, please review whether it still works
with the current settings and adjust accordingly if needed.</p></li><li class="listitem"><p><code class="literal">nix.channel.enable = false</code> no longer implies <code class="literal">nix.settings.nix-path = []</code>.
Since Nix 2.13, a <code class="literal">nix-path</code> set in <code class="literal">nix.conf</code> cannot be overridden by the <code class="literal">NIX_PATH</code> configuration variable.</p></li><li class="listitem"><p>ZFS now imports its pools in <code class="literal">postResumeCommands</code> rather than <code class="literal">postDeviceCommands</code>. If you had <code class="literal">postDeviceCommands</code> scripts that depended on ZFS pools being imported, those now need to be in <code class="literal">postResumeCommands</code>.</p></li><li class="listitem"><p><code class="literal">services.automatic-timezoned.enable = true</code> will now set <code class="literal">time.timeZone = null</code>.
This is to avoid silently shadowing a user’s explicitly defined timezone without recognition on the user’s part.</p></li><li class="listitem"><p><code class="literal">services.localtimed.enable = true</code> will now set <code class="literal">time.timeZone = null</code>.
This is to avoid silently shadowing a user’s explicitly defined timezone without recognition on the user’s part.</p></li><li class="listitem"><p><code class="literal">qgis</code> and <code class="literal">qgis-ltr</code> are now built without <code class="literal">grass</code> by default. <code class="literal">grass</code> support can be enabled with <code class="literal">qgis.override { withGrass = true; }</code>.</p></li><li class="listitem"><p><code class="literal">virtualisation.incus</code> module gained new <code class="literal">incus-user.service</code> and <code class="literal">incus-user.socket</code> systemd units. It is now possible to add a user to <code class="literal">incus</code> group instead of <code class="literal">incus-admin</code> for increased security.</p></li><li class="listitem"><p><code class="literal">buildDotnetModule</code> now uses JSON-based instead of nix-based lockfiles.
Support for nix-based lockfiles has been deprecated and will be dropped on release 25.11.</p></li><li class="listitem"><p><code class="literal">buildDotnetModule.fetch-deps</code> now generates a JSON lockfile by default.
A nix-based lockfile will be generated if one existed before for compatibility, however it has been deprecated and will be dropped on release 25.11.</p></li><li class="listitem"><p><code class="literal">freecad</code> now supports addons and custom configuration in nix-way, which can be used by calling <code class="literal">freecad.customize</code>.</p></li><li class="listitem"><p><code class="literal">buildNimSbom</code> was added as an alternative to <code class="literal">buildNimPackage</code>. <code class="literal">buildNimSbom</code> uses <a class="link" href="https://cyclonedx.org/"  target="_top">SBOMs</a> to generate packages whereas <code class="literal">buildNimPackage</code> uses a custom JSON lockfile format.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-24.11-migration" class="title" >Detailed Migration Information   </h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-release-24.11-migration-sound" class="title" ><code class="literal">sound</code> options removal   </h4>  </div> </div></div><p>The <code class="literal">sound</code> options have been largely removed, as they are unnecessary for most modern setups, and cause issues when enabled.</p><p>If you set <code class="literal">sound.enable</code> in your configuration:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>If you are using Pulseaudio or PipeWire, simply remove that option</p></li><li class="listitem"><p>If you are not using an external sound server, and want volumes to be persisted across shutdowns, set <code class="literal">hardware.alsa.enablePersistence = true</code> instead</p></li></ul></div><p>If you set <code class="literal">sound.enableOSSEmulation</code> in your configuration:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Make sure it is still necessary, as very few applications actually use OSS</p></li><li class="listitem"><p>If necessary, set <code class="literal">boot.kernelModules = [ &quot;snd_pcm_oss&quot; ]</code></p></li></ul></div><p>If you set <code class="literal">sound.extraConfig</code> in your configuration:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>If you are using another sound server, like Pulseaudio, JACK or PipeWire, migrate your configuration to that</p></li><li class="listitem"><p>If you are not using an external sound server, set <code class="literal">environment.etc.&quot;asound.conf&quot;.text = yourExtraConfig</code> instead</p></li></ul></div><p>If you set <code class="literal">sound.mediaKeys</code> in your configuration:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Preferably switch to handling media keys in your desktop environment/compositor</p></li><li class="listitem"><p>If you want to maintain the exact behavior of the option, use the following snippet</p></li></ul></div><pre><code class="programlisting nix">services.actkbd = let
  volumeStep = &quot;1%&quot;;
in {
  enable = true;
  bindings = [
    # &quot;Mute&quot; media key
    { keys = [ 113 ]; events = [ &quot;key&quot; ];       command = &quot;${alsa-utils}/bin/amixer -q set Master toggle&quot;; }

    # &quot;Lower Volume&quot; media key
    { keys = [ 114 ]; events = [ &quot;key&quot; &quot;rep&quot; ]; command = &quot;${alsa-utils}/bin/amixer -q set Master ${volumeStep}- unmute&quot;; }

    # &quot;Raise Volume&quot; media key
    { keys = [ 115 ]; events = [ &quot;key&quot; &quot;rep&quot; ]; command = &quot;${alsa-utils}/bin/amixer -q set Master ${volumeStep}+ unmute&quot;; }

    # &quot;Mic Mute&quot; media key
    { keys = [ 190 ]; events = [ &quot;key&quot; ];       command = &quot;${alsa-utils}/bin/amixer -q set Capture toggle&quot;; }
  ];
};
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-release-24.11-migration-dto-compatible" class="title" ><code class="literal">hardware.deviceTree.overlays</code> compatible string matching   </h4>  </div> </div></div><p>The original compatible string implementation in older NixOS versions relied on substring matching,
which is incorrect for overlays with multiple compatible strings and other cases.</p><p>The new behavior is consistent with what other tools already do - the overlay is considered applicable if,
and only if, <span class="emphasis"><em>any</em></span> of the compatible strings in the overlay match <span class="emphasis"><em>any</em></span> of the compatible strings in the DT.</p><p>To provide some examples:</p><div class="informaltable"><table class="informaltable" border="1"><colgroup><col align="left" /><col align="left" /><col align="left" /><col align="left" /><col align="left" /></colgroup><thead><tr><th align="left">Overlay <code class="literal">compatible</code></th><th align="left">DT <code class="literal">compatible</code></th><th align="left">Pre-24.11 behavior</th><th align="left">Correct behavior</th><th align="left">Notes</th></tr></thead><tbody><tr><td align="left"><code class="literal">&quot;foo&quot;</code></td><td align="left"><code class="literal">&quot;foo&quot;, &quot;bar&quot;</code></td><td align="left">match</td><td align="left">match</td><td align="left">Most common use case does not change</td></tr><tr><td align="left"><code class="literal">&quot;foo&quot;</code></td><td align="left"><code class="literal">&quot;foobar&quot;</code></td><td align="left">match</td><td align="left">no match</td><td align="left">Substrings should not be matched</td></tr><tr><td align="left"><code class="literal">&quot;foo bar&quot;</code></td><td align="left"><code class="literal">&quot;foo&quot;, &quot;bar&quot;</code></td><td align="left">match</td><td align="left">no match</td><td align="left">Separators should not be matched to spaces</td></tr><tr><td align="left"><code class="literal">&quot;foo&quot;, &quot;bar&quot;</code></td><td align="left"><code class="literal">&quot;baz&quot;, &quot;bar&quot;</code></td><td align="left">no match</td><td align="left">match</td><td align="left">One compatible string matching is enough</td></tr></tbody></table></div><p>Note that this also allows writing overlays that explicitly apply to multiple boards.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-24.11-lib" class="title" >Nixpkgs Library   </h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-release-24.11-lib-breaking" class="title" >Breaking changes   </h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.strings.escapeShellArg"  target="_top"><code class="literal">lib.escapeShellArg</code></a> and <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.strings.escapeShellArgs"  target="_top"><code class="literal">lib.escapeShellArgs</code></a>: Arguments that don’t need to be escaped won’t be anymore, which is not breaking according to the functions documentation, but it can cause breakages if used for the non-intended use cases.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.trivial.warn"  target="_top"><code class="literal">lib.warn msg val</code></a> (and its relatives <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.trivial.warnIf"  target="_top"><code class="literal">lib.warnIf</code></a> and <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.trivial.warnIfNot"  target="_top"><code class="literal">lib.warnIfNot</code></a>) now require <code class="literal">msg</code> to be a string to match the behavior of the new <a class="link" href="https://nix.dev/manual/nix/2.25/language/builtins.html?highlight=warn#builtins-warn"  target="_top"><code class="literal">builtins.warn</code></a>.</p></li><li class="listitem"><p><code class="literal">lib.mdDoc</code>: Removed after deprecation in the previous release.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-release-24.11-lib-additions-improvements" class="title" >Additions and Improvements   </h4>  </div> </div></div><p>New and extended interfaces:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.trivial.fromHexString"  target="_top"><code class="literal">lib.fromHexString</code></a>: Convert a hexadecimal string to it’s integer representation.</p></li><li class="listitem"><p><code class="literal">lib.network.ipv6.fromString</code>: Parse an IPv6 address.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.meta.getLicenseFromSpdxIdOr"  target="_top"><code class="literal">lib.getLicenseFromSpdxIdOr</code></a>: Get the corresponding attribute in <code class="literal">lib.licenses</code> from an SPDX ID or fall back to the given default value.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.meta.licensesSpdx"  target="_top"><code class="literal">lib.licensesSpdx</code></a>: Mapping of SPDX ID to the attributes in <code class="literal">lib.licenses</code>.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.attrsets.getFirstOutput"  target="_top"><code class="literal">lib.getFirstOutput</code></a>: Like <code class="literal">getOutput</code> but with a list of fallback output names.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.attrsets.getInclude"  target="_top"><code class="literal">lib.getInclude</code></a> and <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.attrsets.getStatic"  target="_top"><code class="literal">lib.getStatic</code></a>: Get a package’s <code class="literal">include</code>/<code class="literal">static</code> output.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.strings.trim"  target="_top"><code class="literal">lib.trim</code></a> and <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.strings.trimWith"  target="_top"><code class="literal">lib.trimWith</code></a>: Remove leading and trailing whitespace from a string.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.meta.defaultPriority"  target="_top"><code class="literal">lib.meta.defaultPriority</code></a>: The default priority of packages in Nix.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.fixedPoints.toExtension"  target="_top"><code class="literal">lib.toExtension</code></a>: Convert to an extending function (overlay).</p></li><li class="listitem"><p><code class="literal">lib.fetchers.normalizeHash</code>: Convert an attrset containing one of <code class="literal">hash</code>, <code class="literal">sha256</code> or <code class="literal">sha512</code> into one containing <code class="literal">outputHash{,Algo}</code> as accepted by <code class="literal">mkDerivation</code>.</p></li><li class="listitem"><p><code class="literal">lib.fetchers.withNormalizedHash</code>: Wraps a function which accepts <code class="literal">outputHash{,Algo}</code> into one which accepts <code class="literal">hash</code>, <code class="literal">sha256</code> or <code class="literal">sha512</code>.</p></li><li class="listitem"><p>Various builtins are now reexported in a more standard way:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">lib.map</code> -&gt; <code class="literal">lib.lists.map</code> -&gt; <code class="literal">builtins.map</code></p></li><li class="listitem"><p><code class="literal">lib.intersectAttrs</code> -&gt; <code class="literal">lib.attrsets.intersectAttrs</code> -&gt; <code class="literal">builtins.intersectAttrs</code></p></li><li class="listitem"><p><code class="literal">lib.removeAttrs</code> -&gt; <code class="literal">lib.attrsets.removeAttrs</code> -&gt; <code class="literal">builtins.removeAttrs</code></p></li><li class="listitem"><p><code class="literal">lib.match</code> -&gt; <code class="literal">lib.strings.match</code> -&gt; <code class="literal">builtins.match</code></p></li><li class="listitem"><p><code class="literal">lib.split</code> -&gt; <code class="literal">lib.strings.split</code> -&gt; <code class="literal">builtins.split</code></p></li><li class="listitem"><p><code class="literal">lib.typeOf</code> -&gt; <code class="literal">builtins.typeOf</code></p></li><li class="listitem"><p><code class="literal">lib.unsafeGetAttrPos</code> -&gt; <code class="literal">builtins.unsafeGetAttrPos</code></p></li></ul></div></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.cli.toGNUCommandLine"  target="_top"><code class="literal">lib.cli.toGNUCommandLine</code></a> now supports the <code class="literal">optionValueSeparator</code> argument attribute to control the key-value separator for arguments.</p></li></ul></div><p>Documentation improvements:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Much of the documentation has been migrated to the <a class="link" href="https://github.com/NixOS/rfcs/pull/145"  target="_top">standard doc-comment format</a>, including <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#sec-functions-library-derivations"  target="_top"><code class="literal">lib.derivations</code></a>, <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#sec-functions-library-fixedPoints"  target="_top"><code class="literal">lib.fixedPoints</code></a>, <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#sec-functions-library-gvariant"  target="_top"><code class="literal">lib.gvariant</code></a>, <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#sec-functions-library-filesystem"  target="_top"><code class="literal">lib.filesystem</code></a>, <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#sec-functions-library-strings"  target="_top"><code class="literal">lib.strings</code></a>, <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#sec-functions-library-meta"  target="_top"><code class="literal">lib.meta</code></a>.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#sec-functions-library-generators"  target="_top"><code class="literal">lib.generators</code> documentation</a> is now improved and rendered in the manual.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#sec-functions-library-cli"  target="_top"><code class="literal">lib.cli</code> documentation</a> is now improved and rendered in the manual.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.fixedPoints.composeExtensions"  target="_top"><code class="literal">lib.composeExtensions</code></a> and <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.fixedPoints.composeManyExtensions"  target="_top"><code class="literal">lib.composeManyExtensions</code></a> documentation is now improved.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.trivial.importTOML"  target="_top"><code class="literal">lib.importTOML</code></a> and <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.trivial.importJSON"  target="_top"><code class="literal">lib.importJSON</code></a>’s documentation now have an example.</p></li></ul></div><p>Module System:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">lib.importApply</code>: New function, imports a Nix expression file much like the module system would, after passing an extra positional argument to the function in the file.</p></li><li class="listitem"><p>Improve error message when accessing an option that isn’t defined.</p></li><li class="listitem"><p><code class="literal">lib.types.anything</code>: Don’t fail to merge when specifying the same list multiple times.</p></li><li class="listitem"><p>Improve error when loading a flake as a module.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-release-24.11-lib-deprecations" class="title" >Deprecations   </h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.options.mkPackageOptionMD"  target="_top"><code class="literal">lib.options.mkPackageOptionMD</code></a> is now obsolete; use the identical <a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.options.mkPackageOption"  target="_top"><code class="literal">lib.options.mkPackageOption</code></a> instead.</p></li><li class="listitem"><p><code class="literal">lib.misc.mapAttrsFlatten</code> is now formally deprecated and will be removed in future releases; use the identical <a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.attrsets.mapAttrsToList"  target="_top"><code class="literal">lib.attrsets.mapAttrsToList</code></a> instead.</p></li><li class="listitem"><p><code class="literal">lib.isInOldestRelease</code>: Renamed to <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.trivial.oldestSupportedReleaseIsAtLeast"  target="_top"><code class="literal">oldestSupportedReleaseIsAtLeast</code></a> and deprecated.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-24.11-wiki" class="title" >NixOS Wiki   </h3>  </div> </div></div><p>The official NixOS Wiki at <a class="link" href="https://wiki.nixos.org/"  target="_top">wiki.nixos.org</a> was launched in April 2024, featuring
content initially copied from the community wiki. The wiki enhances the official documentation, linking to
existing resources and providing a categorization system for easy navigation, and is guided by a new “Manual
of Style” — a contribution guide and enhanced templates. It offers a wealth of new information, including
articles on applications, desktop environments, and a growing number of translations in multiple languages.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-24.05" class="title" style="clear: both">Release 24.05 (“Uakari”, 2024.05/31)   </h2>  </div> </div></div><p>Support is planned until the end of December 2024, handing over to 24.11.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-24.05-highlights" class="title" >Highlights   </h3>  </div> </div></div><p>In addition to numerous new and upgraded packages, this release has the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The default kernel package has been updated from 6.1 to 6.6. All supported kernels remain available.</p></li><li class="listitem"><p>For each supporting version of the Linux kernel, firmware blobs
are compressed with zstd. For firmware blobs this means an increase of 4.4% in size, however
a significantly higher decompression speed.</p></li><li class="listitem"><p>NixOS now installs a stub ELF loader that prints an informative error message when users attempt to run binaries not made for NixOS.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>This can be disabled through the <code class="literal">environment.stub-ld.enable</code> option.</p></li><li class="listitem"><p>If you use <code class="literal">programs.nix-ld.enable</code>, no changes are needed. The stub will be disabled automatically.</p></li></ul></div></li><li class="listitem"><p>On flake-based NixOS configurations using <code class="literal">nixpkgs.lib.nixosSystem</code>, NixOS will automatically set <code class="literal">NIX_PATH</code> and the system-wide flake registry (<code class="literal">/etc/nix/registry.json</code>) to point <code class="literal">&lt;nixpkgs&gt;</code> and the unqualified flake path <code class="literal">nixpkgs</code> to the version of nixpkgs used to build the system.</p><p>This makes <code class="literal">nix run nixpkgs#hello</code> and <code class="literal">nix-build &#x27;&lt;nixpkgs&gt;&#x27; -A hello</code> work out of the box with no added configuration, reusing dependencies already on the system.</p><p>This may be undesirable if Nix commands are not going to be run on the built system since it adds nixpkgs to the system closure. For such closure-size-constrained non-interactive systems, this setting should be disabled.</p><p>To disable it, set <a class="link" href="options.html#opt-nixpkgs.flake.setNixPath"  >nixpkgs.flake.setNixPath</a> and <a class="link" href="options.html#opt-nixpkgs.flake.setFlakeRegistry"  >nixpkgs.flake.setFlakeRegistry</a> to false.</p></li><li class="listitem"><p>NixOS AMIs are now uploaded regularly to a new AWS Account.
Instructions on how to use them can be found on <a class="link" href="https://nixos.github.io/amis"  target="_top">https://nixos.github.io/amis</a>.
We are working on integrating the data into the NixOS homepage.
The list in <code class="literal">nixos/modules/virtualisation/amazon-ec2-amis.nix</code> will stop
being updated and will be removed in the future.</p></li><li class="listitem"><p>It is now possible to have a completely perlless system (i.e. a system
without perl). Previously, the NixOS activation depended on two perl scripts
which can now be replaced via an opt-in mechanism. To make your system
perlless, you can use the new perlless profile:</p><pre><code class="programlisting nix">{ modulesPath, ... }: {
  imports = [ &quot;${modulesPath}/profiles/perlless.nix&quot; ];
}
</code></pre></li><li class="listitem"><p>Cinnamon has been updated to 6.0. Please be aware that the <a class="link" href="https://blog.linuxmint.com/?p=4591"  target="_top">Wayland session</a> is still experimental in this release and could potentially <a class="link" href="https://blog.linuxmint.com/?p=4639"  target="_top">affect Xorg sessions</a>. We suggest a reboot when switching between sessions.</p></li><li class="listitem"><p>GNOME has been updated to 46 “Kathmandu”. Refer to the <a class="link" href="https://release.gnome.org/46/"  target="_top">release notes</a> for more details. Notably this release brings experimental VRR support, default GTK renderer changes and WebDAV support in Online Accounts. This release we have also stopped including the legacy and unsupported Adwaita-Dark theme by default.</p></li><li class="listitem"><p>Lomiri (formerly known as Unity8) desktop mode, using Mir 2.x to function as a Wayland compositor, is now available and can be installed with <code class="literal">services.desktopManager.lomiri.enable = true</code>. Note that some core applications, services and indicators have yet to be packaged, and some functions may remain incomplete, but the base experience should be there.</p></li><li class="listitem"><p>LXQt has been updated to 2.0, which is based on Qt 6 and features Wayland support for many applications.</p></li><li class="listitem"><p>MATE has been updated to 1.28.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>To properly support panel plugins built with Wayland (in-process) support, we are introducing the <code class="literal">services.xserver.desktopManager.mate.extraPanelApplets</code> option, please use that for installing panel applets.</p></li><li class="listitem"><p>Similarly, please use the <code class="literal">services.xserver.desktopManager.mate.extraCajaExtensions</code> option for installing Caja extensions.</p></li><li class="listitem"><p>To use the Wayland session, enable <code class="literal">services.xserver.desktopManager.mate.enableWaylandSession</code>. This is opt-in for now as it is in early an stage and introduces a new set of Wayfire closures. Due to <a class="link" href="https://github.com/canonical/lightdm/issues/63"  target="_top">known issues with LightDM</a>, we suggest using SDDM as the display manager.</p></li></ul></div></li><li class="listitem"><p>Plasma 6 is now available and can be installed with <code class="literal">services.desktopManager.plasma6.enable = true;</code>. Plasma 5 will likely be deprecated in the next release (24.11). Note that Plasma 6 runs as Wayland by default, and the X11 session needs to be explicitly selected if necessary.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-24.05-new-services" class="title" >New Services   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://docs.ankiweb.net/sync-server.html"  target="_top">Anki Sync Server</a>, the official sync server built into recent versions of Anki. Available as <a class="link" href="options.html#opt-services.anki-sync-server.enable"  >services.anki-sync-server</a>.
The pre-existing <code class="literal">services.ankisyncd</code> has been marked deprecated and will be dropped after 24.05 due to lack of maintenance of the ankisyncd software.</p></li><li class="listitem"><p><a class="link" href="https://github.com/alvr-org/alvr"  target="_top">ALVR</a>, a VR desktop streamer. Available as <a class="link" href="options.html#opt-programs.alvr.enable"  >programs.alvr</a>.</p></li><li class="listitem"><p><a class="link" href="https://appimage.org/"  target="_top">AppImage</a>, a tool to package desktop applications, now has a <code class="literal">binfmt</code> option to support running AppImages seamlessly on NixOS. Available as <a class="link" href="options.html#opt-programs.appimage.binfmt"  >programs.appimage.binfmt</a>.</p></li><li class="listitem"><p><a class="link" href="https://wiki.armagetronad.org"  target="_top">armagetronad</a>, a mid-2000s 3D lightcycle game widely played at iD Tech Camps. You can define multiple servers using <code class="literal">services.armagetronad.&lt;server&gt;.enable</code>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/sosy-lab/benchexec"  target="_top">BenchExec</a>, a framework for reliable benchmarking and resource measurement, available as <a class="link" href="options.html#opt-programs.benchexec.enable"  >programs.benchexec</a>,
as well as related programs
<a class="link" href="https://github.com/sosy-lab/cpu-energy-meter"  target="_top">CPU Energy Meter</a>, available as <a class="link" href="options.html#opt-programs.cpu-energy-meter.enable"  >programs.cpu-energy-meter</a>, and
<a class="link" href="https://gitlab.com/sosy-lab/software/pqos-wrapper"  target="_top">PQoS Wrapper</a>, available as <a class="link" href="options.html#opt-programs.pqos-wrapper.enable"  >programs.pqos-wrapper</a>.</p></li><li class="listitem"><p><a class="link" href="https://bluemap.bluecolored.de/"  target="_top">Bluemap</a>, a 3D minecraft map renderer. Available as <a class="link" href="options.html#opt-services.bluemap.enable"  >services.bluemap</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/toreanderson/clatd"  target="_top">clatd</a>, a CLAT / SIIT-DC Edge Relay implementation for Linux.</p></li><li class="listitem"><p><a class="link" href="https://github.com/latchset/clevis"  target="_top">Clevis</a>, a pluggable framework for automated decryption, used to unlock encrypted devices in initrd. Available as <a class="link" href="options.html#opt-boot.initrd.clevis.enable"  >boot.initrd.clevis.enable</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/Athou/commafeed"  target="_top">CommaFeed</a>, a Google Reader-inspired self-hosted RSS reader. Available as <a class="link" href="options.html#opt-services.commafeed.enable"  >services.commafeed</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/tchapi/davis"  target="_top">davis</a>, a simple CardDav and CalDav server inspired by Baïkal. Available as <a class="link" href="options.html#opt-services.davis.enable"  >services.davis</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/derhuerst/db-rest"  target="_top">db-rest</a>, a wrapper around Deutsche Bahn’s internal API for public transport data. Available as <a class="link" href="options.html#opt-services.db-rest.enable"  >services.db-rest</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/AdguardTeam/dnsproxy"  target="_top">dnsproxy</a>, a simple DNS proxy with DoH, DoT, DoQ and DNSCrypt support. Available as <a class="link" href="options.html#opt-services.dnsproxy.enable"  >services.dnsproxy</a>.</p></li><li class="listitem"><p><a class="link" href="https://fcast.org"  target="_top">FCast Receiver</a>, an open-source alternative to Chromecast and AirPlay. Available as <a class="link" href="options.html#opt-programs.fcast-receiver.enable"  >programs.fcast-receiver</a>.</p></li><li class="listitem"><p><a class="link" href="https://filesender.org/"  target="_top">FileSender</a>, a file sharing software. Available as <a class="link" href="options.html#opt-services.filesender.enable"  >services.filesender</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.firefly-iii.org"  target="_top">Firefly-iii</a>, a free and open source personal finance manager. Available as <a class="link" href="options.html#opt-services.firefly-iii.enable"  >services.firefly-iii</a>.</p></li><li class="listitem"><p><a class="link" href="https://flarum.org/"  target="_top">Flarum</a>, a delightfully simple discussion platform for your website. Available as <a class="link" href="options.html#opt-services.flarum.enable"  >services.flarum</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/pdreker/fritz_exporter"  target="_top">fritz-exporter</a>, a Prometheus exporter for extracting metrics from <a class="link" href="https://avm.de/produkte/"  target="_top">FRITZ!</a> devices. Available as <a class="link" href="options.html#opt-services.prometheus.exporters.fritz.enable"  >services.prometheus.exporters.fritz</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.gns3.com/"  target="_top">GNS3</a>, a network software emulator. Available as <a class="link" href="options.html#opt-services.gns3-server.enable"  >services.gns3-server</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/cactus/go-camo"  target="_top">go-camo</a>, a secure image proxy server. Available as <a class="link" href="options.html#opt-services.go-camo.enable"  >services.go-camo</a>.</p></li><li class="listitem"><p><a class="link" href="https://guix.gnu.org"  target="_top">Guix</a>, a functional package manager inspired by Nix. Available as <a class="link" href="options.html#opt-services.guix.enable"  >services.guix</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/hhd-dev/hhd"  target="_top">Handheld Daemon</a>, support for gaming handhelds like the Legion Go, ROG Ally, and GPD Win. Available as <a class="link" href="options.html#opt-services.handheld-daemon.enable"  >services.handheld-daemon</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/haecker-felix/hebbot"  target="_top">hebbot</a>, a Matrix bot to generate “This Week in X” like blog posts. Available as <a class="link" href="options.html#opt-services.hebbot.enable"  >services.hebbot</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/troglobit/inadyn"  target="_top">inadyn</a>, a Dynamic DNS client with built-in support for multiple providers. Available as <a class="link" href="options.html#opt-services.inadyn.enable"  >services.inadyn</a>.</p></li><li class="listitem"><p><a class="link" href="https://drm.pages.freedesktop.org/igt-gpu-tools"  target="_top">intel-gpu-tools</a>, tools for development and testing of the Intel DRM driver. Available as <a class="link" href="options.html#opt-hardware.intel-gpu-tools.enable"  >hardware.intel-gpu-tools</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/ioi/isolate"  target="_top">isolate</a>, a sandbox for securely executing untrusted programs. Available as <a class="link" href="options.html#opt-security.isolate.enable"  >security.isolate</a>.</p></li><li class="listitem"><p><a class="link" href="https://docs.jottacloud.com/en/articles/1436834-jottacloud-command-line-tool"  target="_top">Jottacloud Command-line Tool</a>, a CLI for the <a class="link" href="https://jottacloud.com/"  target="_top">Jottacloud</a> cloud storage provider. Available as <a class="link" href="options.html#opt-services.jotta-cli.enable"  >services.jotta-cli</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.ory.sh/keto/"  target="_top">keto</a>, a permission &amp; access control server, the first open source implementation of <a class="link" href="https://research.google/pubs/zanzibar-googles-consistent-global-authorization-system/"  target="_top"><span class="emphasis"><em>Zanzibar: Google’s Consistent, Global Authorization System</em></span></a>.</p></li><li class="listitem"><p><a class="link" href="https://manticoresearch.com"  target="_top">manticoresearch</a>, easy to use open source fast database for search. Available as <a class="link" href="options.html#opt-services.manticore.enable"  >services.manticore</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/maubot/maubot"  target="_top">maubot</a>, a plugin-based Matrix bot framework. Available as <a class="link" href="options.html#opt-services.maubot.enable"  >services.maubot</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/mautrix/meta"  target="_top">mautrix-meta</a>, a Matrix &lt;-&gt; Facebook and Matrix &lt;-&gt; Instagram hybrid puppeting/relaybot bridge. Available as services.mautrix-meta.</p></li><li class="listitem"><p><a class="link" href="https://github.com/mautrix/signal"  target="_top">mautrix-signal</a>, a Matrix-Signal puppeting bridge. Available as <a class="link" href="options.html#opt-services.mautrix-signal.enable"  >services.mautrix-signal</a>.</p></li><li class="listitem"><p><a class="link" href="https://nightly.mealie.io/"  target="_top">Mealie</a>, a self-hosted recipe manager and meal planner with a RestAPI backend and a reactive frontend application built in NuxtJS for a pleasant user experience for the whole family. Available as <a class="link" href="options.html#opt-services.mealie.enable"  >services.mealie</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/mollyim/mollysocket"  target="_top">MollySocket</a> which allows getting Signal notifications via UnifiedPush.</p></li><li class="listitem"><p><a class="link" href="https://github.com/rofl0r/microsocks"  target="_top">microsocks</a>, a tiny, portable SOCKS5 server with very moderate resource usage. Available as <a class="link" href="options.html#opt-services.microsocks.enable"  >services.microsocks</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/MetaCubeX/mihomo/tree/Alpha"  target="_top">Mihomo</a>, a rule-based proxy in Go. Available as <a class="link" href="options.html#opt-services.mihomo.enable"  >services.mihomo.enable</a>.</p></li><li class="listitem"><p><a class="link" href="https://monado.freedesktop.org/"  target="_top">Monado</a>, an open source XR runtime. Available as <a class="link" href="options.html#opt-services.monado.enable"  >services.monado</a>.</p></li><li class="listitem"><p><a class="link" href="https://netbird.io"  target="_top">Netbird</a>, an open-source VPN management platform, now has a self-hosted management server. Available as <a class="link" href="options.html#opt-services.netbird.server.enable"  >services.netbird.server</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/nix-community/nh"  target="_top">nh</a>, yet another Nix CLI helper. Available as <a class="link" href="options.html#opt-programs.nh.enable"  >programs.nh</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/rlado/oink"  target="_top">oink</a>, a dynamic DNS client for Porkbun. Available as <a class="link" href="options.html#opt-services.oink.enable"  >services.oink</a>.</p></li><li class="listitem"><p><a class="link" href="https://ollama.ai"  target="_top">ollama</a>, server for running large language models locally.</p></li><li class="listitem"><p><a class="link" href="https://github.com/jakobhoeg/nextjs-ollama-llm-ui"  target="_top">nextjs-ollama-llm-ui</a>, light-weight frontend server to chat with Ollama models through a web app.</p></li><li class="listitem"><p><a class="link" href="https://owncloud.com/infinite-scale-4-0/"  target="_top">ownCloud Infinite Scale Stack</a>, a modern and scalable rewrite of ownCloud.</p></li><li class="listitem"><p><a class="link" href="https://photonvision.org/"  target="_top">PhotonVision</a>, a free, fast, and easy-to-use computer vision solution for the FIRST® Robotics Competition.</p></li><li class="listitem"><p><a class="link" href="https://github.com/czerwonk/ping_exporter"  target="_top">ping_exporter</a>, a Prometheus exporter for ICMP echo requests. Available as <a class="link" href="options.html#opt-services.prometheus.exporters.ping.enable"  >services.prometheus.exporters.ping</a>.</p></li><li class="listitem"><p><a class="link" href="https://pretix.eu/about/en/"  target="_top">Pretix</a>, an open source ticketing software for events. Available as <a class="link" href="options.html#opt-services.pretix.enable"  >services.pretix</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/pretalx/pretalx"  target="_top">pretalx</a>, a conference planning tool. Available as <a class="link" href="options.html#opt-services.pretalx.enable"  >services.pretalx</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/zylon-ai/private-gpt"  target="_top">private-gpt</a>, a service to interact with your documents using the power of LLMs, 100% privately, no data leaks. Available as <a class="link" href="options.html#opt-services.private-gpt.enable"  >services.private-gpt</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/chrj/prometheus-dnssec-exporter"  target="_top">Prometheus DNSSEC Exporter</a>: check for validity and expiration in DNSSEC signatures and expose metrics for Prometheus. Available as <a class="link" href="options.html#opt-services.prometheus.exporters.dnssec.enable"  >services.prometheus.exporters.dnssec</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/nats-io/prometheus-nats-exporter"  target="_top">prometheus-nats-exporter</a>, a Prometheus exporter for NATS. Available as <a class="link" href="options.html#opt-services.prometheus.exporters.nats.enable"  >services.prometheus.exporters.nats</a>.</p></li><li class="listitem"><p><a class="link" href="https://pyload.net/"  target="_top">pyLoad</a>, a FOSS download manager written in Python. Available as <a class="link" href="options.html#opt-services.pyload.enable"  >services.pyload</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/home-assistant-libs/python-matter-server"  target="_top">Python Matter Server</a>, a
Matter Controller Server exposing websocket connections for use with other services, notably Home Assistant.
Available as <a class="link" href="options.html#opt-services.matter-server.enable"  >services.matter-server</a>.</p></li><li class="listitem"><p><a class="link" href="https://rustdesk.com"  target="_top">RustDesk</a>, a full-featured open source remote control alternative for self-hosting and security with minimal configuration. Alternative to TeamViewer. Available as <a class="link" href="options.html#opt-services.rustdesk-server.enable"  >services.rustdesk-server</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/mann1x/ryzen_monitor_ng"  target="_top">ryzen-monitor-ng</a>, a desktop AMD CPU power monitor and controller, similar to Ryzen Master but for Linux. Available as <a class="link" href="options.html#opt-programs.ryzen-monitor-ng.enable"  >programs.ryzen-monitor-ng</a>.</p></li><li class="listitem"><p><a class="link" href="https://gitlab.com/leogx9r/ryzen_smu"  target="_top">ryzen-smu</a>, Linux kernel driver to expose the SMU (System Management Unit) for certain AMD Ryzen Processors. Includes the userspace program <code class="literal">monitor_cpu</code>. Available at <a class="link" href="options.html#opt-hardware.cpu.amd.ryzen-smu.enable"  >hardware.cpu.amd.ryzen-smu</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/AnalogJ/scrutiny"  target="_top">Scrutiny</a>, a S.M.A.R.T monitoring tool for hard disks with a web frontend. Available as <a class="link" href="options.html#opt-services.scrutiny.enable"  >services.scrutiny</a>.</p></li><li class="listitem"><p><a class="link" href="https://simplesamlphp.org/"  target="_top">SimpleSAMLphp</a>, an application written in native PHP that deals with authentication (SQL, .htpasswd, YubiKey, LDAP, PAPI, Radius). Available as <a class="link" href="options.html#opt-services.simplesamlphp"  >services.simplesamlphp</a>.</p></li><li class="listitem"><p><code class="literal">systemd</code>’s <code class="literal">gateway</code>, <code class="literal">upload</code>, and <code class="literal">remote</code> services, which provide ways of sending journals across the network. Enable using <a class="link" href="options.html#opt-services.journald.gateway.enable"  >services.journald.gateway</a>, <a class="link" href="options.html#opt-services.journald.upload.enable"  >services.journald.upload</a>, and <a class="link" href="options.html#opt-services.journald.remote.enable"  >services.journald.remote</a>.</p></li><li class="listitem"><p><a class="link" href="https://git.sr.ht/~whynothugo/systemd-lock-handler/"  target="_top">systemd-lock-handler</a>, a bridge between logind D-Bus events and systemd targets. Available as <a class="link" href="options.html#opt-services.systemd-lock-handler.enable"  >services.systemd-lock-handler.enable</a>.</p></li><li class="listitem"><p><a class="link" href="https://gitlab.com/onlime/rspamd-trainer"  target="_top">rspamd-trainer</a>, script triggered by a helper which reads mails from a specific mail inbox and feeds them into rspamd for spam/ham training.</p></li><li class="listitem"><p><a class="link" href="https://app.lizardbyte.dev/Sunshine"  target="_top">Sunshine</a>, a self-hosted game stream host for Moonlight. Available as <a class="link" href="options.html#opt-services.sunshine.enable"  >services.sunshine</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/Suwayomi/Suwayomi-Server"  target="_top">Suwayomi Server</a>, a free and open source manga reader server that runs extensions built for <a class="link" href="https://tachiyomi.org"  target="_top">Tachiyomi</a>. Available as <a class="link" href="options.html#opt-services.suwayomi-server.enable"  >services.suwayomi-server</a>.</p></li><li class="listitem"><p><a class="link" href="https://tigerbeetle.com/"  target="_top">TigerBeetle</a>, a distributed financial accounting database designed for mission critical safety and performance. Available as <a class="link" href="options.html#opt-services.tigerbeetle.enable"  >services.tigerbeetle</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/dutchcoders/transfer.sh"  target="_top">transfer-sh</a>, a tool that supports easy and fast file sharing from the command-line. Available as <a class="link" href="options.html#opt-services.transfer-sh.enable"  >services.transfer-sh</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/Lurkki14/tuxclocker"  target="_top">TuxClocker</a>, a hardware control and monitoring program. Available as <a class="link" href="options.html#opt-programs.tuxclocker.enable"  >programs.tuxclocker</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/EightB1ts/uni-sync"  target="_top">Uni-Sync</a>, a synchronization tool for Lian Li Uni Controllers. Available as <a class="link" href="options.html#opt-hardware.uni-sync.enable"  >hardware.uni-sync</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/matze/wastebin"  target="_top">wastebin</a>, a pastebin server written in rust. Available as <a class="link" href="options.html#opt-services.wastebin.enable"  >services.wastebin</a>.</p></li><li class="listitem"><p><a class="link" href="https://troglobit.com/projects/watchdogd/"  target="_top">watchdogd</a>, a system and process supervisor using watchdog timers. Available as <a class="link" href="options.html#opt-services.watchdogd.enable"  >services.watchdogd</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/Meumeu/WiVRn"  target="_top">WiVRn</a>, an OpenXR streaming application. Available as <a class="link" href="options.html#opt-services.wivrn.enable"  >services.wivrn</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/jovandeginste/workout-tracker"  target="_top">Workout-tracker</a>, a workout tracking web application for personal use.</p></li><li class="listitem"><p><a class="link" href="https://github.com/rhasspy/wyoming-satellite"  target="_top">wyoming-satellite</a>, a voice assistant satellite for Home Assistant using the Wyoming protocol. Available as <a class="link" href="options.html#opt-services.wyoming.satellite.enable"  >services.wyoming.satellite</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/Vladimir-csp/xdg-terminal-exec"  target="_top">xdg-terminal-exec</a>, the proposed Default Terminal Execution Specification.</p></li><li class="listitem"><p>Convenience options for <code class="literal">amdgpu</code>, open source driver for Radeon cards, is now available under <code class="literal">hardware.amdgpu</code>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/ReimuNotMoe/ydotool"  target="_top">ydotool</a>, a generic command-line automation tool now has a module. Available as <a class="link" href="options.html#opt-programs.ydotool.enable"  >programs.ydotool</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/Yooooomi/your_spotify"  target="_top">your_spotify</a>, a self hosted Spotify tracking dashboard. Available as <a class="link" href="options.html#opt-services.your_spotify.enable"  >services.your_spotify</a></p></li><li class="listitem"><p><a class="link" href="https://github.com/rancher/rke2"  target="_top">RKE2</a>, also known as RKE Government, is Rancher’s next-generation Kubernetes distribution. Available as <a class="link" href="options.html#opt-services.rke2.enable"  >services.rke2</a>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-24.05-incompatibilities" class="title" >Backward Incompatibilities   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">akkoma</code> now requires explicitly setting the base URL for uploaded media (<code class="literal">settings.&quot;Pleroma.Upload&quot;.base_url</code>), as well as for the media proxy if enabled (<code class="literal">settings.&quot;Media&quot;</code>).
This is recommended to be a separate (sub)domain to the one Akkoma is hosted at.
See <a class="link" href="https://meta.akkoma.dev/t/akkoma-stable-2024-03-securer-i-barely-know-her/681#explicit-upload-and-media-proxy-domains-5"  target="_top">here</a> for more details.</p></li><li class="listitem"><p><code class="literal">appimageTools.wrapAppImage</code> now creates the binary at <code class="literal">$out/bin/${pname}</code> rather than <code class="literal">$out/bin/${pname}-${version}</code>, which will break downstream workarounds.</p></li><li class="listitem"><p><code class="literal">apptainer</code> and <code class="literal">singularity</code> now prioritize system-wide <code class="literal">PATH</code> over those constructed from dependent packages when searching for third-party utilities. The <code class="literal">PATH</code> to search for third-party utilities, known as <code class="literal">defaultPath</code> inside Apptainer/Singularity source code, is now constructed from the following sources, ordered by their precedence:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">systemBinPaths</code>, a new argument introduced to specify system-wide <code class="literal">&quot;/**/bin&quot;</code> directories.</p></li><li class="listitem"><p>The FHS <code class="literal">defaultPath</code> value set by Apptainer/Singularity developers, making Apptainer/Singularity work out of the box in FHS systems.</p></li><li class="listitem"><p><code class="literal">defaultPathInputs</code>, a list of packages to form the fall-back <code class="literal">PATH</code>.</p></li></ul></div><p>This change is required to enable Sylabs SingularityCE (<code class="literal">singularity</code>) to run images, as it requires a <code class="literal">fusermount3</code> commant with the SUID bit set.</p><p><code class="literal">newuidmapPath</code> and <code class="literal">newgidmapPath</code> arguments are deprecated in favour of <code class="literal">systemBinPaths</code>. Their support will be removed in future releases.</p><p><code class="literal">programs.singularity.systemBinPaths</code> option is introduced to specify the <code class="literal">systemBinPaths</code> argument of the overridden package. It includes <code class="literal">&quot;/run/wrappers/bin&quot;</code> even if specified empty.</p><p><code class="literal">programs.singularity.enableFakeroot</code> option is deprecated and has no effect. <code class="literal">--fakeroot</code> support is now always enabled as long as <code class="literal">programs.singularity.systemBinPaths</code> is not forcefully overridden.</p></li><li class="listitem"><p><code class="literal">azure-cli</code> now has extension support. For example, to install the <code class="literal">aks-preview</code> extension, use</p><pre><code class="programlisting nix">environment.systemPackages = [
  (azure-cli.withExtensions [ azure-cli.extensions.aks-preview ])
];
</code></pre><p>To make the <code class="literal">azure-cli</code> immutable and prevent clashes in case <code class="literal">azure-cli</code> is also installed via other package managers, some configuration files were moved into the derivation.
This can be disabled by overriding <code class="literal">withImmutableConfig = false</code> when building <code class="literal">azure-cli</code>.</p></li><li class="listitem"><p><code class="literal">boot.supportedFilesystems</code> and <code class="literal">boot.initrd.supportedFilesystems</code> are now attribute sets instead of lists. Assignment from lists as done previously is still supported, but checking whether a filesystem is enabled must now by done using <code class="literal">supportedFilesystems.fs or false</code> instead of using <code class="literal">lib.elem &quot;fs&quot; supportedFilesystems</code> as was done previously.</p></li><li class="listitem"><p><code class="literal">buildGoModule</code> now throws an error when <code class="literal">vendorHash</code> is not specified. <code class="literal">vendorSha256</code>, deprecated in Nixpkgs 23.11, is now ignored and is no longer a <code class="literal">vendorHash</code> alias.</p></li><li class="listitem"><p><code class="literal">chromium</code> and <code class="literal">ungoogled-chromium</code> had a long-standing issue regarding Widevine DRM handling in nixpkgs fixed.
<code class="literal">chromium</code> now no longer automatically downloads Widevine when encountering DRM protected content.
To be able to play DRM protected content in <code class="literal">chromium</code>, you now have to explicitly opt-in as originally intended using <code class="literal">chromium.override { enableWideVine = true; }</code>.
This override was added almost 10 years ago.</p></li><li class="listitem"><p><code class="literal">craftos-pc</code> package has been updated to v2.8, which includes <a class="link" href="https://github.com/MCJack123/craftos2/releases/tag/v2.8"  target="_top">breaking changes</a>.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Files are now handled in binary mode; this could break programs with embedded UTF-8 characters.</p></li><li class="listitem"><p>The ROM was updated to match ComputerCraft version v1.109.2.</p></li><li class="listitem"><p>The bundled Lua was updated to Lua v5.2, which includes breaking changes. See the <a class="link" href="https://www.lua.org/manual/5.2/manual.html#8"  target="_top">Lua manual</a> for more information.</p></li><li class="listitem"><p>The WebSocket API <a class="link" href="https://github.com/MCJack123/craftos2/issues/337"  target="_top">was rewritten</a>, which introduced breaking changes.</p></li></ul></div></li><li class="listitem"><p><code class="literal">cryptsetup</code> has been upgraded from 2.6.1 to 2.7.0. Cryptsetup is a critical component enabling LUKS-based (but not only) full disk encryption.
Take the time to review <a class="link" href="https://gitlab.com/cryptsetup/cryptsetup/-/raw/v2.7.0/docs/v2.7.0-ReleaseNotes"  target="_top">the release notes</a>.
One of the highlights is that it is now possible to use hardware OPAL-based encryption of your disk with <code class="literal">cryptsetup</code>. It has a lot of caveats, see the above notes for the full details.</p></li><li class="listitem"><p><code class="literal">crystal</code> package has been updated to 1.11.x, which has some breaking changes.
Refer to crystal’s changelog for more information. (<a class="link" href="https://github.com/crystal-lang/crystal/blob/master/CHANGELOG.md#1100-2023-10-09"  target="_top">v1.10</a>, <a class="link" href="https://github.com/crystal-lang/crystal/blob/master/CHANGELOG.md#1110-2024-01-08"  target="_top">v1.11</a>)</p></li><li class="listitem"><p><code class="literal">cudaPackages</code> package scope has been updated to <code class="literal">cudaPackages_12</code>.</p></li><li class="listitem"><p><code class="literal">cudaPackages.autoAddOpenGLRunpathHook</code> and <code class="literal">cudaPackages.autoAddDriverRunpath</code> have been deprecated for <code class="literal">pkgs.autoAddDriverRunpath</code>. Functionality has not changed, but the setuphook has been renamed and moved to the top-level package scope.</p></li><li class="listitem"><p><code class="literal">cudaPackages.cudatoolkit</code> has been deprecated and replaced with a
symlink-based wrapper for the splayed redistributable CUDA packages. The
wrapper only includes tools and libraries necessary to build common packages
such as tensorflow. The original runfile-based <code class="literal">cudatoolkit</code> is still
available as <code class="literal">cudatoolkit-legacy-runfile</code>.</p></li><li class="listitem"><p><code class="literal">cudaPackages.nsight_systems</code> now has most vendored third-party libraries removed, though we now only ship it for <code class="literal">cudaPackages_11_8</code> and later, due to outdated dependencies. Users comfortable with the vendored dependencies may use <code class="literal">overrideAttrs</code> to amend the <code class="literal">postPatch</code> phase and the <code class="literal">meta.broken</code> correspondingly. Alternatively, one could package the deprecated <code class="literal">boost170</code> locally, as required for <code class="literal">cudaPackages_11_4.nsight_systems</code>.</p></li><li class="listitem"><p><code class="literal">cudaPackages.autoFixElfFiles</code> has been deprecated for <code class="literal">pkgs.autoFixElfFiles</code>. Functionality has not changed, but the setuphook has been renamed and moved to the top-level package scope.</p></li><li class="listitem"><p><code class="literal">davfs2</code>’s <code class="literal">services.davfs2.extraConfig</code> setting has been deprecated and converted to the free-form type option named <code class="literal">services.davfs2.settings</code> according to RFC42.</p></li><li class="listitem"><p><code class="literal">dwarf-fortress</code> has been updated to version 50, which is identical to the version on Steam, but without the paid elements like tilepacks.
dfhack and Dwarf Therapist still work, and older versions are still packaged in case you’d like to roll back. Note that DF 50 saves will not be compatible with DF 0.47 and earlier.
See <a class="link" href="http://www.bay12games.com/dwarves/"  target="_top">Bay 12 Games</a> for more details on what’s new in Dwarf Fortress.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>Running an earlier version can be achieved through an override: <code class="literal">dwarf-fortress-packages.dwarf-fortress-full.override { dfVersion = &quot;0.47.5&quot;; }</code></p></li><li class="listitem"><p>Ruby plugin support has been disabled in DFHack. Many of the Ruby plugins have been converted to Lua, and support was removed upstream due to frequent crashes.</p></li></ul></div></li><li class="listitem"><p><code class="literal">erlang-ls</code> package no longer ships the <code class="literal">els_dap</code> binary as of v0.51.0.</p></li><li class="listitem"><p><code class="literal">erlang_node_short_name</code>, <code class="literal">erlang_node_name</code>: <code class="literal">port</code> and <code class="literal">options</code> configuration parameters are gone, and have been replaced with an <code class="literal">environment</code> parameter.
Use the appropriate <a class="link" href="https://hexdocs.pm/livebook/readme.html#environment-variables"  target="_top">environment variables</a> inside <code class="literal">environment</code> to configure the service instead.</p></li><li class="listitem"><p><code class="literal">firefox-devedition</code>, <code class="literal">firefox-beta</code>, <code class="literal">firefox-esr</code> executable file names for now match their package names, which is consistent with the <code class="literal">firefox-*-bin</code> packages. The desktop entries are also updated so that you can have multiple editions of firefox in your app launcher.</p></li><li class="listitem"><p><code class="literal">gauge</code> now supports installing plugins using Nix. For the old imperative approach, switch to <code class="literal">gauge-unwrapped</code>.
You can load plugins from an existing gauge manifest file using <code class="literal">gauge.fromManifest ./path/to/manifest.json</code> or
specify plugins in Nix using <code class="literal">gauge.withPlugins (p: with p; [ js html-report xml-report ])</code>.</p></li><li class="listitem"><p><code class="literal">gitea</code> has been updated to 1.21, which introduces several breaking changes, including:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Custom themes and other assets that were previously stored in <code class="literal">custom/public/*</code> now belong in <code class="literal">custom/public/assets/*</code></p></li><li class="listitem"><p>New instances of Gitea using MySQL now ignore the <code class="literal">[database].CHARSET</code> config option and always use the <code class="literal">utf8mb4</code> charset, existing instances should migrate via the <code class="literal">gitea doctor convert</code> CLI command.</p></li></ul></div></li><li class="listitem"><p><code class="literal">git-town</code> was updated from version 11 to 13. See the <a class="link" href="https://github.com/git-town/git-town/blob/main/CHANGELOG.md#1300-2024-03-22"  target="_top">changelog</a> for breaking changes.</p></li><li class="listitem"><p><code class="literal">gonic</code> has been updated to v0.16.4. Config now requires <code class="literal">playlists-path</code> to be set. See the rest of the <a class="link" href="https://github.com/sentriz/gonic/releases/tag/v0.16.0"  target="_top">v0.16.0 release notes</a> for more details.</p></li><li class="listitem"><p><code class="literal">go-ethereum</code> has been updated to v1.14.3. Geth v1.14.0 introduced a brand new live-tracing feature,
which required a number of breaking internal API changes. If you had your own native tracers implemented before this change,
the <a class="link" href="https://github.com/ethereum/go-ethereum/blob/master/core/tracing/CHANGELOG.md"  target="_top">changelog</a> contains the necessary steps needed to update your old code for the new APIs.
Geth v1.14.0 drops support for running pre-merge networks (<a class="link" href="https://github.com/ethereum/go-ethereum/pull/29169"  target="_top">#29169</a>).
It also stops automatically constructing the pending block (<a class="link" href="https://github.com/ethereum/go-ethereum/pull/28623"  target="_top">#28623</a>),
removes support for filtering pending logs, switched to using Go v1.22 by default (#28946), which means we’ve dropped support for Go v1.20.
See <a class="link" href="https://github.com/ethereum/go-ethereum/releases/tag/v1.14.0"  target="_top">the 1.14.0 release notes</a> for more details.</p></li><li class="listitem"><p><code class="literal">grafana-loki</code> has been updated to 3.0.0, which includes <a class="link" href="https://github.com/grafana/loki/releases/tag/v3.0.0"  target="_top">breaking changes</a>.</p></li><li class="listitem"><p><code class="literal">gtest</code> package has been updated past v1.13.0, which requires C++14 or higher.</p></li><li class="listitem"><p><code class="literal">hare</code> may now be cross-compiled. For that to work, however, <code class="literal">haredoc</code> needed to stop being built together with it. Thus, the latter is now its own package with the name of <code class="literal">haredoc</code>.</p></li><li class="listitem"><p><code class="literal">himalaya</code> has been updated to v1.0.0-beta.4, which introduces breaking changes. Check out the <a class="link" href="https://github.com/soywod/himalaya/releases/tag/v1.0.0-beta.4"  target="_top">release note</a> for details.</p></li><li class="listitem"><p><code class="literal">halloy</code> has been updated to 2024.5, which introduced a breaking change by switching the config format from YAML to TOML. See <a class="link" href="https://github.com/squidowl/halloy/releases/tag/2024.5"  target="_top">https://github.com/squidowl/halloy/releases/tag/2024.5</a> for details.</p></li><li class="listitem"><p><code class="literal">hvm</code> was updated to version 2.</p></li><li class="listitem"><p><code class="literal">icu</code> no longer includes <code class="literal">install-sh</code> and <code class="literal">mkinstalldirs</code> in the shared folder.</p></li><li class="listitem"><p><code class="literal">idris2</code> was updated to v0.7.0. This version introduces breaking changes. Check out the <a class="link" href="https://github.com/idris-lang/Idris2/blob/v0.7.0/CHANGELOG.md#v070"  target="_top">changelog</a> for details.</p></li><li class="listitem"><p><code class="literal">inetutils</code> now has a lower priority to avoid shadowing the commonly-used <code class="literal">util-linux</code>. If one wishes to restore the default priority, simply use <code class="literal">lib.setPrio 5 inetutils</code> or override with <code class="literal">meta.priority = 5</code>.</p></li><li class="listitem"><p><code class="literal">jdt-language-server</code> package now uses upstream’s provided python wrapper instead of our own custom wrapper. This results in the following breaking and notable changes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>The main binary for the package is now named <code class="literal">jdtls</code> instead of <code class="literal">jdt-language-server</code>, equivalent to what most editors expect the binary to be named.</p></li><li class="listitem"><p>JVM arguments should now be provided with the <code class="literal">--jvm-arg</code> flag instead of setting <code class="literal">JAVA_OPTS</code>.</p></li><li class="listitem"><p>The <code class="literal">-data</code> path is no longer required to run the package, and will be set to point to a folder in <code class="literal">$TMP</code> if missing.</p></li></ul></div></li><li class="listitem"><p><code class="literal">julia</code> environments can now be built with arbitrary packages from the ecosystem using the <code class="literal">.withPackages</code> function. For example: <code class="literal">julia.withPackages [&quot;Plots&quot;]</code>.</p></li><li class="listitem"><p><code class="literal">k3s</code> has been updated to version <a class="link" href="https://github.com/k3s-io/k3s/releases/tag/v1.30.0%2Bk3s1"  target="_top">v1.30</a>, previous supported versions are available under release-specific names (e.g. k3s_1_27, k3s_1_28, and k3s_1_29) in order to help you migrate to the latest supported version. See <a class="link" href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.30.md#changelog-since-v1290"  target="_top">changelog and upgrade notes</a> for more information.</p></li><li class="listitem"><p><code class="literal">k9s</code> was updated to v0.31. There have been various breaking changes in the config file format,
check out the changelog of <a class="link" href="https://github.com/derailed/k9s/releases/tag/v0.29.0"  target="_top">v0.29</a>,
<a class="link" href="https://github.com/derailed/k9s/releases/tag/v0.30.0"  target="_top">v0.30</a> and
<a class="link" href="https://github.com/derailed/k9s/releases/tag/v0.31.0"  target="_top">v0.31</a> for details. It is recommended
to back up your current configuration and let k9s recreate the new base configuration.</p></li><li class="listitem"><p><code class="literal">kanata</code> package has been updated to v1.6.1, which includes breaking changes.  Check out the changelog of <a class="link" href="https://github.com/jtroo/kanata/releases/tag/v1.5.0"  target="_top">v1.5.0</a> and <a class="link" href="https://github.com/jtroo/kanata/releases/tag/v1.6.0"  target="_top">v1.6.0</a> for details.</p></li><li class="listitem"><p><code class="literal">linuxPackages_testing_bcachefs</code> is now fully deprecated by <code class="literal">linuxPackages_latest</code>, and is therefore no longer available.</p></li><li class="listitem"><p><code class="literal">livebook</code> package is now built as a <code class="literal">mix release</code> instead of an <code class="literal">escript</code>.
This means that configuration now has to be done using <a class="link" href="https://hexdocs.pm/livebook/readme.html#environment-variables"  target="_top">environment variables</a> instead of command line arguments.
This has the further consequence that the <code class="literal">livebook</code> service configuration has changed.</p></li><li class="listitem"><p><code class="literal">lua</code> interpreters default LUA_PATH and LUA_CPATH are not overridden by nixpkgs
anymore, we patch LUA_ROOT instead which is more respectful to upstream.</p></li><li class="listitem"><p><code class="literal">luarocks-packages-updater</code>’s .csv format, used to define lua packages to be updated, has changed: <code class="literal">src</code> (URL of a git repository) has now become <code class="literal">rockspec</code> (URL of a rockspec) to remove ambiguity regarding which rockspec to use and simplify implementation.</p></li><li class="listitem"><p><code class="literal">mkosi</code> was updated to v22. Parts of the user interface have changed. Consult the
release notes of <a class="link" href="https://github.com/systemd/mkosi/releases/tag/v19"  target="_top">v19</a>,
<a class="link" href="https://github.com/systemd/mkosi/releases/tag/v20"  target="_top">v20</a>,
<a class="link" href="https://github.com/systemd/mkosi/releases/tag/v21"  target="_top">v21</a> and
<a class="link" href="https://github.com/systemd/mkosi/releases/tag/v22"  target="_top">v22</a> for a list of changes.</p></li><li class="listitem"><p><code class="literal">mongodb-4_4</code> has been removed as it has reached end of life. Consequently, <code class="literal">unifi7</code> and <code class="literal">unifi8</code> now use MongoDB 5.0 by default.</p></li><li class="listitem"><p><code class="literal">mongodb-5_0</code> and newer requires a cpu with the AVX instruction set to run.</p></li><li class="listitem"><p><code class="literal">neo4j</code> has been updated to version 5. You may want to read the <a class="link" href="https://neo4j.com/release-notes/database/neo4j-5/"  target="_top">release notes for Neo4j 5</a>.</p></li><li class="listitem"><p><code class="literal">netbox</code> was updated to v3.7. <code class="literal">services.netbox.package</code> still defaults
to v3.6 if <code class="literal">stateVersion</code> is earlier than 24.05. Refer to upstream’s breaking
changes <a class="link" href="https://github.com/netbox-community/netbox/releases/tag/v3.7.0"  target="_top">for
v3.7.0</a> and
upgrade NetBox by changing <code class="literal">services.netbox.package</code>. Database migrations
will be run automatically.</p></li><li class="listitem"><p><code class="literal">network-interfaces.target</code> system target was removed as it has been deprecated for a long time. Use <code class="literal">network.target</code> instead.</p></li><li class="listitem"><p><code class="literal">networking.iproute2.enable</code> now does not set <code class="literal">environment.etc.&quot;iproute2/rt_tables&quot;.text</code>.</p><p>Setting <code class="literal">environment.etc.&quot;iproute2/{CONFIG_FILE_NAME}&quot;.text</code> will override the whole configuration file instead of appending it to the upstream configuration file.</p><p><code class="literal">CONFIG_FILE_NAME</code> includes <code class="literal">bpf_pinning</code>, <code class="literal">ematch_map</code>, <code class="literal">group</code>, <code class="literal">nl_protos</code>, <code class="literal">rt_dsfield</code>, <code class="literal">rt_protos</code>, <code class="literal">rt_realms</code>, <code class="literal">rt_scopes</code>, and <code class="literal">rt_tables</code>.</p></li><li class="listitem"><p><code class="literal">nextcloud26</code> has been removed since it’s not maintained anymore by upstream. The latest available version of Nextcloud is now v29 (available as <code class="literal">pkgs.nextcloud29</code>). The installation logic is as follows:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>If <a class="link" href="options.html#opt-services.nextcloud.package"  ><code class="literal">services.nextcloud.package</code></a> is specified explicitly, this package will be installed (<span class="strong"><strong>recommended</strong></span>).</p></li><li class="listitem"><p>If <a class="link" href="options.html#opt-system.stateVersion"  ><code class="literal">system.stateVersion</code></a> is &gt;=24.05, <code class="literal">pkgs.nextcloud29</code> will be installed by default.</p></li><li class="listitem"><p>If <a class="link" href="options.html#opt-system.stateVersion"  ><code class="literal">system.stateVersion</code></a> is &gt;=23.11, <code class="literal">pkgs.nextcloud27</code> will be installed by default.</p></li><li class="listitem"><p>Please note that an upgrade from v27 (or older) to v29 directly is not possible. Please upgrade to <code class="literal">nextcloud28</code> (or earlier) first. Nextcloud prohibits skipping major versions while upgrading. You can upgrade by declaring <a class="link" href="options.html#opt-services.nextcloud.package"  target="_top"><code class="literal">services.nextcloud.package = pkgs.nextcloud28;</code></a>.</p></li><li class="listitem"><p>Known warnings after the upgrade are documented in <a class="xref" href="index.html#module-services-nextcloud-known-warnings" title="Known warnings" >the section called “Known warnings”</a> from now on.</p></li><li class="listitem"><p>The “Photos” app only displays Media from inside the <code class="literal">Photos</code> directory. This can be changed manually in the “Photos” tab below “Photos settings”.</p></li></ul></div></li><li class="listitem"><p><code class="literal">nitter</code> requires a <code class="literal">guest_accounts.jsonl</code> to be provided as a path or loaded into the default location at <code class="literal">/var/lib/nitter/guest_accounts.jsonl</code>. See <a class="link" href="https://github.com/zedeus/nitter/wiki/Guest-Account-Branch-Deployment"  target="_top">Guest Account Branch Deployment</a> for details.</p></li><li class="listitem"><p><code class="literal">nixVersions.unstable</code> was removed. Instead the following attributes are provided:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">nixVersions.git</code> which tracks the latest Nix master and is roughly updated once a week. This is intended to enable people to easily test unreleased changes of Nix to catch regressions earlier.</p></li><li class="listitem"><p><code class="literal">nixVersions.latest</code> which points to the latest Nix version packaged in nixpkgs.</p></li></ul></div></li><li class="listitem"><p><code class="literal">nomad</code> has been updated - note that HashiCorp recommends updating one minor version at a time. Please check <a class="link" href="https://developer.hashicorp.com/nomad/docs/upgrade"  target="_top">their upgrade guide</a> for information on safely updating clusters and potential breaking changes.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">nomad</code> is now Nomad 1.7.x.</p></li><li class="listitem"><p><code class="literal">nomad_1_4</code> has been removed, as it is now unsupported upstream.</p></li></ul></div></li><li class="listitem"><p><code class="literal">nvtop</code> family of packages was reorganized into a nested attrset. <code class="literal">nvtop</code> has been renamed to <code class="literal">nvtopPackages.full</code>, and all <code class="literal">nvtop-{amd,nvidia,intel,msm}</code> packages are renamed to <code class="literal">nvtopPackages.{amd,nvidia,intel,msm}</code>.</p></li><li class="listitem"><p><code class="literal">openssh</code>, <code class="literal">openssh_hpn</code> and <code class="literal">openssh_gssapi</code> are now compiled without support for the DSA signature algorithm as it is being deprecated upstream. Users still relying on DSA keys should consider upgrading
to another signature algorithm. However, for the time being it is possible to restore DSA key support using <code class="literal">override</code> to set <code class="literal">dsaKeysSupport = true</code>.</p></li><li class="listitem"><p><code class="literal">optparse-bash</code> is now dropped due to upstream inactivity. Alternatives available in Nixpkgs include <a class="link" href="https://github.com/sigoden/argc"  target="_top"><code class="literal">argc</code></a>, <a class="link" href="https://github.com/matejak/argbash"  target="_top"><code class="literal">argbash</code></a>, <a class="link" href="https://github.com/DannyBen/bashly"  target="_top"><code class="literal">bashly</code></a> and <a class="link" href="https://github.com/charmbracelet/gum"  target="_top"><code class="literal">gum</code></a>, to name a few.</p></li><li class="listitem"><p><code class="literal">paperless</code>’ <code class="literal">services.paperless.extraConfig</code> setting has been removed and converted to the free-form type and option named <code class="literal">services.paperless.settings</code>.</p></li><li class="listitem"><p><code class="literal">pdns</code> was updated to version <a class="link" href="https://doc.powerdns.com/authoritative/changelog/4.9.html"  target="_top">v4.9.x</a>, which introduces breaking changes. Check out the <a class="link" href="https://doc.powerdns.com/authoritative/upgrading.html#to-4-9-0"  target="_top">Upgrade Notes</a> for details.</p></li><li class="listitem"><p><code class="literal">percona-server</code> now follows <a class="link" href="https://www.percona.com/blog/lts-and-innovation-releases-for-percona-server-for-mysql/"  target="_top">the same two-fold release cycle</a> as Oracle MySQL and provides a <span class="emphasis"><em>Long-Term-Support (LTS)</em></span> in parallel with a continuous-delivery <span class="emphasis"><em>Innovation</em></span> release. <code class="literal">percona-server</code> defaults to <code class="literal">percona-server_lts</code>, will be backed by the same release branch throughout the lifetime of this stable NixOS release, and is still available under the versioned attribute <code class="literal">percona-server_8_0</code>.
The <code class="literal">percona-server_innovation</code> releases however have support periods shorter than the lifetime of this NixOS release and will continuously be updated to newer Percona releases. Note that Oracle considers the <span class="emphasis"><em>Innovation</em></span> releases to be production-grade, but each release might include backwards-incompatible changes, even in its on-disk format.
The same release scheme is applied to the supporting <code class="literal">percona-xtrabackup</code> tool as well.</p></li><li class="listitem"><p><code class="literal">pipewire</code> and <code class="literal">wireplumber</code> modules have removed support for using
<code class="literal">environment.etc.&quot;pipewire/...&quot;</code> and <code class="literal">environment.etc.&quot;wireplumber/...&quot;</code>.
Use <code class="literal">services.pipewire.extraConfig</code> or <code class="literal">services.pipewire.configPackages</code> for PipeWire and
<code class="literal">services.pipewire.wireplumber.configPackages</code> for WirePlumber instead.</p></li><li class="listitem"><p><code class="literal">power.ups</code> now generates <code class="literal">upsd.conf</code>, <code class="literal">upsd.users</code> and <code class="literal">upsmon.conf</code> automatically from a set of new configuration options. This breaks compatibility with existing <code class="literal">power.ups</code> setups where these files were created manually. Back up these files before upgrading NixOS.</p></li><li class="listitem"><p><code class="literal">programs.nix-ld.libraries</code> no longer sets <code class="literal">baseLibraries</code> via the option’s default but in config and now merges any additional libraries with the default ones.
This means that <code class="literal">lib.mkForce</code> must be used to clear the list of default libraries.</p></li><li class="listitem"><p><code class="literal">screen</code>’s module has been cleaned, and will now require you to set <code class="literal">programs.screen.enable</code> in order to populate <code class="literal">screenrc</code> and add the program to the environment.</p></li><li class="listitem"><p><code class="literal">security.acme.defaults.server</code> now has a default value instead of <code class="literal">null</code>.
This effectively uses the same server, the Let’s Encrypt production server,
but makes the default explicit, instead of relying on the Lego default.</p><p>A side effect of this is that the directory in which account data is stored
changes and the ACME module will request a new account and new certificates
for all domains.  This may cause issues if you pin an <code class="literal">acccounturl</code> in a CAA
DNS record.  To avoid this, you
may set <code class="literal">security.acme.defaults.server = null</code> to keep the old hashes.</p></li><li class="listitem"><p><code class="literal">security.pam.sshAgentAuth.enable</code> now requires <code class="literal">services.openssh.authorizedKeysFiles</code> to be non-empty,
which is the case when <code class="literal">services.openssh.enable</code> is true. Previously, <code class="literal">pam_ssh_agent_auth</code> silently failed to work.</p></li><li class="listitem"><p><code class="literal">security.pam.enableSSHAgentAuth</code> was replaced by the <code class="literal">sshAgentAuth</code> attrset, and <span class="strong"><strong>only</strong></span>
<code class="literal">authorized_keys</code> files listed in <a class="link" href="options.html#opt-security.pam.sshAgentAuth.authorizedKeysFiles"  ><code class="literal">sshAgentAuth.authorizedKeysFiles</code></a> are trusted,
defaulting to <code class="literal">/etc/ssh/authorized_keys.d/%u</code>.</p><div class="warning"><h3 class="title">Warning</h3><p>Users of <span class="citerefentry"><span class="refentrytitle">pam_ssh_agent_auth</span>(8)</span> must take care that the pubkeys they use (for instance with <code class="literal">sudo</code>)
are listed in <a class="link" href="options.html#opt-security.pam.sshAgentAuth.authorizedKeysFiles"  ><code class="literal">sshAgentAuth.authorizedKeysFiles</code></a>.</p></div><div class="note"><h3 class="title">Note</h3><p>Previously, all <code class="literal">services.openssh.authorizedKeysFiles</code> were trusted, including <code class="literal">~/.ssh/authorized_keys</code>,
which results in an <span class="strong"><strong>insecure</strong></span> configuration; see <a class="link" href="https://github.com/NixOS/nixpkgs/issues/31611"  target="_top">#31611</a>.</p></div></li></ul></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">services.archisteamfarm</code> no longer uses the abbreviation <code class="literal">asf</code> for its state directory (<code class="literal">/var/lib/asf</code>), user and group (both <code class="literal">asf</code>). Instead the long name <code class="literal">archisteamfarm</code> is used.
Configurations with <code class="literal">system.stateVersion</code> 23.11 or earlier, default to the old stateDirectory until the 24.11 release and must either set the option explicitly or move the data to the new directory.</p></li><li class="listitem"><p><code class="literal">frr</code> was updated to 10.0, which introduces the default of <code class="literal">enforce-first-as</code> for BGP. Please disable again if needed.</p></li><li class="listitem"><p><code class="literal">services.aria2.rpcSecret</code> has been replaced with <code class="literal">services.aria2.rpcSecretFile</code>.
This was done so that secrets aren’t stored in the world-readable Nix store.
To migrate, you will have to create a file with the same exact string, and change
your module options to point to that file. For example, <code class="literal">services.aria2.rpcSecret = &quot;mysecret&quot;</code> becomes <code class="literal">services.aria2.rpcSecretFile = &quot;/path/to/secret_file&quot;</code>
where the file <code class="literal">secret_file</code> contains the string <code class="literal">mysecret</code>.</p></li><li class="listitem"><p><code class="literal">services.avahi.nssmdns</code> was split into <code class="literal">services.avahi.nssmdns4</code> and <code class="literal">services.avahi.nssmdns6</code> which enable the mDNS NSS switches for IPv4 and IPv6 respectively.
Since most mDNS responders only register IPv4 addresses, most users want to keep the IPv6 support disabled to avoid long timeouts.</p></li><li class="listitem"><p><code class="literal">services.frp.settings</code> now generates the frp configuration file in TOML format as <a class="link" href="https://github.com/fatedier/frp#configuration-files"  target="_top">recommended by upstream</a>, instead of the legacy INI format. This has also introduced other changes in the configuration file structure and options:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>The <code class="literal">settings.common</code> section in the configuration is no longer valid and all the options form inside it now go directly under <code class="literal">settings</code>.</p></li><li class="listitem"><p>Configuration option names have been changed from snake_case to camelCase. For example: <code class="literal">server_addr</code> becomes <code class="literal">serverAddr</code>, <code class="literal">server_port</code> becomes <code class="literal">serverPort</code> etc.</p></li><li class="listitem"><p>Proxies are now defined with a new option, <code class="literal">settings.proxies</code>, which takes a list of proxies.</p></li><li class="listitem"><p>Consult the <a class="link" href="https://github.com/fatedier/frp#example-usage"  target="_top">upstream documentation</a> for more details on the changes.</p></li></ul></div></li><li class="listitem"><p><code class="literal">services.hledger-web.capabilities</code> options has been replaced by a new option <code class="literal">services.hledger-web.allow</code>.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">allow = &quot;view&quot;</code> means <code class="literal">capabilities = { view = true; }</code>;</p></li><li class="listitem"><p><code class="literal">allow = &quot;add&quot;</code> means <code class="literal">capabilities = { view = true; add = true; }</code>;</p></li><li class="listitem"><p><code class="literal">allow = &quot;edit&quot;</code> means <code class="literal">capabilities = { view = true; add = true; edit = true }</code>;</p></li><li class="listitem"><p><code class="literal">allow = &quot;sandstorm&quot;</code> reads permissions from the <code class="literal">X-Sandstorm-Permissions</code> request header.</p></li></ul></div></li><li class="listitem"><p><code class="literal">services.homepage-dashboard</code> now takes its configuration using native Nix expressions, rather than dumping templated configurations into <code class="literal">/var/lib/homepage-dashboard</code> where they were previously managed manually. There are now new options which allow the configuration of bookmarks, services, widgets and custom CSS/JS natively in Nix.</p></li><li class="listitem"><p><code class="literal">services.invidious.settings.db.user</code>, the default database username has changed from <code class="literal">kemal</code> to <code class="literal">invidious</code>. Setups involving an externally-provisioned database (i.e. <code class="literal">services.invidious.database.createLocally == false</code>) should adjust their configuration accordingly. The old <code class="literal">kemal</code> user will not be removed automatically even when the database is provisioned automatically.(https://github.com/NixOS/nixpkgs/pull/265857).</p></li><li class="listitem"><p><code class="literal">services.oauth2_proxy</code> was renamed to <code class="literal">services.oauth2-proxy</code>. Also the corresponding service, user and group were renamed.</p></li><li class="listitem"><p><code class="literal">services.smokeping</code> now has an option <code class="literal">webService</code>. When enabled, smokeping is now served via nginx instead of thttpd. This change brings the following consequences:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>The default port for smokeping is now the nginx default port 80 instead of 8081.</p></li><li class="listitem"><p>The option <code class="literal">services.smokeping.port</code> has been removed. To customize the port, use <code class="literal">services.nginx.virtualHosts.smokeping.listen.*.port</code>.</p></li></ul></div></li><li class="listitem"><p><code class="literal">services.neo4j.allowUpgrade</code> was removed and no longer has any effect. Neo4j 5 supports automatic rolling upgrades.</p></li><li class="listitem"><p><code class="literal">services.nextcloud</code> has the following options moved into <a class="link" href="options.html#opt-services.nextcloud.settings"  ><code class="literal">services.nextcloud.settings</code></a> and renamed to match the name from Nextcloud’s <code class="literal">config.php</code>:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">logLevel</code> -&gt; <a class="link" href="options.html#opt-services.nextcloud.settings.loglevel"  ><code class="literal">loglevel</code></a>,</p></li><li class="listitem"><p><code class="literal">logType</code> -&gt; <a class="link" href="options.html#opt-services.nextcloud.settings.log_type"  ><code class="literal">log_type</code></a>,</p></li><li class="listitem"><p><code class="literal">defaultPhoneRegion</code> -&gt; <a class="link" href="options.html#opt-services.nextcloud.settings.default_phone_region"  ><code class="literal">default_phone_region</code></a>,</p></li><li class="listitem"><p><code class="literal">overwriteProtocol</code> -&gt; <a class="link" href="options.html#opt-services.nextcloud.settings.overwriteprotocol"  ><code class="literal">overwriteprotocol</code></a>,</p></li><li class="listitem"><p><code class="literal">skeletonDirectory</code> -&gt; <a class="link" href="options.html#opt-services.nextcloud.settings.skeletondirectory"  ><code class="literal">skeletondirectory</code></a>,</p></li><li class="listitem"><p><code class="literal">globalProfiles</code> -&gt; <a class="link" href="options.html#opt-services.nextcloud.settings._profile.enabled_"  ><code class="literal">profile.enabled</code></a>,</p></li><li class="listitem"><p><code class="literal">extraTrustedDomains</code> -&gt; <a class="link" href="options.html#opt-services.nextcloud.settings.trusted_domains"  ><code class="literal">trusted_domains</code></a> and</p></li><li class="listitem"><p><code class="literal">trustedProxies</code> -&gt; <a class="link" href="options.html#opt-services.nextcloud.settings.trusted_proxies"  ><code class="literal">trusted_proxies</code></a>.</p></li></ul></div></li><li class="listitem"><p><code class="literal">services.nginx</code> will no longer advertise HTTP/3 availability automatically. This must now be manually added, preferably to each location block.
Example:</p><pre><code class="programlisting nix">{
  locations.&quot;/&quot;.extraConfig = &#x27;&#x27;
    add_header Alt-Svc &#x27;h3=&quot;:$server_port&quot;; ma=86400&#x27;;
  &#x27;&#x27;;
  locations.&quot;^~ /assets/&quot;.extraConfig = &#x27;&#x27;
    add_header Alt-Svc &#x27;h3=&quot;:$server_port&quot;; ma=86400&#x27;;
  &#x27;&#x27;;
}
</code></pre></li><li class="listitem"><p><code class="literal">services.pgbouncer</code> now has systemd support enabled and will log to journald. The default setting for <code class="literal">services.pgbouncer.logFile</code> is now <code class="literal">null</code> to disable logging to a separate log file.</p></li><li class="listitem"><p><code class="literal">services.postgresql.ensureUsers._.ensurePermissions</code> has been removed as it is
not declarative and is broken with newer postgresql versions. Consider using
<a class="xref" href="options.html#opt-services.postgresql.ensureUsers._.ensureDBOwnership"  ><code class="option">services.postgresql.ensureUsers.*.ensureDBOwnership</code></a>
instead or a tool that is more suited for managing the data inside a postgresql database.</p></li><li class="listitem"><p><code class="literal">services.redis.vmOverCommit</code> now defaults to <code class="literal">true</code> and no longer enforces Transparent Hugepages (THP) to be disabled. Redis only works with THP configured to <code class="literal">madvise</code> which is the kernel’s default.</p></li><li class="listitem"><p><code class="literal">services.resolved.fallbackDns</code></p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>can now be used to disable the upstream fallback servers entirely by setting it to <code class="literal">[]</code></p></li><li class="listitem"><p>to get previous behaviour of upstream defaults, set it to <code class="literal">null</code></p></li><li class="listitem"><p>default value has changed from <code class="literal">[]</code> to <code class="literal">null</code>, in order to preserve default behaviour</p></li></ul></div></li><li class="listitem"><p><code class="literal">services.vikunja</code> systemd service now uses <code class="literal">vikunja</code> as dynamic user instead of <code class="literal">vikunja-api</code>. Database users might need to be changed.</p></li><li class="listitem"><p><code class="literal">services.vikunja.setupNginx</code> setting has been removed. Users now need to set up the webserver configuration on their own with a proxy pass to the vikunja service.</p></li><li class="listitem"><p><code class="literal">services.vmagent</code> module deprecates <code class="literal">dataDir</code>, <code class="literal">group</code> and <code class="literal">user</code> settings in favor of the systemd-provided CacheDirectory and DynamicUser.</p></li><li class="listitem"><p><code class="literal">services.vmagent.remoteWriteUrl</code> setting has been renamed to <code class="literal">services.vmagent.remoteWrite.url</code> and now defaults to <code class="literal">null</code>.</p></li><li class="listitem"><p><code class="literal">services.zope2</code> has been removed, as <code class="literal">zope2</code> is unmaintained and was relying on Python 2.</p></li><li class="listitem"><p><code class="literal">spark2014</code> has been renamed to <code class="literal">gnatprove</code>. A version of <code class="literal">gnatprove</code> matching different GNAT versions is available from the different <code class="literal">gnatPackages</code> sets.</p></li><li class="listitem"><p><code class="literal">stalwart-mail</code> has been updated to v0.5.3, which includes <a class="link" href="https://github.com/stalwartlabs/mail-server/blob/v0.5.3/UPGRADING.md"  target="_top">breaking changes</a>.</p></li><li class="listitem"><p><code class="literal">system.etc.overlay.enable</code> option was added. If enabled, <code class="literal">/etc</code> is
mounted via an overlayfs instead of being created by a custom perl script.</p></li><li class="listitem"><p><code class="literal">system.forbiddenDependenciesRegex</code> has been renamed to <code class="literal">system.forbiddenDependenciesRegexes</code> and now has the type of <code class="literal">listOf string</code> instead of <code class="literal">string</code> to accept multiple regexes.</p></li><li class="listitem"><p><code class="literal">systemd.oomd</code> module behavior has changed:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>Raise ManagedOOMMemoryPressureLimit from 50% to 80%. This should make systemd-oomd kill things less often, and fix issues like <a class="link" href="https://pagure.io/fedora-workstation/issue/358"  target="_top">this</a>.
Reference: <a class="link" href="https://src.fedoraproject.org/rpms/systemd/c/806c95e1c70af18f81d499b24cd7acfa4c36ffd6?branch=806c95e1c70af18f81d499b24cd7acfa4c36ffd6"  target="_top">commit</a>.</p></li><li class="listitem"><p>Remove swap policy. This helps prevent killing processes when user’s swap is small.</p></li><li class="listitem"><p>Expand the memory pressure policy to <code class="literal">system.slice</code>, <code class="literal">user-.slice</code>, and all user-owned slices. Reference: <a class="link" href="https://src.fedoraproject.org/rpms/systemd/c/7665e1796f915dedbf8e014f0a78f4f576d609bb"  target="_top">commit</a>.</p></li><li class="listitem"><p>Rename <code class="literal">systemd.oomd.enableUserServices</code> to <code class="literal">systemd.oomd.enableUserSlices</code>.</p></li></ul></div></li><li class="listitem"><p><code class="literal">systemd.sysusers.enable</code> option was added. If enabled, users and
groups are created with systemd-sysusers instead of with a custom perl script.</p></li><li class="listitem"><p><code class="literal">teleport</code> has been upgraded from major version 14 to major version 15.
Refer to upstream <a class="link" href="https://goteleport.com/docs/management/operations/upgrading/"  target="_top">upgrade instructions</a>
and release notes for <a class="link" href="https://goteleport.com/docs/changelog/#1500-013124"  target="_top">v15</a>.</p></li><li class="listitem"><p><code class="literal">unifiLTS</code>, <code class="literal">unifi5</code> and <code class="literal">unifi6</code> have been removed, as they require MongoDB versions which are end-of-life. All these versions can be upgraded to <code class="literal">unifi7</code> directly.</p></li><li class="listitem"><p><code class="literal">unrar</code> was updated to v7. See <a class="link" href="https://www.rarlab.com/unrar7notes.htm"  target="_top">changelog</a> for more information.</p></li><li class="listitem"><p><code class="literal">virtualisation.docker.enableNvidia</code> and <code class="literal">virtualisation.podman.enableNvidia</code> options are deprecated. <code class="literal">hardware.nvidia-container-toolkit.enable</code> should be used instead. This option will expose GPUs on containers with the <code class="literal">--device</code> CLI option. This is supported by Docker 25, Podman 3.2.0 and Singularity 4. Any container runtime that supports the CDI specification will take advantage of this feature.</p></li><li class="listitem"><p><code class="literal">virtialisation.incus</code> now defaults to the newly-added <code class="literal">incus-lts</code> release (v6.0.x). Users who wish to continue using the non-LTS release will need to set <code class="literal">virtualisation.incus.package = pkgs.incus</code>. Stable release users are encouraged to stay on the LTS release as non-LTS releases will by default not be backported.</p></li><li class="listitem"><p><code class="literal">woodpecker-*</code> packages have been updated to v2 which includes <a class="link" href="https://woodpecker-ci.org/docs/next/migrations#200"  target="_top">breaking changes</a>.</p></li><li class="listitem"><p><code class="literal">wpaperd</code> has been updated to 1.0.1, which has a breaking change: previous version 0.3.0 had 2 different configuration files, one for wpaperd and one for the wallpapers. Remove the former and move the latter (<code class="literal">wallpaper.toml</code>) to <code class="literal">config.toml</code>.</p></li><li class="listitem"><p><code class="literal">writeReferencesToFile</code> is deprecated in favour of the new trivial build helper <code class="literal">writeClosure</code>. The latter accepts a list of paths and has an unambiguous name and cleaner implementation.</p></li><li class="listitem"><p><code class="literal">xfsprogs</code> was updated to version 6.6.0, which enables reverse mapping (rmapbt) and large extent counts (nrext64) by default.
Support for these features was added in kernel 4.9 and 5.19 and nrext64 was deemed stable in kernel 6.5.
Format your filesystems with <code class="literal">mkfs.xfs -i nrext64=0</code>, if they need to be readable by GRUB2 before 2.12 or kernels older than 5.19.</p></li><li class="listitem"><p><code class="literal">xxd</code> has been moved from <code class="literal">vim</code> default output to its own output to reduce closure size. The canonical way to reference it across all platforms is <code class="literal">unixtools.xxd</code>.</p></li><li class="listitem"><p><code class="literal">youtrack</code> was bumped to 2023.3. The update is not performed automatically, it requires manual interaction. See the YouTrack section in the manual for details.</p></li><li class="listitem"><p>Ada packages (libraries and tools) have been moved into the <code class="literal">gnatPackages</code> scope. <code class="literal">gnatPackages</code> uses the default GNAT compiler, <code class="literal">gnat12Packages</code> and <code class="literal">gnat13Packages</code> use the respective matching compiler version.</p></li><li class="listitem"><p>Paths provided as <code class="literal">restartTriggers</code> and <code class="literal">reloadTriggers</code> for systemd units will now be copied into the Nix store to make the behavior consistent.
Previously, <code class="literal">restartTriggers = [ ./config.txt ]</code>, if defined in a flake, would trigger a restart when any part of the flake changed; and if not defined in a flake, would never trigger a restart even if the contents of <code class="literal">config.txt</code> changed.</p></li><li class="listitem"><p>A warning has been added for services that are
<code class="literal">after = [ &quot;network-online.target&quot; ]</code> but do not depend on it (e.g. using
<code class="literal">wants</code>), because the dependency that <code class="literal">multi-user.target</code> has on
<code class="literal">network-online.target</code> is planned for removal.</p></li><li class="listitem"><p>switch-to-configuration does not directly call systemd-tmpfiles anymore.
Instead, the new artificial sysinit-reactivation.target is introduced which
allows to restart multiple services that are ordered before sysinit.target
and respect the ordering between the services.</p></li><li class="listitem"><p><code class="literal">services.prometheus.exporters.snmp</code>’s configuration format changed with release 0.23.0.
The module now includes an optional config check, that is enabled by default, to make the change obvious before any deployment.
More information about the configuration syntax change is available in the <a class="link" href="https://github.com/prometheus/snmp_exporter/blob/b75fc6b839ee3f3ccbee68bee55f1ae99555084a/auth-split-migration.md"  target="_top">upstream repository</a>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-24.05-notable-changes" class="title" >Other Notable Changes   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">addDriverRunpath</code> has been added to facilitate the deprecation of the old <code class="literal">addOpenGLRunpath</code> setuphook. This change is motivated by the evolution of the setuphook to include all hardware acceleration.</p></li><li class="listitem"><p><code class="literal">appimage</code>, <code class="literal">appimageTools.wrapAppImage</code> and <code class="literal">buildFHSEnvBubblewrap</code> now properly accept <code class="literal">pname</code> and <code class="literal">version</code>.</p></li><li class="listitem"><p><code class="literal">bacula</code> now allows to configure <code class="literal">TLS</code> for encrypted communication.</p></li><li class="listitem"><p><code class="literal">boot.initrd.network.ssh.authorizedKeyFiles</code> is a new option in the initrd ssh daemon module, for adding authorized keys via list of files.</p></li><li class="listitem"><p><code class="literal">boot.kernel.sysctl.&quot;net.core.wmem_max&quot;</code> changed from a string to an integer because of the addition of a custom merge option (taking the highest value defined to avoid conflicts between 2 services trying to set that value), just as <code class="literal">boot.kernel.sysctl.&quot;net.core.rmem_max&quot;</code> since 22.11.</p></li><li class="listitem"><p><code class="literal">boot.loader.systemd-boot.xbootldrMountPoint</code> is a new option for setting up a separate <a class="link" href="https://uapi-group.org/specifications/specs/boot_loader_specification/"  target="_top">XBOOTLDR partition</a> to store boot files. Useful on systems with a small EFI System partition that cannot be easily repartitioned.</p></li><li class="listitem"><p><code class="literal">boot.loader.systemd-boot</code> will now verify that <code class="literal">efiSysMountPoint</code> (and <code class="literal">xbootldrMountPoint</code> if configured) are mounted partitions.</p></li><li class="listitem"><p><code class="literal">buildDubPackage</code> can now be used to build Programs written in <a class="link" href="https://dlang.org/"  target="_top">D</a> using the <code class="literal">dub</code> build system and package manager.
See the <a class="link" href="https://nixos.org/manual/nixpkgs/unstable#dlang"  target="_top">D section</a> in the manual for more information.</p></li><li class="listitem"><p><code class="literal">castopod</code> has some migration actions to be taken in case of a S3 setup. Some new features may also need some manual migration actions. See <a class="link" href="https://code.castopod.org/adaures/castopod/-/releases"  target="_top">https://code.castopod.org/adaures/castopod/-/releases</a> for more information.</p></li><li class="listitem"><p><code class="literal">documentation.man.mandoc</code> now, by default, uses <code class="literal">MANPATH</code> to set the directories where mandoc will search for manual pages.
This enables mandoc to find manual pages in Nix profiles. To set the manual search paths via the <code class="literal">mandoc.conf</code> configuration file like before, use <code class="literal">documentation.man.mandoc.settings.manpath</code> instead.</p></li><li class="listitem"><p><code class="literal">drbd</code> out-of-tree Linux kernel driver has been added in version 9.2.7. With it the DRBD 9.x features can be used instead of the 8.x features provided by the 8.4.11 in-tree driver.</p></li><li class="listitem"><p><code class="literal">garage</code> has been updated to v1.x.x. Users should read the <a class="link" href="https://git.deuxfleurs.fr/Deuxfleurs/garage/releases/tag/v1.0.0"  target="_top">upstream release notes</a> and follow the documentation when changing over their <code class="literal">services.garage.package</code> and performing this manual upgrade.</p></li><li class="listitem"><p><code class="literal">hardware.pulseaudio</code> module now sets permissions of pulse user home directory to 755 when running in systemWide mode. It fixes <a class="link" href="https://github.com/NixOS/nixpkgs/issues/114399"  target="_top">issue 114399</a>.</p></li><li class="listitem"><p><code class="literal">kavita</code> has been updated to 0.8.0, requiring a manual forced library scan on all libraries for migration. Refer to upstream’s <a class="link" href="https://github.com/Kareadita/Kavita/releases/tag/v0.8.0"  target="_top">release notes</a> for details.</p></li><li class="listitem"><p><code class="literal">krb5</code> module has been rewritten and moved to <code class="literal">security.krb5</code>, moving all options but <code class="literal">security.krb5.enable</code> and <code class="literal">security.krb5.package</code> into <code class="literal">security.krb5.settings</code>.</p></li><li class="listitem"><p><code class="literal">libass</code> now uses the native CoreText backend on Darwin, which may fix subtitle rendering issues with <code class="literal">mpv</code>, <code class="literal">ffmpeg</code>, etc.</p></li><li class="listitem"><p><code class="literal">libjxl</code> version was bumped from 0.8.2 to 0.9.1 <a class="link" href="https://github.com/libjxl/libjxl/pull/2576"  target="_top">dropped support for the butteraugli API</a>. You will no longer be able to set <code class="literal">enableButteraugli</code> on <code class="literal">libaom</code>.</p></li><li class="listitem"><p><a class="link" href="https://lilypond.org/index.html"  target="_top"><code class="literal">lilypond</code></a> and <a class="link" href="https://www.denemo.org"  target="_top"><code class="literal">denemo</code></a> are now compiled with Guile 3.0.</p></li><li class="listitem"><p><code class="literal">lxd</code> has been upgraded to v5.21.x, an LTS release. The LTS release is now the only supported LXD release. Users are encouraged to <a class="link" href="https://linuxcontainers.org/incus/docs/main/howto/server_migrate_lxd/"  target="_top">migrate to Incus</a> for better support on NixOS.</p></li><li class="listitem"><p><a class="link" href="https://element-hq.github.io/synapse/"  target="_top"><code class="literal">matrix-synapse</code></a> homeserver module now supports configuring UNIX domain socket <a class="link" href="options.html#opt-services.matrix-synapse.settings.listeners"  ><code class="literal">listeners</code></a> through the <code class="literal">path</code> option.
The default replication worker on the main instance has been migrated away from TCP sockets to UNIX domain sockets.</p></li><li class="listitem"><p><code class="literal">mockgen</code> has changed to the <a class="link" href="https://github.com/uber-go/mock"  target="_top">go.uber.org/mock</a> fork because <a class="link" href="https://github.com/golang/mock#gomock"  target="_top">the original repository is no longer maintained</a>.</p></li><li class="listitem"><p><code class="literal">mpich</code> now requires <code class="literal">withPm</code> to be a list, e.g. <code class="literal">&quot;hydra:gforker&quot;</code> becomes <code class="literal">[ &quot;hydra&quot; &quot;gforker&quot; ]</code>.</p></li><li class="listitem"><p><code class="literal">nextcloud-setup.service</code> no longer changes the group of each file and directory inside <code class="literal">/var/lib/nextcloud/{config,data,store-apps}</code> if one of these directories has the wrong owner group. This was part of transitioning the group used for <code class="literal">/var/lib/nextcloud</code>, but isn’t necessary anymore.</p></li><li class="listitem"><p><code class="literal">oils-for-unix</code>, the oil shell’s C++ version is now available. The Python version is still available as <code class="literal">oil</code>.</p></li><li class="listitem"><p><code class="literal">pkgsExtraHardening</code>, a new top-level package set, was added. This is a set of packages built with stricter hardening flags - those that have not yet received enough testing to be applied universally, those that are more likely to cause build failures or those that have drawbacks to their use (e.g. performance or required hardware features).</p></li><li class="listitem"><p><a class="link" href="https://github.com/majewsky/portunus"  target="_top"><code class="literal">portunus</code></a> has been updated to major version 2.
This version of Portunus supports strong password hashes, but the legacy hash SHA-256 is also still supported to ensure a smooth migration of existing user accounts.
After upgrading, follow the instructions on the <a class="link" href="https://github.com/majewsky/portunus/releases/tag/v2.0.0"  target="_top">upstream release notes</a> to upgrade all user accounts to strong password hashes.
Support for weak password hashes will be removed in NixOS 24.11.</p></li><li class="listitem"><p><code class="literal">programs.fish.package</code> now allows you to override the package used in the <code class="literal">fish</code> module.</p></li><li class="listitem"><p><code class="literal">qt6.qtmultimedia</code> has changed its default backend to <code class="literal">QT_MEDIA_BACKEND=ffmpeg</code> (previously <code class="literal">gstreamer</code> on Linux or <code class="literal">darwin</code> on macOS).
The previous native backends remain available but are now minimally maintained. Refer to <a class="link" href="https://doc.qt.io/qt-6/qtmultimedia-index.html#ffmpeg-as-the-default-backend"  target="_top">upstream documentation</a> for further details about each platform.</p></li><li class="listitem"><p><code class="literal">services.btrbk</code> now automatically selects and provides required compression
program depending on the configured <code class="literal">stream_compress</code> option.</p></li><li class="listitem"><p><code class="literal">services.github-runner</code> module has been removed. To configure a single GitHub Actions Runner refer to <code class="literal">services.github-runners.*</code>. Note that this will trigger a new runner registration.</p></li><li class="listitem"><p><code class="literal">services.networkmanager.extraConfig</code> was renamed to <code class="literal">services.networkmanager.settings</code> and changed to use the ini type instead of using a multiline string.</p></li><li class="listitem"><p><code class="literal">services.nextcloud.config.dbport</code> option of the Nextcloud module was removed to match upstream.
The port can be specified in <a class="link" href="options.html#opt-services.nextcloud.config.dbhost"  ><code class="literal">services.nextcloud.config.dbhost</code></a>.</p></li><li class="listitem"><p><code class="literal">services.kavita</code> now uses the free-form option <code class="literal">services.kavita.settings</code> for the application settings file.
The options <code class="literal">services.kavita.ipAdresses</code> and <code class="literal">services.kavita.port</code> now exist at <code class="literal">services.kavita.settings.IpAddresses</code>
and <code class="literal">services.kavita.settings.IpAddresses</code>. The file at <code class="literal">services.kavita.tokenKeyFile</code> now needs to contain a secret with
512+ bits instead of 128+ bits.</p></li><li class="listitem"><p><code class="literal">services.netbird</code> now allows running multiple tunnels in parallel through <a class="link" href="options.html#opt-services.netbird.tunnels"  ><code class="literal">services.netbird.tunnels</code></a>.</p></li><li class="listitem"><p><code class="literal">services.nginx.virtualHosts</code> using <code class="literal">forceSSL</code> or
<code class="literal">globalRedirect</code> can now have redirect codes other than 301 through <code class="literal">redirectCode</code>.</p></li><li class="listitem"><p><code class="literal">services.openssh</code> now has an option <code class="literal">authorizedKeysInHomedir</code>, controlling whether <code class="literal">~/.ssh/authorizedKeys</code> is
added to <code class="literal">authorizedKeysFiles</code>.</p><div class="note"><h3 class="title">Note</h3><p>This option currently defaults to <code class="literal">true</code> for NixOS 24.05, preserving the previous behaviour.
This is expected to change in NixOS 24.11.</p></div><div class="warning"><h3 class="title">Warning</h3><p>Users should check that their SSH keys are in <code class="literal">users.users.*.openssh</code>, or that they have another way to access
and administer the system, before setting this option to <code class="literal">false</code>.</p></div></li><li class="listitem"><p><code class="literal">services.paperless</code> module no longer uses the previously downloaded NLTK data stored in <code class="literal">/var/cache/paperless/nltk</code>. This directory can be removed.</p></li><li class="listitem"><p><code class="literal">services.postgresql.extraPlugins</code>’ type has expanded. Previously it was a list of packages, now it can also be a function that returns such a list.
For example a config line like <code class="literal">services.postgresql.extraPlugins = with pkgs.postgresql_11.pkgs; [ postgis ];</code> is recommended to be changed to <code class="literal">services.postgresql.extraPlugins = ps: with ps; [ postgis ];</code>;</p></li><li class="listitem"><p><code class="literal">services.slskd</code> has been refactored to include more configuration options in
the free-form <code class="literal">services.slskd.settings</code> option, and some defaults (including listen ports)
have been changed to match the upstream defaults. Additionally, disk logging is now
disabled by default, and the log rotation timer has been removed.
The nginx virtualhost option is now of the <code class="literal">vhost-options</code> type.</p></li><li class="listitem"><p><code class="literal">services.soju</code> now has a wrapper for the <code class="literal">sojuctl</code> command, pointed at the service config file. It also has the new option <code class="literal">adminSocket.enable</code>, which creates a unix admin socket at <code class="literal">/run/soju/admin</code>.</p></li><li class="listitem"><p><code class="literal">services.stalwart-mail</code> uses the legacy version 0.6.X as default because newer <code class="literal">stalwart-mail</code> versions require a <a class="link" href="https://github.com/stalwartlabs/mail-server/blob/main/UPGRADING.md"  target="_top">manual upgrade process</a>. Change <a class="link" href="options.html#opt-services.stalwart-mail.package"  ><code class="literal">services.stalwart-mail.package</code></a> to <code class="literal">pkgs.stalwart-mail</code> if you wish to switch to the new version.</p></li><li class="listitem"><p><code class="literal">services.teeworlds</code> module now has a wealth of configuration options, including a new <code class="literal">package</code> option.</p></li><li class="listitem"><p><code class="literal">services.xserver.desktopManager.budgie</code> installs <code class="literal">gnome.gnome-terminal</code> by default (instead of <code class="literal">mate.mate-terminal</code>).</p></li><li class="listitem"><p><code class="literal">services.zfs.zed.enableMail</code> now uses the global <code class="literal">sendmail</code> wrapper defined by an email module
(such as msmtp or Postfix). It no longer requires using a special ZFS build with email support.</p></li><li class="listitem"><p><code class="literal">sonarr</code> version was bumped to from 3.0.10 to 4.0.3. Consequently existing config database files will be upgraded automatically, but note that some old apparently-working configs <a class="link" href="https://forums.sonarr.tv/t/sonarr-v4-released/33089"  target="_top">might actually be corrupt and fail to upgrade cleanly</a>.</p></li><li class="listitem"><p><code class="literal">stdenv</code>: The <code class="literal">--replace</code> flag in <code class="literal">substitute</code>, <code class="literal">substituteInPlace</code>, <code class="literal">substituteAll</code>, <code class="literal">substituteAllStream</code>, and <code class="literal">substituteStream</code> is now deprecated if favor of the new <code class="literal">--replace-fail</code>, <code class="literal">--replace-warn</code> and <code class="literal">--replace-quiet</code>. The deprecated <code class="literal">--replace</code> equates to <code class="literal">--replace-warn</code>.</p></li><li class="listitem"><p><code class="literal">systemd</code>: when merging unit options (of type <code class="literal">unitOption</code>),
if at least one definition is a list, all those which aren’t are now lifted into a list,
making it possible to accumulate definitions without resorting to <code class="literal">mkForce</code>,
hence to retain the definitions not anticipating that need.</p></li><li class="listitem"><p><code class="literal">systemd</code> units can now specify the <code class="literal">Upholds=</code> and <code class="literal">UpheldBy=</code> unit dependencies via the aptly
named <code class="literal">upholds</code> and <code class="literal">upheldBy</code> options. These options get systemd to enforce that the
dependencies remain continuously running for as long as the dependent unit is in a running state.</p></li><li class="listitem"><p>A stdenv’s default set of hardening flags can now be set via its <code class="literal">bintools-wrapper</code>’s <code class="literal">defaultHardeningFlags</code> argument. A convenient stdenv adapter, <code class="literal">withDefaultHardeningFlags</code>, can be used to override an existing stdenv’s <code class="literal">defaultHardeningFlags</code>.</p></li><li class="listitem"><p>Programs written in <a class="link" href="https://nim-lang.org/"  target="_top">Nim</a> are built with libraries selected by lockfiles.
The <code class="literal">nimPackages</code> and <code class="literal">nim2Packages</code> sets have been removed.
See https://nixos.org/manual/nixpkgs/unstable#nim for more information.</p></li><li class="listitem"><p>The EC2 image module now enables the <a class="link" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/ssm-agent.html"  target="_top">Amazon SSM Agent</a> by default.</p></li><li class="listitem"><p>A new abstraction to create both read-only as well as writable overlay file
systems was added. Available via
<a class="link" href="options.html#opt-fileSystems._name_.overlay.lowerdir"  >fileSystems.overlay</a>. See also the
<a class="link" href="index.html#sec-overlayfs" title="Overlayfs" >NixOS docs</a>.</p></li><li class="listitem"><p>A new hardening flag, <code class="literal">zerocallusedregs</code> was made available, corresponding to the gcc/clang option <code class="literal">-fzero-call-used-regs=used-gpr</code>.</p></li><li class="listitem"><p>A new hardening flag, <code class="literal">trivialautovarinit</code> was made available, corresponding to the gcc/clang option <code class="literal">-ftrivial-auto-var-init=pattern</code>.</p></li><li class="listitem"><p><code class="literal">dnsdist</code> has new options to enable and configure a DNSCrypt endpoint (see <code class="literal">services.dnsdist.dnscrypt.enable</code>, etc.).
The module can generate the DNSCrypt provider key pair and certificates, and also rotates them automatically with no downtime.</p></li><li class="listitem"><p>The kernel Yama LSM is now enabled by default, which prevents ptracing
non-child processes. This means you will not be able to attach gdb to an
existing process, but will need to start that process from gdb (so it is a
child). Or you can set <code class="literal">boot.kernel.sysctl.&quot;kernel.yama.ptrace_scope&quot;</code> to 0.</p></li><li class="listitem"><p>Lisp modules: previously deprecated interface based on <code class="literal">common-lisp.sh</code> has now been removed.</p></li><li class="listitem"><p>The <code class="literal">systemd-confinement</code> module extension is now compatible with <code class="literal">DynamicUser=true</code> and thus <code class="literal">ProtectSystem=strict</code> too.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-24.05-nixpkgs-lib" class="title" >Nixpkgs Library   </h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-release-24.05-lib-additions-improvements" class="title" >Additions and Improvements   </h4>  </div> </div></div><p>New functions:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.asserts.assertEachOneOf"  target="_top"><code class="literal">lib.asserts.assertEachOneOf</code></a>: Check that each value is one of the allowed ones.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.attrsets.longestValidPathPrefix"  target="_top"><code class="literal">lib.attrsets.longestValidPathPrefix</code></a>: The longest prefix of an attribute path that refers to an existing attribute in a nesting of attribute sets.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.attrsets.mapCartesianProduct"  target="_top"><code class="literal">lib.attrsets.mapCartesianProduct</code></a>: Apply a function to the cartesian product of attribute set value combinations.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.trivial.xor"  target="_top"><code class="literal">lib.trivial.xor</code></a>: Boolean “exclusive or”</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.lists.ifilter0"  target="_top"><code class="literal">lib.lists.ifilter0</code></a>: Filter a list for elements that satisfy a predicate function. The predicate function is called with both the index and value for each element.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.lists.sortOn"  target="_top"><code class="literal">lib.lists.sortOn</code></a>: Sort a list based on the default comparison of a derived property.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.path.hasStorePathPrefix"  target="_top"><code class="literal">lib.path.hasStorePathPrefix</code></a>: Whether a <a class="link" href="https://nixos.org/manual/nix/stable/language/values.html#type-path"  target="_top">path</a> has a <a class="link" href="https://nixos.org/manual/nix/stable/store/store-path.html#store-path"  target="_top">store path</a> as a prefix.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.filesystem.packagesFromDirectoryRecursive"  target="_top"><code class="literal">lib.filesystem.packagesFromDirectoryRecursive</code></a>: Transform a directory tree containing package files suitable for <code class="literal">callPackage</code> into a matching nested attribute set of derivations.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.fileset.toList"  target="_top"><code class="literal">lib.fileset.toList</code></a>: The list of file paths contained in a given file set.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.fileset.maybeMissing"  target="_top"><code class="literal">lib.fileset.maybeMissing</code></a>: Create a file set from a path that may or may not exist.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.derivations.optionalDrvAttr"  target="_top"><code class="literal">lib.derivations.optionalDrvAttr</code></a>: Conditionally set a derivation attribute.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.strings.makeIncludePath"  target="_top"><code class="literal">lib.strings.makeIncludePath</code></a>: Construct an include search path (such as <code class="literal">C_INCLUDE_PATH</code>) containing the header files for a set of packages or paths.</p></li></ul></div><p>Improvements:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.fixedPoints.extends"  target="_top"><code class="literal">lib.fixedPoints.extends</code></a>: Better documentation</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.customisation.makeScope"  target="_top"><code class="literal">lib.customisation.makeScope</code></a>: Better documentation</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.derivations.lazyDerivation"  target="_top"><code class="literal">lib.derivations.lazyDerivation</code></a>: Now supports multiple outputs with an <code class="literal">outputs</code> argument</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable#sec-functions-library-gvariant"  target="_top"><code class="literal">lib.gvariant</code></a>: Better error message for integers and attribute set values</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.fileset.gitTracked"  target="_top"><code class="literal">lib.filesets.gitTracked</code></a>: Now works within store paths</p></li></ul></div><p>Misc:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>The <a class="link" href="https://github.com/NixOS/nixpkgs/tree/release-24.05/lib"  target="_top"><code class="literal">lib/</code> directory</a> is a self-contained flake now, including a working <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.trivial.version"  target="_top"><code class="literal">lib.trivial.version</code></a> (but note that fetching a subtree by itself is not supported in Nix yet)</p></li><li class="listitem"><p><a class="link" href="https://github.com/NixOS/nixpkgs/issues?q=author%3Aadisbladis+label%3A%226.topic%3A+lib%22+created%3A%3C2024-05-31+"  target="_top">Various minor performance improvements</a></p></li></ul></div><p>Module System:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>New types:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixos/unstable/#sec-option-types-sums"  target="_top"><code class="literal">types.attrTag</code></a>: A tagged union type</p></li><li class="listitem"><p><code class="literal">types.nonEmptyListOf</code>: A non-empty list</p></li></ul></div></li><li class="listitem"><p>Improved types:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">types.uniq</code>/<code class="literal">unique</code> now check the wrapped type</p></li></ul></div></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-release-24.05-lib-deprecations" class="title" >Deprecations   </h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/unstable#function-library-lib.options.mdDoc"  target="_top"><code class="literal">lib.options.mdDoc</code></a> is obsolete and now emits a warning. The core ecosystem has completely migrated to markdown, so marking markdown as markdown is redundant.</p></li><li class="listitem"><p><code class="literal">lib.attrsets.zipWithNames</code> is now a deprecated alias of <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.attrsets.zipAttrsWithNames"  target="_top"><code class="literal">lib.attrsets.zipAttrsWithNames</code></a></p></li><li class="listitem"><p><code class="literal">lib.attrsets.cartesianProductOfSets</code> has been renamed to <a class="link" href="https://nixos.org/manual/nixpkgs/unstable/#function-library-lib.attrsets.cartesianProduct"  target="_top"><code class="literal">lib.attrsets.cartesianProduct</code></a></p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-release-24.05-lib-internal" class="title" >Internal   </h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">lib</code> now has <a class="link" href="https://github.com/NixOS/nixpkgs/tree/master/lib#readme"  target="_top">Readme for contributing</a>.</p></li><li class="listitem"><p>Some function’s documentation is now written using the <a class="link" href="https://github.com/NixOS/rfcs/pull/145"  target="_top">accepted doc comment syntax</a>.</p></li><li class="listitem"><p><code class="literal">odoo</code> has been updated from <code class="literal">16.0.20231024</code> to <code class="literal">17.0.20240507</code>.</p></li></ul></div>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-23.11" class="title" style="clear: both">Release 23.11 (“Tapir”, 2023.11/29)   </h2>  </div> </div></div><p>The NixOS release team is happy to announce a new version of NixOS. The release is called NixOS 23.11 (“Tapir”).</p><p>NixOS is a Linux distribution, whose set of packages can also be used on other Linux systems and macOS.</p><p>Support is planned until the end of June 2024, handing over to NixOS 24.05.</p><p>To upgrade to the latest release, follow the upgrade chapter and check the <a class="link" href="release-notes.html#sec-release-23.11-nixos-breaking-changes" title="Breaking Changes" >Breaking Changes</a>
section for packages and services used in your configuration.</p><p>The team is excited about the many software updates and improvements in this release. Just to name a few, do check the updates
for <code class="literal">GNOME</code> packages, <code class="literal">systemd</code>, <code class="literal">glibc</code>, the <code class="literal">ROCM</code> package set, and <code class="literal">hostapd</code> (which brings support for WiFi6 (IEEE 802.11ax) and WPA3-SAE-PK).</p><p>Make sure to also check the many updates in the <a class="link" href="release-notes.html#sec-release-23.11-nixpkgs-lib" title="Nixpkgs Library" >Nixpkgs library</a> when developing your own packages.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-23.11-toc" class="title" >Table of Contents   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="release-notes.html#sec-release-23.11-nixos" title="NixOS" >NixOS</a></p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><a class="link" href="release-notes.html#sec-release-23.11-nixos-breaking-changes" title="Breaking Changes" >Breaking Changes</a></p></li><li class="listitem"><p><a class="link" href="release-notes.html#sec-release-23.11-nixos-new-services" title="New Services" >New Services</a></p></li><li class="listitem"><p><a class="link" href="release-notes.html#sec-release-23.11-nixos-notable-changes" title="Other Notable Changes" >Other Notable Changes</a></p></li></ul></div></li><li class="listitem"><p><a class="link" href="release-notes.html#sec-release-23.11-nixpkgs-lib" title="Nixpkgs Library" >Nixpkgs Library</a></p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><a class="link" href="release-notes.html#sec-release-23.11-lib-breaking" title="Breaking Changes" >Breaking Changes</a></p></li><li class="listitem"><p><a class="link" href="release-notes.html#sec-release-23.11-lib-additions-improvements" title="Additions and Improvements" >Additions and Improvements</a></p></li><li class="listitem"><p><a class="link" href="release-notes.html#sec-release-23.11-lib-deprecations" title="Deprecations" >Deprecations</a></p></li></ul></div></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-23.11-nixos" class="title" >NixOS   </h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-release-23.11-nixos-breaking-changes" class="title" >Breaking Changes   </h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">services.postgresql.ensurePermissions</code> has been deprecated in favor of
<code class="literal">services.postgresql.ensureUsers.*.ensureDBOwnership</code> which simplifies the
setup of database owned by a certain system user in local database contexts
(which make use of peer authentication via UNIX sockets), migration
guidelines were provided in the NixOS manual, please refer to them if you are
affected by a PostgreSQL 15 changing the way <code class="literal">GRANT ALL PRIVILEGES</code> is
working. <code class="literal">services.postgresql.ensurePermissions</code> will be removed in 24.05.
All NixOS modules were migrated using one of the strategy, e.g.
<code class="literal">ensureDBOwnership</code> or <code class="literal">postStart</code>. Refer to the <a class="link" href="https://github.com/NixOS/nixpkgs/pull/266270"  target="_top">PR
#266270</a> for more details.</p></li><li class="listitem"><p><code class="literal">network-online.target</code> has been fixed to no longer time out for systems with
<code class="literal">networking.useDHCP = true</code> and <code class="literal">networking.useNetworkd = true</code>. Workarounds
for this can be removed.</p></li><li class="listitem"><p>The <code class="literal">boot.loader.raspberryPi</code> options have been marked deprecated, with
intent of removal for NixOS 24.11. They had a limited use-case, and do not
work like people expect. They required either very old installs from (<a class="link" href="https://github.com/NixOS/nixpkgs/pull/62462"  target="_top">before
mid-2019</a>) or customized builds
out of scope of the standard and generic AArch64 support. That option set
never supported the Raspberry Pi 4 family of devices.</p></li><li class="listitem"><p><code class="literal">python3.pkgs.sequoia</code> was removed in favor of <code class="literal">python3.pkgs.pysequoia</code>. The
latter package is based on upstream’s dedicated repository for sequoia’s
Python bindings, where the Python bindings from
<a class="link" href="https://gitlab.com/sequoia-pgp/sequoia"  target="_top">gitlab:sequoia-pgp/sequoia</a> were
removed long ago.</p></li><li class="listitem"><p><code class="literal">writeTextFile</code> requires <code class="literal">executable</code> to be boolean now, values like <code class="literal">null</code>
or <code class="literal">&quot;&quot;</code> will fail to evaluate now.</p></li><li class="listitem"><p>The latest version of <code class="literal">clonehero</code> now stores custom content in
<code class="literal">~/.clonehero</code>. Refer to the <a class="link" href="https://clonehero.net/2022/11/29/v23-to-v1-migration-instructions.html"  target="_top">migration
instructions</a>
for more details. Typically, these content files would exist along side the
binary, but the previous build used a wrapper script that would store them in
<code class="literal">~/.config/unity3d/srylain Inc_/Clone Hero</code>.</p></li><li class="listitem"><p><code class="literal">services.mastodon</code> doesn’t support providing a TCP port to its <code class="literal">streaming</code>
component anymore, as upstream implemented parallelization by running
multiple instances instead of running multiple processes in one instance.
Please create a PR if you are interested in this feature.<br />Due to this, the desired number of such instances
<code class="option">services.mastodon.streamingProcesses</code> now needs to be declared explicitly.</p></li><li class="listitem"><p>The <code class="literal">services.hostapd</code> module was rewritten to support <code class="literal">passwordFile</code> like
options, WPA3-SAE, and management of multiple interfaces. This breaks
compatibility with older configurations.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">hostapd</code> is now started with additional systemd sandbox/hardening options
for better security.</p></li><li class="listitem"><p><code class="literal">services.hostapd.interface</code> was replaced with a per-radio and per-bss
configuration scheme using
<a class="link" href="options.html#opt-services.hostapd.radios"  >services.hostapd.radios</a>.</p></li><li class="listitem"><p><code class="literal">services.hostapd.wpa</code> has been replaced by
<a class="link" href="options.html#opt-services.hostapd.radios._name_.networks._name_.authentication.wpaPassword"  >services.hostapd.radios.&lt;name&gt;.networks.&lt;name&gt;.authentication.wpaPassword</a>
and
<a class="link" href="options.html#opt-services.hostapd.radios._name_.networks._name_.authentication.saePasswords"  >services.hostapd.radios.&lt;name&gt;.networks.&lt;name&gt;.authentication.saePasswords</a>
which configure WPA2-PSK and WP3-SAE respectively.</p></li><li class="listitem"><p>The default authentication has been changed to WPA3-SAE. Options for other
(legacy) schemes are still available.</p></li></ul></div></li><li class="listitem"><p><code class="literal">python3.pkgs.fetchPypi</code> and <code class="literal">python3Packages.fetchPypi</code> have been
deprecated in favor of top-level <code class="literal">fetchPypi</code>.</p></li><li class="listitem"><p>xdg-desktop-portal has been updated to 1.18, which reworked how portal
implementations are selected. If you roll your own desktop environment, you
should either set <code class="literal">xdg.portal.config</code> or <code class="literal">xdg.portal.configPackages</code>, which
allow fine-grained control over which portal backend to use for specific
interfaces, as described in <a class="link" href="https://github.com/flatpak/xdg-desktop-portal/blob/1.18.1/doc/portals.conf.rst.in" target="_top"><span class="citerefentry"><span class="refentrytitle">portals.conf</span>(5)</span></a>.</p><p>If you don’t provide configurations, a portal backend will only be considered
when the desktop you use matches its deprecated <code class="literal">UseIn</code> key. While some NixOS
desktop modules should already ship one for you, it is suggested to test
portal availability by trying <a class="link" href="https://flathub.org/apps/xyz.tytanium.DoorKnocker"  target="_top">Door
Knocker</a> and <a class="link" href="https://flathub.org/apps/com.belmoussaoui.ashpd.demo"  target="_top">ASHPD
Demo</a>. If things
regressed, you may run <code class="literal">G_MESSAGES_DEBUG=all /path/to/xdg-desktop-portal/libexec/xdg-desktop-portal</code> for ideas on which
config file and which portals are chosen.</p></li><li class="listitem"><p><code class="literal">pass</code> now does not contain <code class="literal">password-store.el</code>. Users should get
<code class="literal">password-store.el</code> from Emacs lisp package set <code class="literal">emacs.pkgs.password-store</code>.</p></li><li class="listitem"><p><code class="literal">services.knot</code> now supports <code class="literal">.settings</code> from RFC42.  The previous
<code class="literal">.extraConfig</code> still works the same, but it displays a warning now.</p></li><li class="listitem"><p><code class="literal">services.invoiceplane</code> now supports <code class="literal">.settings</code> from RFC42. The previous
<code class="literal">.extraConfig</code> still works the same way, but it displays a warning now.</p></li><li class="listitem"><p><code class="literal">mu</code> does not install <code class="literal">mu4e</code> files by default now. Users should get <code class="literal">mu4e</code>
from Emacs lisp package set <code class="literal">emacs.pkgs.mu4e</code>.</p></li><li class="listitem"><p><code class="literal">mariadb</code> now defaults to <code class="literal">mariadb_1011</code> instead of <code class="literal">mariadb_106</code>, meaning
the default version was upgraded from v10.6.x to v10.11.x. Refer to the
<a class="link" href="https://mariadb.com/kb/en/upgrading-from-mariadb-10-6-to-mariadb-10-11/"  target="_top">upgrade
notes</a>
for potential issues.</p></li><li class="listitem"><p><code class="literal">getent</code> has been moved from <code class="literal">glibc</code>’s <code class="literal">bin</code> output to its own dedicated
output, reducing closure size for many dependents. Dependents using the
<code class="literal">getent</code> alias should not be affected; others should move from using
<code class="literal">glibc.bin</code> or <code class="literal">getBin glibc</code> to <code class="literal">getent</code> (which also improves compatibility
with non-glibc platforms).</p></li><li class="listitem"><p><code class="literal">maintainers/scripts/update-luarocks-packages</code> is now a proper package
<code class="literal">luarocks-packages-updater</code> that can be run to maintain out-of-tree luarocks
packages.</p></li><li class="listitem"><p>The <code class="literal">users.users.&lt;name&gt;.passwordFile</code> has been renamed to
<code class="literal">users.users.&lt;name&gt;.hashedPasswordFile</code> to avoid possible confusions. The
option is in fact the file-based version of <code class="literal">hashedPassword</code>, not <code class="literal">password</code>,
and expects a file containing the <span class="citerefentry"><span class="refentrytitle">crypt</span>(3)</span> hash of the user
password.</p></li><li class="listitem"><p><code class="literal">chromiumBeta</code> and <code class="literal">chromiumDev</code> have been removed due to the lack of
maintenance in nixpkgs. Consider using <code class="literal">chromium</code> instead.</p></li><li class="listitem"><p><code class="literal">google-chrome-beta</code> and <code class="literal">google-chrome-dev</code> have been removed due to the
lack of maintenance in nixpkgs. Consider using <code class="literal">google-chrome</code> instead.</p></li><li class="listitem"><p>The <code class="literal">services.ananicy.extraRules</code> option now has the type of <code class="literal">listOf attrs</code>
instead of <code class="literal">string</code>.</p></li><li class="listitem"><p><code class="literal">buildVimPluginFrom2Nix</code> has been renamed to <code class="literal">buildVimPlugin</code>, which now
now skips <code class="literal">configurePhase</code> and <code class="literal">buildPhase</code>.</p></li><li class="listitem"><p>JACK tools (<code class="literal">jack_*</code> except <code class="literal">jack_control</code>) have moved from the <code class="literal">jack2</code>
package to <code class="literal">jack-example-tools</code>.</p></li><li class="listitem"><p>The <code class="literal">waagent</code> service does provisioning now.</p></li><li class="listitem"><p>The <code class="literal">matrix-synapse</code> package &amp; module have undergone some significant
internal changes, for most setups no intervention is needed, though:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>The option
<a class="link" href="options.html#opt-services.matrix-synapse.package"  ><code class="literal">services.matrix-synapse.package</code></a>
is read-only now. For modifying the package, use an overlay which modifies
<code class="literal">matrix-synapse-unwrapped</code> instead. More on that below.</p></li><li class="listitem"><p>The <code class="literal">enableSystemd</code> &amp; <code class="literal">enableRedis</code> arguments have been removed and
<code class="literal">matrix-synapse</code> has been renamed to <code class="literal">matrix-synapse-unwrapped</code>. Also,
several optional dependencies (such as <code class="literal">psycopg2</code> or <code class="literal">authlib</code>) have been
removed.</p></li><li class="listitem"><p>These optional dependencies are automatically added via a wrapper
(<code class="literal">pkgs.matrix-synapse.override { extras = [&quot;redis&quot;]; }</code> for <code class="literal">hiredis</code> &amp;
<code class="literal">txredisapi</code> for instance) if the relevant config section is declared in
<code class="literal">services.matrix-synapse.settings</code>. For instance, if
<code class="literal">services.matrix-synapse.settings.redis.enabled</code> is set to <code class="literal">true</code>,
<code class="literal">&quot;redis&quot;</code> will be automatically added to the <code class="literal">extras</code> list of
<code class="literal">pkgs.matrix-synapse</code>.</p></li><li class="listitem"><p>A list of all extras (and the extras enabled by default) can be found at
the <a class="link" href="options.html#opt-services.matrix-synapse.extras"  >option’s reference for
<code class="literal">services.matrix-synapse.extras</code></a>.</p></li><li class="listitem"><p>In some cases (e.g. for running synapse workers) it was necessary to re-use
the <code class="literal">PYTHONPATH</code> of <code class="literal">matrix-synapse.service</code>’s environment to have all
plugins available. This isn’t necessary anymore, instead
<code class="literal">config.services.matrix-synapse.package</code> can be used as it points to the
wrapper with properly configured <code class="literal">extras</code> and also all plugins defined via
<a class="link" href="options.html#opt-services.matrix-synapse.plugins"  ><code class="literal">services.matrix-synapse.plugins</code></a>
available. This is also the reason for why the option is read-only now,
it’s supposed to be set by the module only.</p></li></ul></div></li><li class="listitem"><p><code class="literal">netbox</code> was updated to v3.6. <code class="literal">services.netbox.package</code> still defaults
to v3.5 if <code class="literal">stateVersion</code> is earlier than 23.11. Refer to upstream’s breaking
changes <a class="link" href="https://github.com/netbox-community/netbox/releases/tag/v3.6.0"  target="_top">for
v3.6.0</a> and
upgrade NetBox by changing <code class="literal">services.netbox.package</code>. Database migrations
will be run automatically.</p></li><li class="listitem"><p><code class="literal">etcd</code> has been updated to v3.5. Refer to upgrade guides for <a class="link" href="https://etcd.io/docs/v3.5/upgrades/upgrade_3_4/"  target="_top">v3.3 to
v3.4</a> and <a class="link" href="https://etcd.io/docs/v3.5/upgrades/upgrade_3_5/"  target="_top">v3.4 to
v3.5</a> for more details.</p></li><li class="listitem"><p><code class="literal">gitlab</code> installations created or updated between versions [15.11.0,
15.11.2] have an incorrect database schema. This will become a problem when
upgrading to <code class="literal">gitlab</code> &gt;=16.2.0. A workaround for affected users can be found
in the <a class="link" href="https://docs.gitlab.com/ee/update/versions/gitlab_16_changes.html#undefined-column-error-upgrading-to-162-or-later"  target="_top">GitLab
docs</a>.</p></li><li class="listitem"><p><code class="literal">consul</code> has been updated to v1.16.0. Refer to the <a class="link" href="https://github.com/hashicorp/consul/releases/tag/v1.16.0"  target="_top">release
note</a> for more
details. Once a new Consul version has started and upgraded it’s data
directory, it generally cannot be downgraded to the previous version.</p></li><li class="listitem"><p><code class="literal">llvmPackages_rocm</code> has been moved to <code class="literal">rocmPackages.llvm</code>.</p></li><li class="listitem"><p><code class="literal">hip</code>, <code class="literal">rocm-opencl-runtime</code>, <code class="literal">rocm-opencl-icd</code>, and <code class="literal">rocclr</code> have been
combined into <code class="literal">rocmPackages.clr</code>.</p></li><li class="listitem"><p><code class="literal">clang-ocl</code>, <code class="literal">clr</code>, <code class="literal">composable_kernel</code>, <code class="literal">hipblas</code>, <code class="literal">hipcc</code>, <code class="literal">hip-common</code>, <code class="literal">hipcub</code>,
<code class="literal">hipfft</code>, <code class="literal">hipfort</code>, <code class="literal">hipify</code>, <code class="literal">hipsolver</code>, <code class="literal">hipsparse</code>, <code class="literal">migraphx</code>, <code class="literal">miopen</code>, <code class="literal">miopengemm</code>,
<code class="literal">rccl</code>, <code class="literal">rdc</code>, <code class="literal">rocalution</code>, <code class="literal">rocblas</code>, <code class="literal">rocdgbapi</code>, <code class="literal">rocfft</code>, <code class="literal">rocgdb</code>, <code class="literal">rocm-cmake</code>,
<code class="literal">rocm-comgr</code>, <code class="literal">rocm-core</code>, <code class="literal">rocm-device-libs</code>, <code class="literal">rocminfo</code>, <code class="literal">rocmlir</code>, <code class="literal">rocm-runtime</code>,
<code class="literal">rocm-smi</code>, <code class="literal">rocm-thunk</code>, <code class="literal">rocprim</code>, <code class="literal">rocprofiler</code>, <code class="literal">rocrand</code>, <code class="literal">rocr-debug-agent</code>,
<code class="literal">rocsolver</code>, <code class="literal">rocsparse</code>, <code class="literal">rocthrust</code>, <code class="literal">roctracer</code>, <code class="literal">rocwmma</code>, and <code class="literal">tensile</code>
have been moved to <code class="literal">rocmPackages</code>.</p></li><li class="listitem"><p><code class="literal">himalaya</code> has been updated to v0.8.0, which drops the native TLS support
(in favor of Rustls) and add OAuth 2.0 support. Refer to the <a class="link" href="https://github.com/soywod/himalaya/releases/tag/v0.8.0"  target="_top">release
note</a> for more
details.</p></li><li class="listitem"><p><code class="literal">nix-prefetch-git</code> now ignores global and user git config, to improve
reproducibility.</p></li><li class="listitem"><p>The <a class="link" href="options.html#opt-services.caddy.acmeCA"  >services.caddy.acmeCA</a> option defaults
to <code class="literal">null</code> instead of <code class="literal">&quot;https://acme-v02.api.letsencrypt.org/directory&quot;</code> now.
To use all of Caddy’s default ACME CAs and enable Caddy’s automatic issuer
fallback feature by default, as recommended by upstream.</p></li><li class="listitem"><p>The default priorities of
<a class="link" href="options.html#opt-services.nextcloud.phpOptions"  ><code class="literal">services.nextcloud.phpOptions</code></a> have
changed. This means that e.g.
<code class="literal">services.nextcloud.phpOptions.&quot;opcache.interned_strings_buffer&quot; = &quot;23&quot;;</code>
doesn’t discard all of the other defaults from this option anymore. The
attribute values of <code class="literal">phpOptions</code> are still defaults, these can be overridden
as shown here.</p><p>To override all of the options (including including <code class="literal">upload_max_filesize</code>,
<code class="literal">post_max_size</code> and <code class="literal">memory_limit</code> which all point to
<a class="link" href="options.html#opt-services.nextcloud.maxUploadSize"  ><code class="literal">services.nextcloud.maxUploadSize</code></a>
by default) can be done like this:</p><pre><code class="programlisting nix">{
  services.nextcloud.phpOptions = lib.mkForce {
    /* ... */
  };
}
</code></pre></li><li class="listitem"><p><code class="literal">php80</code> is no longer supported due to upstream not supporting this version
anymore.</p></li><li class="listitem"><p>PHP defaults to PHP 8.2 now, updated from v8.1.</p></li><li class="listitem"><p>GraalVM has been updated to the latest version, and this brings significant
changes. Upstream don’t release multiple versions targeting different JVMs
anymore, so now we only have one GraalVM derivation (<code class="literal">graalvm-ce</code>). While at
first glance the version may seem a downgrade (v22.3.1 -&gt; v21.0.0), the major
version is now following the JVM it targets (so this latest version targets
JVM 21). Also some products like <code class="literal">llvm-installable-svm</code> and
<code class="literal">native-image-svm</code> were incorporate to the main GraalVM derivation, so
they’re included by default.</p></li><li class="listitem"><p>GraalPy (<code class="literal">graalCEPackages.graalpy</code>), TruffleRuby
(<code class="literal">graalCEPackages.truffleruby</code>), GraalJS (<code class="literal">graalCEPackages.graaljs</code>) and
GraalNodeJS (<code class="literal">grallCEPackages.graalnodejs</code>) are now independent from the main
GraalVM derivation.</p></li><li class="listitem"><p>The ISC DHCP package and corresponding module have been removed, because they
are EOL upstream. Refer <a class="link" href="https://www.isc.org/blogs/isc-dhcp-eol/"  target="_top">to this
post</a> for details and switch to a
different DHCP implementation like kea or dnsmasq.</p></li><li class="listitem"><p><code class="literal">prometheus-unbound-exporter</code> has been replaced by the Let’s Encrypt
maintained version, since the previous version was archived. This requires
some changes to the module configuration, most notable <code class="literal">controlInterface</code>
needs migration towards <code class="literal">unbound.host</code> and requires either the <code class="literal">tcp://</code> or
<code class="literal">unix://</code> URI scheme.</p></li><li class="listitem"><p><code class="literal">odoo</code> defaults to v16 now, updated from v15.</p></li><li class="listitem"><p><code class="literal">varnish</code> was upgraded from v7.2.x to v7.4.x. Refer to upgrade guides vor
<a class="link" href="https://varnish-cache.org/docs/7.3/whats-new/upgrading-7.3.html"  target="_top">v7.3</a> and
<a class="link" href="https://varnish-cache.org/docs/7.4/whats-new/upgrading-7.4.html"  target="_top">v7.4</a>. The
current LTS version is still offered as <code class="literal">varnish60</code>.</p></li><li class="listitem"><p><code class="literal">util-linux</code> is now supported on Darwin and is no longer an alias to
<code class="literal">unixtools</code>. Use the <code class="literal">unixtools.util-linux</code> package for access to the Apple
variants of the utilities.</p></li><li class="listitem"><p><code class="literal">services.keyd</code> changed API. Now you can create multiple configuration files.</p></li><li class="listitem"><p><code class="literal">baloo</code>, the file indexer and search engine used by KDE now has a patch to
prevent files from constantly being reindexed when the device IDs of the
their underlying storage change. This happens frequently when using btrfs or
LVM. The patch has not yet been accepted upstream but it provides a
significantly improved experience. When upgrading, reset baloo to get a clean
index: <code class="literal">balooctl disable ; balooctl purge ; balooctl enable</code>.</p></li><li class="listitem"><p>The <code class="literal">vlock</code> program from the <code class="literal">kbd</code> package has been moved into its own
package output and should now be referenced explicitly as <code class="literal">kbd.vlock</code> or
replaced with an alternative such as the standalone <code class="literal">vlock</code> package or
<code class="literal">physlock</code>.</p></li><li class="listitem"><p><code class="literal">fileSystems.&lt;name&gt;.autoFormat</code> now uses <code class="literal">systemd-makefs</code>, which does not
accept formatting options. Therefore, <code class="literal">fileSystems.&lt;name&gt;.formatOptions</code> has
been removed.</p></li><li class="listitem"><p><code class="literal">fileSystems.&lt;name&gt;.autoResize</code> uses <code class="literal">systemd-growfs</code> to resize the file
system online in Stage 2 now. This means that <code class="literal">f2fs</code> and <code class="literal">ext2</code> can no longer
be auto resized, while <code class="literal">xfs</code> and <code class="literal">btrfs</code> now can be.</p></li><li class="listitem"><p><code class="literal">fuse3</code> has been updated from v3.11.0 to v3.16.2. Refer to the
<a class="link" href="https://github.com/libfuse/libfuse/blob/fuse-3.16.2/ChangeLog.rst#libfuse-3162-2023-10-10"  target="_top">changelog</a>
for an overview of the changes.</p><p>Unsupported mount options are no longer silently accepted <a class="link" href="https://github.com/libfuse/libfuse/blob/fuse-3.16.2/ChangeLog.rst#libfuse-3150-2023-06-09"  target="_top">(since
3.15.0)</a>.
The <a class="link" href="https://github.com/libfuse/libfuse/commit/dba6b3983af34f30de01cf532dff0b66f0ed6045"  target="_top">affected mount
options</a>
are: <code class="literal">atime</code>, <code class="literal">diratime</code>, <code class="literal">lazytime</code>, <code class="literal">nolazytime</code>, <code class="literal">relatime</code>, <code class="literal">norelatime</code>,
<code class="literal">strictatime</code>.</p><p>For example,</p><pre><code class="programlisting bash">$ sshfs 127.0.0.1:/home/test/testdir /home/test/sshfs_mnt -o atime
</code></pre><p>would previously terminate successfully with the mount point established, now
it outputs the error message <code class="literal">fuse: unknown option(s): `-o atime&#x27;</code> and
terminates with exit status 1.</p></li><li class="listitem"><p><code class="literal">nixos-rebuild {switch,boot,test,dry-activate}</code> runs the system
activation inside <code class="literal">systemd-run</code> now, creating an ephemeral systemd service
and protecting the system switch against issues like network disconnections
during remote (e.g. SSH) sessions. This has the side effect of running the
switch in an isolated environment, that could possible break post-switch
scripts that depends on things like environment variables being set. If you
want to opt-out from this behavior for now, you may set the
<code class="literal">NIXOS_SWITCH_USE_DIRTY_ENV</code> environment variable before running
<code class="literal">nixos-rebuild</code>. However, keep in mind that this option will be removed in
the future.</p></li><li class="listitem"><p>The <code class="literal">services.vaultwarden.config</code> option default value was changed to make
Vaultwarden only listen on localhost, following the <a class="link" href="https://github.com/NixOS/nixpkgs/issues/100192"  target="_top">secure defaults for most
NixOS services</a>.</p></li><li class="listitem"><p><code class="literal">services.lemmy.settings.federation</code> was removed in v0.17.0 and no longer has
any effect. To enable federation, the hostname must be set in the
configuration file and then federation must be enabled in the admin web UI.
Refer to the <a class="link" href="https://github.com/LemmyNet/lemmy/blob/c32585b03429f0f76d1e4ff738786321a0a9df98/RELEASES.md#upgrade-instructions"  target="_top">release
notes</a>
for more details.</p></li><li class="listitem"><p><code class="literal">pict-rs</code> was upgraded from v0.3 to v0.4 and contains an incompatible database
&amp; configuration change. To upgrade on systems with <code class="literal">stateVersion = &quot;23.05&quot;;</code>
or older follow the migration steps from
https://git.asonix.dog/asonix/pict-rs#user-content-0-3-to-0-4-migration-guide
and set <code class="literal">services.pict-rs.package = pkgs.pict-rs;</code>.</p></li><li class="listitem"><p>The following packages in <code class="literal">haskellPackages</code> have a separate bin output now:
<code class="literal">cabal-fmt</code>, <code class="literal">calligraphy</code>, <code class="literal">eventlog2html</code>, <code class="literal">ghc-debug-brick</code>, <code class="literal">hindent</code>,
<code class="literal">nixfmt</code>, <code class="literal">releaser</code>. This means you need to replace e.g.
<code class="literal">&quot;${pkgs.haskellPackages.nixfmt}/bin/nixfmt&quot;</code> with <code class="literal">&quot;${lib.getBin pkgs.haskellPackages.nixfmt}/bin/nixfmt&quot;</code> or <code class="literal">&quot;${lib.getExe pkgs.haskellPackages.nixfmt}&quot;</code>. The binaries also won’t be in scope if you
rely on them being installed e.g. via <code class="literal">ghcWithPackages</code>.
<code class="literal">environment.packages</code> picks the <code class="literal">bin</code> output automatically, so for normal
installation no intervention is required. Also, toplevel attributes like
<code class="literal">pkgs.nixfmt</code> are not impacted negatively by this change.</p></li><li class="listitem"><p><code class="literal">spamassassin</code> no longer supports the <code class="literal">Hashcash</code> module. The module needs to
be removed from the <code class="literal">loadplugin</code> list if it was copied over from the default
<code class="literal">initPreConf</code> option.</p></li><li class="listitem"><p><code class="literal">nano</code> was removed from <code class="literal">environment.defaultPackages</code>. To not leave systems
without a editor, now <code class="literal">programs.nano.enable</code> is enabled by default.</p></li><li class="listitem"><p><code class="literal">programs.nano.nanorc</code> and <code class="literal">programs.nano.syntaxHighlight</code> no longer have an
effect unless <code class="literal">programs.nano.enable</code> is set to true which is the default.</p></li><li class="listitem"><p><code class="literal">services.outline.sequelizeArguments</code> has been removed, as <code class="literal">outline</code> no
longer executes database migrations via the <code class="literal">sequelize</code> cli.</p></li><li class="listitem"><p>The binary of the package <code class="literal">cloud-sql-proxy</code> has changed from
<code class="literal">cloud_sql_proxy</code> to <code class="literal">cloud-sql-proxy</code>.</p></li><li class="listitem"><p>The module <code class="literal">services.apache-kafka</code> was largely rewritten and has certain
breaking changes. To be precise, this means that the following things have
changed:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Most settings have been migrated to
<a class="link" href="options.html#opt-services.apache-kafka.settings"  >services.apache-kafka.settings</a>.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square;"><li class="listitem"><p>Care must be taken when adapting an existing cluster to these changes,
see <a class="xref" href="index.html#module-services-apache-kafka-migrating-to-settings" title="Migrating to settings" >the section called “Migrating to settings”</a>.</p></li></ul></div></li><li class="listitem"><p>By virtue of being less opinionated, it is now possible to use the module
to run Apache Kafka in KRaft mode instead of Zookeeper mode.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square;"><li class="listitem"><p><a class="link" href="index.html#module-services-apache-kafka-kraft" title="KRaft" >A few options</a> have been added to
assist in this mode.</p></li></ul></div></li></ul></div></li><li class="listitem"><p>Garage has been upgraded to v0.9.x. <code class="literal">services.garage.package</code> needs to be
explicitly set now, so version upgrades can be done in a controlled fashion.
For this, we expose <code class="literal">garage_x_y</code> attributes which can be set here.</p></li><li class="listitem"><p><code class="literal">voms</code> and <code class="literal">xrootd</code> now moves the <code class="literal">$out/etc</code> content to the <code class="literal">$etc</code> output
instead of <code class="literal">$out/etc.orig</code>, when input argument <code class="literal">externalEtc</code> is not <code class="literal">null</code>.</p></li><li class="listitem"><p>The <code class="literal">woodpecker-*</code> CI packages have been updated to v1.0.0. This release is
wildly incompatible with the v0.15.x versions that were previously packaged.
Refer to <a class="link" href="https://woodpecker-ci.org/docs/next/migrations#100"  target="_top">upstream’s
documentation</a> to learn
how to update your CI configurations.</p></li><li class="listitem"><p>Meilisearch was updated from v1.3.1 to v1.5.0. The update has breaking
changes about backslashes and filtering. Refer to the <a class="link" href="https://blog.meilisearch.com/v1-4-release/"  target="_top">release
announcement</a> for more
details.</p></li><li class="listitem"><p>The Caddy module gained a new option named <code class="literal">services.caddy.enableReload</code>
which is enabled by default. It allows reloading the service instead of
restarting it, if only a config file has changed. This option must be
disabled if you have turned off the <a class="link" href="https://caddyserver.com/docs/caddyfile/options#admin"  target="_top">Caddy admin
API</a>. If you keep this
option enabled, you should consider setting
<a class="link" href="https://caddyserver.com/docs/caddyfile/options#grace-period"  target="_top"><code class="literal">grace_period</code></a>
to a non-infinite value to prevent Caddy from delaying the reload
indefinitely.</p></li><li class="listitem"><p>mdraid support is optional now. This reduces initramfs size and prevents the
potentially undesired automatic detection and activation of software RAID
pools. It is disabled by default in new configurations (determined by
<code class="literal">stateVersion</code>), but the appropriate settings will be generated by
<code class="literal">nixos-generate-config</code> when installing to a software RAID device, so the
standard installation procedure should be unaffected. If you have custom
configs relying on mdraid, ensure that you use <code class="literal">stateVersion</code> correctly or
set <code class="literal">boot.swraid.enable</code> manually. On systems with an updated <code class="literal">stateVersion</code>
we now also emit warnings if <code class="literal">mdadm.conf</code> does not contain the minimum
required configuration necessary to run the dynamically enabled monitoring
daemons.</p></li><li class="listitem"><p>The <code class="literal">go-ethereum</code> package has been updated to v1.12.0. This drops support for
proof-of-work. Its GraphQL API now encodes all numeric values as hex strings
and the GraphQL UI is updated to v2.0. The default database has changed from
<code class="literal">leveldb</code> to <code class="literal">pebble</code> but <code class="literal">leveldb</code> can be forced with the
–db.engine=leveldb flag. The <code class="literal">checkpoint-admin</code> command was <a class="link" href="https://github.com/ethereum/go-ethereum/pull/27147"  target="_top">removed along
with trusted
checkpoints</a>.</p></li><li class="listitem"><p>The <code class="literal">aseprite-unfree</code> package has been upgraded from v1.2.16.3 to v1.2.40.
The free version of aseprite has been dropped because it is EOL and the
package attribute now points to the unfree version. A maintained fork of the
last free version of Aseprite, named ‘LibreSprite’, is available in the
<code class="literal">libresprite</code> package.</p></li><li class="listitem"><p>The default <code class="literal">kops</code> version is v1.28.0 now and support for v1.25 and older have
been dropped.</p></li><li class="listitem"><p><code class="literal">pharo</code> has been updated to latest stable v10.0.8, which is compatible with
the latest stable and oldstable images (Pharo 10 and 11). The VM in question
is the 64bit Spur. The 32bit version has been dropped due to lack of
maintenance. The Cog VM has been deleted because it is severely outdated.
Finally, the <code class="literal">pharo-launcher</code> package has been deleted because it was not
compatible with the newer VM, and due to lack of maintenance.</p></li><li class="listitem"><p>Emacs mainline v29 was introduced. This new version includes many major
additions, most notably <code class="literal">tree-sitter</code> support (enabled by default) and
the pgtk variant (useful for Wayland users), which is available under the
attribute <code class="literal">emacs29-pgtk</code>.</p></li><li class="listitem"><p>Emacs macport version 29 was introduced.</p></li><li class="listitem"><p>The option <code class="literal">services.networking.networkmanager.enableFccUnlock</code> was removed
in favor of <code class="literal">networking.networkmanager.fccUnlockScripts</code>, which allows
specifying unlock scripts explicitly. The previous option enabled all unlock
scripts bundled with ModemManager, which is risky, and didn’t allow using
vendor-provided unlock scripts at all.</p></li><li class="listitem"><p>The <code class="literal">html-proofer</code> package has been updated from major version 3 to major
version 5, which includes <a class="link" href="https://github.com/gjtorikian/html-proofer/blob/v5.0.8/UPGRADING.md"  target="_top">breaking
changes</a>.</p></li><li class="listitem"><p><code class="literal">kratos</code> has been updated from v0.10.1 to the first stable v1.0.0, please
read the <a class="link" href="https://github.com/ory/kratos/releases/tag/v0.11.0"  target="_top">v0.10.1 to
v0.11.0</a>, <a class="link" href="https://github.com/ory/kratos/releases/tag/v0.11.1"  target="_top">v0.11.0 to
v0.11.1</a>, <a class="link" href="https://github.com/ory/kratos/releases/tag/v0.13.0"  target="_top">v0.11.1 to
v0.13.0</a> and <a class="link" href="https://github.com/ory/kratos/releases/tag/v1.0.0"  target="_top">v0.13.0 to
v1.0.0</a> upgrade guides.
The most notable breaking change is the introduction of one-time passwords
(<code class="literal">code</code>) and update of the default recovery strategy from <code class="literal">link</code> to <code class="literal">code</code>.</p></li><li class="listitem"><p>The <code class="literal">hail</code> module was removed, as <code class="literal">hail</code> was unmaintained since 2017.</p></li><li class="listitem"><p>Package <code class="literal">noto-fonts-emoji</code> was renamed to <code class="literal">noto-fonts-color-emoji</code>. Refer to
<a class="link" href="https://github.com/NixOS/nixpkgs/issues/221181"  target="_top">PR #221181</a> for more
details.</p></li><li class="listitem"><p>Package <code class="literal">cloud-sql-proxy</code> was renamed to <code class="literal">google-cloud-sql-proxy</code> as it
cannot be used with other cloud providers.</p></li><li class="listitem"><p>Package <code class="literal">pash</code> was removed due to being archived upstream. Use <code class="literal">powershell</code>
as an alternative.</p></li><li class="listitem"><p>The option <code class="literal">services.plausible.releaseCookiePath</code> has been removed. Plausible
does not use any distributed Erlang features, and does not plan to (refer to
<a class="link" href="https://github.com/NixOS/nixpkgs/pull/130297#issuecomment-1805851333"  target="_top">discussion</a>),
Thus NixOS disables them now , and the Erlang cookie becomes unnecessary. You
may delete the file that <code class="literal">releaseCookiePath</code> was set to.</p></li><li class="listitem"><p><code class="literal">security.sudo.extraRules</code> includes <code class="literal">root</code>’s default rule now, with ordering
priority 400. This is functionally identical for users not specifying rule
order, or relying on <code class="literal">mkBefore</code> and <code class="literal">mkAfter</code>, but may impact users calling
<code class="literal">mkOrder n</code> with n ≤ 400.</p></li><li class="listitem"><p>X keyboard extension (XKB) options have been reorganized into a single
attribute set, <code class="literal">services.xserver.xkb</code>. Specifically,
<code class="literal">services.xserver.layout</code> is <code class="literal">services.xserver.xkb.layout</code> now,
<code class="literal">services.xserver.extraLayouts</code> is <code class="literal">services.xserver.xkb.extraLayouts</code> now,
<code class="literal">services.xserver.xkbModel</code> is <code class="literal">services.xserver.xkb.model</code> now,
<code class="literal">services.xserver.xkbOptions</code> is <code class="literal">services.xserver.xkb.options</code> now ,
<code class="literal">services.xserver.xkbVariant</code> is <code class="literal">services.xserver.xkb.variant</code> now, and
<code class="literal">services.xserver.xkbDir</code> is <code class="literal">services.xserver.xkb.dir</code> now.</p></li><li class="listitem"><p><code class="literal">networking.networkmanager.firewallBackend</code> was removed as NixOS is now using
iptables-nftables-compat even when using iptables, therefore Networkmanager
uses the nftables backend unconditionally now.</p></li><li class="listitem"><p><code class="literal">rome</code> was removed because it is no longer maintained and is succeeded by
<code class="literal">biome</code>.</p></li><li class="listitem"><p>The <code class="literal">prometheus-knot-exporter</code> was migrated to a version maintained by
CZ.NIC. Various metric names have changed, so checking existing rules is
recommended.</p></li><li class="listitem"><p>The <code class="literal">services.mtr-exporter.target</code> has been removed in favor of
<code class="literal">services.mtr-exporter.jobs</code> which allows specifying multiple targets.</p></li><li class="listitem"><p><code class="literal">blender-with-packages</code> has been deprecated in favor of
<code class="literal">blender.withPackages</code>, for example <code class="literal">blender.withPackages (ps: [ps.bpycv])</code>.
It behaves similarly to <code class="literal">python3.withPackages</code>.</p></li><li class="listitem"><p>Setting <code class="literal">nixpkgs.config</code> options while providing an external <code class="literal">pkgs</code> instance
will now raise an error instead of silently ignoring the options. NixOS
modules no longer set <code class="literal">nixpkgs.config</code> to accommodate this. This specifically
affects <code class="literal">services.locate</code>,
<code class="literal">services.xserver.displayManager.lightdm.greeters.tiny</code> and
<code class="literal">programs.firefox</code> NixOS modules. No manual intervention should be required
in most cases, however, configurations relying on those modules affecting
packages outside the system environment should switch to explicit overlays.</p></li><li class="listitem"><p><code class="literal">privacyidea</code> (and the corresponding <code class="literal">privacyidea-ldap-proxy</code>) has been
removed from nixpkgs because it has severely outdated dependencies that
became unmaintainable with nixpkgs’ python package-set.</p></li><li class="listitem"><p><code class="literal">dagger</code> was removed because using a package called <code class="literal">dagger</code> and packaging it
from source violates their trademark policy.</p></li><li class="listitem"><p><code class="literal">win-virtio</code> package was renamed to <code class="literal">virtio-win</code> to be consistent with the upstream package name.</p></li><li class="listitem"><p><code class="literal">ps3netsrv</code> has been replaced with the webman-mod fork, the executable has
been renamed from <code class="literal">ps3netsrv++</code> to <code class="literal">ps3netsrv</code> and cli parameters have
changed.</p></li><li class="listitem"><p><code class="literal">ssm-agent</code> package and module were renamed to <code class="literal">amazon-ssm-agent</code> to be
consistent with the upstream package name.</p></li><li class="listitem"><p><code class="literal">services.kea.{ctrl-agent,dhcp-ddns,dhcp,dhcp6}</code> now use separate runtime
directories instead of <code class="literal">/run/kea</code> to work around the runtime directory being
cleared on service start.</p></li><li class="listitem"><p><code class="literal">mkDerivation</code> rejects MD5 hashes now.</p></li><li class="listitem"><p>The <code class="literal">junicode</code> font package has been updated to <a class="link" href="https://github.com/psb1558/Junicode-font/releases/tag/v2.001"  target="_top">major
v2</a>, which is
a font family now. In particular, plain <code class="literal">Junicode.ttf</code> no longer exists. In
addition, TrueType font files are now placed in <code class="literal">font/truetype</code> instead of
<code class="literal">font/junicode-ttf</code>; this change does not affect use via <code class="literal">fonts.packages</code>
option.</p></li><li class="listitem"><p>The <code class="literal">prayer</code> package as well as <code class="literal">services.prayer</code> have been removed because
it’s been unmaintained for several years and the author’s website has
vanished.</p></li><li class="listitem"><p>The <code class="literal">chrony</code> NixOS module now tracks the real-time clock drift from the
system clock with <code class="literal">rtcfile</code> and automatically adjusts it with <code class="literal">rtcautotrim</code>
when it exceeds the maximum error specified in
<code class="literal">services.chrony.autotrimThreshold</code> (defaults to 30 seconds). If you enabled
<code class="literal">rtcsync</code> in <code class="literal">extraConfig</code>, you should remove RTC related options from
<code class="literal">extraConfig</code>. If you do not want chrony configured to keep the RTC in check,
you can set <code class="literal">services.chrony.enableRTCTrimming = false;</code>.</p></li><li class="listitem"><p><code class="literal">trilium-desktop</code> and <code class="literal">trilium-server</code> have been updated to
<a class="link" href="https://github.com/zadam/trilium/releases/tag/v0.61.12"  target="_top">v0.61</a>. For existing
installations, upgrading to this version is supported only after running
v0.60.x at least once. If you are still on an older version, make sure to
update to v0.60 (available in NixOS 23.05) first and only then to v0.61
(available in NixOS 23.11).</p></li><li class="listitem"><p>Cassandra now defaults to v4.x, updated from v3.11.x.</p></li><li class="listitem"><p>FoundationDB now defaults to major version 7.</p></li><li class="listitem"><p><a class="link" href="https://www.gnu.org/software/libc/"  target="_top">glibc</a> has been updated from v2.37 to
v2.38. Refer to the <a class="link" href="https://sourceware.org/glibc/wiki/Release/2.38"  target="_top">the release
notes</a> for more details.</p></li><li class="listitem"><p><code class="literal">linuxPackages_testing_bcachefs</code> is now soft-deprecated by
<code class="literal">linuxPackages_testing</code>.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Please consider changing your NixOS configuration’s <code class="literal">boot.kernelPackages</code>
to <code class="literal">linuxPackages_testing</code> until a stable kernel with bcachefs support is
released.</p></li></ul></div></li><li class="listitem"><p>PostgreSQL now defaults to major version 15.</p></li><li class="listitem"><p>All <a class="link" href="https://rocm.docs.amd.com/en/latest/"  target="_top">ROCm</a> packages have been updated
to v5.7.0.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><a class="link" href="https://rocm.docs.amd.com/en/latest/"  target="_top">ROCm</a> package attribute sets are
versioned: <code class="literal">rocmPackages</code> -&gt; <code class="literal">rocmPackages_5</code>.</p></li></ul></div></li><li class="listitem"><p><a class="link" href="https://systemd.io"  target="_top">systemd</a> has been updated from v253 to v254, refer to
<a class="link" href="https://github.com/systemd/systemd/blob/v254/NEWS#L3-L659"  target="_top">the release
notes</a> for more
details.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">boot.resumeDevice</code> <span class="strong"><strong>must be specified</strong></span> when hibernating if not in EFI
mode.</p></li><li class="listitem"><p>systemd may warn your system about the permissions of your ESP partition
(often <code class="literal">/boot</code>), this warning can be ignored for now, we are looking into
a satisfying solution regarding this problem.</p></li><li class="listitem"><p>Updating with <code class="literal">nixos-rebuild boot</code> and rebooting is recommended, since in
some rare cases the <code class="literal">nixos-rebuild switch</code> into the new generation on a
live system might fail due to missing mount units.</p></li></ul></div></li><li class="listitem"><p>If the user has a custom shell enabled via <code class="literal">users.users.${USERNAME}.shell = ${CUSTOMSHELL}</code>, the assertion will require them to also set
<code class="literal">programs.${CUSTOMSHELL}.enable = true</code>. This is generally safe behavior, but
for anyone needing to opt out from the check
<code class="literal">users.users.${USERNAME}.ignoreShellProgramCheck = true</code> will do the job.</p></li><li class="listitem"><p><code class="literal">yarn-berry</code> has been updated to v4.0.1. This means that NodeJS versions less
v18.12 are no longer supported by it. Refer to the <a class="link" href="https://github.com/yarnpkg/berry/blob/master/CHANGELOG.md"  target="_top">upstream
changelog</a> for
more details.</p></li><li class="listitem"><p>GNOME has been updated to v45. Refer to the <a class="link" href="https://release.gnome.org/45/"  target="_top">release
notes</a> for more details. Notably, Loupe has
replaced Eye of GNOME as the default image viewer, Snapshot has replaced
Cheese as the default camera application, and Photos will no longer be
installed.</p></li><li class="listitem"><p>The module <code class="literal">services.ankisyncd</code> has been switched to
<a class="link" href="https://github.com/ankicommunity/anki-sync-server-rs"  target="_top">anki-sync-server-rs</a>.
The former version written in Python was difficult to update, did not receive
updates in a while, and did not support recent versions of Anki.</p><p>Unfortunately all servers supporting new clients do not support the older
sync protocol that was used in the old server. This includes newer version of
anki-sync-server, Anki’s built in sync server and this new Rust package. Thus
old clients will also need updating. In particular nixpkgs’s Anki package is
also being updated in this release.</p><p>The module update takes care of the new config syntax. The data itself (i.e.
user login and card information) is compatible. Thus users of the module will
be able to simply log in again after updating both client and server without
any extra action needed to be taken.</p></li><li class="listitem"><p>The argument <code class="literal">vendorSha256</code> of <code class="literal">buildGoModule</code> is deprecated. Use
<code class="literal">vendorHash</code> instead. Refer to <a class="link" href="https://github.com/NixOS/nixpkgs/pull/259999"  target="_top">PR
#259999</a>) for more details.</p></li><li class="listitem"><p><code class="literal">go-modules</code> in <code class="literal">buildGoModule</code> attrs has been renamed to <code class="literal">goModules</code>.</p></li><li class="listitem"><p>The package <code class="literal">cawbird</code> is dropped from nixpkgs. It broke by the Twitter API
closing down and has been abandoned upstream.</p></li><li class="listitem"><p>The Cinnamon module now enables XDG desktop integration by default. If you
are experiencing collisions related to xdg-desktop-portal-gtk you can safely
remove <code class="literal">xdg.portal.extraPortals = [ pkgs.xdg-desktop-portal-gtk ];</code> from your
NixOS configuration.</p></li><li class="listitem"><p>GNOME, Pantheon, Cinnamon modules no longer force Qt applications to use
Adwaita style. This implemantion  was buggy and is no longer maintained
upstream. Specifically, Cinnamon defaults to the gtk2 style instead now,
following the default in Linux Mint). If you still want Adwaita used, you may
add the following options to your configuration. Please be aware, that it
will probably be removed eventually.</p><pre><code class="programlisting nix">{
  qt = {
    enable = true;
    platformTheme = &quot;gnome&quot;;
    style = &quot;adwaita&quot;;
  };
}
</code></pre></li><li class="listitem"><p>DocBook option documentation is no longer supported, all module documentation
now uses Markdown.</p></li><li class="listitem"><p>Docker defaults to v24 now, as 20.10 is stopping to receive security updates
and bug fixes after <a class="link" href="https://github.com/moby/moby/discussions/45104"  target="_top">December 10,
2023</a>.</p></li><li class="listitem"><p>Elixir defaults to v1.15 now. Refer to their
<a class="link" href="https://elixir-lang.org/blog/2023/06/19/elixir-v1-15-0-released/"  target="_top">changelog</a>
for more details.</p></li><li class="listitem"><p>The <code class="literal">extend</code> function of <code class="literal">llvmPackages</code> has been removed due it coming from
the <code class="literal">tools</code> attrset thus only extending the <code class="literal">tool</code> attrset. A possible
replacement is to construct the set from <code class="literal">libraries</code> and <code class="literal">tools</code>, or patch
nixpkgs.</p></li><li class="listitem"><p><code class="literal">ffmpeg</code> defaults to <code class="literal">ffmpeg_6</code> now, upgrading from <code class="literal">ffmpeg_5</code>.</p></li><li class="listitem"><p><code class="literal">fontconfig</code> defaults to using greyscale antialiasing now. Previously
subpixel antialiasing was used because of a <a class="link" href="https://gitlab.freedesktop.org/fontconfig/fontconfig/-/issues/337"  target="_top">recommendation from one of the
downstreams</a>.
You can change this value by configuring
<a class="xref" href="options.html#opt-fonts.fontconfig.subpixel.rgba"  ><code class="option">fonts.fontconfig.subpixel.rgba</code></a> accordingly.</p></li><li class="listitem"><p>The <code class="literal">fonts.fonts</code> and <code class="literal">fonts.enableDefaultFonts</code> options have been renamed to
<code class="literal">fonts.packages</code> and <code class="literal">fonts.enableDefaultPackages</code> respectively.</p></li><li class="listitem"><p><code class="literal">services.hedgedoc</code> has been heavily refactored, reducing the amount of
declared options in the module. Most of the options should still work without
any changes to the configuration. Some options have been deprecated, as they
no longer have any effect. Refer to <a class="link" href="https://github.com/NixOS/nixpkgs/pull/244941"  target="_top">PR
#244941</a> for more details.</p></li><li class="listitem"><p><code class="literal">jq</code> was updated to v1.7. This is its <a class="link" href="https://github.com/jqlang/jq/releases/tag/jq-1.7"  target="_top">first release in 5
years</a>.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.attrsets.foldlAttrs"  target="_top"><code class="literal">lib.attrsets.foldlAttrs</code></a>
now always evaluates the initial accumulator argument first.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.lists.foldl-prime"  target="_top"><code class="literal">lib.lists.foldl&#x27;</code></a>
now always evaluates the initial accumulator argument first. If you depend on
the lazier behavior, consider using
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.lists.foldl"  target="_top"><code class="literal">lib.lists.foldl</code></a>
or
<a class="link" href="https://nixos.org/manual/nix/stable/language/builtins.html#builtins-foldl&#x27;"  target="_top"><code class="literal">builtins.foldl&#x27;</code></a>
instead.</p></li><li class="listitem"><p>Now <code class="literal">magma</code> defaults to <code class="literal">magma-hip</code> instead of <code class="literal">magma-cuda</code>. It also
respects the <code class="literal">config.cudaSupport</code> and <code class="literal">config.rocmSupport</code> options.</p></li><li class="listitem"><p>The MariaDB C client library was upgraded from v3.2.x to v3.3.x. Refer to the
<a class="link" href="https://mariadb.com/kb/en/mariadb-connector-c-33-release-notes/"  target="_top">upstream release
notes</a> for
more details.</p></li><li class="listitem"><p>Mattermost has been upgraded to extended support version 8.1 as the previously
packaged extended support version 7.8 is <a class="link" href="https://docs.mattermost.com/upgrade/extended-support-release.html"  target="_top">reaching end-of-life</a>.
Migration may take some time, refer to the <a class="link" href="https://docs.mattermost.com/install/self-managed-changelog.html#release-v8-1-extended-support-release"  target="_top">changelog</a>
and <a class="link" href="https://docs.mattermost.com/upgrade/important-upgrade-notes.html"  target="_top">important upgrade notes</a>.</p></li><li class="listitem"><p>The <code class="literal">netdata</code> package disables cloud support by default now. To enable it use the <code class="literal">netdataCloud</code> package.</p></li><li class="listitem"><p><code class="literal">networking.nftables</code> is no longer flushing all rulesets on every reload.
Use <code class="literal">networking.nftables.flushRuleset = true;</code> to enable the previous behaviour.</p></li><li class="listitem"><p>Node.js v14, v16 has been removed as they were end of life. Any dependent packages that contributors were not able to reasonably upgrade were dropped after a month of notice to their maintainers, were <span class="strong"><strong>removed</strong></span>.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>This includes VSCode Server.</p></li><li class="listitem"><p>This includes Kibana 7 as the ELK stack is unmaintained in nixpkgs and is marked for slow removal.</p></li></ul></div></li><li class="listitem"><p>The application firewall <code class="literal">opensnitch</code> uses the process monitor method eBPF as
default now. This is recommended by upstream. The method may be changed with
the setting
<a class="link" href="options.html#opt-services.opensnitch.settings.ProcMonitorMethod"  >services.opensnitch.settings.ProcMonitorMethod</a>.</p></li><li class="listitem"><p><code class="literal">paperwork</code> is updated to v2.2. Documents scanned with this version will not
be visible to previous versions if you downgrade. Refer to the <a class="link" href="https://forum.openpaper.work/t/paperwork-2-2-testing-phase/316#important-switch-from-jpeg-to-png-for-new-pages-2"  target="_top">upstream
announcement</a>
for details and workarounds.</p></li><li class="listitem"><p>The latest available version of Nextcloud is v27 (available as
<code class="literal">pkgs.nextcloud27</code>). The installation logic is as follows:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>If <a class="link" href="options.html#opt-services.nextcloud.package"  ><code class="literal">services.nextcloud.package</code></a> is
specified explicitly, this package will be installed (<span class="strong"><strong>recommended</strong></span>)</p></li><li class="listitem"><p>If <a class="link" href="options.html#opt-system.stateVersion"  ><code class="literal">system.stateVersion</code></a> is &gt;=23.11,
<code class="literal">pkgs.nextcloud27</code> will be installed by default.</p></li><li class="listitem"><p>If <a class="link" href="options.html#opt-system.stateVersion"  ><code class="literal">system.stateVersion</code></a> is &gt;=23.05,
<code class="literal">pkgs.nextcloud26</code> will be installed by default.</p></li><li class="listitem"><p>Please note that an upgrade from v25 (or older) to v27 is not possible
directly. Please upgrade to <code class="literal">nextcloud26</code> (or earlier) first. Nextcloud
prohibits skipping major versions while upgrading. You may upgrade by
declaring <a class="link" href="options.html#opt-services.nextcloud.package"  target="_top"><code class="literal">services.nextcloud.package = pkgs.nextcloud26;</code></a> inbetween.</p></li></ul></div></li><li class="listitem"><p><code class="literal">postgresql_11</code> has been removed since it’ll stop receiving fixes on November
9th 2023.</p></li><li class="listitem"><p><code class="literal">programs.gnupg.agent.pinentryFlavor</code> is set in <code class="literal">/etc/gnupg/gpg-agent.conf</code>
now. It will no longer take precedence over a <code class="literal">pinentry-program</code> set in
<code class="literal">~/.gnupg/gpg-agent.conf</code>.</p></li><li class="listitem"><p><code class="literal">python3.pkgs.flitBuildHook</code> has been removed. Use <code class="literal">flit-core</code> and <code class="literal">format = &quot;pyproject&quot;</code> instead.</p></li><li class="listitem"><p>Certificate generation via the <code class="literal">security.acme</code> limits the concurrent number
of running certificate renewals and generation jobs now. This is to avoid
spiking resource usage when processing many certificates at once. The limit
defaults to <span class="emphasis"><em>5</em></span> and can be adjusted via <code class="literal">maxConcurrentRenewals</code>. Setting the
value to <span class="emphasis"><em>0</em></span> disables the limits altogether.</p></li><li class="listitem"><p><code class="literal">services.borgmatic.settings.location</code> and
<code class="literal">services.borgmatic.configurations.&lt;name&gt;.location</code> are deprecated, please
move your options out of sections to the global scope.</p></li><li class="listitem"><p><code class="literal">services.fail2ban.jails</code> can be configured with attribute sets now, defining
settings and filters instead of lines. The stringed options <code class="literal">daemonConfig</code>
and <code class="literal">extraSettings</code> have respectively been replaced by <code class="literal">daemonSettings</code> and
<code class="literal">jails.DEFAULT.settings</code>. Those  use attribute sets.</p></li><li class="listitem"><p>The <code class="literal">services.mbpfan</code> module has the option <code class="literal">aggressive</code> enabled by default
now. This is for better heat moderation. To get the upstream defaults you may
disable this.</p></li><li class="listitem"><p>Apptainer/Singularity defaults to using <code class="literal">&quot;$out/var/lib&quot;</code> for the
<code class="literal">LOCALSTATEDIR</code> configuration option instead of the top-level <code class="literal">&quot;/var/lib&quot;</code>
now. This change impacts the <code class="literal">SESSIONDIR</code> (container-run-time mount point)
configuration, which is set to <code class="literal">$LOCALSTATEDIR/&lt;apptainer or singularity&gt;/mnt/session</code>. This detaches the packages from the top-level
directory, rendering the NixOS module optional.</p><p>The default behavior of the NixOS module <code class="literal">programs.singularity</code> stays
unchanged. We add a new option
<code class="literal">programs.singularity.enableExternalSysConfDir</code> (default to <code class="literal">true</code>) to
specify whether to set the top-level <code class="literal">&quot;/var/lib&quot;</code> as <code class="literal">LOCALSTATEDIR</code> or not.</p></li><li class="listitem"><p>The <code class="literal">services.sslh</code> module has been updated to follow <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md"  target="_top">RFC
0042</a>.
As such, several options have been moved to the freeform attribute set
<a class="link" href="options.html#opt-services.sslh.settings"  >services.sslh.settings</a>, which allows to change
any of the settings in <span class="citerefentry"><span class="refentrytitle">sslh</span>(8)</span>.</p><p>In addition, the newly added option
<a class="link" href="options.html#opt-services.sslh.method"  >services.sslh.method</a> allows to switch between
the <span class="citerefentry"><span class="refentrytitle">fork</span>(2)</span>, <span class="citerefentry"><span class="refentrytitle">select</span>(2)</span> and <code class="literal">libev</code>-based connection
handling method. Refer to the <a class="link" href="https://github.com/yrutschle/sslh/blob/master/doc/INSTALL.md#binaries"  target="_top">sslh
docs</a>
for a comparison.</p></li><li class="listitem"><p>Suricata was upgraded from v6.0 to v7.0 and no longer considers HTTP/2
support as experimental. Refer to <a class="link" href="https://forum.suricata.io/t/suricata-7-0-0-released/3715"  target="_top">upstream release
notes</a> for more
details.</p></li><li class="listitem"><p><code class="literal">teleport</code> has been upgraded from major version 12 to major version 14.
Refer to upstream <a class="link" href="https://goteleport.com/docs/management/operations/upgrading/"  target="_top">upgrade
instructions</a>
and release notes for
<a class="link" href="https://goteleport.com/docs/changelog/#1300-050823"  target="_top">v13</a> and
<a class="link" href="https://goteleport.com/docs/changelog/#1400-092023"  target="_top">v14</a>. Note that Teleport
does not officially support upgrades across more than one major version at a
time. If you’re running Teleport server components, it is recommended to
first upgrade to an intermediate v13.x version by setting
<code class="literal">services.teleport.package = pkgs.teleport_13</code>. Afterwards, this option can
be removed to upgrade to the default version (14).</p></li><li class="listitem"><p><code class="literal">zfs</code> was updated from v2.1.x to v2.2.0, <a class="link" href="https://github.com/openzfs/zfs/releases/tag/zfs-2.2.0"  target="_top">enabling newer kernel support and
adding new features</a>.</p></li><li class="listitem"><p>The use of <code class="literal">sourceRoot = &quot;source&quot;;</code>, <code class="literal">sourceRoot = &quot;source/subdir&quot;;</code>, and
similar lines in package derivations using the default <code class="literal">unpackPhase</code> is
deprecated as it requires <code class="literal">unpackPhase</code> to always produce a directory named
“source”. Use <code class="literal">sourceRoot = src.name</code>, <code class="literal">sourceRoot = &quot;${src.name}/subdir&quot;;</code>,
or <code class="literal">setSourceRoot = &quot;sourceRoot=$(echo */subdir)&quot;;</code> or similar instead.</p></li><li class="listitem"><p>The <code class="literal">django</code> alias in the python package set was upgraded to Django v4.x.
Applications that consume Django should always pin their python environment
to a compatible major version, so they can move at their own pace.</p><pre><code class="programlisting nix">{
  python = python3.override {
    packageOverrides = self: super: {
      django = super.django_3;
    };
  };
}
</code></pre></li><li class="listitem"><p>The <code class="literal">qemu-vm.nix</code> module by default now identifies block devices via
persistent names available in <code class="literal">/dev/disk/by-*</code>. Because the rootDevice is
identified by its filesystem label, it needs to be formatted before the VM is
started. The functionality of automatically formatting the rootDevice in the
initrd is removed from the QEMU module. However, for tests that depend on
this functionality, a test utility for the scripted initrd is added
(<code class="literal">nixos/tests/common/auto-format-root-device.nix</code>). To use this in a NixOS
test, import the module, e.g. <code class="literal">imports = [ ./common/auto-format-root-device.nix ];</code> When you use the systemd initrd, you
can automatically format the root device by setting
<code class="literal">virtualisation.fileSystems.&quot;/&quot;.autoFormat = true;</code>.</p></li><li class="listitem"><p>The <code class="literal">electron</code> packages places its application files in
<code class="literal">$out/libexec/electron</code> instead of <code class="literal">$out/lib/electron</code> now. Packages using
electron-builder will fail to build and need to be adjusted by changing <code class="literal">lib</code>
to <code class="literal">libexec</code>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-release-23.11-nixos-new-services" class="title" >New Services   </h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://github.com/MCHPR/MCHPRS"  target="_top">MCHPRS</a>, a multithreaded Minecraft server
built for redstone. Available as
<a class="link" href="options.html#opt-services.mchprs.enable"  >services.mchprs</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/joohoi/acme-dns"  target="_top">acme-dns</a>, a limited DNS server to
handle ACME DNS challenges easily and securely. Available as
<a class="link" href="options.html#opt-services.acme-dns.enable"  >services.acme-dns</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/fatedier/frp"  target="_top">frp</a>, a fast reverse proxy to help you
expose a local server behind a NAT or firewall to the Internet. Available as
<a class="link" href="options.html#opt-services.frp.enable"  >services.frp</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/riverwm/river"  target="_top">river</a>, A dynamic tiling wayland
compositor. Available as <a class="link" href="options.html#opt-programs.river.enable"  >programs.river</a>.</p></li><li class="listitem"><p><a class="link" href="https://wayfire.org"  target="_top">wayfire</a>, a modular and extensible wayland compositor.
Available as <a class="link" href="options.html#opt-programs.wayfire.enable"  >programs.wayfire</a>.</p></li><li class="listitem"><p><a class="link" href="https://docs.mau.fi/bridges/go/whatsapp/index.html"  target="_top">mautrix-whatsapp</a>, a
Matrix-WhatsApp puppeting bridge. Available as
<a class="link" href="options.html#opt-services.mautrix-whatsapp.enable"  >services.mautrix-whatsapp</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/desbma/hddfancontrol"  target="_top">hddfancontrol</a>, a service to
regulate fan speeds based on hard drive temperature. Available as
<a class="link" href="options.html#opt-services.hddfancontrol.enable"  >services.hddfancontrol</a>.</p></li><li class="listitem"><p><a class="link" href="https://sr.ht/~kennylevinsen/seatd/"  target="_top">seatd</a>, A minimal seat management
daemon. Available as <a class="link" href="options.html#opt-services.seatd.enable"  >services.seatd</a>.</p></li><li class="listitem"><p><a class="link" href="https://gotosocial.org/"  target="_top">GoToSocial</a>, an ActivityPub social network server
written in Golang. Available as
<a class="link" href="options.html#opt-services.gotosocial.enable"  >services.gotosocial</a>.</p></li><li class="listitem"><p><a class="link" href="https://castopod.org/"  target="_top">Castopod</a>, an open-source hosting platform made for
podcasters who want to engage and interact with their audience. Available as
<a class="link" href="options.html#opt-services.castopod.enable"  >services.castopod</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/typesense/typesense"  target="_top">Typesense</a>, a fast, typo-tolerant
search engine for building delightful search experiences. Available as
<a class="link" href="options.html#opt-services.typesense.enable"  >services.typesense</a>.</p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://github.com/developersu/ns-usbloader/"  target="_top">NS-USBLoader</a>, an all-in-one
tool for managing Nintendo Switch homebrew. Available as
<a class="link" href="options.html#opt-programs.ns-usbloader.enable"  >programs.ns-usbloader</a>.</p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://github.com/gomods/athens"  target="_top">athens</a>, a Go module datastore and proxy. Available as <a class="link" href="options.html#opt-services.athens.enable"  >services.athens</a>.</p></li><li class="listitem"><p><a class="link" href="https://joinmobilizon.org/"  target="_top">Mobilizon</a>, a Fediverse platform for publishing
events. Available as <a class="link" href="options.html#opt-services.mobilizon.enable"  >services.mobilizon</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/anuko/timetracker"  target="_top">Anuko Time Tracker</a>, a simple, easy to
use, open source time tracking system. Available as
<a class="link" href="options.html#opt-services.anuko-time-tracker.enable"  >services.anuko-time-tracker</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/prometheus/mysqld_exporter"  target="_top">Prometheus MySQL exporter</a>, a
MySQL server exporter for Prometheus. Available as
<a class="link" href="options.html#opt-services.prometheus.exporters.mysqld.enable"  >services.prometheus.exporters.mysqld</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.librenms.org"  target="_top">LibreNMS</a>, a auto-discovering PHP/MySQL/SNMP based
network monitoring. Available as
<a class="link" href="options.html#opt-services.librenms.enable"  >services.librenms</a>.</p></li><li class="listitem"><p><a class="link" href="https://livebook.dev/"  target="_top">Livebook</a>, an interactive notebook with support for
Elixir, graphs, machine learning, and more. Available as
<a class="link" href="options.html#opt-services.livebook.enableUserService"  >services.livebook</a>.</p></li><li class="listitem"><p><a class="link" href="https://sitespeed.io"  target="_top">sitespeed-io</a>, a tool that can generate metrics such
as timings and diagnostics for websites. Available as
<a class="link" href="options.html#opt-services.sitespeed-io.enable"  >services.sitespeed-io</a>.</p></li><li class="listitem"><p><a class="link" href="https://stalw.art"  target="_top">stalwart-mail</a>, an all-in-one email server (SMTP, IMAP,
JMAP). Available as
<a class="link" href="options.html#opt-services.stalwart-mail.enable"  >services.stalwart-mail</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/latchset/tang"  target="_top">tang</a>, a server for binding data to
network presence. Available as <a class="link" href="options.html#opt-services.tang.enable"  >services.tang</a>.</p></li><li class="listitem"><p><a class="link" href="https://nicmx.github.io/Jool/en/index.html"  target="_top">Jool</a>, a kernelspace NAT64 and
SIIT implementation providing translation between IPv4 and IPv6. Available as
<a class="link" href="options.html#opt-networking.jool.enable"  >networking.jool.enable</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/synesthesiam/homeassistant-satellite"  target="_top">Home Assistant
Satellite</a>, a
streaming audio satellite for Home Assistant voice pipelines, where you can
reuse existing mic and speaker hardware. Available as
<code class="literal">services.homeassistant-satellite</code>.</p></li><li class="listitem"><p><a class="link" href="https://guacamole.apache.org/"  target="_top">Apache Guacamole</a>, a cross-platform,
clientless remote desktop gateway. Available as
<a class="link" href="options.html#opt-services.guacamole-server.enable"  >services.guacamole-server</a> and
<a class="link" href="options.html#opt-services.guacamole-client.enable"  >services.guacamole-client</a> services.</p></li><li class="listitem"><p><a class="link" href="https://www.pgbouncer.org"  target="_top">pgBouncer</a>, a PostgreSQL connection pooler.
Available as <a class="link" href="options.html#opt-services.pgbouncer.enable"  >services.pgbouncer</a>.</p></li><li class="listitem"><p><a class="link" href="https://goss.rocks/"  target="_top">Goss</a>, a YAML based serverspec alternative tool for
validating a server’s configuration. Available as
<a class="link" href="options.html#opt-services.goss.enable"  >services.goss</a>.</p></li><li class="listitem"><p><a class="link" href="https://trust-dns.org/"  target="_top">trust-dns</a>, a Rust based DNS server built to be safe
and secure from the ground up. Available as
<code class="literal">services.trust-dns</code>.</p></li><li class="listitem"><p><a class="link" href="https://www.osquery.io/"  target="_top">osquery</a>, a SQL powered operating system
instrumentation, monitoring, and analytics. Available as
<a class="link" href="options.html#opt-services.osquery.enable"  >services.osquery</a>.</p></li><li class="listitem"><p><a class="link" href="https://ebusd.eu"  target="_top">ebusd</a>, a daemon for handling communication with eBUS
devices connected to a 2-wire bus system (“energy bus” used by numerous
heating systems). Available as <a class="link" href="options.html#opt-services.ebusd.enable"  >services.ebusd</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.freedesktop.org/software/systemd/man/systemd-sysupdate.html"  target="_top">systemd-sysupdate</a>,
atomically updates the host OS, container images, portable service images or
other sources. Available as <a class="link" href="opt-systemd.sysupdate"  target="_top">systemd.sysupdate</a>.</p></li><li class="listitem"><p><a class="link" href="https://codeberg.org/eris/eris-go"  target="_top">eris-server</a>, an implementation of the
Encoding for Robust Immutable Storage (ERIS). Available as
<a class="link" href="options.html#opt-services.eris-server.enable"  >services.eris-server</a>.</p></li><li class="listitem"><p><a class="link" href="https://forgejo.org/"  target="_top">forgejo</a>, a git forge and drop-in replacement for
Gitea. Available as <a class="link" href="options.html#opt-services.forgejo.enable"  >services.forgejo</a>.</p></li><li class="listitem"><p><code class="literal">hardware/infiniband.nix</code> adds infiniband subnet manager support using an
<a class="link" href="https://github.com/linux-rdma/opensm"  target="_top">opensm</a> systemd-template service,
instantiated on card guids. The module also adds kernel modules and cli
tooling to help administrators debug and measure performance. Available as
<a class="link" href="options.html#opt-hardware.infiniband.enable"  >hardware.infiniband.enable</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/zwave-js/zwave-js-server"  target="_top">zwave-js</a>, a small server
wrapper around Z-Wave JS to access it via a WebSocket. Available as
<a class="link" href="options.html#opt-services.zwave-js.enable"  >services.zwave-js</a>.</p></li><li class="listitem"><p><a class="link" href="https://humungus.tedunangst.com/r/honk"  target="_top">Honk</a>, a complete ActivityPub server
with minimal setup and support costs. Available as
<a class="link" href="options.html#opt-services.honk.enable"  >services.honk</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.ferretdb.io/"  target="_top">ferretdb</a>, an open-source proxy, converting the
MongoDB 6.0+ wire protocol queries to PostgreSQL or SQLite. Available as
<a class="link" href="options.html#opt-services.ferretdb.enable"  target="_top">services.ferretdb</a>.</p></li><li class="listitem"><p><a class="link" href="https://microbin.eu/"  target="_top">MicroBin</a>, a feature rich, performant and secure text
and file sharing web application, a “paste bin”. Available as
<a class="link" href="options.html#opt-services.microbin.enable"  >services.microbin</a>.</p></li><li class="listitem"><p><a class="link" href="http://www.nncpgo.org/"  target="_top">NNCP</a>, nncp-daemon and nncp-caller services.
Available as <a class="link" href="options.html#opt-programs.nncp.settings"  >programs.nncp.settings</a> and
<a class="link" href="options.html#opt-services.nncp.caller.enable"  >services.nncp</a>.</p></li><li class="listitem"><p><a class="link" href="https://fastnetmon.com/product-overview/"  target="_top">FastNetMon Advanced</a>, a commercial
high performance DDoS detector and sensor. Available as
<a class="link" href="options.html#opt-services.fastnetmon-advanced.enable"  >services.fastnetmon-advanced</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/AaronErhardt/tuxedo-rs"  target="_top">tuxedo-rs</a>, Rust utilities for
interacting with hardware from TUXEDO Computers. Available as
<a class="link" href="options.html#opt-hardware.tuxedo-rs.enable"  >hardware.tuxedo-rs</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/SSLMate/certspotter"  target="_top">certspotter</a>, a certificate
transparency log monitor. Available as
<a class="link" href="options.html#opt-services.certspotter.enable"  >services.certspotter</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/advplyr/audiobookshelf/"  target="_top">audiobookshelf</a>, a self-hosted
audiobook and podcast server. Available as
<a class="link" href="options.html#opt-services.audiobookshelf.enable"  >services.audiobookshelf</a>.</p></li><li class="listitem"><p><a class="link" href="https://zitadel.com"  target="_top">ZITADEL</a>, a turnkey identity and access management
platform. Available as <a class="link" href="options.html#opt-services.zitadel.enable"  >services.zitadel</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/onedr0p/exportarr"  target="_top">exportarr</a>, Prometheus Exporters for
Bazarr, Lidarr, Prowlarr, Radarr, Readarr, and Sonarr. Available as
<a class="link" href="options.html#opt-services.prometheus.exporters.exportarr-bazarr.enable"  >services.prometheus.exporters.exportarr-bazarr</a>/<a class="link" href="options.html#opt-services.prometheus.exporters.exportarr-lidarr.enable"  >services.prometheus.exporters.exportarr-lidarr</a>/<a class="link" href="options.html#opt-services.prometheus.exporters.exportarr-prowlarr.enable"  >services.prometheus.exporters.exportarr-prowlarr</a>/<a class="link" href="options.html#opt-services.prometheus.exporters.exportarr-radarr.enable"  >services.prometheus.exporters.exportarr-radarr</a>/<a class="link" href="options.html#opt-services.prometheus.exporters.exportarr-readarr.enable"  >services.prometheus.exporters.exportarr-readarr</a>/<a class="link" href="options.html#opt-services.prometheus.exporters.exportarr-sonarr.enable"  >services.prometheus.exporters.exportarr-sonarr</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/gravitl/netclient"  target="_top">netclient</a>, an automated WireGuard
Management Client. Available as
<a class="link" href="options.html#opt-services.netclient.enable"  >services.netclient</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/ctron/trunk"  target="_top">trunk-ng</a>, A fork of <code class="literal">trunk</code>: Build, bundle
&amp; ship your Rust WASM application to the web</p></li><li class="listitem"><p><a class="link" href="https://virt-manager.org/"  target="_top">virt-manager</a>, an UI for managing virtual
machines in libvirt. Available as
<a class="link" href="options.html#opt-programs.virt-manager.enable"  >programs.virt-manager</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/charmbracelet/soft-serve"  target="_top">Soft Serve</a>, a tasty,
self-hostable Git server for the command line. Available as
<a class="link" href="options.html#opt-services.soft-serve.enable"  >services.soft-serve</a>.</p></li><li class="listitem"><p><a class="link" href="https://rosenpass.eu/"  target="_top">Rosenpass</a>, a service for post-quantum-secure VPNs
with WireGuard. Available as
<a class="link" href="options.html#opt-services.rosenpass.enable"  >services.rosenpass</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/c2FmZQ/c2FmZQ/"  target="_top">c2FmZQ</a>, an application that can securely
encrypt, store, and share files, including but not limited to pictures and
videos. Available as
<a class="link" href="options.html#opt-services.c2fmzq-server.enable"  >services.c2fmzq-server</a>.</p></li><li class="listitem"><p><a class="link" href="http://sourceforge.net/projects/preload"  target="_top">preload</a>, a service that makes
applications run faster by prefetching binaries and shared objects.
Available as <a class="link" href="options.html#opt-services.preload.enable"  >services.preload</a>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-release-23.11-nixos-notable-changes" class="title" >Other Notable Changes   </h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The new option <code class="literal">system.switch.enable</code> was added. It is enabled by default.
Disabling it makes the system unable to be reconfigured via <code class="literal">nixos-rebuild</code>.
This is of advantage for image based appliances where updates are handled
outside the image.</p></li><li class="listitem"><p><code class="literal">services.searx</code> receives new options for better SearXNG support. This
includes options for the built-in rate limiter, bot protection and
automatically configuring a local Redis server.</p></li><li class="listitem"><p>The iptables firewall module installs the <code class="literal">nixos-firewall-tool</code> now which
allows the user to easily temporarily open ports through the firewall.</p></li><li class="listitem"><p>A new option was added to the virtualisation module that enables specifying
explicitly named network interfaces in QEMU VMs. The existing
<code class="literal">virtualisation.vlans</code> is still supported for cases where the name of the
network interface is irrelevant.</p></li><li class="listitem"><p><code class="literal">services.outline</code> can be configured to use local filesystem storage now.
Previously ony S3 storage was possible. This may be set using
<a class="link" href="options.html#opt-services.outline.storage.storageType"  >services.outline.storage.storageType</a>.</p></li><li class="listitem"><p><code class="literal">pkgs.openvpn3</code> optionally supports systemd-resolved now. <code class="literal">programs.openvpn3</code>
will automatically enable systemd-resolved support if
<a class="link" href="options.html#opt-services.resolved.enable"  >services.resolved.enable</a> is set to true.</p></li><li class="listitem"><p>The
<a class="link" href="options.html#opt-services.woodpecker-server.environmentFile"  >services.woodpecker-server.environmentFile</a>
type was changed to list of paths to be more consistent to the
woodpecker-agent module</p></li><li class="listitem"><p><code class="literal">services.matrix-synapse</code> has new options to configure worker processes for
matrix-synapse using
<a class="link" href="options.html#opt-services.matrix-synapse.workers"  ><code class="literal">services.matrix-synapse.workers</code></a>.
Configuring a local redis server using
<a class="link" href="options.html#opt-services.matrix-synapse.configureRedisLocally"  ><code class="literal">services.matrix-synapse.configureRedisLocally</code></a>
is also possible now.</p></li><li class="listitem"><p>The <code class="literal">services.nginx</code> module gained a <code class="literal">defaultListen</code> option at server-level
with support for PROXY protocol listeners. Also <code class="literal">proxyProtocol</code> is exposed in
the <code class="literal">services.nginx.virtualHosts.&lt;name&gt;.listen</code> option now. This it is
possible to run PROXY listeners and non-PROXY listeners at a server-level.
Refer to <a class="link" href="https://github.com/NixOS/nixpkgs/pull/213510/"  target="_top">PR #213510</a> for more
details.</p></li><li class="listitem"><p><code class="literal">services.restic.backups</code> adds wrapper scripts to your system path now. This
wrapper script sets the same environment variables as the service, so restic
operations can easily be run from the command line. This behavior can be
disabled by setting <code class="literal">createWrapper</code> to <code class="literal">false</code>, for each backup
configuration.</p></li><li class="listitem"><p><code class="literal">services.prometheus.exporters</code> has a new exporter to monitor electrical
power consumption based on PowercapRAPL sensor called
<a class="link" href="https://github.com/hubblo-org/scaphandre"  target="_top">Scaphandre</a>. Refer to <a class="link" href="https://github.com/NixOS/nixpkgs/pull/239803"  target="_top">PR
#239803</a> for more details.</p></li><li class="listitem"><p>The <code class="literal">services.calibre-server</code> module has new options to configure the <code class="literal">host</code>,
<code class="literal">port</code>, <code class="literal">auth.enable</code>, <code class="literal">auth.mode</code> and <code class="literal">auth.userDb</code> path. Refer to <a class="link" href="https://github.com/NixOS/nixpkgs/pull/216497/"  target="_top">PR
#216497</a> for more details.</p></li><li class="listitem"><p><code class="literal">services.prometheus.exporters</code> has a new
<a class="link" href="https://github.com/hipages/php-fpm_exporter"  target="_top">exporter</a> to monitor PHP-FPM
processes. Refer to <a class="link" href="https://github.com/NixOS/nixpkgs/pull/240394"  target="_top">PR
#240394</a> for more details.</p></li><li class="listitem"><p><code class="literal">services.github-runner</code> and <code class="literal">services.github-runners.&lt;name&gt;</code> gained the
option <code class="literal">nodeRuntimes</code>. This option defaults to <code class="literal">[ &quot;node20&quot; ]</code>.  I.e., the
service supports Node.js 20 GitHub Actions only. The list of Node.js versions
accepted by <code class="literal">nodeRuntimes</code> tracks the versions the upstream GitHub Actions
runner supports. Refer to <a class="link" href="https://github.com/NixOS/nixpkgs/pull/249103"  target="_top">PR
#249103</a> for details.</p></li><li class="listitem"><p><code class="literal">programs.gnupg</code> has the option <code class="literal">agent.settings</code> now. This allows setting
verbatim config values in <code class="literal">/etc/gnupg/gpg-agent.conf</code>.</p></li><li class="listitem"><p><code class="literal">dockerTools.buildImage</code>, <code class="literal">dockerTools.buildLayeredImage</code> and
<code class="literal">dockerTools.streamLayeredImage</code> use <code class="literal">lib.makeOverridable</code> now . This allows
<code class="literal">dockerTools</code>-based images to be customized more efficiently at the Nix
level.</p></li><li class="listitem"><p><code class="literal">services.influxdb2</code> supports doing an automatic initial setup and
provisioning of users, organizations, buckets and authentication tokens now.
Refer to <a class="link" href="https://github.com/NixOS/nixpkgs/pull/249502"  target="_top">PR #249502</a> for more
details.</p></li><li class="listitem"><p><code class="literal">wrapHelm</code> exposes <code class="literal">passthru.pluginsDir</code> now which can be passed to
<code class="literal">helmfile</code>. For convenience, a top-level package <code class="literal">helmfile-wrapped</code> has been
added, which inherits <code class="literal">passthru.pluginsDir</code> from <code class="literal">kubernetes-helm-wrapped</code>.
Refer to <a class="link" href="https://github.com/NixOS/nixpkgs/issues/217768"  target="_top">PR #217768</a> for
more details.</p></li><li class="listitem"><p>The <code class="literal">boot.initrd.network.udhcp.enable</code> option allows control over DHCP during
Stage 1 regardless of what <code class="literal">networking.useDHCP</code> is set to.</p></li><li class="listitem"><p><code class="literal">networking.nftables</code> has the option <code class="literal">networking.nftables.table.&lt;table&gt;</code> now. This creates tables
and have them be updated atomically, instead of flushing the ruleset.</p></li><li class="listitem"><p><code class="literal">hardware.nvidia</code> gained <code class="literal">datacenter</code> options for enabling NVIDIA Data Center
drivers and configuration of NVLink/NVSwitch topologies through
<code class="literal">nv-fabricmanager</code>.</p></li><li class="listitem"><p>The new <code class="literal">boot.bcache.enable</code> option allows completely removing <code class="literal">bcache</code>
mount support. It is enabled by default.</p></li><li class="listitem"><p><code class="literal">security.sudo</code> provides two extra options now, while not changing the
module’s default behaviour:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">defaultOptions</code> controls the options used for the default rules;</p></li><li class="listitem"><p><code class="literal">keepTerminfo</code> controls whether <code class="literal">TERMINFO</code> and <code class="literal">TERMINFO_DIRS</code> are preserved
for <code class="literal">root</code> and the <code class="literal">wheel</code> group.</p></li></ul></div></li><li class="listitem"><p><code class="literal">virtualisation.googleComputeImage</code> provides a <code class="literal">efi</code> option to support UEFI
booting now.</p></li><li class="listitem"><p>CoreDNS may be built with external plugins now. This may be done by
overriding <code class="literal">externalPlugins</code> and <code class="literal">vendorHash</code> arguments like this:</p><pre><code class="programlisting nix">{
  services.coredns = {
    enable = true;
    package = pkgs.coredns.override {
      externalPlugins = [
        {name = &quot;fanout&quot;; repo = &quot;github.com/networkservicemesh/fanout&quot;; version = &quot;v1.9.1&quot;;}
      ];
      vendorHash = &quot;&lt;SRI hash&gt;&quot;;
    };
  };
}
</code></pre><p>To get the necessary SRI hash, set <code class="literal">vendorHash = &quot;&quot;;</code>. The build will fail
and produce the correct <code class="literal">vendorHash</code> in the error message.</p><p>If you use this feature, updates to CoreDNS may require updating <code class="literal">vendorHash</code>
by following these steps again.</p></li><li class="listitem"><p>Using <code class="literal">fusuma</code> enables the following plugins now:
<a class="link" href="https://github.com/iberianpig/fusuma-plugin-appmatcher"  target="_top">appmatcher</a>,
<a class="link" href="https://github.com/iberianpig/fusuma-plugin-keypress"  target="_top">keypress</a>,
<a class="link" href="https://github.com/iberianpig/fusuma-plugin-sendkey"  target="_top">sendkey</a>,
<a class="link" href="https://github.com/iberianpig/fusuma-plugin-tap"  target="_top">tap</a> and
<a class="link" href="https://github.com/iberianpig/fusuma-plugin-wmctrl"  target="_top">wmctrl</a>.</p></li><li class="listitem"><p>The Home Assistant module offers support for installing custom components and
lovelace modules now. Available at
<a class="link" href="options.html#opt-services.home-assistant.customComponents"  ><code class="literal">services.home-assistant.customComponents</code></a>
and
<a class="link" href="options.html#opt-services.home-assistant.customLovelaceModules"  ><code class="literal">services.home-assistant.customLovelaceModules</code></a>.</p></li><li class="listitem"><p>TeX Live environments can now be built with the new <code class="literal">texlive.withPackages</code>.
The procedure for creating custom TeX packages has been changed. Refer to the
<a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-language-texlive-custom-packages"  target="_top">Nixpkgs
manual</a>
for more details.</p></li><li class="listitem"><p>In <code class="literal">wxGTK32</code>, the webkit module <code class="literal">wxWebView</code> has been enabled on all builds.
Prior releases only enabled this on Darwin.</p></li><li class="listitem"><p>Support for WiFi6 (IEEE 802.11ax) and WPA3-SAE-PK was enabled in the
<code class="literal">hostapd</code> package, along with a significant rework of the hostapd module.</p></li><li class="listitem"><p>LXD supports virtual machine instances now to complement the existing
container support.</p></li><li class="listitem"><p>The <code class="literal">nixos-rebuild</code> command has been given a <code class="literal">list-generations</code> subcommand.
Refer to <code class="literal">man nixos-rebuild</code> for more details.</p></li><li class="listitem"><p><a class="link" href="https://github.com/memorysafety/sudo-rs/"  target="_top"><code class="literal">sudo-rs</code></a>, a reimplementation of <code class="literal">sudo</code> in Rust, is now supported.
An experimental new module <code class="literal">security.sudo-rs</code> was added.
Switching to it (via <code class="literal"> security.sudo-rs.enable = true;</code>) introduces
slight changes in sudo behaviour, due to <code class="literal">sudo-rs</code>’ current limitations:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>terminfo-related environment variables aren’t preserved for <code class="literal">root</code> and <code class="literal">wheel</code>;</p></li><li class="listitem"><p><code class="literal">root</code> and <code class="literal">wheel</code> are not given the ability to set (or preserve)
arbitrary environment variables.</p></li></ul></div><p><span class="strong"><strong>Note:</strong></span> The <code class="literal">sudo-rs</code> module only takes configuration through <code class="literal">security.sudo-rs</code>,
and in particular does not automatically use previously-set rules; this could be
achieved with <code class="literal">security.sudo-rs.extraRules = security.sudo.extraRules;</code> for instance.</p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>There is a new NixOS option when writing NixOS tests
<code class="literal">testing.initrdBackdoor</code>, that enables <code class="literal">backdoor.service</code> in initrd. Requires
<code class="literal">boot.initrd.systemd.enable</code> to be enabled. Boot will pause in Stage 1 at
<code class="literal">initrd.target</code>, and will listen for commands from the <code class="literal">Machine</code> python
interface, just like Stage 2 normally does. This enables commands to be sent
to test and debug Stage 1. Use <code class="literal">machine.switch_root()</code> to leave Stage 1 and
proceed to Stage 2.</p></li><li class="listitem"><p>The Linux kernel module <code class="literal">msr</code> (refer to
<a class="link" href="https://man7.org/linux/man-pages/man4/msr.4.html"  target="_top"><code class="literal">msr(4)</code></a>), which provides
an interface to read and write the model-specific registers (MSRs) of an x86
CPU, can now be configured via <code class="literal">hardware.cpu.x86.msr</code>.</p></li><li class="listitem"><p>The <code class="literal">qemu-vm.nix</code> module now supports disabling overriding <code class="literal">fileSystems</code> with
<code class="literal">virtualisation.fileSystems</code>. This enables the user to boot VMs from
“external” disk images not created by the qemu-vm module. You can stop the
qemu-vm module from overriding <code class="literal">fileSystems</code> by setting
<code class="literal">virtualisation.fileSystems = lib.mkForce { };</code>.</p></li><li class="listitem"><p>When using <a class="link" href="https://www.snapraid.it/manual#7.1"  target="_top">split parity files</a> in <code class="literal">snapraid</code>,
the snapraid-sync systemd service will no longer fail to run.</p></li><li class="listitem"><p><code class="literal">wpa_supplicant</code>’s configuration file cannot be read by non-root users, and
secrets (such as Pre-Shared Keys) can safely be passed via
<code class="literal">networking.wireless.environmentFile</code>.</p><p>The configuration file could previously be read, when <code class="literal">userControlled.enable</code> (non-default),
by users who are in both <code class="literal">wheel</code> and <code class="literal">userControlled.group</code> (defaults to <code class="literal">wheel</code>)</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-23.11-nixpkgs-lib" class="title" >Nixpkgs Library   </h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-release-23.11-lib-breaking" class="title" >Breaking Changes   </h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.lists.foldl-prime"  target="_top"><code class="literal">lib.lists.foldl&#x27;</code></a>
now always evaluates the initial accumulator argument first. If you depend on
the lazier behavior, consider using
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.lists.foldl"  target="_top"><code class="literal">lib.lists.foldl</code></a>
or
<a class="link" href="https://nixos.org/manual/nix/stable/language/builtins.html#builtins-foldl&#x27;"  target="_top"><code class="literal">builtins.foldl&#x27;</code></a>
instead.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.attrsets.foldlAttrs"  target="_top"><code class="literal">lib.attrsets.foldlAttrs</code></a>
now always evaluates the initial accumulator argument first.</p></li><li class="listitem"><p>Now that the internal NixOS transition to Markdown documentation is complete,
<code class="literal">lib.options.literalDocBook</code> has been removed after deprecation in 22.11.</p></li><li class="listitem"><p><code class="literal">lib.types.string</code> is now fully deprecated and gives a warning when used.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-release-23.11-lib-additions-improvements" class="title" >Additions and Improvements   </h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable#sec-functions-library-fileset"  target="_top"><code class="literal">lib.fileset</code></a>:
A new sub-library to select local files to use for sources, designed to be
easy and safe to use.</p><p>This aims to be a replacement for <code class="literal">lib.sources</code>-based filtering. To learn
more about it, see <a class="link" href="https://www.tweag.io/blog/2023-11-28-file-sets/"  target="_top">the blog
post</a> or <a class="link" href="https://nix.dev/tutorials/file-sets"  target="_top">the
tutorial</a>.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable#sec-functions-library-gvariant"  target="_top"><code class="literal">lib.gvariant</code></a>:
A partial and basic implementation of GVariant formatted strings. See
<a class="link" href="https://docs.gtk.org/glib/gvariant-format-strings.html"  target="_top">GVariant Format
Strings</a> for details.</p><div class="warning"><h3 class="title">Warning</h3><p>This API is not considered fully stable and it might therefore
change in backwards incompatible ways without prior notice.</p></div></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable#sec-functions-library-asserts"  target="_top"><code class="literal">lib.asserts</code></a>:
New function:
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.asserts.assertEachOneOf"  target="_top"><code class="literal">assertEachOneOf</code></a>.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable#sec-functions-library-attrsets"  target="_top"><code class="literal">lib.attrsets</code></a>:
New function:
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.attrsets.attrsToList"  target="_top"><code class="literal">attrsToList</code></a>.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable#sec-functions-library-customisation"  target="_top"><code class="literal">lib.customisation</code></a>:
New function:
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.customisation.makeScopeWithSplicing-prime"  target="_top"><code class="literal">makeScopeWithSplicing&#x27;</code></a>.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable#sec-functions-library-fixedPoints"  target="_top"><code class="literal">lib.fixedPoints</code></a>:
Documentation improvements for
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.fixedPoints.fix"  target="_top"><code class="literal">lib.fixedPoints.fix</code></a>.</p></li><li class="listitem"><p><code class="literal">lib.generators</code>: New functions:
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.generators.mkDconfKeyValue"  target="_top"><code class="literal">mkDconfKeyValue</code></a>,
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.generators.toDconfINI"  target="_top"><code class="literal">toDconfINI</code></a>.</p><p><code class="literal">lib.generators.toKeyValue</code> now supports the <code class="literal">indent</code> attribute in its first
argument.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable#sec-functions-library-lists"  target="_top"><code class="literal">lib.lists</code></a>:
New functions:
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.lists.findFirstIndex"  target="_top"><code class="literal">findFirstIndex</code></a>,
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.lists.hasPrefix"  target="_top"><code class="literal">hasPrefix</code></a>,
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.lists.removePrefix"  target="_top"><code class="literal">removePrefix</code></a>,
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.lists.commonPrefix"  target="_top"><code class="literal">commonPrefix</code></a>,
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.lists.allUnique"  target="_top"><code class="literal">allUnique</code></a>.</p><p>Documentation improvements for
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.lists.foldl-prime"  target="_top"><code class="literal">lib.lists.foldl&#x27;</code></a>.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable#sec-functions-library-meta"  target="_top"><code class="literal">lib.meta</code></a>:
Documentation of functions now gets rendered</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable#sec-functions-library-path"  target="_top"><code class="literal">lib.path</code></a>:
New functions:
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.path.hasPrefix"  target="_top"><code class="literal">hasPrefix</code></a>,
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.path.removePrefix"  target="_top"><code class="literal">removePrefix</code></a>,
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.path.splitRoot"  target="_top"><code class="literal">splitRoot</code></a>,
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.path.subpath.components"  target="_top"><code class="literal">subpath.components</code></a>.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable#sec-functions-library-strings"  target="_top"><code class="literal">lib.strings</code></a>:
New functions:
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.strings.replicate"  target="_top"><code class="literal">replicate</code></a>,
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.strings.cmakeOptionType"  target="_top"><code class="literal">cmakeOptionType</code></a>,
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.strings.cmakeBool"  target="_top"><code class="literal">cmakeBool</code></a>,
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.strings.cmakeFeature"  target="_top"><code class="literal">cmakeFeature</code></a>.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable#sec-functions-library-trivial"  target="_top"><code class="literal">lib.trivial</code></a>:
New function:
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.trivial.mirrorFunctionArgs"  target="_top"><code class="literal">mirrorFunctionArgs</code></a>.</p></li><li class="listitem"><p><code class="literal">lib.systems</code>: New function:
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.systems.equals"  target="_top"><code class="literal">equals</code></a>.</p></li><li class="listitem"><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable#sec-functions-library-options"  target="_top"><code class="literal">lib.options</code></a>:
Improved documentation for
<a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.options.mkPackageOption"  target="_top"><code class="literal">mkPackageOption</code></a>.</p><p><a class="link" href="https://nixos.org/manual/nixpkgs/stable#function-library-lib.options.mkPackageOption"  target="_top"><code class="literal">mkPackageOption</code></a>.
now also supports the <code class="literal">pkgsText</code> attribute.</p></li></ul></div><p>Module system:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Options in the <code class="literal">options</code> module argument now have the <code class="literal">declarationPositions</code>
attribute containing the position where the option was declared:</p><pre><code class="programlisting">$ nix-repl -f &#x27;&lt;nixpkgs/nixos&gt;&#x27; [...]
nix-repl&gt; :p options.environment.systemPackages.declarationPositions
[ {
  column = 7;
  file = &quot;/nix/store/vm9zf9wvfd628cchj0hdij1g4hzjrcz9-source/nixos/modules/config/system-path.nix&quot;;
  line = 62;
} ]
</code></pre><p>Not to be confused with <code class="literal">definitionsWithLocations</code>, which is the same but for option <span class="emphasis"><em>definitions</em></span>.</p></li><li class="listitem"><p>Improved error message for option declarations missing <code class="literal">mkOption</code></p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-release-23.11-lib-deprecations" class="title" >Deprecations   </h4>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">lib.meta.getExe pkg</code> (also available as <code class="literal">lib.getExe</code>) now gives a warning if
<code class="literal">pkg.meta.mainProgram</code> is not set, but it continues to default to the
derivation name. Nixpkgs accepts PRs that set <code class="literal">meta.mainProgram</code> on packages
where it makes sense. Use <code class="literal">lib.getExe&#x27; pkg &quot;some-command&quot;</code> to avoid the
warning and/or select a different executable.</p></li></ul></div>
</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-23.05" class="title" style="clear: both">Release 23.05 (“Stoat”, 2023.05/31)   </h2>  </div> </div></div><p>The NixOS release team is happy to announce a new version of NixOS. The release is called NixOS 23.05 (“Stoat”).</p><p>NixOS is a Linux distribution, whose set of packages can also be used on other Linux systems and macOS.</p><p>Support is planned until the end of December 2023, handing over to NixOS 23.11.</p><p>To upgrade to the latest release, follow the <a class="link" href="https://nixos.org/manual/nixos/stable/index.html#sec-upgrading"  target="_top">upgrade chapter</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-23.05-highlights" class="title" >Highlights   </h3>  </div> </div></div><p>In addition to numerous new and updated packages, this release has the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The default <a class="link" href="https://github.com/NixOS/nix"  target="_top">Nix</a> version was updated from 2.11 to 2.13. In particular, this includes a <a class="link" href="https://github.com/NixOS/nix/issues/8259"  target="_top">small language alteration</a> in the way floats are represented in <code class="literal">builtins.toJSON</code>. See the release notes for <a class="link" href="https://nixos.org/manual/nix/stable/release-notes/rl-2.12.html"  target="_top">2.12</a> and <a class="link" href="https://nixos.org/manual/nix/unstable/release-notes/rl-2.13.html"  target="_top">2.13</a> for more information.</p></li><li class="listitem"><p>The default <a class="link" href="https://kernel.org/"  target="_top">Linux Kernel</a> was updated from version 5.15 to 6.1, see <a class="link" href="https://kernelnewbies.org/Linux_6.1"  target="_top">Kernelnewbies</a> for what has changed. All Kernels currently shown on <a class="link" href="https://kernel.org/"  target="_top">kernel.org</a> are available.</p></li><li class="listitem"><p><a class="link" href="https://systemd.io"  target="_top">systemd</a> has been updated from v252 to v253, see <a class="link" href="https://github.com/systemd/systemd/blob/v253/NEWS#L3-L659"  target="_top">the release notes</a> for more information on the changes.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Updating with <code class="literal">nixos-rebuild boot</code> and rebooting is recommended, since in some rare cases the <code class="literal">nixos-rebuild switch</code> into the new generation on a live system might fail due to missing mount units.</p></li></ul></div></li><li class="listitem"><p><a class="link" href="https://www.gnu.org/software/libc/"  target="_top">glibc</a> has been updated from version 2.35 to 2.37, see <a class="link" href="https://sourceware.org/glibc/wiki/Release/2.37"  target="_top">the release notes</a> for what was changed.</p></li><li class="listitem"><p><a class="link" href="https://github.com/besser82/libxcrypt"  target="_top">libxcrypt</a>, the library providing the <code class="literal">crypt(3)</code> password hashing function, is now built without support for algorithms not flagged <a class="link" href="https://github.com/besser82/libxcrypt/blob/v4.4.33/lib/hashes.conf#L48"  target="_top"><code class="literal">strong</code></a>. This affects the availability of password hashing algorithms used for system login (<code class="literal">login(1)</code>, <code class="literal">passwd(1)</code>), but also Apache2 Basic-Auth, Samba, OpenLDAP, Dovecot, and <a class="link" href="https://sourcegraph.com/search?q=context:global+repo:%5Egithub%5C.com/NixOS/nixpkgs%24+libxcrypt&amp;patternType=standard&amp;sm=1&amp;groupBy=path"  target="_top">many other packages</a>.</p></li><li class="listitem"><p>NixOS now defaults to using <a class="link" href="https://github.com/twosigma/nsncd"  target="_top">nsncd</a>, a non-caching reimplementation of nscd in Rust, as its NSS lookup dispatcher. This replaces the buggy and deprecated nscd implementation provided through glibc. When you find problems, you can switch back by disabling it:</p><pre><code class="programlisting nix">{
  services.nscd.enableNsncd = false;
}
</code></pre></li><li class="listitem"><p>The internal option <code class="literal">boot.bootspec.enable</code> is now enabled by default because <a class="link" href="https://github.com/NixOS/rfcs/pull/125"  target="_top">RFC 0125</a> was merged. This means you will have a bootspec document called <code class="literal">boot.json</code> generated for each system and specialisation in the top-level. This is useful to enable advanced boot use cases in NixOS, such as Secure Boot.</p></li><li class="listitem"><p>Two changes to <code class="literal">nixos-rebuild</code> are important to highlight as well.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Support for an extra <code class="literal">--specialisation</code> option was added that can be used to change specialisation for <code class="literal">switch</code> and <code class="literal">test</code> commands.</p></li><li class="listitem"><p>The <code class="literal">--target-host</code> and <code class="literal">--build-host</code> options no longer treat the <code class="literal">localhost</code> value specially – to build on resp. deploy to a local machine, omit the relevant flag.</p></li></ul></div></li><li class="listitem"><p><a class="link" href="https://www.python.org"  target="_top">Python</a> implements <a class="link" href="https://peps.python.org/pep-0668/"  target="_top">PEP 668</a>, providing better feedback to users that try to run <code class="literal">pip install</code> for system-wide or user home installations.</p></li><li class="listitem"><p><a class="link" href="https://github.com/linuxmint/Cinnamon"  target="_top">Cinnamon</a> has been updated to version 5.6, see <a class="link" href="https://github.com/NixOS/nixpkgs/pull/201328#issue-1449910204"  target="_top">the pull request</a> for what was changed.</p></li><li class="listitem"><p><a class="link" href="https://www.gnome.org"  target="_top">GNOME</a> has been updated to version 44, see the <a class="link" href="https://release.gnome.org/44/"  target="_top">the release notes</a> for details.</p></li><li class="listitem"><p><a class="link" href="https://kde.org/de/plasma-desktop/"  target="_top">KDE Plasma</a> has been updated to version 5.27, see <a class="link" href="https://kde.org/announcements/plasma/5/5.27.0/"  target="_top">the release notes</a> for what was changed.</p></li><li class="listitem"><p><code class="literal">openra</code> was updated to <code class="literal">20230225</code>. Due to large scope of the update, currently only <code class="literal">openraPackages.engines.release</code> and <code class="literal">openraPackages.engines.latest</code> packages are available.
If you want to use the old engine versions or mods, they were moved to the <code class="literal">openraPackages_2019</code> namespace.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-23.05-new-services" class="title" >New Services   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://akkoma.social"  target="_top">Akkoma</a>, an ActivityPub microblogging server. Available as <a class="link" href="options.html#opt-services.akkoma.enable"  target="_top">services.akkoma</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/google/alertmanager-irc-relay"  target="_top">alertmanager-irc-relay</a>, a Prometheus Alertmanager IRC Relay. Available as <a class="link" href="options.html#opt-services.prometheus.alertmanagerIrcRelay.enable"  target="_top">services.prometheus.alertmanagerIrcRelay</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/alice-lg/alice-lg"  target="_top">alice-lg</a>, a looking-glass for BGP sessions. Available as <a class="link" href="options.html#opt-services.alice-lg.enable"  >services.alice-lg</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/ellie/atuin"  target="_top">atuin</a>, a sync server for shell history. Available as <a class="link" href="options.html#opt-services.atuin.enable"  >services.atuin</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.authelia.com/"  target="_top">authelia</a>, an open-source authentication and authorization server. Available as <a class="link" href="options.html#opt-services.authelia.enable"  target="_top">services.authelia</a>.</p></li><li class="listitem"><p><a class="link" href="github.com/alice-lg/birdwatcher"  target="_top">birdwatcher</a>, a small HTTP server meant to provide an API defined by Barry O’Donovan’s birds-eye to the BIRD internet routing daemon. Available as <a class="link" href="options.html#opt-services.birdwatcher.enable"  >services.birdwatcher</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/akinomyoga/ble.sh"  target="_top">blesh</a>, a line editor written in pure bash. Available as <a class="link" href="options.html#opt-programs.bash.blesh.enable"  >programs.bash.blesh</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/BuddiesOfBudgie/budgie-desktop"  target="_top">Budgie Desktop</a>, a familiar, modern desktop environment. Available as <a class="link" href="options.html#opt-services.xserver.desktopManager.budgie"  target="_top">services.xserver.desktopManager.budgie</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/zzzgydi/clash-verge"  target="_top">clash-verge</a>, a Clash GUI based on tauri. Available as <a class="link" href="options.html#opt-programs.clash-verge.enable"  >programs.clash-verge</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.magicbug.co.uk/cloudlog/"  target="_top">Cloudlog</a>, a web-based Amateur Radio logging application. Available as <a class="link" href="options.html#opt-services.cloudlog.enable"  >services.cloudlog</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/hashicorp/consul-template/"  target="_top">consul-template</a>, a template renderer, notifier, and supervisor for HashiCorp Consul and Vault data. Available as <a class="link" href="options.html#opt-services.consul-template.instances"  >services.consul-template</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/alexivkin/CUPS-PDF-to-PDF"  target="_top">cups-pdf-to-pdf</a>, a PDF-generating CUPS backend based on <a class="link" href="https://www.cups-pdf.de/"  target="_top">cups-pdf</a>. Available as <a class="link" href="options.html#opt-services.printing.cups-pdf.enable"  >services.printing.cups-pdf</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/linuxdeepin/dde"  target="_top">Deepin Desktop Environment</a>, an elegant, easy to use and reliable desktop environment. Available as <a class="link" href="options.html#opt-services.xserver.desktopManager.deepin"  target="_top">services.xserver.desktopManager.deepin</a>.</p></li><li class="listitem"><p><a class="link" href="https://esphome.io"  target="_top">esphome</a>, a dashboard to configure ESP8266/ESP32 devices for use with Home Automation systems. Available as <a class="link" href="options.html#opt-services.esphome.enable"  >services.esphome</a>.</p></li><li class="listitem"><p><a class="link" href="https://frigate.video"  target="_top">frigate</a>, an open source NVR built around real-time AI object detection. Available as <a class="link" href="options.html#opt-services.frigate.enable"  >services.frigate</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/junegunn/fzf"  target="_top">fzf</a>, a command line fuzzyfinder. Available as <a class="link" href="options.html#opt-programs.fzf.fuzzyCompletion"  >programs.fzf</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/rubygems/gemstash"  target="_top">gemstash</a>, a RubyGems.org cache and private gem server. Available as <a class="link" href="options.html#opt-services.gemstash.enable"  >services.gemstash</a>.</p></li><li class="listitem"><p><a class="link" href="https://gitea.com/gitea/act_runner"  target="_top">gitea-actions-runner</a>, a CI runner for Gitea/Forgejo Actions. Available as <a class="link" href="options.html#opt-services.gitea-actions-runner.instances"  >services.gitea-actions-runner</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/philipl/evdevremapkeys"  target="_top">evdevremapkeys</a>, a daemon to remap key events. Available as <a class="link" href="options.html#opt-services.evdevremapkeys.enable"  >services.evdevremapkeys</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/hzeller/gmrender-resurrect"  target="_top">gmediarender</a>, a simple, headless UPnP/DLNA renderer.  Available as <a class="link" href="options.html#opt-services.gmediarender.enable"  target="_top">services.gmediarender</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/AlexxIT/go2rtc"  target="_top">go2rtc</a>, a camera streaming application with support for RTSP, WebRTC, HomeKit, FFMPEG, RTMP and other protocols. Available as <a class="link" href="options.html#opt-services.go2rtc.enable"  target="_top">services.go2rtc</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/slurdge/goeland"  target="_top">goeland</a>, an alternative to rss2email written in Golang with many filters. Available as <a class="link" href="options.html#opt-services.goeland.enable"  >services.goeland</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/sentriz/gonic"  target="_top">gonic</a>, a Subsonic music streaming server. Available as <a class="link" href="options.html#opt-services.gonic.enable"  >services.gonic</a>.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-hardware.ipu6.enable"  >hardware.ipu6</a>, drivers for IPU6 based webcams on Intel Tiger Lake and Alder Lake.</p></li><li class="listitem"><p><a class="link" href="https://github.com/nix-community/harmonia/"  target="_top">harmonia</a>, a Nix binary cache implemented in Rust using <a class="link" href="https://docs.rs/libnixstore/latest/libnixstore/"  target="_top">libnixstore</a>. Available as <a class="link" href="options.html#opt-services.harmonia.enable"  target="_top">services.harmonia</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/hyprwm/hyprland"  target="_top">hyprland</a>, a dynamic tiling Wayland compositor that doesn’t sacrifice on its looks. Available as <a class="link" href="options.html#opt-programs.hyprland.enable"  >programs.hyprland</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/h2non/imaginary"  target="_top">imaginary</a>, a microservice for high-level image processing that Nextcloud can use to generate previews. Available as <a class="link" href="options.html#opt-services.imaginary.enable"  >services.imaginary</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.ivpn.net/"  target="_top">ivpn</a>, a secure, private VPN with fast WireGuard connections. Available as <a class="link" href="options.html#opt-services.ivpn.enable"  >services.ivpn</a>.</p></li><li class="listitem"><p><a class="link" href="https://victoriametrics.com/"  target="_top">vmalert</a>, an alerting engine for VictoriaMetrics. Available as <a class="link" href="options.html#opt-services.vmalert.enable"  >services.vmalert</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/Fallenbagel/jellyseerr"  target="_top">jellyseerr</a>, a web-based requests manager for Jellyfin, forked from Overseerr. Available as <a class="link" href="options.html#opt-services.jellyseerr.enable"  >services.jellyseerr</a>.</p></li><li class="listitem"><p><a class="link" href="https://kavitareader.com"  target="_top">kavita</a>, a self-hosted digital library. Available as <a class="link" href="options.html#opt-services.kavita.enable"  target="_top">services.kavita</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/rvaiya/keyd"  target="_top">keyd</a>, a key remapping daemon for Linux. Available as <a class="link" href="options.html#opt-services.keyd.enable"  >services.keyd</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/lldap/lldap"  target="_top">lldap</a>, a lightweight authentication server that provides an opinionated, simplified LDAP interface for authentication. Available as <a class="link" href="options.html#opt-services.lldap.enable"  >services.lldap</a>.</p></li><li class="listitem"><p><a class="link" href="https://gitlab.com/DavidGriffith/minipro/"  target="_top">minipro</a>, an open source program for controlling the MiniPRO TL866xx series of chip programmers. Available as <a class="link" href="options.html#opt-programs.minipro.enable"  target="_top">programs.minipro</a>.</p></li><li class="listitem"><p><a class="link" href="https://gitlab.com/kop316/mmsd"  target="_top">mmsd</a>, a lower level daemon that transmits and receives MMSes. Available as <a class="link" href="options.html#opt-services.mmsd.enable"  >services.mmsd</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.monicahq.com"  target="_top">monica</a>, an open source personal CRM. Available as <a class="link" href="options.html#opt-services.monica.enable"  target="_top">services.monica</a>.</p></li><li class="listitem"><p><a class="link" href="https://gitlab.com/craftyguy/networkd-dispatcher"  target="_top">networkd-dispatcher</a>, a dispatcher service for systemd-networkd connection status changes. Available as <a class="link" href="options.html#opt-services.networkd-dispatcher.enable"  >services.networkd-dispatcher</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/avahe-kellenberger/nimdow"  target="_top">nimdow</a>, a window manager written in Nim, inspired by dwm. Available as <a class="link" href="options.html#opt-services.xserver.windowManager.nimdow.enable"  target="_top">services.xserver.windowManager.nimdow.enable</a>.</p></li><li class="listitem"><p><a class="link" href="https://opensearch.org"  target="_top">opensearch</a>, a search server alternative to Elasticsearch. Available as <a class="link" href="options.html#opt-services.opensearch.enable"  target="_top">services.opensearch</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/gitpod-io/openvscode-server"  target="_top">openvscode-server</a>, run VS Code on a remote machine with access through a modern web browser from any device, anywhere. Available as <a class="link" href="options.html#opt-services.openvscode-server.enable"  >services.openvscode-server</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/ljanyst/peroxide"  target="_top">peroxide</a>, a fork of the official <a class="link" href="https://github.com/ProtonMail/proton-bridge"  target="_top">ProtonMail bridge</a> that aims to be similar to <a class="link" href="https://github.com/emersion/hydroxide"  target="_top">Hydroxide</a>. Available as <a class="link" href="options.html#opt-services.peroxide.enable"  >services.peroxide</a>.</p></li><li class="listitem"><p><a class="link" href="https://photoprism.app/"  target="_top">photoprism</a>, a AI-powered photos app for the decentralized web. Available as <a class="link" href="options.html#opt-services.photoprism.enable"  target="_top">services.photoprism</a>.</p></li><li class="listitem"><p><a class="link" href="https://pixelfed.org/"  target="_top">Pixelfed</a>, an Instagram-like ActivityPub server. Available as <a class="link" href="options.html#opt-services.pixelfed.enable"  target="_top">services.pixelfed</a>.</p></li><li class="listitem"><p><a class="link" href="https://pufferpanel.com"  target="_top">PufferPanel</a>, a game server management panel designed to be easy to use. Available as <a class="link" href="options.html#opt-services.pufferpanel.enable"  >services.pufferpanel</a>.</p></li><li class="listitem"><p><a class="link" href="https://dm3mat.darc.de/qdmr/"  target="_top">QDMR</a>, a GUI application and command line tool for programming DMR radios <a class="link" href="options.html#opt-programs.qdmr.enable"  >programs.qdmr</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/Readarr/Readarr"  target="_top">readarr</a>, book manager and automation (Sonarr for ebooks). Available as <a class="link" href="options.html#opt-services.readarr.enable"  target="_top">services.readarr</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/rharish101/ReGreet"  target="_top">ReGreet</a>, a clean and customizable greeter for greetd. Available as <a class="link" href="options.html#opt-programs.regreet.enable"  >programs.regreet</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/Mellanox/rshim-user-space"  target="_top">rshim</a>, the user-space rshim driver for the BlueField SoC. Available as <a class="link" href="options.html#opt-services.rshim.enable"  target="_top">services.rshim</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/drakkan/sftpgo"  target="_top">SFTPGo</a>, a fully featured and highly configurable SFTP server with optional HTTP/S, FTP/S and WebDAV support. Available as <a class="link" href="options.html#opt-services.sftpgo.enable"  target="_top">services.sftpgo</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/parvardegr/sharing"  target="_top">sharing</a>, a command-line tool to share directories and files from the CLI to iOS and Android devices without the need of an extra client app. Available as <a class="link" href="options.html#opt-programs.sharing.enable"  >programs.sharing</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/GyulyVGC/sniffnet"  target="_top">sniffnet</a>, an application to monitor your network traffic. Available as <a class="link" href="options.html#opt-programs.sniffnet.enable"  >programs.sniffnet</a>.</p></li><li class="listitem"><p><a class="link" href="https://sr.ht/~zethra/stargazer/"  target="_top">stargazer</a>, a fast and easy to use Gemini server. Available as <a class="link" href="options.html#opt-services.stargazer.enable"  >services.stargazer</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/StevenBlack/hosts"  target="_top">stevenblack-blocklist</a>, a unified hosts file with base extensions for blocking unwanted websites. Available as <a class="link" href="options.html#opt-networking.stevenblack.enable"  target="_top">networking.stevenblack</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.freedesktop.org/software/systemd/man/systemd-repart.service.html"  target="_top">systemd-repart</a>, grow and add partitions to a partition table. Available as <a class="link" href="options.html#opt-systemd.repart"  target="_top">systemd.repart</a> and <a class="link" href="options.html#opt-boot.initrd.systemd.repart"  target="_top">boot.initrd.systemd.repart</a></p></li><li class="listitem"><p><a class="link" href="https://github.com/fujiapple852/trippy"  target="_top">trippy</a>, a network diagnostic tool. Available as <a class="link" href="options.html#opt-programs.trippy.enable"  >programs.trippy</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/coqui-ai/TTS"  target="_top">tts</a>, a battle-tested deep learning toolkit for Text-to-Speech. Multiple servers may be configured below <a class="link" href="options.html#opt-services.tts.servers"  >services.tts.servers</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.netfilter.org/projects/ulogd/index.html"  target="_top">ulogd</a>, a userspace logging daemon for netfilter/iptables related logging. Available as <a class="link" href="options.html#opt-services.ulogd.enable"  target="_top">services.ulogd</a>.</p></li><li class="listitem"><p><a class="link" href="https://v2raya.org"  target="_top">v2rayA</a>, a Linux web GUI client of Project V which supports V2Ray, Xray, SS, SSR, Trojan and Pingtunnel. Available as <a class="link" href="options.html#opt-services.v2raya.enable"  target="_top">services.v2raya</a>.</p></li><li class="listitem"><p><a class="link" href="https://git.launchpad.net/v4l2-relayd"  target="_top">v4l2-relayd</a>, a streaming relay for v4l2loopback using gstreamer. Available as <a class="link" href="options.html#opt-services.v4l2-relayd.instances._name_.enable"  >services.v4l2-relayd</a>.</p></li><li class="listitem"><p><a class="link" href="https://developer.hashicorp.com/vault/docs/agent"  target="_top">vault-agent</a>, a template renderer and API auth proxy for HashiCorp Vault, similar to <code class="literal">consul-template</code>. Available as <a class="link" href="options.html#opt-services.vault-agent.instances"  >services.vault-agent</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/adnanh/webhook"  target="_top">webhook</a>, a lightweight webhook server. Available as <a class="link" href="options.html#opt-services.webhook.enable"  >services.webhook</a>.</p></li><li class="listitem"><p><a class="link" href="https://git.deuxfleurs.fr/Deuxfleurs/wgautomesh"  target="_top">wgautomesh</a>, a simple utility to help connect wireguard nodes together in a full mesh topology. Available as <a class="link" href="options.html#opt-services.wgautomesh.enable"  target="_top">services.wgautomesh</a>.</p></li><li class="listitem"><p><a class="link" href="https://woodpecker-ci.org/"  target="_top">woodpecker</a>, a simple CI engine with great extensibility. Available as <a class="link" href="options.html#opt-services.woodpecker-server.enable"  >services.woodpecker-server</a> and <a class="link" href="options.html#opt-services.woodpecker-agents.agents._name_.enable"  >services.woodpecker-agents</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/erebe/wstunnel"  target="_top">wstunnel</a>, a proxy tunnelling arbitrary TCP or UDP traffic through a WebSocket connection. Available as <a class="link" href="options.html#opt-services.wstunnel.enable"  target="_top">services.wstunnel</a>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-23.05-incompatibilities" class="title" >Backward Incompatibilities   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">services.asusd</code> configuration now uses strings instead of structured configuration, as upstream switched to the <a class="link" href="https://github.com/ron-rs/ron"  target="_top">RON</a> configuration format. Support for structured configuration may return when <a class="link" href="https://github.com/ron-rs/ron"  target="_top">RON</a> generation is implemented in nixpkgs.</p></li><li class="listitem"><p><code class="literal">borgbackup</code> module now has an option for inhibiting system sleep while backups are running, defaulting to off (not inhibiting sleep), available as <a class="link" href="options.html#opt-services.borgbackup.jobs._name_.inhibitsSleep"  ><code class="literal">services.borgbackup.jobs.&lt;name&gt;.inhibitsSleep</code></a>.</p></li><li class="listitem"><p>The <code class="literal">openssh</code> client now comes with the <code class="literal">~C</code> escape sequence disabled by default. It can be re-enabled by setting <code class="literal">EnableEscapeCommandline yes</code></p></li><li class="listitem"><p>The <code class="literal">programs.ssh</code> client module does not read <code class="literal">/etc/ssh/ssh_known_hosts2</code> anymore, since this location is <a class="link" href="https://marc.info/?l=openssh-unix-dev&amp;m=100508718416162&amp;w=2"  target="_top">deprecated since 2001</a>.</p></li><li class="listitem"><p>The <code class="literal">services.openssh</code> server module does not read <code class="literal">~/.ssh/authorized_keys2</code> anymore, since this location is <a class="link" href="https://marc.info/?l=openssh-unix-dev&amp;m=100508718416162&amp;w=2"  target="_top">deprecated since 2001</a>.</p></li><li class="listitem"><p>MAC-then-encrypt algorithms were removed from the default selection of <code class="literal">services.openssh.settings.Macs</code>. If you still require these <a class="link" href="https://en.wikipedia.org/wiki/Message_authentication_code"  target="_top">MACs</a>, for example when you are relying on libssh2 (e.g. VLC) or the SSH library shipped on the iPhone, you can re-add them like this:</p><pre><code class="programlisting nix">{
  services.openssh.settings.Macs = [
    &quot;hmac-sha2-512&quot;
    &quot;hmac-sha2-256&quot;
    &quot;umac-128@openssh.com&quot;
  ];
}
</code></pre></li><li class="listitem"><p><code class="literal">podman</code> now uses the <code class="literal">netavark</code> network stack. Users will need to delete all of their local containers, images, volumes, etc, by running <code class="literal">podman system reset --force</code> once before upgrading their systems.</p></li><li class="listitem"><p><code class="literal">git-bug</code> has been updated to at least version 0.8.0, which includes backwards incompatible changes. The <code class="literal">git-bug-migration</code> package can be used to upgrade existing repositories.</p></li><li class="listitem"><p><code class="literal">graylog</code> has been updated to version 5, which can not be updated directly from the previously packaged version 3.3. If you had installed the previously packaged version 3.3, please follow the <a class="link" href="https://go2docs.graylog.org/5-0/upgrading_graylog/upgrade_path.htm"  target="_top">upgrade path</a> from 3.3 to 4.0 to 4.3 to 5.0.</p></li><li class="listitem"><p><code class="literal">buildFHSUserEnv</code> is now called <code class="literal">buildFHSEnv</code> and uses FlatPak’s Bubblewrap sandboxing tool rather than Nixpkgs’ own chrootenv. The old chrootenv-based implementation is still available via <code class="literal">buildFHSEnvChroot</code> but is considered deprecated and will be removed when the remaining uses inside Nixpkgs have been migrated. If your FHSEnv-wrapped application misbehaves when using the new bubblewrap implementation, please create an issue in Nixpkgs.</p></li><li class="listitem"><p><code class="literal">nushell</code> has been updated to at least version 0.77.0, which includes potential breaking changes in aliases. The old aliases are now available as <code class="literal">old-alias</code> but it is recommended you migrate to the new format. See <a class="link" href="https://www.nushell.sh/blog/2023-03-14-nushell_0_77.html#reworked-aliases-breaking-changes-kubouch"  target="_top">Reworked aliases</a>.</p></li><li class="listitem"><p><code class="literal">gajim</code> has been updated to version 1.7.3 which has disabled legacy ciphers. See <a class="link" href="https://dev.gajim.org/gajim/gajim/-/releases/1.7.0"  target="_top">changelog for version 1.7.0</a>.</p></li><li class="listitem"><p><code class="literal">keepassx</code> and <code class="literal">keepassx2</code> have been removed, due to upstream <a class="link" href="https://www.keepassx.org/index.html%3Fp=636.html"  target="_top">stopping development</a>. Consider <a class="link" href="https://keepassxc.org"  target="_top">KeePassXC</a> as a maintained alternative.</p></li><li class="listitem"><p>The <a class="link" href="options.html#opt-services.kubo.settings"  >services.kubo.settings</a> option is now no longer stateful. If you changed any of the options in <a class="link" href="options.html#opt-services.kubo.settings"  >services.kubo.settings</a> in the past and then removed them from your NixOS configuration again, those changes are still in your Kubo configuration file but will now be reset to the default. If you’re unsure, you may want to make a backup of your configuration file (probably <code class="literal">/var/lib/ipfs/config</code>) and compare after the update.</p></li><li class="listitem"><p>The Kubo HTTP API will no longer listen on localhost and will instead only listen on a Unix domain socket by default. Read the <a class="link" href="options.html#opt-services.kubo.settings.Addresses.API"  >services.kubo.settings.Addresses.API</a> option description for more information.</p></li><li class="listitem"><p>The EC2 image module no longer fetches instance metadata in stage-1. This results in a significantly smaller initramfs, since network drivers no longer need to be included, and faster boots, since metadata fetching can happen in parallel with startup of other services.
This breaks services which rely on metadata being present by the time stage-2 is entered. Anything which reads EC2 metadata from <code class="literal">/etc/ec2-metadata</code> should now have an <code class="literal">after</code> dependency on <code class="literal">fetch-ec2-metadata.service</code></p></li><li class="listitem"><p>The mailman service now defaults to using a randomly generated REST API password instead of a hard-coded one.</p></li><li class="listitem"><p><code class="literal">minio</code> removed support for its legacy filesystem backend in <a class="link" href="https://github.com/minio/minio/releases/tag/RELEASE.2022-10-29T06-21-33Z"  target="_top">RELEASE.2022-10-29T06-21-33Z</a>. This means if your storage was created with the old format, minio will no longer start. Unfortunately, minio doesn’t provide an automatic migration, they only provide <a class="link" href="https://min.io/docs/minio/windows/operations/install-deploy-manage/migrate-fs-gateway.html"  target="_top">instructions how to manually convert the node</a>. To facilitate this migration, we keep around the last version that still supports the old filesystem backend as <code class="literal">minio_legacy_fs</code>. Use it via <code class="literal">services.minio.package = minio_legacy_fs;</code> to export your data before switching to the new version. See the corresponding <a class="link" href="https://github.com/NixOS/nixpkgs/issues/199318"  target="_top">issue</a> for more details.</p></li><li class="listitem"><p><code class="literal">services.sourcehut.dispatch</code> and the corresponding package (<code class="literal">sourcehut.dispatchsrht</code>) have been removed due to <a class="link" href="https://sourcehut.org/blog/2022-08-01-dispatch-deprecation-plans/"  target="_top">upstream deprecation</a>.</p></li><li class="listitem"><p>The attributes used by <code class="literal">services.snapper.configs.&lt;name&gt;</code> have changed. Migrate from this:</p><pre><code class="programlisting nix">{
  services.snapper.configs.example = {
    subvolume = &quot;/example&quot;;
    extraConfig = &#x27;&#x27;
      ALLOW_USERS=&quot;alice&quot;
    &#x27;&#x27;;
  };
}
</code></pre><p>to this:</p><pre><code class="programlisting nix">{
  services.snapper.configs.example = {
    SUBVOLUME = &quot;/example&quot;;
    ALLOW_USERS = [ &quot;alice&quot; ];
  };
}
</code></pre></li><li class="listitem"><p>The default module options for <a class="link" href="options.html#opt-services.snapserver.openFirewall"  >services.snapserver.openFirewall</a>, <a class="link" href="options.html#opt-services.tmate-ssh-server.openFirewall"  >services.tmate-ssh-server.openFirewall</a> and <code class="literal">services.unifi-video.openFirewall</code> have been changed from <code class="literal">true</code> to <code class="literal">false</code>. You will need to explicitly set this option to <code class="literal">true</code>, or configure your firewall.</p></li><li class="listitem"><p>The option <code class="literal">i18n.inputMethod.fcitx5.enableRimeData</code> has been removed. Default RIME data is now included in <code class="literal">fcitx5-rime</code> by default, and can be customized using</p><pre><code class="programlisting nix">fcitx5-rime.override {
  rimeDataPkgs = [
    pkgs.rime-data
    # ...
  ];
}
</code></pre></li><li class="listitem"><p>The <code class="literal">udev</code> hwdb.bin file is now built with systemd-hwdb rather than the <a class="link" href="https://github.com/systemd/systemd/pull/25714"  target="_top">deprecated “udevadm hwdb”</a>. This may impact mappings where the same key is defined in multiple matching entries. The updated behavior will select the latest definition in case of conflict. In general, this should be a positive change, as the hwdb source files are designed with this ordering in mind. As an example, the mapping of the HP Dev One keyboard scan code for “mute mic” is corrected by this update. This change may impact users who have worked-around previously incorrect mappings.</p></li><li class="listitem"><p>Kime has been updated from 2.5.6 to 3.0.2 and the <code class="literal">i18n.inputMethod.kime.config</code> option has been removed. Users should use <code class="literal">daemonModules</code>, <code class="literal">iconColor</code>, and <code class="literal">extraConfig</code> options under <code class="literal">i18n.inputMethod.kime</code> instead.</p></li><li class="listitem"><p><code class="literal">tut</code> has been updated from 1.0.34 to 2.0.0, and now uses the TOML format for the configuration file instead of INI. Additional information can be found <a class="link" href="https://github.com/RasmusLindroth/tut/releases/tag/2.0.0"  target="_top">here</a>.</p></li><li class="listitem"><p><code class="literal">i3status-rust</code> has been updated from 0.22.0 to 0.30.5, and this brings many changes to its configuration format. Additional information can be found <a class="link" href="https://github.com/greshake/i3status-rust/blob/v0.30.0/NEWS.md"  target="_top">here</a>.</p></li><li class="listitem"><p>The <code class="literal">wordpress</code> derivation no longer contains any built-in plugins or themes. If you need them, you have to add them back to prevent your site from breaking. You can find them in <code class="literal">wordpressPackages.{plugins,themes}</code>.</p></li><li class="listitem"><p><code class="literal">llvmPackages_rocm.llvm</code> will not contain <code class="literal">clang</code> or <code class="literal">compiler-rt</code>. <code class="literal">llvmPackages_rocm.clang</code> will not contain <code class="literal">llvm</code>. <code class="literal">llvmPackages_rocm.clangNoCompilerRt</code> has been removed in favor of using <code class="literal">llvmPackages_rocm.clang-unwrapped</code>.</p></li><li class="listitem"><p><code class="literal">services.xserver.desktopManager.plasma5.excludePackages</code> has been moved to <code class="literal">environment.plasma5.excludePackages</code>, for consistency with other Desktop Environments.</p></li><li class="listitem"><p><code class="literal">teleport</code> has been updated from major version 10 to major version 12. Please see upstream <a class="link" href="https://goteleport.com/docs/setup/operations/upgrading/"  target="_top">upgrade instructions</a> and release notes for versions <a class="link" href="https://goteleport.com/docs/changelog/#1100"  target="_top">11</a> and <a class="link" href="https://goteleport.com/docs/changelog/#1201"  target="_top">12</a>. Note that Teleport does not officially support upgrades across more than one major version at a time. If you’re running Teleport server components, it is recommended to first upgrade to an intermediate 11.x version by setting <code class="literal">services.teleport.package = pkgs.teleport_11</code>. Afterwards, this option can be removed to upgrade to the default version (12).</p></li><li class="listitem"><p>The EC2 image module previously detected and automatically mounted ext3-formatted instance store devices and partitions in stage-1 (initramfs), storing <code class="literal">/tmp</code> on the first discovered device. This behaviour, which only catered to very specific use cases and could not be disabled, has been removed. Users relying on this should provide their own implementation, and probably use ext4 and perform the mount in stage-2.</p></li><li class="listitem"><p>The EC2 image module previously detected and activated swap-formatted instance store devices and partitions in stage-1 (initramfs). This behaviour has been removed. Users relying on this should provide their own implementation.</p></li><li class="listitem"><p><code class="literal">gitlab</code> has been upgraded from major version 15 to major version 16 and requires at least PostgreSQL 13.6. Check the <a class="link" href="index.html#module-services-postgres-upgrading" title="Upgrading" >upgrade guide</a> in the NixOS manual on how to upgrade your PostgreSQL installation.</p></li><li class="listitem"><p><code class="literal">gitlab</code> 16 deprecates the use of external container registries, in our case <code class="literal">pkgs.docker-distribution</code>. Module users who have <a class="link" href="options.html#opt-services.gitlab.registry.enable"  ><code class="literal">services.gitlab.registry.enable</code></a> set to <code class="literal">true</code> are advised to back up their state and switch to gitlab’s fork by setting <a class="link" href="options.html#opt-services.gitlab.registry.package"  ><code class="literal">services.gitlab.registry.package</code></a> to <code class="literal">pkgs.gitlab-container-registry</code>.</p></li><li class="listitem"><p><code class="literal">fail2ban</code> has been updated to 1.0.2, which has a few breaking changes compared to 0.11.2 (<a class="link" href="https://github.com/fail2ban/fail2ban/blob/1.0.1/ChangeLog"  target="_top">changelog for 1.0.1</a>, <a class="link" href="https://github.com/fail2ban/fail2ban/blob/1.0.2/ChangeLog"  target="_top">changelog for 1.0.2</a>)</p></li><li class="listitem"><p><code class="literal">albert</code> has been updated from 0.17.6 to 0.20.13, and 0.18.0 changed the config format and many plugins (<a class="link" href="https://github.com/albertlauncher/albert/blob/v0.18.0/CHANGELOG.md"  target="_top">changelog for 0.18.0</a>)</p></li><li class="listitem"><p><code class="literal">dokuwiki</code> has been updated from 2023-07-31a (Igor) to 2023-04-04 (Jack Jackrum), which has <a class="link" href="https://www.dokuwiki.org/changes#release_2023-04-04_jack_jackrum"  target="_top">completely removed</a> the options to embed HTML and PHP for security reasons. The <a class="link" href="https://www.dokuwiki.org/plugin:htmlok"  target="_top">htmlok plugin</a> can be used to regain this functionality.</p></li><li class="listitem"><p>The old unsupported version 6.x of the ELK-stack and Elastic beats have been removed. Use OpenSearch instead.</p></li><li class="listitem"><p>The <code class="literal">cosmoc</code> package has been removed. The upstream scripts in <code class="literal">cosmocc</code> should be used instead.</p></li><li class="listitem"><p>Qt 5.12 and 5.14 have been removed, as the corresponding branches have been EOL upstream for a long time. This affected under 10 packages in nixpkgs, largely unmaintained upstream as well, however, out-of-tree package expressions may need to be updated manually.</p></li><li class="listitem"><p>The <a class="link" href="options.html#opt-services.wordpress.sites._name_.plugins"  >services.wordpress.sites.&lt;name&gt;.plugins</a> and <a class="link" href="options.html#opt-services.wordpress.sites._name_.themes"  >services.wordpress.sites.&lt;name&gt;.themes</a> options have been converted from sets to attribute sets to allow for consumers to specify explicit install paths via attribute name.</p></li><li class="listitem"><p><code class="literal">protonmail-bridge</code> package has been updated to major version 3.</p></li><li class="listitem"><p>Nebula now runs as a system user and group created for each nebula network, using the <code class="literal">CAP_NET_ADMIN</code> ambient capability on launch rather than starting as root. Ensure that any files each Nebula instance needs to access are owned by the correct user and group, by default <code class="literal">nebula-${networkName}</code>.</p></li><li class="listitem"><p>The <code class="literal">i18n.inputMethod.fcitx</code> option has been replaced with <code class="literal">i18n.inputMethod.fcitx5</code> because fcitx 4 <code class="literal">pkgs.fcitx</code> has been removed.</p></li><li class="listitem"><p>In <code class="literal">mastodon</code> it is now necessary to specify location of file with <code class="literal">PostgreSQL</code> database password. In <code class="literal">services.mastodon.database.passwordFile</code> parameter default value <code class="literal">/var/lib/mastodon/secrets/db-password</code> has been changed to <code class="literal">null</code>.</p></li><li class="listitem"><p>The <code class="literal">nix.readOnlyStore</code> option has been renamed to <code class="literal">boot.readOnlyNixStore</code> to clarify that it configures the NixOS boot process, not the Nix daemon.</p></li><li class="listitem"><p>The latest available version of Nextcloud is v26 (available as <code class="literal">pkgs.nextcloud26</code>) which uses PHP 8.2 as interpreter by default. The installation logic is as follows:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>If <code class="literal">system.stateVersion</code> is &gt;=23.05, <code class="literal">pkgs.nextcloud26</code> will be installed by default.</p></li><li class="listitem"><p>If <code class="literal">system.stateVersion</code> is &gt;=22.11, <code class="literal">pkgs.nextcloud25</code> will be installed by default.</p></li><li class="listitem"><p>Please note that an upgrade from v24 (or older) to v26 directly is not possible. Please upgrade to <code class="literal">nextcloud25</code> (or earlier) first. Nextcloud prohibits skipping major versions while upgrading. You can upgrade by declaring <a class="link" href="options.html#opt-services.nextcloud.package"  target="_top"><code class="literal">services.nextcloud.package = pkgs.nextcloud25;</code></a>.</p></li><li class="listitem"><p>It’s recommended to use the latest version available (i.e. v26) and to specify that using <code class="literal">services.nextcloud.package</code>.</p></li></ul></div></li><li class="listitem"><p>.NET 5.0 and .NET 3.1 were removed due to being end-of-life, use a newer, supported .NET version. Visit the  <a class="link" href="https://dotnet.microsoft.com/en-us/platform/support/policy/dotnet-core"  target="_top">Support Policy</a> for more information.</p></li><li class="listitem"><p>The iputils package, which is installed by default, no longer provides the
<code class="literal">ninfod</code>, <code class="literal">rarpd</code> and <code class="literal">rdisc</code> tools. See <a class="link" href="https://github.com/iputils/iputils/releases/tag/20221126"  target="_top">upstream’s release notes</a> for more details and available replacements.</p></li><li class="listitem"><p>The ppp plugin <code class="literal">rp-pppoe.so</code> has been renamed to <code class="literal">pppoe.so</code> in ppp 2.4.9. Starting from ppp 2.5.0, there is no longer an alias for backwards compatibility. Configurations that use this plugin must be updated accordingly from <code class="literal">plugin rp-pppoe.so</code> to <code class="literal">plugin pppoe.so</code>. See <a class="link" href="https://github.com/ppp-project/ppp/commit/610a7bd76eb1f99f22317541b35001b1e24877ed"  target="_top">upstream change</a>.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.xserver.videoDrivers"  target="_top">services.xserver.videoDrivers</a> now defaults to the <code class="literal">modesetting</code> driver over device-specific ones. The <code class="literal">radeon</code>, <code class="literal">amdgpu</code> and <code class="literal">nouveau</code> drivers are still available, but effectively unmaintained and not recommended for use. Note that this <span class="strong"><strong>does not</strong></span> affect your regular graphics drivers; this only concerns the DDX component of the driver, which most people are not relying on.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.xserver.libinput.enable"  target="_top">services.xserver.libinput.enable</a> is now set by default, enabling the more actively maintained and consistently behaved input device driver.</p></li><li class="listitem"><p>To enable the HTTP3 (QUIC) protocol for a nginx virtual host, set the <code class="literal">quic</code> attribute on it to true, e.g. <code class="literal">services.nginx.virtualHosts.&lt;name&gt;.quic = true;</code>.</p></li><li class="listitem"><p>In <code class="literal">services.fail2ban</code>, <code class="literal">bantime-increment.&lt;name&gt;</code> options now default to <code class="literal">null</code> (except <code class="literal">bantime-increment.enable</code>) and are used to set the corresponding option in <code class="literal">jail.local</code> only if not <code class="literal">null</code>. Also, enforce that <code class="literal">bantime-increment.formula</code> and <code class="literal">bantime-increment.multipliers</code> are not both specified.</p></li><li class="listitem"><p>The default <code class="literal">asterisk</code> package was changed to v20 from v19. Asterisk versions 16 and 19 have been dropped due to being EOL. You may need to update /var/lib/asterisk to match the template files in <code class="literal">${asterisk-20}/var/lib/asterisk</code>.</p></li><li class="listitem"><p>conntrack helper autodetection has been removed from kernels 6.0 and up upstream, and an assertion was added to ensure things don’t silently stop working. Migrate your configuration to assign helpers explicitly or use an older LTS kernel branch as a temporary workaround.</p></li><li class="listitem"><p>The <code class="literal">services.pipewire.config</code> options have been removed, as they have basically never worked correctly. All behavior defined by the default configuration can be overridden with drop-in files as necessary - see <a class="link" href="release-notes.html#sec-release-23.05-migration-pipewire" title="Pipewire configuration overrides" >below</a> for details.</p></li><li class="listitem"><p>The catch-all <code class="literal">hardware.video.hidpi.enable</code> option was removed. Users on high density displays may want to:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Set <code class="literal">services.xserver.upscaleDefaultCursor</code> to upscale the default X11 cursor for higher resolutions</p></li><li class="listitem"><p>Adjust settings under <code class="literal">fonts.fontconfig</code> according to preference</p></li><li class="listitem"><p>Adjust <code class="literal">console.font</code> according to preference, though the kernel will generally choose a reasonably sized font</p></li></ul></div></li><li class="listitem"><p><code class="literal">services.pipewire.media-session</code> and the <code class="literal">pipewire-media-session</code> package have been removed, as they are no longer supported upstream. Users are encouraged to use <code class="literal">services.pipewire.wireplumber</code> instead.</p></li><li class="listitem"><p>The <code class="literal">baget</code> package and module was removed due to being unmaintained.</p></li><li class="listitem"><p>The <code class="literal">qlandkartegt</code> and <code class="literal">garmindev</code> packages were removed due to being unmaintained and insecure.</p></li><li class="listitem"><p>The <code class="literal">go-ethereum</code> package has been updated to v1.11.5 and the <code class="literal">puppeth</code> command is no longer available as of v1.11.0.</p></li><li class="listitem"><p>The <code class="literal">pnpm</code> package has be updated to from version 7.29.1 to version 8.1.1 and Node.js 14 support has been discontinued (though, there are workarounds if Node.js 14 is still required)</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Migration instructions: <a class="link" href="https://github.com/pnpm/pnpm/releases/tag/v8.0.0"  target="_top">“Before updating pnpm to v8 in your CI, regenerate your pnpm-lock.yaml. To upgrade your lockfile, run pnpm install and commit the changes. Existing dependencies will not be updated; however, due to configuration changes in pnpm v8, some missing peer dependencies may be added to the lockfile and some packages may get deduplicated. You can commit the new lockfile even before upgrading Node.js in the CI, as pnpm v7 already supports the new lockfile format.”</a></p></li></ul></div></li><li class="listitem"><p>The <code class="literal">zplug</code> package changes its output path from <code class="literal">$out</code> to <code class="literal">$out/share/zplug</code>. Users should update their dependency on <code class="literal">${pkgs.zplug}/init.zsh</code> to <code class="literal">${pkgs.zplug}/share/zplug/init.zsh</code>.</p></li><li class="listitem"><p>The <code class="literal">pict-rs</code> package was updated from an 0.3 alpha release to 0.3 stable, and related environment variables now require two underscores instead of one.</p></li><li class="listitem"><p>The <code class="literal">shattered-pixel-dungeon</code> game was updated from 1.1.2 to 2.0.2.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>The location of game data has changed. To migrate it, run <code class="literal">mv ~/.shatteredpixel ~/.local/share/.shatteredpixel</code></p></li><li class="listitem"><p>The update will delete all your in-progress games.</p></li></ul></div></li><li class="listitem"><p><code class="literal">espanso</code> has been updated to major version 2. Therefore, migration steps may need to be performed. See <a class="link" href="https://espanso.org/docs/migration/overview/"  target="_top">the official migration instructions</a> for how to perform these migrations. Further, <code class="literal">espanso-wayland</code> can now be used for Wayland support.</p></li><li class="listitem"><p>Only <code class="literal">k3s</code> version 1.26 is included. Users of the <code class="literal">k3s_1_24</code> or <code class="literal">k3s_1_25</code> packages should upgrade to use the <code class="literal">1.26</code> version of the package.</p></li><li class="listitem"><p>The <code class="literal">nerdfonts</code> package has been updated to major version 3, which includes potential <a class="link" href="https://github.com/ryanoasis/nerd-fonts/releases/tag/v3.0.0"  target="_top">breaking changes</a>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-23.05-notable-changes" class="title" >Other Notable Changes   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>To follow <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md"  target="_top">RFC 0042</a> a few options of <code class="literal">openssh</code> have been moved from <code class="literal">extraConfig</code> to the new freeform option <code class="literal">settings</code> and renamed, e.g.:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">services.openssh.forwardX11</code> to <code class="literal">services.openssh.settings.X11Forwarding</code></p></li><li class="listitem"><p><code class="literal">services.openssh.kbdInteractiveAuthentication</code> -&gt; <code class="literal">services.openssh.settings.KbdInteractiveAuthentication</code></p></li><li class="listitem"><p><code class="literal">services.openssh.passwordAuthentication</code> to <code class="literal">services.openssh.settings.PasswordAuthentication</code></p></li><li class="listitem"><p><code class="literal">services.openssh.useDns</code> to <code class="literal">services.openssh.settings.UseDns</code></p></li><li class="listitem"><p><code class="literal">services.openssh.permitRootLogin</code> to <code class="literal">services.openssh.settings.PermitRootLogin</code></p></li><li class="listitem"><p><code class="literal">services.openssh.logLevel</code> to <code class="literal">services.openssh.settings.LogLevel</code></p></li><li class="listitem"><p><code class="literal">services.openssh.kexAlgorithms</code> to <code class="literal">services.openssh.settings.KexAlgorithms</code></p></li><li class="listitem"><p><code class="literal">services.openssh.macs</code> to <code class="literal">services.openssh.settings.Macs</code></p></li><li class="listitem"><p><code class="literal">services.openssh.ciphers</code> to <code class="literal">services.openssh.settings.Ciphers</code></p></li><li class="listitem"><p><code class="literal">services.openssh.gatewayPorts</code> to <code class="literal">services.openssh.settings.GatewayPorts</code></p></li></ul></div></li><li class="listitem"><p><code class="literal">vim_configurable</code> has been renamed to <code class="literal">vim-full</code> to avoid confusion: <code class="literal">vim-full</code>’s build-time features are configurable, but both <code class="literal">vim</code> and <code class="literal">vim-full</code> are <span class="emphasis"><em>customizable</em></span> (in the sense of user configuration, like vimrc).</p></li><li class="listitem"><p>Pantheon now defaults to Mutter 43 and GNOME settings daemon 43, all Pantheon packages are now tracking elementary OS 7 updates.</p></li><li class="listitem"><p>The module for the application firewall <code class="literal">opensnitch</code> got the ability to configure rules. Available as <a class="link" href="options.html#opt-services.opensnitch.rules"  >services.opensnitch.rules</a></p></li><li class="listitem"><p>The module <code class="literal">usbmuxd</code> now has the ability to change the package used by the daemon. In case you’re experiencing issues with <code class="literal">usbmuxd</code> you can try an alternative program like <code class="literal">usbmuxd2</code>. Available as <a class="link" href="options.html#opt-services.usbmuxd.package"  >services.usbmuxd.package</a></p></li><li class="listitem"><p><code class="literal">netbox</code> was updated to 3.5. NixOS’ <code class="literal">services.netbox.package</code> still defaults to 3.3 if <code class="literal">stateVersion</code> is earlier than 23.05. Please review upstream’s breaking changes <a class="link" href="https://github.com/netbox-community/netbox/releases/tag/v3.4.0"  target="_top">for 3.4.0</a> and <a class="link" href="https://github.com/netbox-community/netbox/releases/tag/v3.5.0"  target="_top">for 3.5.0</a>, and upgrade NetBox by changing <code class="literal">services.netbox.package</code>. Database migrations will be run automatically.</p></li><li class="listitem"><p><code class="literal">services.netbox</code> now support RFC42-style options, through <code class="literal">services.netbox.settings</code>.</p></li><li class="listitem"><p><code class="literal">services.mastodon</code> gained a tootctl wrapped named <code class="literal">mastodon-tootctl</code> similar to <code class="literal">nextcloud-occ</code> which can be executed from any user and switches to the configured mastodon user with sudo and sources the environment variables.</p></li><li class="listitem"><p><code class="literal">services.borgmatic</code> now allows for multiple configurations, placed in <code class="literal">/etc/borgmatic.d/</code>, you can define them with <code class="literal">services.borgmatic.configurations</code>.</p></li><li class="listitem"><p><code class="literal">service.openafsServer</code> features a new backup server <code class="literal">pkgs.fabs</code> as a
replacement for openafs’s own <code class="literal">buserver</code>. See
<a class="link" href="https://github.com/openafs-contrib/fabs"  target="_top">FABS</a> to check if this is an viable
replacement. It stores backups as volume dump files and thus better integrates
into contemporary backup solutions.</p></li><li class="listitem"><p><code class="literal">services.maddy</code> got several updates:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Configuration of users and their credentials using <code class="literal">services.maddy.ensureCredentials</code>.</p></li><li class="listitem"><p>TLS configuration is now possible via <code class="literal">services.maddy.tls</code> with two loaders present: ACME and file based.</p></li></ul></div></li><li class="listitem"><p>The <code class="literal">dnsmasq</code> service now takes configuration via the
<code class="literal">services.dnsmasq.settings</code> attribute set. The option
<code class="literal">services.dnsmasq.extraConfig</code> will be deprecated when NixOS 22.11 reaches
end of life.</p></li><li class="listitem"><p>The <code class="literal">dokuwiki</code> service is now configured via <code class="literal">services.dokuwiki.sites.&lt;name&gt;.settings</code> attribute set; <code class="literal">extraConfig</code> has been removed.
The <code class="literal">{aclUse,superUser,disableActions}</code> attributes have been renamed accordingly. <code class="literal">pluginsConfig</code> now only accepts an attribute set of booleans.
Passing plain PHP is no longer possible.
Same applies to <code class="literal">acl</code> which now also only accepts structured <code class="literal">settings</code>.</p></li><li class="listitem"><p>The <code class="literal">zsh</code> package changes the way to set environment variables on NixOS systems where <code class="literal">programs.zsh.enable</code> equals <code class="literal">false</code>.  It now sources <code class="literal">/etc/set-environment</code> when reading the system-level <code class="literal">zshenv</code> file.  Before, it sourced <code class="literal">/etc/profile</code> when reading the system-level <code class="literal">zprofile</code> file.</p></li><li class="listitem"><p>The <code class="literal">wordpress</code> service now takes configuration via the <code class="literal">services.wordpress.sites.&lt;name&gt;.settings</code> attribute set, <code class="literal">extraConfig</code> is still available to append  additional text to <code class="literal">wp-config.php</code>.</p></li><li class="listitem"><p>To reduce closure size in <code class="literal">nixos/modules/profiles/minimal.nix</code> profile disabled installation documentations and manuals. Also disabled <code class="literal">logrotate</code> and <code class="literal">udisks2</code> services.</p></li><li class="listitem"><p>To reduce closure size in <code class="literal">nixos/modules/installer/netboot/netboot-minimal.nix</code> profile disabled load linux firmwares, pre-installing the complete stdenv and <code class="literal">networking.wireless</code> service.</p></li><li class="listitem"><p>The minimal ISO image now uses the <code class="literal">nixos/modules/profiles/minimal.nix</code> profile.</p></li><li class="listitem"><p>NixOS installer ISOs can now be built for <code class="literal">powerpc64le-linux</code>; see <code class="literal">nixos/modules/installer/sd-card/sd-image-powerpc64le.nix</code> and <a class="link" href="https://github.com/NixOS/nixpkgs/pull/192672"  target="_top">PR 192672</a>.  Hydra does not support this platform, so you must build the binaries yourself.</p></li><li class="listitem"><p>The <code class="literal">ghcWithPackages</code> and <code class="literal">ghcWithHoogle</code> wrappers will now also symlink GHC’s
and all included libraries’ documentation to <code class="literal">$out/share/doc</code> for convenience.
If undesired, the old behavior can be restored by overriding the builders with
<code class="literal">{ installDocumentation = false; }</code>.</p></li><li class="listitem"><p>The nftables module now validates its ruleset at build time. The new <code class="literal">networking.nftables.checkRuleset</code> option allows disabling this check, which may fail when rules have very specific requirements, that the sandbox environment, by default, will not cover. The <code class="literal">networking.nftables.preCheckRuleset</code> option can be used to prepare the environment before the checks are run.</p></li><li class="listitem"><p>The <code class="literal">services.mastodon</code> module now supports connection to a remote <code class="literal">PostgreSQL</code> database.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.nextcloud.database.createLocally"  ><code class="literal">services.nextcloud.database.createLocally</code></a> now uses socket authentication and is no longer compatible with password authentication.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>If you want the module to manage the database for you, unset <a class="link" href="options.html#opt-services.nextcloud.config.dbpassFile"  ><code class="literal">services.nextcloud.config.dbpassFile</code></a> (and <a class="link" href="options.html#opt-services.nextcloud.config.dbhost"  ><code class="literal">services.nextcloud.config.dbhost</code></a>, if it’s set).</p></li><li class="listitem"><p>If you want to use password authentication <span class="strong"><strong>and</strong></span> create the database locally, you will have to use <a class="link" href="options.html#opt-services.mysql.enable"  ><code class="literal">services.mysql</code></a> to set it up.</p></li></ul></div></li><li class="listitem"><p><a class="link" href="options.html#opt-services.nextcloud.config.objectstore.s3.sseCKeyFile"  ><code class="literal">services.nextcloud.config.objectstore.s3.sseCKeyFile</code></a> is a new option to enable server-side encryption with customer provided keys (SSE-C) for your S3 in Nextcloud.</p></li><li class="listitem"><p>NixOS swap partitions with random encryption can now control the sector size, cipher, and key size used to set up the plain encryption device over the underlying block device rather than allowing them to be determined by <code class="literal">cryptsetup(8)</code>. One can use these features like so:</p><pre><code class="programlisting nix">{
  swapDevices = [ {
    device = &quot;/dev/disk/by-partlabel/swapspace&quot;;
    randomEncryption = {
      enable = true;
      cipher = &quot;aes-xts-plain64&quot;;
      keySize = 512;
      sectorSize = 4096;
    };
  } ];
}
</code></pre></li><li class="listitem"><p>New option <code class="literal">security.pam.zfs</code> to enable unlocking and mounting of encrypted ZFS home dataset at login.</p></li><li class="listitem"><p><code class="literal">services.peertube</code> now requires you to specify the secret file <code class="literal">secrets.secretsFile</code>. It can be generated by running <code class="literal">openssl rand -hex 32</code>.  Before upgrading, check the release notes for <a class="link" href="https://github.com/Chocobozzz/PeerTube/releases/tag/v5.0.0"  target="_top">PeerTube v5.0.0</a>.And backup your data.</p></li><li class="listitem"><p><code class="literal">services.chronyd</code> is now started with additional systemd sandbox/hardening options for better security.</p></li><li class="listitem"><p>PostgreSQL has added opt-in support for <a class="link" href="https://www.postgresql.org/docs/current/jit-reason.html"  target="_top">JIT compilation</a>. It can be enabled like this:</p><pre><code class="programlisting nix">{
  services.postgresql.enableJIT = true;
}
</code></pre></li><li class="listitem"><p><code class="literal">services.netdata</code> offers a <a class="link" href="options.html#opt-services.netdata.deadlineBeforeStopSec"  ><code class="literal">services.netdata.deadlineBeforeStopSec</code></a> option which will control the deadline (in seconds) after which systemd will consider your netdata instance as dead if it didn’t start in the elapsed time. It is helpful when your netdata instance takes longer to start because of a large amount of state or upgrades.</p></li><li class="listitem"><p><code class="literal">services.dhcpcd</code> service stopped soliciting or accepting IPv6 Router Advertisements on interfaces that use static IPv6 addresses.
If your network provides both IPv6 unique local addresses (ULA) and globally unique addresses (GUA) through autoconfiguration with SLAAC, you must add the parameter <code class="literal">networking.dhcpcd.IPv6rs = true;</code>.</p></li><li class="listitem"><p>The module <code class="literal">services.headscale</code> was refactored to be compliant with <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md"  target="_top">RFC 0042</a>. To be precise, this means that the following things have changed:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Most settings have been migrated below <a class="link" href="options.html#opt-services.headscale.settings"  >services.headscale.settings</a> which is a freeform attribute-set that will be converted into headscale’s YAML config format. This means that the configuration from <a class="link" href="https://github.com/juanfont/headscale/blob/main/config-example.yaml"  target="_top">headscale’s example configuration</a> can be directly written as attribute-set in Nix within this option.</p></li></ul></div></li><li class="listitem"><p><code class="literal">services.kubo</code> now unmounts <code class="literal">ipfsMountDir</code> and <code class="literal">ipnsMountDir</code> even if it is killed unexpectedly when <code class="literal">autoMount</code> is enabled.</p></li><li class="listitem"><p><code class="literal">services.grafana</code> listens only on localhost by default again. This was changed to the upstream default of <code class="literal">0.0.0.0</code> by accident in the freeform setting conversion.</p></li><li class="listitem"><p>Grafana Tempo has been updated to version 2.0. See the <a class="link" href="https://grafana.com/docs/tempo/latest/release-notes/v2-0/#upgrade-considerations"  target="_top">upstream upgrade guide</a> for migration instructions.</p></li><li class="listitem"><p>A new <code class="literal">virtualisation.rosetta</code> module was added to allow running <code class="literal">x86_64</code> binaries through <a class="link" href="https://developer.apple.com/documentation/apple-silicon/about-the-rosetta-translation-environment"  target="_top">Rosetta</a> inside virtualised NixOS guests on Apple Silicon. This feature works by default with the <a class="link" href="https://docs.getutm.app/"  target="_top">UTM</a> virtualisation <a class="link" href="https://search.nixos.org/packages?channel=23.05&amp;show=utm&amp;from=0&amp;size=1&amp;sort=relevance&amp;type=packages&amp;query=utm"  target="_top">package</a>.</p></li><li class="listitem"><p>The new option <code class="literal">users.motdFile</code> allows configuring a Message Of The Day that can be updated dynamically.</p></li><li class="listitem"><p>The <code class="literal">root</code> package is now built with the <code class="literal">&quot;-Dgnuinstall=ON&quot;</code> CMake flag, making the output conform the <code class="literal">bin</code> <code class="literal">lib</code> <code class="literal">share</code> layout. In this layout, <code class="literal">tutorials</code> is under <code class="literal">share/doc/ROOT/</code>; <code class="literal">cmake</code>, <code class="literal">font</code>, <code class="literal">icons</code>, <code class="literal">js</code> and <code class="literal">macro</code> under <code class="literal">share/root</code>; <code class="literal">Makefile.comp</code> and <code class="literal">Makefile.config</code> under <code class="literal">etc/root</code>.</p></li><li class="listitem"><p>There are various new options in the <code class="literal">services.nginx</code> module:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Enabling global redirect in <code class="literal">services.nginx.virtualHosts</code> now allows one to add exceptions with the <code class="literal">locations</code> option.</p></li><li class="listitem"><p>The <code class="literal">proxyCachePath</code> option has been added to <code class="literal">services.nginx</code>. It allows configuring the <a class="link" href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_cache_path"  target="_top"><code class="literal">proxy_cache_path</code></a>, that configures the storage path and various other settings for the cache.</p></li><li class="listitem"><p>A new option <code class="literal">recommendedBrotliSettings</code> has been added to <code class="literal">services.nginx</code>. Learn more about compression in Brotli format <a class="link" href="https://github.com/google/ngx_brotli/blob/master/README.md"  target="_top">here</a>.</p></li><li class="listitem"><p><code class="literal">services.nginx.recommendedProxySettings</code> now removes the <code class="literal">Connection</code> header preventing clients from closing backend connections.</p></li></ul></div></li><li class="listitem"><p>The nginx module also received an update to <code class="literal">services.nginx.recommendedGzipSettings</code>:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Enables gzip compression for only certain proxied requests.</p></li><li class="listitem"><p>Allow checking and loading of precompressed files.</p></li><li class="listitem"><p>Updated gzip mime-types.</p></li><li class="listitem"><p>Increased the minimum length of a response that will be gzipped.</p></li></ul></div></li><li class="listitem"><p><a class="link" href="https://garagehq.deuxfleurs.fr/"  target="_top">Garage</a> version is based on <a class="link" href="options.html#opt-system.stateVersion"  target="_top">system.stateVersion</a>, existing installations will keep using version 0.7. New installations will use version 0.8. In order to upgrade a Garage cluster, please follow <a class="link" href="https://garagehq.deuxfleurs.fr/documentation/cookbook/upgrading/"  target="_top">upstream instructions</a> and configure <a class="link" href="options.html#opt-services.garage.package"  target="_top">services.garage.package</a>.</p></li><li class="listitem"><p>Nebula now supports the <code class="literal">services.nebula.networks.&lt;name&gt;.isRelay</code> and <code class="literal">services.nebula.networks.&lt;name&gt;.relays</code> configuration options for setting up or allowing traffic relaying. See the <a class="link" href="https://www.defined.net/blog/announcing-relay-support-in-nebula/"  target="_top">announcement</a> for more details about relays.</p></li><li class="listitem"><p>Resilio sync secret keys can now be provided using a secrets file at runtime, preventing these secrets from ending up in the Nix store.</p></li><li class="listitem"><p>The <code class="literal">firewall</code> and <code class="literal">nat</code> modules can now optionally rely on an nftables based implementation. Enable <code class="literal">networking.nftables</code> to use it.</p></li><li class="listitem"><p>The <code class="literal">services.fwupd</code> module now allows arbitrary daemon settings to be configured in a structured manner (<a class="link" href="options.html#opt-services.fwupd.daemonSettings"  ><code class="literal">services.fwupd.daemonSettings</code></a>).</p></li><li class="listitem"><p><code class="literal">services.xserver.desktopManager.plasma5.phononBackend</code> now defaults to vlc according to <a class="link" href="https://community.kde.org/Distributions/Packaging_Recommendations#Non-Plasma_packages"  target="_top">upstrean recommendation</a></p></li><li class="listitem"><p>The <code class="literal">zramSwap</code> is now implemented with <code class="literal">zram-generator</code>, and the option <code class="literal">zramSwap.numDevices</code> for using ZRAM devices as general purpose ephemeral block devices has been removed.</p></li><li class="listitem"><p>As Singularity has renamed to <a class="link" href="https://apptainer.org/news/community-announcement-20211130"  target="_top">Apptainer</a>
to distinguish from <a class="link" href="https://sylabs.io/2021/05/singularity-community-edition"  target="_top">an un-renamed fork by Sylabs Inc.</a>,
there are now two packages of Singularity/Apptainer:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">apptainer</code>: From <code class="literal">github.com/apptainer/apptainer</code>, which is the new repo after renaming.</p></li><li class="listitem"><p><code class="literal">singularity</code>: From <code class="literal">github.com/sylabs/singularity</code>, which is the fork by Sylabs Inc…</p></li></ul></div><p><code class="literal">singularity-tools.buildImage</code> got a new input argument <code class="literal">singularity</code> to specify which package to use.</p></li><li class="listitem"><p>The new option <code class="literal">programs.singularity.enableFakeroot</code>, if set to <code class="literal">true</code>, provides <code class="literal">--fakeroot</code> support for <code class="literal">apptainer</code> and <code class="literal">singularity</code>.</p></li><li class="listitem"><p>The new option <code class="literal">services.tailscale.useRoutingFeatures</code> controls various settings for using Tailscale features like exit nodes and subnet routers. If you wish to use your machine as an exit node, you can set this setting to <code class="literal">server</code>, otherwise if you wish to use an exit node you can set this setting to <code class="literal">client</code>. The strict RPF warning has been removed as the RPF will be loosened automatically based on the value of this setting.</p></li><li class="listitem"><p><code class="literal">openjdk</code> from version 11 and above is not build with <code class="literal">openjfx</code> (i.e.: JavaFX) support by default anymore. You can re-enable it by overriding, e.g.: <code class="literal">openjdk11.override { enableJavaFX = true; };</code>.</p></li><li class="listitem"><p><a class="link" href="https://xastir.org/index.php/Main_Page"  target="_top">Xastir</a> can now access AX.25 interfaces via the <code class="literal">libax25</code> package.</p></li><li class="listitem"><p><code class="literal">nixos-version</code> now accepts <code class="literal">--configuration-revision</code> to display more information about the current generation revision</p></li><li class="listitem"><p>The option <code class="literal">services.nomad.extraSettingsPlugins</code> has been fixed to allow more than one plugin in the path.</p></li><li class="listitem"><p>The option <code class="literal">services.prometheus.exporters.pihole.interval</code> does not exist anymore and has been removed.</p></li><li class="listitem"><p>The option <code class="literal">services.gpsd.device</code> has been replaced with  <code class="literal">services.gpsd.devices</code>, which supports multiple devices.</p></li><li class="listitem"><p><code class="literal">k3s</code> can now be configured with an <code class="literal">EnvironmentFile</code> for its systemd service, allowing secrets to be provided without ending up in the Nix Store.</p></li><li class="listitem"><p>The <code class="literal">gitea</code> module options have been moved into a freeform attribute set below <code class="literal">services.gitea.settings</code>.</p></li><li class="listitem"><p><code class="literal">boot.initrd.luks.device.&lt;name&gt;</code> has a new <code class="literal">tryEmptyPassphrase</code> option, this is useful for OEMs who need to install an encrypted disk with a future settable passphrase</p></li><li class="listitem"><p>The <code class="literal">bind</code> module now allows the per-zone <code class="literal">allow-query</code> setting to be configured (previously it was hard-coded to <code class="literal">any</code>; it still defaults to <code class="literal">any</code> to retain compatibility).</p></li><li class="listitem"><p>The option <code class="literal">services.jitsi-videobridge.apis</code> has been renamed to <code class="literal">colibriRestApi</code> and turned into a boolean. Setting it to <code class="literal">true</code> will enable the private rest API, useful for monitoring using <code class="literal">services.prometheus.exporters.jitsi.enable</code>. Learn more about the API: “<a class="link" href="https://github.com/jitsi/jitsi-videobridge/blob/v2.3/doc/rest.md"  target="_top">The COLIBRI control interface (/colibri/)</a>”.</p></li><li class="listitem"><p>Booting from a volume managed by the Stratis storage management daemon is now supported. Use <code class="literal">fileSystems.&lt;name&gt;.stratis.poolUuid</code> to configure the pool containing the fs.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-23.05-nixpkgs-internals" class="title" >Nixpkgs internals   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">buildDunePackage</code> now defaults to <code class="literal">strictDeps = true</code> which means that any library should go into <code class="literal">buildInputs</code> or <code class="literal">checkInputs</code>. Any executable that is run on the building machine should go into <code class="literal">nativeBuildInputs</code> or <code class="literal">nativeCheckInputs</code> respectively. Example of executables are <code class="literal">ocaml</code>, <code class="literal">findlib</code> and <code class="literal">menhir</code>. PPXs are libraries which are built by dune and should therefore not go into <code class="literal">nativeBuildInputs</code>.</p></li><li class="listitem"><p><code class="literal">buildFHSUserEnv</code> is now called <code class="literal">buildFHSEnv</code> and uses FlatPak’s Bubblewrap sandboxing tool rather than Nixpkgs’ own chrootenv. The old chrootenv-based implementation is still available via <code class="literal">buildFHSEnvChroot</code> but is considered deprecated and will be removed when the remaining uses inside Nixpkgs have been migrated. If your FHSEnv-wrapped application misbehaves when using the new bubblewrap implementation, please create an issue in Nixpkgs.</p></li><li class="listitem"><p>Top-level <code class="literal">buildPlatform</code>, <code class="literal">hostPlatform</code>, <code class="literal">targetPlatform</code> have been deprecated, use <code class="literal">stdenv.X</code> instead.</p></li><li class="listitem"><p><code class="literal">carnix</code> and <code class="literal">cratesIO</code> has been removed due to being unmaintained, use alternatives such as <a class="link" href="https://github.com/nix-community/naersk"  target="_top">naersk</a> and <a class="link" href="https://github.com/kolloch/crate2nix"  target="_top">crate2nix</a> instead.</p></li><li class="listitem"><p><code class="literal">checkInputs</code> have been renamed to <code class="literal">nativeCheckInputs</code>, because they behave the same as <code class="literal">nativeBuildInputs</code> when <code class="literal">doCheck</code> is set. <code class="literal">checkInputs</code> now denote a new type of dependencies, added to <code class="literal">buildInputs</code> when <code class="literal">doCheck</code> is set. As a rule of thumb, <code class="literal">nativeCheckInputs</code> are tools on <code class="literal">$PATH</code> used during the tests, and <code class="literal">checkInputs</code> are libraries which are linked to executables built as part of the tests. Similarly, <code class="literal">installCheckInputs</code> are renamed to <code class="literal">nativeInstallCheckInputs</code>, corresponding to <code class="literal">nativeBuildInputs</code>, and <code class="literal">installCheckInputs</code> are a new type of dependencies added to <code class="literal">buildInputs</code> when <code class="literal">doInstallCheck</code> is set. (Note that this change will not cause breakage to derivations with <code class="literal">strictDeps</code> unset, which are most packages except python, rust, ocaml and go packages).</p></li><li class="listitem"><p>DocBook option documentation, which has been deprecated since 22.11, will now cause a warning when documentation is built. Out-of-tree modules should migrate to using CommonMark documentation as outlined in <a class="xref" href="index.html#sec-option-declarations" title="Option Declarations" >the section called “Option Declarations”</a> to silence this warning.</p><p>DocBook option documentation support will be removed in the next release and CommonMark will become the default. DocBook option documentation that has not been migrated until then will no longer render properly or cause errors.</p></li><li class="listitem"><p><code class="literal">lib.systems.examples.ghcjs</code> and consequently <code class="literal">pkgsCross.ghcjs</code> now use the target triplet <code class="literal">javascript-unknown-ghcjs</code> instead of <code class="literal">js-unknown-ghcjs</code>. This has been done to match an <a class="link" href="https://gitlab.haskell.org/ghc/ghc/-/commit/6636b670233522f01d002c9b97827d00289dbf5c"  target="_top">upstream decision</a> to follow Cabal’s platform naming more closely. Nixpkgs will also reject <code class="literal">js</code> as an architecture name.</p></li><li class="listitem"><p>Lisp gained a <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#lisp"  target="_top">manual section</a>, documenting a new and backwards incompatible interface. The previous interface will be removed in a future release.</p></li><li class="listitem"><p>Calling <code class="literal">makeSetupHook</code> without passing a <code class="literal">name</code> argument is deprecated.</p></li><li class="listitem"><p><code class="literal">nixos/lib/make-disk-image.nix</code> handles <code class="literal">contents</code> arguments that are directories better, fixing a bug where it used to put them in a subdirectory of the intended <code class="literal">target</code>.</p></li><li class="listitem"><p><code class="literal">nixos/lib/make-disk-image.nix</code> can now mutate EFI variables, run user-provided EFI firmware or variable templates. This is now extensively documented in the NixOS manual.</p></li><li class="listitem"><p>Nixpkgs now uses <a class="link" href="https://github.com/NixOS/nixpkgs/pull/170215"  target="_top">IEEE-standard floating point arithmetic</a> on <code class="literal">powerpc64le-linux</code>.</p></li><li class="listitem"><p>Deprecated <code class="literal">xlibsWrapper</code> transitional package has been removed in favour of direct use of its constituents: <code class="literal">xorg.libX11</code>, <code class="literal">freetype</code> and others.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-23.05-migration" class="title" >Detailed migration information   </h3>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h4 id="sec-release-23.05-migration-pipewire" class="title" >Pipewire configuration overrides   </h4>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="sec-release-23.05-migration-pipewire-why" class="title" >Why this change?   </h5>  </div> </div></div><p>The Pipewire config semantics don’t really match the NixOS module semantics, so it’s extremely awkward to override the default config, especially when lists are involved. Vendoring the configuration files in nixpkgs also creates unnecessary maintenance overhead.</p><p>Also, upstream added a lot of accommodations to allow doing most of the things you’d want to do with a config edit in better ways.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="sec-release-23.05-migration-pipewire-how" class="title" >Migrating your configuration   </h5>  </div> </div></div><p>Compare your settings to <a class="link" href="https://gitlab.freedesktop.org/pipewire/pipewire/-/tree/master/src/daemon"  target="_top">the defaults</a> and where your configuration differs from them.</p><p>Then, create a drop-in JSON file in <code class="literal">/etc/pipewire/&lt;config file name&gt;.d/99-custom.conf</code> (the actual filename can be anything) and migrate your changes to it according to the following sections.</p><p>Repeat for every file you’ve modified, changing the directory name accordingly.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="sec-release-23.05-migration-pipewire-simple" class="title" >Things you can just copy over   </h5>  </div> </div></div><p>If you are:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>setting properties via <code class="literal">*.properties</code></p></li><li class="listitem"><p>loading a new module to <code class="literal">context.modules</code></p></li><li class="listitem"><p>creating new objects with <code class="literal">context.objects</code></p></li><li class="listitem"><p>declaring SPA libraries with <code class="literal">context.spa-libs</code></p></li><li class="listitem"><p>running custom commands with <code class="literal">context.exec</code></p></li><li class="listitem"><p>adding new rules with <code class="literal">*.rules</code></p></li><li class="listitem"><p>running custom PulseAudio commands with <code class="literal">pulse.cmd</code></p></li></ul></div><p>Move the definitions into the drop-in.</p><p>Note that the use of <code class="literal">context.exec</code> is not recommended and other methods of running your thing are likely a better option.</p><pre><code class="programlisting json">{
  &quot;context.properties&quot;: {
    &quot;your.property.name&quot;: &quot;your.property.value&quot;
  },
  &quot;context.modules&quot;: [
    { &quot;name&quot;: &quot;libpipewire-module-my-cool-thing&quot; }
  ],
  &quot;context.objects&quot;: [
    { &quot;factory&quot;: { ... } }
  ],
  &quot;alsa.rules&quot;: [
    { &quot;matches: { ... }, &quot;actions&quot;: { ... } }
  ]
}
</code></pre>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="sec-release-23.05-migration-pipewire-removing-modules" class="title" >Removing a module from <code class="literal">context.modules</code>   </h5>  </div> </div></div><p>Look for an option to disable it via <code class="literal">context.properties</code> (<code class="literal">&quot;module.x11.bell&quot;: &quot;false&quot;</code> is likely the most common use case here).
If one is not available, proceed to <a class="link" href="release-notes.html#sec-release-23.05-migration-pipewire" title="Pipewire configuration overrides" >Nuclear option</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="sec-release-23.05-migration-pipewire-modifying-modules" class="title" >Modifying a module’s parameters in <code class="literal">context.modules</code>   </h5>  </div> </div></div><p>For most modules (e.g. <code class="literal">libpipewire-module-rt</code>) it’s enough to load the module again with the new arguments, e.g.:</p><pre><code class="programlisting json">{
  &quot;context.modules&quot;: [
    {
      &quot;name&quot;: &quot;libpipewire-module-rt&quot;,
      &quot;args&quot;: {
        &quot;rt.prio&quot;: 90
      }
    }
  ]
}
</code></pre><p>Note that <code class="literal">module-rt</code> specifically will generally use the highest values available by default, so setting limits on the <code class="literal">pipewire</code> systemd service is preferable to reloading.</p><p>If reloading the module is not an option, proceed to <a class="link" href="release-notes.html#sec-release-23.05-migration-pipewire" title="Pipewire configuration overrides" >Nuclear option</a>.</p>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h5 id="sec-release-23.05-migration-pipewire-nuclear" class="title" >Nuclear option   </h5>  </div> </div></div><p>If all else fails, you can still manually copy the contents of the default configuration file
from <code class="literal">${pkgs.pipewire}/share/pipewire</code> to <code class="literal">/etc/pipewire</code> and edit it to fully override the default.
However, this should be done only as a last resort. Please talk to the Pipewire maintainers if you ever need to do this.</p>
</div>

</div>

</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-22.11" class="title" style="clear: both">Release 22.11 (“Raccoon”, 2022.11/30)   </h2>  </div> </div></div><p>The NixOS release team is happy to announce a new version of NixOS 22.11. NixOS is a Linux distribution, whose set of packages can also be used on other Linux systems and macOS.</p><p>This release is supported until the end of June 2023, handing over to NixOS 23.05.</p><p>To upgrade to the latest release follow the <a class="link" href="index.html#sec-upgrading" title="Upgrading NixOS" >upgrade chapter</a>.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-22.11-highlights" class="title" >Highlights   </h3>  </div> </div></div><p>In addition to numerous new and upgraded packages, this release includes the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Software that uses the <code class="literal">crypt</code> password hashing API is now using the implementation provided by <a class="link" href="https://github.com/besser82/libxcrypt"  target="_top"><code class="literal">libxcrypt</code></a> instead of glibc’s, which enables support for more secure algorithms.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Support for algorithms that <code class="literal">libxcrypt</code> <a class="link" href="https://github.com/besser82/libxcrypt/blob/v4.4.28/lib/hashes.conf#L41"  target="_top">does not consider strong</a> are <span class="strong"><strong>deprecated</strong></span> as of this release, and will be removed in NixOS 23.05.</p></li><li class="listitem"><p>This includes system login passwords. Given this, we <span class="strong"><strong>strongly encourage</strong></span> all users to update their system passwords, as you will be unable to login if password hashes are not migrated by the time their support is removed.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square;"><li class="listitem"><p>When using <code class="literal">users.users.&lt;name&gt;.hashedPassword</code> to configure user passwords, run <code class="literal">mkpasswd</code>, and use the yescrypt hash that is provided as the new value.</p></li><li class="listitem"><p>On the other hand, for interactively configured user passwords, re-set the passwords for all users with <code class="literal">passwd</code>.</p></li><li class="listitem"><p>This release introduces warnings for the use of deprecated hash algorithms for both methods of configuring passwords. To make sure you migrated correctly, run <code class="literal">nixos-rebuild switch</code>.</p></li></ul></div></li></ul></div></li><li class="listitem"><p>The NixOS documentation is now generated from markdown. While docbook is still part of the documentation build process, it’s a big step towards the full migration.</p></li><li class="listitem"><p><code class="literal">aarch64-linux</code> is now included in the <code class="literal">nixos-22.11</code> and <code class="literal">nixos-22.11-small</code> channels. This means that when those channel update, both <code class="literal">x86_64-linux</code> and <code class="literal">aarch64-linux</code> will be available in the binary cache.</p></li><li class="listitem"><p><code class="literal">aarch64-linux</code> ISOs are now available on the <a class="link" href="https://nixos.org/download.html"  target="_top">downloads page</a>.</p></li><li class="listitem"><p><code class="literal">nsncd</code> is now available as a replacement of <code class="literal">nscd</code>.</p><p><code class="literal">nscd</code> is responsible for resolving hostnames, users and more in NixOS and has been a long standing source of bugs, such as sporadic network freezes.</p><p>More context in this <a class="link" href="https://github.com/NixOS/nixpkgs/issues/135888"  target="_top">issue</a>.</p><p>Help us test the new implementation by setting <code class="literal">services.nscd.enableNsncd</code> to <code class="literal">true</code>.</p><p>We plan to use <code class="literal">nsncd</code> by default in NixOS 23.05.</p></li><li class="listitem"><p>Linode cloud images are now supported by importing <code class="literal">${modulesPath}/virtualisation/linode-image.nix</code> and accessing <code class="literal">system.build.linodeImage</code> on the output.</p></li><li class="listitem"><p><code class="literal">hardware.nvidia</code> has a new option, <code class="literal">hardware.nvidia.open</code>, that can be used to enable the usage of NVIDIA’s open-source kernel driver. Note that the driver’s support for GeForce and Workstation GPUs is still alpha quality, see <a class="link" href="https://developer.nvidia.com/blog/nvidia-releases-open-source-gpu-kernel-modules/"  target="_top">the release announcement</a> for more information.</p></li><li class="listitem"><p>The <code class="literal">emacs</code> package now makes use of native compilation which means:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Emacs packages from Nixpkgs, builtin or not, will do native compilation ahead of time so you can enjoy the benefit of native compilation without compiling them on you machine;</p></li><li class="listitem"><p>Emacs packages from somewhere else, e.g. <code class="literal">package-install</code>, will perform asynchronously deferred native compilation. If you do not want this, maybe to avoid CPU consumption for compilation, you can use <code class="literal">(setq native-comp-deferred-compilation nil)</code> to disable it while still benefiting from native compilation for packages from Nixpkgs.</p></li></ul></div></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-22.11-internal" class="title" >Internal changes   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Haskell <code class="literal">ghcWithPackages</code> is now up to 15 times faster to evaluate, thanks to changing <code class="literal">lib.closePropagation</code> from a quadratic to linear complexity. Please see backward incompatibilities notes below. <a class="link" href="https://github.com/NixOS/nixpkgs/pull/194391"  target="_top">https://github.com/NixOS/nixpkgs/pull/194391</a></p></li><li class="listitem"><p>For cross-compilation targets that can also run on the building machine, we now run tests. This, for example, is the case for the <code class="literal">pkgsStatic</code> and <code class="literal">pkgsLLVM</code> package sets or i686 packages on <code class="literal">x86_64</code> machines.</p></li><li class="listitem"><p>To simplify cross-compilation in NixOS, this release introduces the <code class="literal">nixpkgs.hostPlatform</code> and <code class="literal">nixpkgs.buildPlatform</code> options. These cover and override the <code class="literal">nixpkgs.{system,localSystem,crossSystem}</code> options.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">hostPlatform</code> is the platform or “<code class="literal">system</code>” string of the NixOS system
described by the configuration.</p></li><li class="listitem"><p><code class="literal">buildPlatform</code> is the platform that is responsible for building the NixOS
configuration. It defaults to the <code class="literal">hostPlatform</code>, for a non-cross
build configuration. To cross compile, set <code class="literal">buildPlatform</code> to a different
value.</p></li></ul></div><p>The new options convey the same information, but with fewer options, and
following the Nixpkgs terminology.</p><p>The existing options <code class="literal">nixpkgs.{system,localSystem,crossSystem}</code> have not
been formally deprecated, to allow for evaluation of the change and to allow
for a transition period so that in time the ecosystem can switch without
breaking compatibility with any supported NixOS release.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-22.11-version-updates" class="title" >Notable version updates   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Nix has been upgraded from v2.8.1 to v2.11.0. For more information, please see the release notes for <a class="link" href="https://nixos.org/manual/nix/stable/release-notes/rl-2.9.html"  target="_top">2.9</a>, <a class="link" href="https://nixos.org/manual/nix/stable/release-notes/rl-2.10.html"  target="_top">2.10</a> and <a class="link" href="https://nixos.org/manual/nix/stable/release-notes/rl-2.11.html"  target="_top">2.11</a>.</p></li><li class="listitem"><p>OpenSSL now defaults to OpenSSL 3, updated from 1.1.1.</p></li><li class="listitem"><p>GNOME has been upgraded to version 43. Please see the <a class="link" href="https://release.gnome.org/43/"  target="_top">release notes</a> for details.</p></li><li class="listitem"><p>KDE Plasma has been upgraded from v5.24 to v5.26. Please see the release notes for <a class="link" href="https://kde.org/announcements/plasma/5/5.25.0/"  target="_top">v5.25</a> and <a class="link" href="https://kde.org/announcements/plasma/5/5.26.0/"  target="_top">v5.26</a> for more details on the included changes.</p></li><li class="listitem"><p>Cinnamon has been updated to 5.4, and the Cinnamon module now defaults to
Blueman as the Bluetooth manager and slick-greeter as the LightDM greeter, to match upstream.</p></li><li class="listitem"><p>PHP now defaults to PHP 8.1, updated from 8.0.</p></li><li class="listitem"><p>Perl has been updated to 5.36, and its core module <code class="literal">HTTP::Tiny</code> was patched to verify SSL/TLS certificates by default.</p></li><li class="listitem"><p>Python now defaults to 3.10, updated from 3.9.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-22.11-incompatibilities" class="title" >Backward Incompatibilities   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Nixpkgs now requires Nix 2.3 or newer.</p></li><li class="listitem"><p>The <code class="literal">isCompatible</code> predicate checking CPU compatibility is no longer exposed
by the platform sets generated using <code class="literal">lib.systems.elaborate</code>. In most cases
you will want to use the new <code class="literal">canExecute</code> predicate instead which also
takes the kernel / syscall interface into account.
<code class="literal">lib.systems.parse.isCompatible</code> still exists, but has changed semantically:
Architectures with differing endianness modes are <span class="emphasis"><em>no longer considered compatible</em></span>.</p></li><li class="listitem"><p><code class="literal">ngrok</code> has been upgraded from 2.3.40 to 3.0.4. Please see <a class="link" href="https://ngrok.com/docs/guides/upgrade-v2-v3"  target="_top">the upgrade guide</a>
and <a class="link" href="https://ngrok.com/docs/ngrok-agent/changelog"  target="_top">changelog</a>. Notably, breaking changes are that the config file format has
changed and support for single hyphen arguments was dropped.</p></li><li class="listitem"><p><code class="literal">i18n.supportedLocales</code> is now only generated with the locales set in <code class="literal">i18n.defaultLocale</code> and <code class="literal">i18n.extraLocaleSettings</code>.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>This reduces the final system closure size by up to 200MB.</p></li><li class="listitem"><p>If you require all locales installed, set the option to <code class="literal">[ &quot;all&quot; ]</code>.</p></li></ul></div></li><li class="listitem"><p>Deprecated settings <code class="literal">logrotate.paths</code> and <code class="literal">logrotate.extraConfig</code> have
been removed. Please convert any uses to
<a class="link" href="options.html#opt-services.logrotate.settings"  >services.logrotate.settings</a> instead.</p></li><li class="listitem"><p>The <code class="literal">isPowerPC</code> predicate, found on <code class="literal">platform</code> attrsets (<code class="literal">hostPlatform</code>, <code class="literal">buildPlatform</code>, <code class="literal">targetPlatform</code>, etc) has been removed in order to reduce confusion.  The predicate was was defined such that it matches only the 32-bit big-endian members of the POWER/PowerPC family, despite having a name which would imply a broader set of systems.  If you were using this predicate, you can replace <code class="literal">foo.isPowerPC</code> with <code class="literal">(with foo; isPower &amp;&amp; is32bit &amp;&amp; isBigEndian)</code>.</p></li><li class="listitem"><p>The <code class="literal">fetchgit</code> fetcher now uses <a class="link" href="https://www.git-scm.com/docs/git-sparse-checkout/2.37.0#_internalscone_mode_handling"  target="_top">cone mode</a> by default for sparse checkouts. <a class="link" href="https://www.git-scm.com/docs/git-sparse-checkout/2.37.0#_internalsnon_cone_problems"  target="_top">Non-cone mode</a> can be enabled by passing <code class="literal">nonConeMode = true</code>, but note that non-cone mode is deprecated and this option may be removed alongside a future Git update without notice.</p></li><li class="listitem"><p>The <code class="literal">fetchgit</code> fetcher supports sparse checkouts via the <code class="literal">sparseCheckout</code> option. This used to accept a multi-line string with directories/patterns to check out, but now requires a list of strings.</p></li><li class="listitem"><p><code class="literal">openssh</code> was updated to version 9.1, disabling the generation of DSA keys when using <code class="literal">ssh-keygen -A</code> as they are insecure. Also, <code class="literal">SetEnv</code> directives in <code class="literal">ssh_config</code> and <code class="literal">sshd_config</code> are now first-match-wins.</p></li><li class="listitem"><p><code class="literal">bsp-layout</code> no longer uses the command <code class="literal">cycle</code> to switch to other window layouts, as it got replaced by the commands <code class="literal">previous</code> and <code class="literal">next</code>.</p></li><li class="listitem"><p>The Barco ClickShare driver/client package <code class="literal">pkgs.clickshare-csc1</code> and the option <code class="literal">programs.clickshare-csc1.enable</code> have been removed,
as it requires <code class="literal">qt4</code>, which reached its end-of-life 2015 and will no longer be supported by nixpkgs.
<a class="link" href="https://www.barco.com/de/support/knowledge-base/4380-can-i-use-linux-os-with-clickshare-base-units"  target="_top">According to Barco</a> many of their base unit models can be used with Google Chrome and the Google Cast extension.</p></li><li class="listitem"><p><code class="literal">services.hbase</code> has been renamed to <code class="literal">services.hbase-standalone</code>.
For production HBase clusters, use <code class="literal">services.hadoop.hbase</code> instead.</p></li><li class="listitem"><p>The <code class="literal">p4</code> package now only includes the open-source Perforce Helix Core command-line client and APIs. It no longer installs the unfree Helix Core Server binaries <code class="literal">p4d</code>, <code class="literal">p4broker</code>, and <code class="literal">p4p</code>. To install the Helix Core Server binaries, use the <code class="literal">p4d</code> package instead.</p></li><li class="listitem"><p>The OpenSSL extension for the PHP interpreter used by Nextcloud is built against OpenSSL 1.1 if
<a class="xref" href="options.html#opt-system.stateVersion"  ><code class="option">system.stateVersion</code></a> is below <code class="literal">22.11</code>. This is to make sure that people using <a class="link" href="https://docs.nextcloud.com/server/latest/admin_manual/configuration_files/encryption_configuration.html"  target="_top">server-side encryption</a>
don’t lose access to their files.</p><p>In any other case, it’s safe to use OpenSSL 3 for PHP’s OpenSSL extension. This can be done by setting
<code class="literal">services.nextcloud.enableBrokenCiphersForSSE</code> to <code class="literal">false</code>.</p></li><li class="listitem"><p>The <code class="literal">coq</code> package and versioned variants starting at <code class="literal">coq_8_14</code> no
longer include CoqIDE, which is now available through
<code class="literal">coqPackages.coqide</code>. It is still possible to get CoqIDE as part of
the <code class="literal">coq</code> package by overriding the <code class="literal">buildIde</code> argument of the
derivation.</p></li><li class="listitem"><p>PHP 7.4 is no longer supported due to upstream not supporting this
version for the entire lifecycle of the 22.11 release.</p></li><li class="listitem"><p>The ipfs package and module were renamed to kubo. The kubo module now uses an RFC42-style <code class="literal">settings</code> option instead of <code class="literal">extraConfig</code> and the <code class="literal">gatewayAddress</code>, <code class="literal">apiAddress</code> and <code class="literal">swarmAddress</code> options were renamed. Using the old names will print a warning but still work.</p></li><li class="listitem"><p><code class="literal">pkgs.cosign</code> does not provide the <code class="literal">cosigned</code> binary anymore. The <code class="literal">sget</code> binary has been moved into its own package.</p></li><li class="listitem"><p>Emacs now uses the Lucid toolkit by default instead of GTK because of stability and compatibility issues.
Users who still wish to remain using GTK can do so by using <code class="literal">emacs-gtk</code>.</p></li><li class="listitem"><p><code class="literal">kanidm</code> has been updated to 1.1.0-alpha.10 and now requires a TLS certificate and key. It will always start <code class="literal">https</code> and-–-if enabled-–-an LDAPS server and no HTTP and LDAP server anymore.</p></li><li class="listitem"><p>riak package removed along with <code class="literal">services.riak</code> module, due to lack of maintainer to update the package.</p></li><li class="listitem"><p>ppd files in <code class="literal">pkgs.cups-drv-rastertosag-gdi</code> are now gzipped.  If you refer to such a ppd file with its path (e.g. via <a class="link" href="options.html#opt-hardware.printers.ensurePrinters"  target="_top">hardware.printers.ensurePrinters</a>) you will need to append <code class="literal">.gz</code> to the path.</p></li><li class="listitem"><p>xow package removed along with the <code class="literal">hardware.xow</code> module, due to the project being deprecated in favor of <code class="literal">xone</code>,  which is available via the <code class="literal">hardware.xone</code> module.</p></li><li class="listitem"><p>dd-agent package removed along with the <code class="literal">services.dd-agent</code> module, due to the project being deprecated in favor of <code class="literal">datadog-agent</code>,  which is available via the <code class="literal">services.datadog-agent</code> module.</p></li><li class="listitem"><p><code class="literal">teleport</code> has been upgraded to major version 10. Please see upstream <a class="link" href="https://goteleport.com/docs/ver/10.0/management/operations/upgrading/"  target="_top">upgrade instructions</a> and <a class="link" href="https://goteleport.com/docs/ver/10.0/changelog/#1000"  target="_top">release notes</a>.</p></li><li class="listitem"><p><code class="literal">lib.closePropagation</code> now needs that all gathered sets have an <code class="literal">outPath</code> attribute.</p></li><li class="listitem"><p>lemmy module option <code class="literal">services.lemmy.settings.database.createLocally</code>
moved to <code class="literal">services.lemmy.database.createLocally</code>.</p></li><li class="listitem"><p>virtlyst package and <code class="literal">services.virtlyst</code> module removed, due to lack of maintainers.</p></li><li class="listitem"><p>The <code class="literal">nix.checkConfig</code> option now fully disables the config check. The new <code class="literal">nix.checkAllErrors</code> option behaves like <code class="literal">nix.checkConfig</code>  previously did.</p></li><li class="listitem"><p><code class="literal">generateOptparseApplicativeCompletions</code> and <code class="literal">generateOptparseApplicativeCompletion</code> from <code class="literal">haskell.lib.compose</code>
(and <code class="literal">haskell.lib</code>) have been deprecated in favor of <code class="literal">generateOptparseApplicativeCompletions</code> (plural!) as
provided by the haskell package sets (so <code class="literal">haskellPackages.generateOptparseApplicativeCompletions</code> etc.).
The latter allows for cross-compilation (by automatically disabling generation of completion in the cross case).
For it to work properly you need to make sure that the function comes from the same context as the package
you are trying to override, i.e. always use the same package set as your package is coming from or – even
better – use <code class="literal">self.generateOptparseApplicativeCompletions</code> if you are overriding a haskell package set.
The old functions are retained for backwards compatibility, but yield are warning.</p></li><li class="listitem"><p>The <code class="literal">services.graphite.api</code> and <code class="literal">services.graphite.beacon</code> NixOS options, and
the <code class="literal">python3.pkgs.graphite_api</code>, <code class="literal">python3.pkgs.graphite_beacon</code> and
<code class="literal">python3.pkgs.influxgraph</code> packages, have been removed due to lack of upstream
maintenance.</p></li><li class="listitem"><p>The <code class="literal">trace</code> binary from <code class="literal">perf-linux</code> package has been removed, due to being a duplicate of the <code class="literal">perf</code> binary.</p></li><li class="listitem"><p>The <code class="literal">aws</code> package has been removed due to being abandoned by the upstream. It is recommended to use <code class="literal">awscli</code> or <code class="literal">awscli2</code> instead.</p></li><li class="listitem"><p>The <a class="link" href="https://ce-programming.github.io/CEmu"  target="_top">CEmu TI-84 Plus CE emulator</a> package has been renamed to <code class="literal">cemu-ti</code>. The <a class="link" href="https://cemu.info"  target="_top">Cemu Wii U emulator</a> is now packaged as <code class="literal">cemu</code>.</p></li><li class="listitem"><p><code class="literal">systemd-networkd</code> v250 deprecated, renamed, and moved some sections and settings which leads to the following breaking module changes:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">systemd.network.networks.&lt;name&gt;.dhcpV6PrefixDelegationConfig</code> is renamed to <code class="literal">systemd.network.networks.&lt;name&gt;.dhcpPrefixDelegationConfig</code>.</p></li><li class="listitem"><p><code class="literal">systemd.network.networks.&lt;name&gt;.dhcpV6Config</code> no longer accepts the <code class="literal">ForceDHCPv6PDOtherInformation=</code> setting. Please use the <code class="literal">WithoutRA=</code> and <code class="literal">UseDelegatedPrefix=</code> settings in your <code class="literal">systemd.network.networks.&lt;name&gt;.dhcpV6Config</code> and the <code class="literal">DHCPv6Client=</code> setting in your <code class="literal">systemd.network.networks.&lt;name&gt;.ipv6AcceptRAConfig</code> to control when the DHCPv6 client is started and how the delegated prefixes are handled by the DHCPv6 client.</p></li><li class="listitem"><p><code class="literal">systemd.network.networks.&lt;name&gt;.networkConfig</code> no longer accepts the <code class="literal">IPv6Token=</code> setting. Use the <code class="literal">Token=</code> setting in your <code class="literal">systemd.network.networks.&lt;name&gt;.ipv6AcceptRAConfig</code> instead. The <code class="literal">systemd.network.networks.&lt;name&gt;.ipv6Prefixes.*.ipv6PrefixConfig</code> now also accepts the <code class="literal">Token=</code> setting.</p></li></ul></div></li><li class="listitem"><p><code class="literal">arangodb</code> versions 3.3, 3.4, and 3.5 have been removed because they are at EOL upstream. The default is now 3.10.0. Support for aarch64-linux has been removed since the target cannot be built reproducibly. By default <code class="literal">arangodb</code> is now built for the <code class="literal">haswell</code> architecture. If you wish to build for a different architecture, you may override the <code class="literal">targetArchitecture</code> argument with a value from <a class="link" href="https://github.com/arangodb/arangodb/blob/207ec6937e41a46e10aea34953879341f0606841/cmake/OptimizeForArchitecture.cmake#L594"  target="_top">this list supported upstream</a>. Some architecture specific optimizations are also conditionally enabled. You may alter this behavior by overriding the <code class="literal">asmOptimizations</code> parameter. You may also add additional architecture support by adding more <code class="literal">-DHAS_XYZ</code> flags to <code class="literal">cmakeFlags</code> via <code class="literal">overrideAttrs</code>.</p></li><li class="listitem"><p>The <code class="literal">meta.mainProgram</code> attribute of packages in <code class="literal">wineWowPackages</code> now defaults to <code class="literal">&quot;wine64&quot;</code>.</p></li><li class="listitem"><p>The <code class="literal">paperless</code> module now defaults <code class="literal">PAPERLESS_TIME_ZONE</code> to your configured system timezone.</p></li><li class="listitem"><p>The top-level <code class="literal">termonad-with-packages</code> alias for <code class="literal">termonad</code> has been removed.</p></li><li class="listitem"><p>Linux 4.9 has been removed because it will reach its end of life within the lifespan of 22.11.</p></li><li class="listitem"><p>(Neo)Vim can not be configured with <code class="literal">configure.pathogen</code> anymore to reduce maintenance burden.
Use <code class="literal">configure.packages</code> instead.</p></li><li class="listitem"><p>Neovim can not be configured with plug anymore (still works for vim).</p></li><li class="listitem"><p>The <code class="literal">adguardhome</code> module no longer uses <code class="literal">host</code> and <code class="literal">port</code> options, use <code class="literal">settings.bind_host</code> and <code class="literal">settings.bind_port</code> instead.</p></li><li class="listitem"><p>The default <code class="literal">kops</code> version is now 1.25.1 and support for 1.22 and older has been dropped.</p></li><li class="listitem"><p>The <code class="literal">zrepl</code> package has been updated from 0.5.0 to 0.6.0. See the <a class="link" href="https://zrepl.github.io/changelog.html"  target="_top">changelog</a> for details.</p></li><li class="listitem"><p><code class="literal">k3s</code> no longer supports Docker as runtime due to upstream dropping support.</p></li><li class="listitem"><p><code class="literal">cassandra_2_1</code> and <code class="literal">cassandra_2_2</code> have been removed. Please update to <code class="literal">cassandra_3_11</code> or <code class="literal">cassandra_3_0</code>. See the <a class="link" href="https://github.com/apache/cassandra/blob/cassandra-3.11.14/NEWS.txt"  target="_top">changelog</a> for more information about the upgrade process.</p></li><li class="listitem"><p><code class="literal">mysql57</code> has been removed. Please update to <code class="literal">mysql80</code> or <code class="literal">mariadb</code>. See the <a class="link" href="https://mariadb.com/kb/en/upgrading-from-mysql-to-mariadb/"  target="_top">upgrade guide</a> for more information.</p></li><li class="listitem"><p>Consequently, <code class="literal">cqrlog</code> and <code class="literal">amorok</code> now use <code class="literal">mariadb</code> instead of <code class="literal">mysql57</code> for their embedded databases. Running <code class="literal">mysql_upgrade</code> may be necessary.</p></li><li class="listitem"><p><code class="literal">k3s</code> supports <code class="literal">clusterInit</code> option, and it is enabled by default, for servers.</p></li><li class="listitem"><p><code class="literal">percona-server56</code> has been removed. Please migrate to <code class="literal">mysql</code> or <code class="literal">mariadb</code> if possible.</p></li><li class="listitem"><p><code class="literal">obs-studio</code> hase been updated to version 28. If you have packaged custom plugins, check if they are compatible. <code class="literal">obs-websocket</code> has been integrated into <code class="literal">obs-studio</code>.</p></li><li class="listitem"><p><code class="literal">signald</code> has been bumped to <code class="literal">0.23.0</code>. For the upgrade, a migration process is necessary. It can be
done by running a command like this before starting <code class="literal">signald.service</code>:</p><pre><code class="programlisting">signald -d /var/lib/signald/db \
  --database sqlite:/var/lib/signald/db \
  --migrate-data
</code></pre><p>For further information, please read the upstream changelogs.</p></li><li class="listitem"><p><code class="literal">stylua</code> no longer accepts <code class="literal">lua52Support</code> and <code class="literal">luauSupport</code> overrides. Use <code class="literal">features</code> instead, which defaults to <code class="literal">[ &quot;lua54&quot; &quot;luau&quot; ]</code>.</p></li><li class="listitem"><p><code class="literal">ocamlPackages.ocaml_extlib</code> has been renamed to <code class="literal">ocamlPackages.extlib</code>.</p></li><li class="listitem"><p><code class="literal">pkgs.fetchNextcloudApp</code> has been rewritten to circumvent impurities in e.g. tarballs from GitHub and to make it easier to
apply patches. This means that your hashes are out-of-date and the (previously required) attributes <code class="literal">name</code> and <code class="literal">version</code>
are no longer accepted.</p></li><li class="listitem"><p>The Syncthing service now only allows absolute paths—starting with <code class="literal">/</code> or
<code class="literal">~/</code>—for <code class="literal">services.syncthing.folders.&lt;name&gt;.path</code>.
In a future release other paths will be allowed again and interpreted
relative to <code class="literal">services.syncthing.dataDir</code>.</p></li><li class="listitem"><p><code class="literal">services.github-runner</code> and <code class="literal">services.github-runners.&lt;name&gt;</code> gained the option <code class="literal">serviceOverrides</code> which allows overriding the systemd <code class="literal">serviceConfig</code>. If you have been overriding the systemd service configuration (i.e., by defining <code class="literal">systemd.services.github-runner.serviceConfig</code>), you have to use the <code class="literal">serviceOverrides</code> option now. Example:</p><pre><code class="programlisting nix">{
  services.github-runner.serviceOverrides.SupplementaryGroups = [
    &quot;docker&quot;
  ];
}
</code></pre></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-22.11-notable-changes" class="title" >Other Notable Changes   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>PHP is now built in <code class="literal">NTS</code> (Non-Thread Safe) mode by default.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>For Apache and <code class="literal">mod_php</code> usage, we enable <code class="literal">ZTS</code> (Zend Thread Safe) mode. This has been a
common practice for a long time in other distributions.</p></li></ul></div></li><li class="listitem"><p><code class="literal">firefox</code>, <code class="literal">thunderbird</code> and <code class="literal">librewolf</code> now come with Wayland support by default. The <code class="literal">firefox-wayland</code>, <code class="literal">firefox-esr-wayland</code>, <code class="literal">thunderbird-wayland</code> and <code class="literal">librewolf-wayland</code> attributes are obsolete and have been aliased to their generic attribute.</p></li><li class="listitem"><p>The <code class="literal">xplr</code> package has been updated from 0.18.0 to 0.19.0, which brings some breaking changes. See the <a class="link" href="https://github.com/sayanarijit/xplr/releases/tag/v0.19.0"  target="_top">upstream release notes</a> for more details.</p></li><li class="listitem"><p>Configuring multiple GitHub runners is now possible through <code class="literal">services.github-runners.&lt;name&gt;</code>. The options under <code class="literal">services.github-runner</code> remain, to configure a single runner.</p></li><li class="listitem"><p><code class="literal">github-runner</code> gained support for ephemeral runners and registrations using a personal access token (PAT) instead of a registration token. See <code class="literal">services.github-runner.ephemeral</code> and <code class="literal">services.github-runner.tokenFile</code> for details.</p></li><li class="listitem"><p>A new module was added to provide hardware support for the Saleae Logic device family, providing the options <code class="literal">hardware.saleae-logic.enable</code> and <code class="literal">hardware.saleae-logic.package</code>.</p></li><li class="listitem"><p>ZFS module will no longer allow hibernation by default.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>This is a safety measure to prevent data loss cases like the ones described at <a class="link" href="https://github.com/openzfs/zfs/issues/260"  target="_top">OpenZFS/260</a> and <a class="link" href="https://github.com/openzfs/zfs/issues/12842"  target="_top">OpenZFS/12842</a>.</p></li><li class="listitem"><p>Use the <code class="literal">boot.zfs.allowHibernation</code> option to configure this behaviour.</p></li></ul></div></li><li class="listitem"><p>Mastodon now automatically removes remote media attachments older than 30 days. This is configurable through <code class="literal">services.mastodon.mediaAutoRemove</code>.</p></li><li class="listitem"><p>The Redis module now disables RDB persistence when <code class="literal">services.redis.servers.&lt;name&gt;.save = []</code> instead of using the Redis default.</p></li><li class="listitem"><p>Neo4j was updated from version 3 to version 4. See upstream’s <a class="link" href="https://neo4j.com/docs/upgrade-migration-guide/current/"  target="_top">migration guide</a> for information on how to migrate your instance.</p></li><li class="listitem"><p>The <code class="literal">networking.wireguard</code> module now can set the mtu on interfaces and tag its packets with an fwmark.</p></li><li class="listitem"><p>The option <code class="literal">overrideStrategy</code> was added to the different systemd unit options (<code class="literal">systemd.services.&lt;name&gt;</code>, <code class="literal">systemd.sockets.&lt;name&gt;</code>, …) to allow enforcing the creation of a dropin file, rather than the main unit file, by setting it to <code class="literal">asDropin</code>.
This is useful in cases where the existence of the main unit file is not known to Nix at evaluation time, for example when the main unit file is provided by adding a package to <code class="literal">systemd.packages</code>.
See the fix proposed in <a class="link" href="https://github.com/NixOS/nixpkgs/issues/135557#issuecomment-1295392470"  target="_top">NixOS’s systemd abstraction doesn’t work with systemd template units</a> for an example.</p></li><li class="listitem"><p>The <code class="literal">polymc</code> package has been removed due to a rogue maintainer. It has been
replaced by <code class="literal">prismlauncher</code>, a fork by the rest of the maintainers. For more
details, see <a class="link" href="https://github.com/NixOS/nixpkgs/pull/196624"  target="_top">the PR that made this change</a> and
<a class="link" href="https://github.com/NixOS/nixpkgs/issues/196460"  target="_top">the issue detailing the vulnerability</a>.
Users with existing installations should rename <code class="literal">~/.local/share/polymc</code> to
<code class="literal">~/.local/share/PrismLauncher</code>. The main config file’s path has also moved
from <code class="literal">~/.local/share/polymc/polymc.cfg</code> to
<code class="literal">~/.local/share/PrismLauncher/prismlauncher.cfg</code>.</p></li><li class="listitem"><p>The <code class="literal">bloat</code> package has been updated from unstable-2022-03-31 to unstable-2022-10-25, which brings a breaking change. See <a class="link" href="https://git.freesoftwareextremist.com/bloat/commit/?id=887ed241d64ba5db3fd3d87194fb5595e5ad7d73"  target="_top">this upstream commit message</a> for details.</p></li><li class="listitem"><p>Synapse’s systemd unit has been hardened.</p></li><li class="listitem"><p>The module <code class="literal">services.grafana</code> was refactored to be compliant with <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md"  target="_top">RFC 0042</a>. To be precise, this means that the following things have changed:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>The newly introduced option <a class="xref" href="options.html#opt-services.grafana.settings"  ><code class="option">services.grafana.settings</code></a> is an attribute-set that
will be converted into Grafana’s INI format. This means that the configuration from
<a class="link" href="https://grafana.com/docs/grafana/latest/setup-grafana/configure-grafana/"  target="_top">Grafana’s configuration reference</a>
can be directly written as attribute-set in Nix within this option.</p></li><li class="listitem"><p>The option <code class="literal">services.grafana.extraOptions</code> has been removed. This option was an association
of environment variables for Grafana. If you had an expression like</p><pre><code class="programlisting nix">{
  services.grafana.extraOptions.SECURITY_ADMIN_USER = &quot;foobar&quot;;
}
</code></pre><p>your Grafana instance was running with <code class="literal">GF_SECURITY_ADMIN_USER=foobar</code> in its environment.</p><p>For the migration, it is recommended to turn it into the INI format, i.e.
to declare</p><pre><code class="programlisting nix">{
  services.grafana.settings.security.admin_user = &quot;foobar&quot;;
}
</code></pre><p>instead.</p><p>The keys in <code class="literal">services.grafana.extraOptions</code> have the format <code class="literal">&lt;INI section name&gt;_&lt;Key Name&gt;</code>.
Further details are outlined in the <a class="link" href="https://grafana.com/docs/grafana/latest/setup-grafana/configure-grafana/#override-configuration-with-environment-variables"  target="_top">configuration reference</a>.</p><p>Alternatively you can also set all your values from <code class="literal">extraOptions</code> to
<code class="literal">systemd.services.grafana.environment</code>, make sure you don’t forget to add
the <code class="literal">GF_</code> prefix though!</p></li><li class="listitem"><p>Previously, the options <a class="link" href="options.html#opt-services.grafana.provision.datasources"  >services.grafana.provision.datasources</a> and
<a class="link" href="options.html#opt-services.grafana.provision.dashboards"  >services.grafana.provision.dashboards</a> expected lists of datasources
or dashboards for the <a class="link" href="https://grafana.com/docs/grafana/latest/administration/provisioning/"  target="_top">declarative provisioning</a>.</p><p>To declare lists of</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square;"><li class="listitem"><p><span class="strong"><strong>datasources</strong></span>, please rename your declarations to <a class="link" href="options.html#opt-services.grafana.provision.datasources.settings.datasources"  >services.grafana.provision.datasources.settings.datasources</a>.</p></li><li class="listitem"><p><span class="strong"><strong>dashboards</strong></span>, please rename your declarations to <a class="link" href="options.html#opt-services.grafana.provision.dashboards.settings.providers"  >services.grafana.provision.dashboards.settings.providers</a>.</p></li></ul></div><p>This change was made to support more features for that:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: square;"><li class="listitem"><p>It’s possible to declare the <code class="literal">apiVersion</code> of your dashboards and datasources
by <a class="link" href="options.html#opt-services.grafana.provision.datasources.settings.apiVersion"  >services.grafana.provision.datasources.settings.apiVersion</a> (or
<a class="link" href="options.html#opt-services.grafana.provision.dashboards.settings.apiVersion"  >services.grafana.provision.dashboards.settings.apiVersion</a>).</p></li><li class="listitem"><p>Instead of declaring datasources and dashboards in pure Nix, it’s also possible
to specify configuration files (or directories) with YAML instead using
<a class="link" href="options.html#opt-services.grafana.provision.datasources.path"  >services.grafana.provision.datasources.path</a> (or
<a class="link" href="options.html#opt-services.grafana.provision.dashboards.path"  >services.grafana.provision.dashboards.path</a>. This is useful when having
provisioning files from non-NixOS Grafana instances that you also want to
deploy to NixOS.</p><p><span class="strong"><strong>Note:</strong></span> secrets from these files will be leaked into the store unless you use a
<a class="link" href="https://grafana.com/docs/grafana/latest/setup-grafana/configure-grafana/#file-provider"  target="_top"><span class="strong"><strong>file</strong></span>-provider or env-var</a> for secrets!</p></li><li class="listitem"><p><code class="literal">services.grafana.provision.notifiers</code> is not affected by this change because
this feature is deprecated by Grafana and will probably be removed in Grafana 10.
It’s recommended to use <code class="literal">services.grafana.provision.alerting.contactPoints</code> instead.</p></li></ul></div></li></ul></div></li><li class="listitem"><p>The <code class="literal">services.grafana.provision.alerting</code> option was added. It includes suboptions for every alerting-related objects (with the exception of <code class="literal">notifiers</code>), which means it’s now possible to configure modern Grafana alerting declaratively.</p></li><li class="listitem"><p>Synapse now requires entries in the <code class="literal">state_group_edges</code> table to be unique, in order to prevent accidentally introducing duplicate information (for example, because a database backup was restored multiple times). If your Synapse database already has duplicate rows in this table, this could fail with an error and require manual remediation.</p></li><li class="listitem"><p>The <code class="literal">diamond</code> package has been update from 0.8.36 to 2.0.15. See the <a class="link" href="https://github.com/bbuchfink/diamond/releases"  target="_top">upstream release notes</a> for more details.</p></li><li class="listitem"><p>The <code class="literal">guake</code> package has been updated from 3.6.3 to 3.9.0, see the <a class="link" href="https://github.com/Guake/guake/releases"  target="_top">changelog</a> for more details.</p></li><li class="listitem"><p>The <code class="literal">netlify-cli</code> package has been updated from 6.13.2 to 12.2.4, see the <a class="link" href="https://github.com/netlify/cli/releases"  target="_top">changelog</a> for more details.</p></li><li class="listitem"><p><code class="literal">dockerTools.buildImage</code>’s <code class="literal">contents</code> parameter has been deprecated in favor of <code class="literal">copyToRoot</code>.
Use <code class="literal">copyToRoot = buildEnv { ... };</code> or similar if you intend to add packages to <code class="literal">/bin</code>.</p></li><li class="listitem"><p>The <code class="literal">proxmox.qemuConf.bios</code> option was added, it corresponds to <code class="literal">Hardware-&gt;BIOS</code> field in Proxmox web interface. Use <code class="literal">&quot;ovmf&quot;</code> value to build UEFI image, default value remains <code class="literal">&quot;bios&quot;</code>. New option <code class="literal">proxmox.partitionTableType</code> defaults to either <code class="literal">&quot;legacy&quot;</code> or <code class="literal">&quot;efi&quot;</code>, depending on the <code class="literal">bios</code> value. Setting <code class="literal">partitionTableType</code> to <code class="literal">&quot;hybrid&quot;</code> results in an image, which supports both methods (<code class="literal">&quot;bios&quot;</code> and <code class="literal">&quot;ovmf&quot;</code>), thereby remaining bootable after change to Proxmox <code class="literal">Hardware-&gt;BIOS</code> field.</p></li><li class="listitem"><p>memtest86+ was updated from 5.00-coreboot-002 to 6.00-beta2. It is now the upstream version from https://www.memtest.org/, as coreboot’s fork is no longer available.</p></li><li class="listitem"><p>Option descriptions, examples, and defaults writing in DocBook are now deprecated. Using CommonMark is preferred and will become the default in a future release.</p></li><li class="listitem"><p>The <code class="literal">documentation.nixos.options.allowDocBook</code> option was added to ease the transition to CommonMark option documentation. Setting this option to <code class="literal">false</code> causes an error for every option included in the manual that uses DocBook documentation; it defaults to <code class="literal">true</code> to preserve the previous behavior and will be removed once the transition to CommonMark is complete.</p></li><li class="listitem"><p>The Redis module now persists each instance’s configuration file in the state directory, in order to support some more advanced use cases like Sentinel.</p></li><li class="listitem"><p><code class="literal">protonup</code> has been aliased to and replaced by <code class="literal">protonup-ng</code> due to upstream not maintaining it.</p></li><li class="listitem"><p>The udisks2 service, available at <code class="literal">services.udisks2.enable</code>, is now disabled by default. It will automatically be enabled through services and desktop environments as needed.
This also means that polkit will now actually be disabled by default. The default for <code class="literal">security.polkit.enable</code> was already flipped in the previous release, but udisks2 being enabled by default re-enabled it.</p></li><li class="listitem"><p>Nextcloud has been updated to version <span class="strong"><strong>25</strong></span>. Additionally the following things have changed
for Nextcloud in NixOS:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>For Nextcloud <span class="strong"><strong>&gt;=24</strong></span>, the default PHP version is 8.1.</p></li><li class="listitem"><p>Nextcloud <span class="strong"><strong>23</strong></span> has been removed since it will reach its <a class="link" href="https://github.com/nextcloud/server/wiki/Maintenance-and-Release-Schedule/d76576a12a626d53305d480a6065b57cab705d3d"  target="_top">end of life in December 2022</a>.</p></li><li class="listitem"><p>If <code class="literal">system.stateVersion</code> is <span class="strong"><strong>&gt;=22.11</strong></span>, Nextcloud 25 will be installed by default. For older versions,
Nextcloud 24 will be installed.</p></li><li class="listitem"><p>Please ensure that you only upgrade one major release at a time! Nextcloud doesn’t support
upgrades across multiple versions, i.e. an upgrade from <span class="strong"><strong>23</strong></span> to <span class="strong"><strong>25</strong></span> is only possible
when upgrading to <span class="strong"><strong>24</strong></span> first.</p></li></ul></div></li><li class="listitem"><p>systemd-oomd is enabled by default. Depending on which systemd units have
<code class="literal">ManagedOOMSwap=kill</code> or <code class="literal">ManagedOOMMemoryPressure=kill</code>, systemd-oomd will
SIGKILL all the processes under the appropriate descendant cgroups when the
configured limits are exceeded. NixOS does currently not configure cgroups
with oomd by default, this can be enabled using
<a class="link" href="options.html#opt-systemd.oomd.enableRootSlice"  target="_top">systemd.oomd.enableRootSlice</a>,
<a class="link" href="options.html#opt-systemd.oomd.enableSystemSlice"  target="_top">systemd.oomd.enableSystemSlice</a>,
and <a class="link" href="options.html#opt-systemd.oomd.enableUserServices"  target="_top">systemd.oomd.enableUserServices</a>.</p></li><li class="listitem"><p>The <code class="literal">tt-rss</code> service performs two database migrations when you first use its web UI after upgrade. Consider backing up its database before updating.</p></li><li class="listitem"><p>The <code class="literal">pass-secret-service</code> package now includes systemd units from upstream, so adding it to the NixOS <code class="literal">services.dbus.packages</code> option will make it start automatically as a systemd user service when an application tries to talk to the libsecret D-Bus API.</p></li><li class="listitem"><p>The Wordpress module now has support for installing language packs through a new option, <code class="literal">services.wordpress.sites.&lt;site&gt;.languages</code>.</p></li><li class="listitem"><p>The default package for <code class="literal">services.mullvad-vpn.package</code> was changed to <code class="literal">pkgs.mullvad</code>, allowing cross-platform usage of Mullvad. <code class="literal">pkgs.mullvad</code> only contains the Mullvad CLI tool, so users who rely on the Mullvad GUI will want to change it back to <code class="literal">pkgs.mullvad-vpn</code>, or add <code class="literal">pkgs.mullvad-vpn</code> to their environment.</p></li><li class="listitem"><p>PowerDNS has been updated from v4.6.2 to v4.7.2. Please be sure to review the <a class="link" href="https://doc.powerdns.com/authoritative/upgrading.html#to-4-7-0-or-master"  target="_top">Upgrade Notes</a> provided by upstream before upgrading. Worth specifically noting is that the new Catalog Zones feature comes with a mandatory schema change for the GSQL database backends, which has to be manually applied.</p></li><li class="listitem"><p>There is a new module for the <code class="literal">thunar</code> program (the Xfce file manager), which depends on the <code class="literal">xfconf</code> dbus service, and also has a dbus service and a systemd unit. The option <code class="literal">services.xserver.desktopManager.xfce.thunarPlugins</code> has been renamed to <code class="literal">programs.thunar.plugins</code>, and may be removed in a future release.</p></li><li class="listitem"><p>There is a new module for <code class="literal">xfconf</code> (the Xfce configuration storage system), which has a dbus service.</p></li><li class="listitem"><p>The Mastodon package has been upgraded to v4.0.0. See the <a class="link" href="https://github.com/mastodon/mastodon/releases/tag/v4.0.0"  target="_top">v4.0.0 release notes</a> for a list of changes. On standard setups, no manual migration steps are required. Nevertheless, a database backup is recommended.</p></li><li class="listitem"><p>The <code class="literal">nomad</code> package now defaults to v1.3, which no longer has a downgrade path to v1.2 or older.</p></li><li class="listitem"><p>The <code class="literal">nodePackages</code> package set now defaults to the LTS release in the <code class="literal">nodejs</code> package again, instead of being pinned to <code class="literal">nodejs-14_x</code>. Several updates to node2nix have been made for compatibility with newer Node.js and npm versions and a new <code class="literal">postRebuild</code> hook has been added for packages to perform extra build steps before the npm install step prunes dev dependencies.</p></li><li class="listitem"><p><code class="literal">boot.kernel.sysctl</code> is defined as a freeformType and adds a custom merge option for <code class="literal">net.core.rmem_max</code> (taking the highest value defined to avoid conflicts between 2 services trying to set that value).</p></li><li class="listitem"><p>The <code class="literal">mame</code> package does not ship with its tools anymore in the default output. They were moved to a separate <code class="literal">tools</code> output instead. For convenience, <code class="literal">mame-tools</code> package was added for those who want to use it.</p></li><li class="listitem"><p>A NixOS module for Firefox has been added which allows preferences and <a class="link" href="https://github.com/mozilla/policy-templates/blob/master/README.md"  target="_top">policies</a> to be set. This also allows extensions to be installed via the <code class="literal">ExtensionSettings</code> policy. The new options are under <code class="literal">programs.firefox</code>.</p></li><li class="listitem"><p>The option <code class="literal">services.picom.experimentalBackends</code> was removed since it is now the default and the option will cause <code class="literal">picom</code> to quit instead.</p></li><li class="listitem"><p><code class="literal">haskellPackages.callHackage</code> is not always invalidated if <code class="literal">all-cabal-hashes</code> changes, leading to less rebuilds of haskell dependencies.</p></li><li class="listitem"><p><code class="literal">haskellPackages.callHackage</code> and <code class="literal">haskellPackages.callCabal2nix</code> (and related functions) no longer keep a reference to the <code class="literal">cabal2nix</code> call used to generate them. As a result, they will be garbage collected more often.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-22.11-new-services" class="title" >New Services   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://git.sr.ht/~migadu/alps"  target="_top">alps</a>, a simple and extensible webmail. Available as <a class="link" href="options.html#opt-services.alps.enable"  >services.alps</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/jollheef/appvm"  target="_top">appvm</a>, Nix based app VMs. Available as <a class="link" href="options.html#opt-virtualisation.appvm.enable"  target="_top">virtualisation.appvm</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.ausweisapp.bund.de/"  target="_top">AusweisApp2</a>, the authentication software for the German ID card. Available as <a class="link" href="options.html#opt-programs.ausweisapp.enable"  >programs.ausweisapp</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/maxbrunet/automatic-timezoned"  target="_top">automatic-timezoned</a>. a Linux daemon to automatically update the system timezone based on location. Available as <a class="link" href="options.html#opt-services.automatic-timezoned.enable"  >services.automatic-timezoned</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.dolibarr.org/"  target="_top">Dolibarr</a>, an enterprise resource planning and customer relationship manager. Enable using <a class="link" href="options.html#opt-services.dolibarr.enable"  >services.dolibarr</a>.</p></li><li class="listitem"><p><a class="link" href="https://dragonflydb.io/"  target="_top">dragonflydb</a>, a modern replacement for Redis and Memcached. Available as <a class="link" href="options.html#opt-services.dragonflydb.enable"  >services.dragonflydb</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/shizunge/endlessh-go"  target="_top">endlessh-go</a>, an SSH tarpit that exposes Prometheus metrics. Available as <a class="link" href="options.html#opt-services.endlessh-go.enable"  >services.endlessh-go</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/skeeto/endlessh"  target="_top">endlessh</a>, an SSH tarpit. Available as <a class="link" href="options.html#opt-services.endlessh.enable"  >services.endlessh</a>.</p></li><li class="listitem"><p><a class="link" href="https://evcc.io"  target="_top">EVCC</a> is an EV charge controller with PV integration. It supports a multitude of chargers, meters, vehicle APIs and more and ties that together with a well-tested backend and a lightweight web frontend. Available as <a class="link" href="options.html#opt-services.evcc.enable"  >services.evcc</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.expressvpn.com"  target="_top">expressvpn</a>, the CLI client for ExpressVPN. Available as <a class="link" href="options.html#opt-services.expressvpn.enable"  >services.expressvpn</a>.</p></li><li class="listitem"><p><a class="link" href="https://freshrss.org/"  target="_top">FreshRSS</a>, a free, self-hostable RSS feed aggregator. Available as <a class="link" href="options.html#opt-services.freshrss.enable"  >services.freshrss</a>.</p></li><li class="listitem"><p><a class="link" href="https://garagehq.deuxfleurs.fr/"  target="_top">Garage</a>, a simple object storage server for geodistributed deployments, alternative to MinIO. Available as <a class="link" href="options.html#opt-services.garage.enable"  >services.garage</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/L11R/go-autoconfig"  target="_top">go-autoconfig</a>, IMAP/SMTP autodiscover server. Available as <a class="link" href="options.html#opt-services.go-autoconfig.enable"  >services.go-autoconfig</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.grafana.com/oss/tempo/"  target="_top">Grafana Tempo</a>, a distributed tracing store. Available as <a class="link" href="options.html#opt-services.tempo.enable"  >services.tempo</a>.</p></li><li class="listitem"><p><a class="link" href="https://hbase.apache.org/"  target="_top">HBase cluster</a>, a distributed, scalable, big data store. Available as <a class="link" href="options.html#opt-services.hadoop.hbase.enable"  target="_top">services.hadoop.hbase</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/leetronics/infnoise"  target="_top">infnoise</a>, a hardware True Random Number Generator dongle. Available as <a class="link" href="options.html#opt-services.infnoise.enable"  target="_top">services.infnoise</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/jtroo/kanata"  target="_top">kanata</a>, a tool to improve keyboard comfort and usability with advanced customization. Available as <a class="link" href="options.html#opt-services.kanata.enable"  target="_top">services.kanata</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/prymitive/karma"  target="_top">karma</a>, an alert dashboard for Prometheus Alertmanager. Available as <a class="link" href="options.html#opt-services.karma.enable"  target="_top">services.karma</a></p></li><li class="listitem"><p><a class="link" href="https://komga.org/"  target="_top">Komga</a>, a free and open source comics/mangas media server. Available as <a class="link" href="options.html#opt-services.komga.enable"  >services.komga</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/prymitive/kthxbye"  target="_top">kthxbye</a>, an alert acknowledgement management daemon for Prometheus Alertmanager. Available as <a class="link" href="options.html#opt-services.kthxbye.enable"  target="_top">services.kthxbye</a></p></li><li class="listitem"><p><a class="link" href="https://languagetool.org/"  target="_top">languagetool</a>, a multilingual grammar, style, and spell checker. Available as <a class="link" href="options.html#opt-services.languagetool.enable"  target="_top">services.languagetool</a>.</p></li><li class="listitem"><p><a class="link" href="https://listmonk.app"  target="_top">Listmonk</a>, a self-hosted newsletter manager. Enable using <a class="link" href="options.html#opt-services.listmonk.enable"  target="_top">services.listmonk</a>.</p></li><li class="listitem"><p><a class="link" href="https://mepo.milesalan.com"  target="_top">Mepo</a>, a fast, simple, hackable OSM map viewer for mobile and desktop Linux. Available as <a class="link" href="options.html#opt-programs.mepo.enable"  >programs.mepo.enable</a>.</p></li><li class="listitem"><p><a class="link" href="https://troglobit.com/projects/merecat/"  target="_top">merecat</a>, a small and easy HTTP server based on thttpd. Available as <a class="link" href="options.html#opt-services.merecat.enable"  >services.merecat</a></p></li><li class="listitem"><p><a class="link" href="https://netbird.io"  target="_top">netbird</a>, a zero configuration VPN. Available as <a class="link" href="options.html#opt-services.netbird.enable"  target="_top">services.netbird</a>.</p></li><li class="listitem"><p><a class="link" href="https://ntfy.sh"  target="_top">ntfy.sh</a>, a push notification service. Available as <a class="link" href="options.html#opt-services.ntfy-sh.enable"  >services.ntfy-sh</a></p></li><li class="listitem"><p><a class="link" href="https://gitlab.com/CalcProgrammer1/OpenRGB/-/tree/master"  target="_top">OpenRGB</a>, a FOSS tool for controlling RGB lighting. Available as <a class="link" href="options.html#opt-services.hardware.openrgb.enable"  target="_top">services.hardware.openrgb.enable</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.getoutline.com/"  target="_top">Outline</a>, a wiki and knowledge base similar to Notion. Available as <a class="link" href="options.html#opt-services.outline.enable"  >services.outline</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/zalando/patroni"  target="_top">Patroni</a>, a template for PostgreSQL HA with ZooKeeper, etcd or Consul. Available as <a class="link" href="options.html#opt-services.patroni.enable"  target="_top">services.patroni</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/aiberia/persistent-evdev"  target="_top">persistent-evdev</a>, a daemon to add virtual proxy devices that mirror a physical input device but persist even if the underlying hardware is hot-plugged. Available as <a class="link" href="options.html#opt-services.persistent-evdev.enable"  >services.persistent-evdev</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/edneville/please"  target="_top">Please</a>, a Sudo clone written in Rust. Available as <a class="link" href="options.html#opt-security.please.enable"  >security.please</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/prometheus-community/ipmi_exporter"  target="_top">Prometheus IPMI exporter</a>, an IPMI exporter for Prometheus. Available as <a class="link" href="options.html#opt-services.prometheus.exporters.ipmi.enable"  >services.prometheus.exporters.ipmi</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/messagebird/sachet/"  target="_top">Sachet</a>, an SMS alerting tool for the Prometheus Alertmanager. Available as <a class="link" href="options.html#opt-services.prometheus.sachet.enable"  >services.prometheus.sachet</a>.</p></li><li class="listitem"><p><a class="link" href="https://schleuder.org/"  target="_top">schleuder</a>, a mailing list manager with PGP support. Enable using <a class="link" href="options.html#opt-services.schleuder.enable"  >services.schleuder</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/mozilla-services/syncstorage-rs"  target="_top">syncstorage-rs</a>, a self-hostable sync server for Firefox. Available as <a class="link" href="options.html#opt-services.firefox-syncserver.enable"  target="_top">services.firefox-syncserver</a>.</p></li><li class="listitem"><p><a class="link" href="https://tandoor.dev"  target="_top">Tandoor Recipes</a>, a self-hosted multi-tenant recipe collection. Available as <a class="link" href="options.html#opt-services.tandoor-recipes.enable"  target="_top">services.tandoor-recipes</a>.</p></li><li class="listitem"><p><a class="link" href="http://www.litech.org/tayga/"  target="_top">TAYGA</a>, an out-of-kernel stateless NAT64 implementation. Available as <a class="link" href="options.html#opt-services.tayga.enable"  >services.tayga</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/tmate-io/tmate-ssh-server"  target="_top">tmate-ssh-server</a>, server side part of <a class="link" href="https://tmate.io/"  target="_top">tmate</a>. Available as <a class="link" href="options.html#opt-services.tmate-ssh-server.enable"  >services.tmate-ssh-server</a>.</p></li><li class="listitem"><p><a class="link" href="https://uptime.kuma.pet/"  target="_top">Uptime Kuma</a>, a fancy self-hosted monitoring tool. Available as <a class="link" href="options.html#opt-services.uptime-kuma.enable"  >services.uptime-kuma</a>.</p></li><li class="listitem"><p><a class="link" href="https://writefreely.org"  target="_top">WriteFreely</a>, a simple blogging platform with ActivityPub support. Available as <a class="link" href="options.html#opt-services.writefreely.enable"  target="_top">services.writefreely</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/XTLS/Xray-core"  target="_top">xray</a>, a fully compatible v2ray-core replacement. Features XTLS, which when enabled on server and client, brings UDP FullCone NAT to proxy setups. Available as <a class="link" href="options.html#opt-services.xray.enable"  target="_top">services.xray</a>.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-22.05" class="title" style="clear: both">Release 22.05 (“Quokka”, 2022.05/30)   </h2>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Support is planned until the end of December 2022, handing over to 22.11.</p></li></ul></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-22.05-highlights" class="title" >Highlights   </h3>  </div> </div></div><p>In addition to numerous new and upgraded packages, this release has the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Nix has been updated from 2.3 to 2.8. This mainly brings experimental support
for Flakes, but also marks the <code class="literal">nix</code> command as experimental which now has to
be enabled via the configuration explicitly. For more information and
instructions for upgrades, see the
release notes for <a class="link" href="https://nixos.org/manual/nix/stable/release-notes/rl-2.4.html"  target="_top">nix-2.4</a>,
<a class="link" href="https://nixos.org/manual/nix/stable/release-notes/rl-2.5.html"  target="_top">nix-2.5</a>,
<a class="link" href="https://nixos.org/manual/nix/stable/release-notes/rl-2.6.html"  target="_top">nix-2.6</a>,
<a class="link" href="https://nixos.org/manual/nix/stable/release-notes/rl-2.7.html"  target="_top">nix-2.7</a> and
<a class="link" href="https://nixos.org/manual/nix/stable/release-notes/rl-2.8.html"  target="_top">nix-2.8</a></p></li><li class="listitem"><p>The <code class="literal">firefox</code> browser on <code class="literal">x86_64-linux</code> now makes use of profile-guided
optimisation, resulting in a much more responsive browsing experience.</p></li><li class="listitem"><p>GNOME has been upgraded to 42. Please take a look at their <a class="link" href="https://release.gnome.org/42/"  target="_top">Release
Notes</a> for details. In particular, it replaces
gedit with GNOME Text Editor, GNOME Terminal with GNOME Console (formerly
King’s Cross) and GNOME Screenshot by a tool integrated into the Shell.</p></li><li class="listitem"><p>PHP 8.1 is now available.</p></li><li class="listitem"><p>systemd services can now set <a class="link" href="options.html#opt-systemd.services"  >systemd.services.&lt;name&gt;.reloadTriggers</a> instead of <code class="literal">reloadIfChanged</code> for a more granular distinction between reloads and restarts.</p></li><li class="listitem"><p>Systemd has been upgraded to the version 250.</p></li><li class="listitem"><p>Pulseaudio has been updated to version 15.0 and now optionally
<a class="link" href="https://www.freedesktop.org/wiki/Software/PulseAudio/Notes/15.0/#supportforldacandaptxbluetoothcodecsplussbcxqsbcwithhigher-qualityparameters"  target="_top">supports additional Bluetooth audio codecs</a>
such as aptX or LDAC, with codec switching available in <code class="literal">pavucontrol</code>. This
feature is disabled by default, but can be enabled with the option
<code class="literal">hardware.pulseaudio.package = pkgs.pulseaudioFull;</code>. Existing third-party
modules that offered similar functions, such as <code class="literal">pulseaudio-modules-bt</code> or
<code class="literal">pulseaudio-hsphfpd</code>, are obsolete and have been removed.</p></li><li class="listitem"><p>PostgreSQL now defaults to major version 14.</p></li><li class="listitem"><p>Module authors can use <code class="literal">mkRenamedOptionModuleWith</code> to automate the deprecation cycle without annoying out-of-tree module authors and their users.</p></li><li class="listitem"><p>The default GHC version has been updated from 8.10.7 to 9.0.2. <code class="literal">pkgs.haskellPackages</code> and <code class="literal">pkgs.ghc</code> will now use this version by default.</p></li><li class="listitem"><p>The GNOME and Plasma installation CDs now use <code class="literal">pkgs.calamares</code> and <code class="literal">pkgs.calamares-nixos-extensions</code> to allow users to easily install and set up NixOS with a GUI.</p></li><li class="listitem"><p><code class="literal">security.acme.defaults</code> has been added to simplify the configuration of
settings for many certificates at once. This also opens up the option to use
DNS-01 validation when using <code class="literal">enableACME</code> web server virtual hosts (e.g.
<code class="literal">services.nginx.virtualHosts.*.enableACME</code>).</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-22.05-new-services" class="title" >New Services   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://1password.com/"  target="_top">1password</a>, command-lines and graphic interface for 1Password. Available as <a class="link" href="options.html#opt-programs._1password.enable"  >programs._1password</a> and <a class="link" href="options.html#opt-programs._1password.enable"  >programs._1password-gui</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/intel/linux-sgx#install-the-intelr-sgx-psw"  target="_top">aesmd</a>, the Intel SGX Architectural Enclave Service Manager. Available as <a class="link" href="options.html#opt-services.aesmd.enable"  >services.aesmd</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/mbrubeck/agate"  target="_top">agate</a>, a very simple server for the Gemini hypertext protocol. Available as <a class="link" href="options.html#opt-services.agate.enable"  >services.agate</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/linux-apfs/linux-apfs-rw"  target="_top">apfs</a>, a kernel module for mounting the Apple File System (APFS).</p></li><li class="listitem"><p><a class="link" href="https://gitlab.com/DarkElvenAngel/argononed"  target="_top">argonone</a>, a replacement daemon for the Raspberry Pi Argon One power button and cooler. Available at <a class="link" href="options.html#opt-services.hardware.argonone.enable"  target="_top">services.hardware.argonone</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/JustArchiNET/ArchiSteamFarm"  target="_top">ArchiSteamFarm</a>, a C# application with primary purpose of idling Steam cards from multiple accounts simultaneously. Available as <a class="link" href="options.html#opt-services.archisteamfarm.enable"  >services.archisteamfarm</a>.</p></li><li class="listitem"><p><a class="link" href="https://loic-sharma.github.io/BaGet/"  target="_top">BaGet</a>, a lightweight NuGet and symbol server. Available at services.baget.</p></li><li class="listitem"><p><a class="link" href="https://github.com/xddxdd/bird-lg-go"  target="_top">bird-lg</a>, a BGP looking glass for Bird Routing. Available as <a class="link" href="options.html#opt-services.bird-lg.package"  >services.bird-lg</a>.</p></li><li class="listitem"><p><a class="link" href="https://0xerr0r.github.io/blocky/"  target="_top">blocky</a>, fast and lightweight DNS proxy as ad-blocker for local network with many features. Available as <a class="link" href="options.html#opt-services.blocky.enable"  >services.blocky</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/kissgyorgy/cloudflare-dyndns"  target="_top">cloudflare-dyndns</a>, CloudFlare Dynamic DNS client. Available as <a class="link" href="options.html#opt-services.cloudflare-dyndns.enable"  >services.cloudflare-dyndns</a>.</p></li><li class="listitem"><p><a class="link" href="https://corosync.github.io/corosync/"  target="_top">Corosync</a> and <a class="link" href="https://clusterlabs.org/pacemaker/"  target="_top">Pacemaker</a>, A open-source high availability resource manager. Available as <a class="link" href="options.html#opt-services.corosync.enable"  >services.corosync</a> and <a class="link" href="options.html#opt-services.pacemaker.enable"  >services.pacemaker</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/lakinduakash/linux-wifi-hotspot"  target="_top">create_ap</a>, a module for creating wifi hotspots using the program linux-wifi-hotspot. Available as <a class="link" href="options.html#opt-services.create_ap.enable"  >services.create_ap</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.envoyproxy.io/"  target="_top">Envoy</a>, a high-performance reverse proxy. Available as <a class="link" href="options.html#opt-services.envoy.enable"  >services.envoy</a>.</p></li><li class="listitem"><p><a class="link" href="https://ergo.chat"  target="_top">ergochat</a>, a modern IRC with IRCv3 features. Available as <a class="link" href="options.html#opt-services.ergochat.enable"  >services.ergochat</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/audreyt/ethercalc"  target="_top">ethercalc</a>, an online collaborative spreadsheet. Available as <a class="link" href="options.html#opt-services.ethercalc.enable"  >services.ethercalc</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-overview.html"  target="_top">filebeat</a>, a lightweight shipper for forwarding and centralizing log data. Available as <a class="link" href="options.html#opt-services.filebeat.enable"  >services.filebeat</a>.</p></li><li class="listitem"><p><a class="link" href="https://frrouting.org/"  target="_top">FRRouting</a>, a popular suite of Internet routing protocol daemons (BGP, BFD, OSPF, IS-IS, VRRP and others). Available as <a class="link" href="options.html#opt-services.frr.babeld.enable"  >services.frr</a>.</p></li><li class="listitem"><p><a class="link" href="https://grafana.com/oss/mimir/"  target="_top">Grafana Mimir</a>, an open source, horizontally scalable, highly available, multi-tenant, long-term storage for Prometheus. Available as <a class="link" href="options.html#opt-services.mimir.enable"  >services.mimir</a>.</p></li><li class="listitem"><p><a class="link" href="https://hastebin.com/about.md"  target="_top">Haste</a>, a pastebin written in node.js. Available as <a class="link" href="options.html#opt-services.haste-server.enable"  >services.haste</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/juanfont/headscale"  target="_top">headscale</a>, an Open Source implementation of the <a class="link" href="https://tailscale.io"  target="_top">Tailscale</a> Control Server. Available as <a class="link" href="options.html#opt-services.headscale.enable"  >services.headscale</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/hifi/heisenbridge"  target="_top">heisenbridge</a>, a bouncer-style Matrix IRC bridge. Available as <a class="link" href="options.html#opt-services.heisenbridge.enable"  >services.heisenbridge</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/aarond10/https_dns_proxy"  target="_top">https-dns-proxy</a>, DNS to DNS over HTTPS (DoH) proxy. Available as <a class="link" href="options.html#opt-services.https-dns-proxy.enable"  >services.https-dns-proxy</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/sezanzeb/input-remapper"  target="_top">input-remapper</a>, an easy to use tool to change the mapping of your input device buttons. Available at <a class="link" href="options.html#opt-services.input-remapper.enable"  >services.input-remapper</a>.</p></li><li class="listitem"><p><a class="link" href="https://invoiceplane.com"  target="_top">InvoicePlane</a>, web application for managing and creating invoices. Available at <a class="link" href="options.html#opt-services.invoiceplane.sites._name_.enable"  >services.invoiceplane</a>.</p></li><li class="listitem"><p><a class="link" href="https://userbase.kde.org/K3b"  target="_top">k3b</a>, the KDE disk burning application. Available as <a class="link" href="options.html#opt-programs.k3b.enable"  >programs.k3b</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.scorchworks.com/K40whisperer/k40whisperer.html"  target="_top">K40-Whisperer</a>, a program to control cheap Chinese laser cutters. Available as <a class="link" href="options.html#opt-programs.k40-whisperer.enable"  >programs.k40-whisperer.enable</a>. Users must add themselves to the <code class="literal">k40</code> group to be able to access the device.</p></li><li class="listitem"><p><a class="link" href="https://kanidm.github.io/kanidm/stable/"  target="_top">kanidm</a>, an identity management server written in Rust. Available as <a class="link" href="options.html#opt-services.kanidm.enableServer"  >services.kanidm</a></p></li><li class="listitem"><p><a class="link" href="https://maddy.email/"  target="_top">Maddy</a>, a free an open source mail server. Available as <a class="link" href="options.html#opt-services.maddy.enable"  >services.maddy</a>.</p></li><li class="listitem"><p><a class="link" href="https://conduit.rs/"  target="_top">matrix-conduit</a>, a simple, fast and reliable chat server powered by matrix. Available as <a class="link" href="options.html#opt-services.matrix-conduit.enable"  target="_top">services.matrix-conduit</a>.</p></li><li class="listitem"><p><a class="link" href="https://moosefs.com"  target="_top">Moosefs</a>, fault tolerant petabyte distributed file system. Available as <a class="link" href="options.html#opt-services.moosefs.master.enable"  >moosefs</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/mozilla-mobile/mozilla-vpn-client"  target="_top">mozillavpn</a>, the client for the <a class="link" href="https://vpn.mozilla.org/"  target="_top">Mozilla VPN</a> service. Available as <a class="link" href="options.html#opt-services.mozillavpn.enable"  >services.mozillavpn</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/mgumz/mtr-exporter"  target="_top">mtr-exporter</a>, a Prometheus exporter for mtr metrics. Available as <a class="link" href="options.html#opt-services.mtr-exporter.enable"  >services.mtr-exporter</a>.</p></li><li class="listitem"><p><a class="link" href="https://nbd.sourceforge.io/"  target="_top">nbd</a>, a Network Block Device server. Available as <a class="link" href="options.html#opt-services.nbd.server.enable"  >services.nbd</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/netbox-community/netbox"  target="_top">netbox</a>, infrastructure resource modeling (IRM) tool. Available as <a class="link" href="options.html#opt-services.netbox.enable"  >services.netbox</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/vvilhonen/nethoscope"  target="_top">nethoscope</a>, listen to your network traffic. Available as <a class="link" href="options.html#opt-programs.nethoscope.enable"  >programs.nethoscope</a>.</p></li><li class="listitem"><p><a class="link" href="https://nifi.apache.org"  target="_top">nifi</a>, an easy to use, powerful, and reliable system to process and distribute data. Available as <a class="link" href="options.html#opt-services.nifi.enable"  >services.nifi</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/Mic92/nix-ld"  target="_top">nix-ld</a>, Run unpatched dynamic binaries on NixOS. Available as <a class="link" href="options.html#opt-programs.nix-ld.enable"  >programs.nix-ld</a>.</p></li><li class="listitem"><p><a class="link" href="http://www.nncpgo.org"  target="_top">NNCP</a>, NNCP (Node to Node copy) utilities and configuration, Available as <a class="link" href="options.html#opt-programs.nncp.enable"  >programs.nncp</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/postgres/pgadmin4"  target="_top">pgadmin4</a>, an admin interface for the PostgreSQL database. Available at <a class="link" href="options.html#opt-services.pgadmin.enable"  >services.pgadmin</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/ngoduykhanh/PowerDNS-Admin"  target="_top">PowerDNS-Admin</a>, a web interface for the PowerDNS server. Available at <a class="link" href="options.html#opt-services.powerdns-admin.enable"  >services.powerdns-admin</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/prometheus-pve/prometheus-pve-exporter"  target="_top">prometheus-pve-exporter</a>, a tool that exposes information from the Proxmox VE API for use by Prometheus. Available as <a class="link" href="options.html#opt-services.prometheus.exporters.pve.enable"  >services.prometheus.exporters.pve</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/ThomasLeister/prosody-filer"  target="_top">prosody-filer</a>, a server for handling XMPP HTTP Upload requests. Available at <a class="link" href="options.html#opt-services.prosody-filer.enable"  >services.prosody-filer</a>.</p></li><li class="listitem"><p><a class="link" href="https://public-inbox.org"  target="_top">Public Inbox</a>, an “archives first” approach to mailing lists. Available as <a class="link" href="options.html#opt-services.public-inbox.enable"  >services.public-inbox</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/fleaz/r53-ddns"  target="_top">r53-ddns</a>, a small tool to run your own DDNS service via AWS Route53. Available as <a class="link" href="options.html#opt-services.r53-ddns.enable"  >services.r53-ddns</a>.</p></li><li class="listitem"><p><a class="link" href="https://ddvk.github.io/rmfakecloud/"  target="_top">rmfakecloud</a>, a clone of the cloud sync the remarkable tablet. Available as <a class="link" href="options.html#opt-services.rmfakecloud.enable"  >services.rmfakecloud</a>.</p></li><li class="listitem"><p><a class="link" href="https://docs.docker.com/engine/security/rootless/"  target="_top">rootless Docker</a>, a <code class="literal">systemd --user</code> Docker service which runs without root permissions. Available as <a class="link" href="options.html#opt-virtualisation.docker.rootless.enable"  >virtualisation.docker.rootless.enable</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.rstudio.com/products/rstudio/#rstudio-server"  target="_top">rstudio-server</a>, a browser-based version of the RStudio IDE for the R programming language. Available as <a class="link" href="options.html#opt-services.rstudio-server.enable"  >services.rstudio-server</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/aler9/mediamtx"  target="_top">mediamtx</a>, ready-to-use RTSP / RTMP / HLS server and proxy that allows to read, publish and proxy video and audio streams. Available as <a class="link" href="options.html#opt-services.mediamtx.enable"  >services.mediamtx</a>.</p></li><li class="listitem"><p><a class="link" href="https://snipeitapp.com"  target="_top">Snipe-IT</a>, a free open source IT asset/license management system. Available as <a class="link" href="options.html#opt-services.snipe-it.enable"  >services.snipe-it</a>.</p></li><li class="listitem"><p><a class="link" href="https://snowflake.torproject.org/"  target="_top">snowflake-proxy</a>, a system to defeat internet censorship. Available as <a class="link" href="options.html#opt-services.snowflake-proxy.enable"  >services.snowflake-proxy</a>.</p></li><li class="listitem"><p><a class="link" href="https://sslmate.com/"  target="_top">sslmate-agent</a>, a daemon for managing SSL/TLS certificates on a server. Available as <a class="link" href="services.sslmate-agent.enable"  target="_top">services.sslmate-agent</a>.</p></li><li class="listitem"><p><a class="link" href="https://starship.rs"  target="_top">starship</a>, a minimal, blazing-fast, and infinitely customizable prompt for any shell. Available at <a class="link" href="options.html#opt-programs.starship.enable"  >programs.startship</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/rfjakob/systembus-notify"  target="_top">systembus-notify</a>, allow system level notifications to reach the users. Available as <a class="link" href="opt-services.systembus-notify.enable"  target="_top">services.systembus-notify</a>. Please keep in mind that this service should only be enabled on machines with fully trusted users, as any local user is able to DoS user sessions by spamming notifications.</p></li><li class="listitem"><p><a class="link" href="https://goteleport.com"  target="_top">teleport</a>, allows engineers and security professionals to unify access for SSH servers, Kubernetes clusters, web applications, and databases across all environments. Available at <a class="link" href="options.html#opt-services.teleport.enable"  >services.teleport</a>.</p></li><li class="listitem"><p><a class="link" href="https://tetrd.app"  target="_top">tetrd</a>, share your internet connection from your device to your PC and vice versa through a USB cable. Available at <a class="link" href="options.html#opt-services.tetrd.enable"  >services.tetrd</a>.</p></li><li class="listitem"><p><a class="link" href="https://upterm.dev"  target="_top">uptermd</a>, an open-source solution for sharing terminal sessions instantly over the public internet via secure tunnels. Available at <a class="link" href="options.html#opt-services.uptermd.enable"  >services.uptermd</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/darrylb123/usbrelay"  target="_top">usbrelayd</a>, an USB Relay MQTT daemon. Available as <a class="link" href="options.html#opt-services.usbrelayd.enable"  >services.usbrelayd</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/miquels/webdav-server-rs"  target="_top">webdav-server-rs</a>, Webdav server in rust. Available as <a class="link" href="options.html#opt-services.webdav-server-rs.enable"  >services.webdav-server-rs</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/gin66/wg_netmanager"  target="_top">wg-netmanager</a>, the Wireguard network manager. Available as <a class="link" href="options.html#opt-services.wg-netmanager.enable"  >services.wg-netmanager</a>.</p></li><li class="listitem"><p><a class="link" href="https://zammad.org/"  target="_top">Zammad</a>, a web-based, open source user support/ticketing solution. Available as <a class="link" href="options.html#opt-services.zammad.enable"  >services.zammad</a>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-22.05-incompatibilities" class="title" >Backward Incompatibilities   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">pkgs.ghc</code> now refers to <code class="literal">pkgs.targetPackages.haskellPackages.ghc</code>.
This <span class="emphasis"><em>only</em></span> makes a difference if you are cross-compiling and will
ensure that <code class="literal">pkgs.ghc</code> always runs on the host platform and compiles
for the target platform (similar to <code class="literal">pkgs.gcc</code> for example).
<code class="literal">haskellPackages.ghc</code> still behaves as before, running on the build
platform and compiling for the host platform (similar to <code class="literal">stdenv.cc</code>).
This means you don’t have to adjust your derivations if you use
<code class="literal">haskellPackages.callPackage</code>, but when using <code class="literal">pkgs.callPackage</code> and
taking <code class="literal">ghc</code> as an input, you should now use <code class="literal">buildPackages.ghc</code>
instead to ensure cross compilation keeps working (or switch to
<code class="literal">haskellPackages.callPackage</code>).</p></li><li class="listitem"><p><code class="literal">pkgs.ghc.withPackages</code> as well as <code class="literal">haskellPackages.ghcWithPackages</code> etc.
now needs be overridden directly, as opposed to overriding the result of
calling it. Additionally, the <code class="literal">withLLVM</code> parameter has been renamed to
<code class="literal">useLLVM</code>. So instead of <code class="literal">(ghc.withPackages (p: [])).override { withLLVM = true; }</code>,
one needs to use <code class="literal">(ghc.withPackages.override { useLLVM = true; }) (p: [])</code>.</p></li><li class="listitem"><p>The update of the haskell package set brings with it a new version of the <code class="literal">xmonad</code>
module, which will break your configuration if you use <code class="literal">launch</code> as entrypoint. The
example code the corresponding nixos module was adjusted, you may want to have a look at it.</p></li><li class="listitem"><p>The <code class="literal">home-assistant</code> module now requires users that don’t want their
configuration to be managed declaratively to set
<code class="literal">services.home-assistant.config = null;</code>. This is required
due to the way default settings are handled with the new settings style.</p><p>Additionally the default list of <code class="literal">extraComponents</code> now includes the minimal
dependencies to successfully complete the <a class="link" href="https://www.home-assistant.io/getting-started/onboarding/"  target="_top">onboarding</a>
procedure.</p></li><li class="listitem"><p><code class="literal">pkgs.emacsPackages.orgPackages</code> is removed because org elpa is deprecated.
The packages in the top level of <code class="literal">pkgs.emacsPackages</code>, such as org and
org-contrib, refer to the ones in <code class="literal">pkgs.emacsPackages.elpaPackages</code> and
<code class="literal">pkgs.emacsPackages.nongnuPackages</code> where the new versions will release.</p></li><li class="listitem"><p>The configuration and state directories used by <code class="literal">nixos-containers</code> have been
moved from <code class="literal">/etc/containers</code> and <code class="literal">/var/lib/containers</code> to
<code class="literal">/etc/nixos-containers</code> and <code class="literal">/var/lib/nixos-containers</code>.</p><p>If you are changing <code class="literal">system.stateVersion</code> to <code class="literal">&quot;22.05&quot;</code> manually on an existing
system you are responsible for migrating these directories yourself.</p><p>This is to improve compatibility with <code class="literal">libcontainer</code> based software such as Podman and Skopeo
which assumes they have ownership over <code class="literal">/etc/containers</code>.</p></li><li class="listitem"><p><code class="literal">lib.systems.supported</code> has been removed, as it was overengineered for determining the systems to support in the nixpkgs flake. The list of systems exposed by the nixpkgs flake can now be accessed as <code class="literal">lib.systems.flakeExposed</code>.</p></li><li class="listitem"><p>For new installations <code class="literal">virtualisation.oci-containers.backend</code> is now set to <code class="literal">podman</code> by default.
If you still want to use Docker on systems where <code class="literal">system.stateVersion</code> is set to to <code class="literal">&quot;22.05&quot;</code> set <code class="literal">virtualisation.oci-containers.backend = &quot;docker&quot;;</code>.Old systems with older <code class="literal">stateVersion</code>s stay with “docker”.</p></li><li class="listitem"><p><code class="literal">security.klogd</code> was removed.  Logging of kernel messages is handled
by systemd since Linux 3.5.</p></li><li class="listitem"><p><code class="literal">pkgs.ssmtp</code> has been dropped due to the program being unmaintained.
<code class="literal">pkgs.msmtp</code> can be used instead as a substitute <code class="literal">sendmail</code> implementation.
The corresponding options <code class="literal">services.ssmtp.*</code> have been removed as well.
<code class="literal">programs.msmtp.*</code> can be used instead for an equivalent setup. For example:</p><pre><code class="programlisting nix">{
  # Original ssmtp configuration:
  services.ssmtp = {
    enable = true;
    useTLS = true;
    useSTARTTLS = true;
    hostName = &quot;smtp.example:587&quot;;
    authUser = &quot;someone&quot;;
    authPassFile = &quot;/secrets/password.txt&quot;;
  };

  # Equivalent msmtp configuration:
  programs.msmtp = {
    enable = true;
    accounts.default = {
      tls = true;
      tls_starttls = true;
      auth = true;
      host = &quot;smtp.example&quot;;
      port = 587;
      user = &quot;someone&quot;;
      passwordeval = &quot;cat /secrets/password.txt&quot;;
    };
  };
}
</code></pre></li><li class="listitem"><p><code class="literal">services.kubernetes.addons.dashboard</code> was removed due to it being an outdated version.</p></li><li class="listitem"><p><code class="literal">services.kubernetes.scheduler.{port,address}</code> now set <code class="literal">--secure-port</code> and <code class="literal">--bind-address</code> instead of <code class="literal">--port</code> and <code class="literal">--address</code>, since the former have been deprecated and are no longer functional in kubernetes&gt;=1.23. Ensure that you are not relying on the insecure behaviour before upgrading.</p></li><li class="listitem"><p>In the PowerDNS Recursor module (<code class="literal">services.pdns-recursor</code>), default values of several IP address-related NixOS options have been updated to match the default upstream behavior.
In particular, Recursor by default will:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>listen on (and allows connections from) both IPv4 and IPv6 addresses
(<code class="literal">services.pdns-recursor.dns.address</code>, <code class="literal">services.pdns-recursor.dns.allowFrom</code>);</p></li><li class="listitem"><p>allow only local connections to the REST API server (<code class="literal">services.pdns-recursor.api.allowFrom</code>).</p></li></ul></div></li><li class="listitem"><p>In the ncdns module, the default value of <code class="literal">services.ncdns.address</code> has been changed to the IPv6 loopback address (<code class="literal">::1</code>).</p></li><li class="listitem"><p><code class="literal">openldap</code> (and therefore the slapd LDAP server) were updated to version 2.6.2. The project introduced backwards-incompatible changes, namely the removal of the bdb, hdb, ndb, and shell backends in slapd. Therefore before updating, dump your database <code class="literal">slapcat -n 1</code> in LDIF format, and reimport it after updating your <code class="literal">services.openldap.settings</code>, which represents your <code class="literal">cn=config</code>.</p><p>Additionally with 2.5 the argon2 module was included in the standard distribution and renamed from <code class="literal">pw-argon2</code> to <code class="literal">argon2</code>. Remember to update your <code class="literal">olcModuleLoad</code> entry in <code class="literal">cn=config</code>.</p></li><li class="listitem"><p><code class="literal">openssh</code> has been update to 8.9p1, changing the FIDO security key middleware interface.</p></li><li class="listitem"><p><code class="literal">git</code> no longer hardcodes the path to openssh’ ssh binary to reduce the amount of rebuilds. If you are using git with ssh remotes and do not have a ssh binary in your environment consider adding <code class="literal">openssh</code> to it or switching to <code class="literal">gitFull</code>.</p></li><li class="listitem"><p><code class="literal">services.k3s.enable</code> no longer implies <code class="literal">systemd.enableUnifiedCgroupHierarchy = false</code>, and will default to the ‘systemd’ cgroup driver when using <code class="literal">services.k3s.docker = true</code>.
This change may require a reboot to take effect, and k3s may not be able to run if the boot cgroup hierarchy does not match its configuration.
The previous behavior may be retained by explicitly setting <code class="literal">systemd.enableUnifiedCgroupHierarchy = false</code> in your configuration.</p></li><li class="listitem"><p><code class="literal">fonts.fonts</code> no longer includes ancient bitmap fonts when both <code class="literal">config.services.xserver.enable</code> and <code class="literal">config.nixpkgs.config.allowUnfree</code> are enabled.
If you still want these fonts, use:</p><pre><code class="programlisting nix">{
  fonts.fonts = [
    pkgs.xorg.fontbhlucidatypewriter100dpi
    pkgs.xorg.fontbhlucidatypewriter75dpi
    pkgs.xorg.fontbh100dpi
  ];
}
</code></pre></li><li class="listitem"><p><code class="literal">services.prometheus.alertManagerTimeout</code> has been removed as it has been deprecated upstream and has no effect.</p></li><li class="listitem"><p>The DHCP server (<code class="literal">services.dhcpd4</code>, <code class="literal">services.dhcpd6</code>) has been hardened.
The service is now using the systemd’s <code class="literal">DynamicUser</code> mechanism to run as an unprivileged dynamically-allocated user with limited capabilities.
The dhcpd state files are now always stored in <code class="literal">/var/lib/dhcpd{4,6}</code> and the <code class="literal">services.dhcpd4.stateDir</code> and <code class="literal">service.dhcpd6.stateDir</code> options have been removed.
If you were depending on root privileges or set{uid,gid,cap} binaries in dhcpd shell hooks, you may give dhcpd more capabilities with e.g. <code class="literal">systemd.services.dhcpd6.serviceConfig.AmbientCapabilities</code>.</p></li><li class="listitem"><p>The <code class="literal">mailpile</code> email webclient (<code class="literal">services.mailpile</code>) has been removed due to its reliance on python2.</p></li><li class="listitem"><p><code class="literal">services.ipfs.extraFlags</code> is now escaped with <code class="literal">utils.escapeSystemdExecArgs</code>. If you rely on systemd interpolating <code class="literal">extraFlags</code> in the service <code class="literal">ExecStart</code>, this will no longer work.</p></li><li class="listitem"><p><code class="literal">hbase</code> version 0.98.24 has been removed. The package now defaults to version 2.4.11. Versions 1.7.1 and 3.0.0-alpha-2 are also available.</p></li><li class="listitem"><p><code class="literal">services.paperless-ng</code> was renamed to <code class="literal">services.paperless</code>. Accordingly, the <code class="literal">paperless-ng-manage</code> script (located in <code class="literal">dataDir</code>) was renamed to <code class="literal">paperless-manage</code>. <code class="literal">services.paperless</code> now uses <code class="literal">paperless-ngx</code>.</p></li><li class="listitem"><p>The <code class="literal">matrix-synapse</code> service (<code class="literal">services.matrix-synapse</code>) has been converted to use the <code class="literal">settings</code> option defined in RFC42.
This means that options that are part of your <code class="literal">homeserver.yaml</code> configuration, and that were specified at the top-level of the
module (<code class="literal">services.matrix-synapse</code>) now need to be moved into <code class="literal">services.matrix-synapse.settings</code>. And while not all options you
may use are defined in there, they are still supported, because you can set arbitrary values in this freeform type.</p><p>The <code class="literal">listeners.*.bind_address</code> option was renamed to <code class="literal">bind_addresses</code> in order to match the upstream <code class="literal">homeserver.yaml</code> option
name. It is now also a list of strings instead of a string.</p><p>An example to make the required migration clearer:</p><p>Before:</p><pre><code class="programlisting nix">{
  services.matrix-synapse = {
    enable = true;

    server_name = &quot;example.com&quot;;
    public_baseurl = &quot;https://example.com:8448&quot;;

    enable_registration = false;
    registration_shared_secret = &quot;xohshaeyui8jic7uutuDogahkee3aehuaf6ei3Xouz4iicie5thie6nohNahceut&quot;;
    macaroon_secret_key = &quot;xoo8eder9seivukaiPh1cheikohquuw8Yooreid0The4aifahth3Ou0aiShaiz4l&quot;;

    tls_certificate_path = &quot;/var/lib/acme/example.com/fullchain.pem&quot;;
    tls_certificate_path = &quot;/var/lib/acme/example.com/fullchain.pem&quot;;

    listeners = [ {
      port = 8448;
      bind_address = &quot;&quot;;
      type = &quot;http&quot;;
      tls = true;
      resources = [ {
        names = [ &quot;client&quot; ];
        compress = true;
      } {
        names = [ &quot;federation&quot; ];
        compress = false;
      } ];
    } ];

  };
}
</code></pre><p>After:</p><pre><code class="programlisting nix">{
  services.matrix-synapse = {
    enable = true;

    # this attribute set holds all values that go into your homeserver.yaml configuration
    # See https://github.com/matrix-org/synapse/blob/develop/docs/sample_config.yaml for
    # possible values.
    settings = {
      server_name = &quot;example.com&quot;;
      public_baseurl = &quot;https://example.com:8448&quot;;

      enable_registration = false;
      # pass `registration_shared_secret` and `macaroon_secret_key` via `extraConfigFiles` instead

      tls_certificate_path = &quot;/var/lib/acme/example.com/fullchain.pem&quot;;
      tls_certificate_path = &quot;/var/lib/acme/example.com/fullchain.pem&quot;;

      listeners = [ {
        port = 8448;
        bind_addresses = [
          &quot;::&quot;
          &quot;0.0.0.0&quot;
        ];
        type = &quot;http&quot;;
        tls = true;
        resources = [ {
          names = [ &quot;client&quot; ];
          compress = true;
        } {
          names = [ &quot;federation&quot; ];
          compress = false;
        } ];
      } ];
    };

    extraConfigFiles = [
      &quot;/run/keys/matrix-synapse/secrets.yaml&quot;
    ];
  };
}
</code></pre><p>The secrets in your original config should be migrated into a YAML file that is included via <code class="literal">extraConfigFiles</code>. The filename must be quoted to prevent nix from copying it to the (world readable) store.</p><p>Additionally a few option defaults have been synced up with upstream default values, for example the <code class="literal">max_upload_size</code> grew from <code class="literal">10M</code> to <code class="literal">50M</code>. For the same reason, the default
<code class="literal">media_store_path</code> was changed from <code class="literal">${dataDir}/media</code> to <code class="literal">${dataDir}/media_store</code> if <code class="literal">system.stateVersion</code> is at least <code class="literal">22.05</code>. Files will need to be manually moved to the new
location if the <code class="literal">stateVersion</code> is updated.</p><p>As of Synapse 1.58.0, the old groups/communities feature has been disabled by default. It will be completely removed with Synapse 1.61.0.</p></li><li class="listitem"><p>The Keycloak package (<code class="literal">pkgs.keycloak</code>) has been switched from the
Wildfly version, which will soon be deprecated, to the Quarkus based
version. The Keycloak service (<code class="literal">services.keycloak</code>) has been updated
to accommodate the change and now differs from the previous version
in a few ways:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">services.keycloak.extraConfig</code> has been removed in favor of the
new <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md"  target="_top">settings-style</a>
<a class="link" href="options.html#opt-services.keycloak.settings"  ><code class="literal">services.keycloak.settings</code></a>
option. The available options correspond directly to parameters in
<code class="literal">conf/keycloak.conf</code>. Some of the most important parameters are
documented as suboptions, the rest can be found in the <a class="link" href="https://www.keycloak.org/server/all-config"  target="_top">All
configuration section of the Keycloak Server Installation and
Configuration
Guide</a>. While the new
configuration is much simpler and cleaner than the old JBoss CLI
one, this unfortunately mean that there’s no straightforward way
to convert an old configuration to the new format and some
settings may not even be available anymore.</p></li><li class="listitem"><p><code class="literal">services.keycloak.frontendUrl</code> was removed and the frontend URL
is now configured through the <code class="literal">hostname</code> family of settings in
<a class="link" href="options.html#opt-services.keycloak.settings"  ><code class="literal">services.keycloak.settings</code></a>
instead. See the <a class="link" href="https://www.keycloak.org/server/hostname"  target="_top">Hostname section of the Keycloak Server
Installation and Configuration
Guide</a> for more
details. Additionally, <code class="literal">/auth</code> was removed from the default
context path and needs to be added back in
<a class="link" href="options.html#opt-services.keycloak.settings.http-relative-path"  ><code class="literal">services.keycloak.settings.http-relative-path</code></a>
if you want to keep compatibility with your current clients.</p></li><li class="listitem"><p><code class="literal">services.keycloak.bindAddress</code>,
<code class="literal">services.keycloak.forceBackendUrlToFrontendUrl</code>,
<code class="literal">services.keycloak.httpPort</code> and <code class="literal">services.keycloak.httpsPort</code>
have been removed in favor of their equivalent options in
<a class="link" href="options.html#opt-services.keycloak.settings"  ><code class="literal">services.keycloak.settings</code></a>. <code class="literal">httpPort</code>
and <code class="literal">httpsPort</code> have additionally had their types changed from
<code class="literal">str</code> to <code class="literal">port</code>.</p><p>The new names are as follows:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square;"><li class="listitem"><p><code class="literal">bindAddress</code>: <a class="link" href="options.html#opt-services.keycloak.settings.http-host"  ><code class="literal">services.keycloak.settings.http-host</code></a></p></li><li class="listitem"><p><code class="literal">forceBackendUrlToFrontendUrl</code>: <code class="literal">services.keycloak.settings.hostname-strict-backchannel</code></p></li><li class="listitem"><p><code class="literal">httpPort</code>: <a class="link" href="options.html#opt-services.keycloak.settings.http-port"  ><code class="literal">services.keycloak.settings.http-port</code></a></p></li><li class="listitem"><p><code class="literal">httpsPort</code>: <a class="link" href="options.html#opt-services.keycloak.settings.https-port"  ><code class="literal">services.keycloak.settings.https-port</code></a></p></li></ul></div></li></ul></div><p>For example, when using a reverse proxy the migration could look
like this:</p><p>Before:</p><pre><code class="programlisting nix">{
  services.keycloak = {
    enable = true;
    httpPort = &quot;8080&quot;;
    frontendUrl = &quot;https://keycloak.example.com/auth&quot;;
    database.passwordFile = &quot;/run/keys/db_password&quot;;
    extraConfig = {
      &quot;subsystem=undertow&quot;.&quot;server=default-server&quot;.&quot;http-listener=default&quot;.proxy-address-forwarding = true;
    };
  };
}
</code></pre><p>After:</p><pre><code class="programlisting nix">{
  services.keycloak = {
    enable = true;
    settings = {
      http-port = 8080;
      hostname = &quot;keycloak.example.com&quot;;
      http-relative-path = &quot;/auth&quot;;
      proxy = &quot;edge&quot;;
    };
    database.passwordFile = &quot;/run/keys/db_password&quot;;
  };
}
</code></pre></li><li class="listitem"><p>The MoinMoin wiki engine (<code class="literal">services.moinmoin</code>) has been removed, because Python 2 is being retired from nixpkgs.</p></li><li class="listitem"><p>Services in the <code class="literal">hadoop</code> module previously set <code class="literal">openFirewall</code> to true by default.
This has now been changed to false. Node definitions for multi-node clusters would need
<code class="literal">openFirewall = true;</code> to be added to to hadoop services when upgrading from NixOS 21.11.</p></li><li class="listitem"><p><code class="literal">services.hadoop.yarn.nodemanager</code> now uses cgroup-based CPU limit enforcement by default.
Additionally, the option <code class="literal">useCGroups</code> was added to nodemanagers as an easy way to switch
back to the old behavior.</p></li><li class="listitem"><p>The <code class="literal">wafHook</code> hook now honors <code class="literal">NIX_BUILD_CORES</code> when <code class="literal">enableParallelBuilding</code> is not set explicitly. Packages can restore the old behaviour by setting <code class="literal">enableParallelBuilding=false</code>.</p></li><li class="listitem"><p><code class="literal">pkgs.claws-mail-gtk2</code>, representing Claws Mail’s older release version three, was removed in order to get rid of Python 2.
Please switch to <code class="literal">claws-mail</code>, which is Claws Mail’s latest release based on GTK+3 and Python 3.</p></li><li class="listitem"><p>The <code class="literal">writers.writePython2</code> and corresponding <code class="literal">writers.writePython2Bin</code> convenience functions to create executable Python 2 scripts in the store were removed in preparation of removal of the Python 2 interpreter.
Scripts have to be converted to Python 3 for use with <code class="literal">writers.writePython3</code> or <code class="literal">writers.writePyPy2</code> needs to be used.</p></li><li class="listitem"><p><code class="literal">buildGoModule</code> was updated to use <code class="literal">go_1_17</code>, third party derivations that specify &gt;= go 1.17 in the main <code class="literal">go.mod</code> will need to regenerate their <code class="literal">vendorSha256</code> hash.</p></li><li class="listitem"><p>The <code class="literal">gnome-passwordsafe</code> package updated to <a class="link" href="https://gitlab.gnome.org/World/secrets/-/tags/6.0"  target="_top">version 6.x</a> and renamed to <code class="literal">gnome-secrets</code>.</p></li><li class="listitem"><p><code class="literal">services.gnome.experimental-features.realtime-scheduling</code> option has been removed, as GNOME Shell now <a class="link" href="https://gitlab.gnome.org/GNOME/mutter/-/merge_requests/2060"  target="_top">uses rtkit</a>. Use <code class="literal">security.rtkit.enable = true;</code> instead. As before, you will need to have it enabled using GSettings.</p></li><li class="listitem"><p><code class="literal">services.telepathy</code> will no longer be enabled by default for GNOME desktops, one should enable it in their configs if using Empathy or Polari.</p></li><li class="listitem"><p>If you previously used <code class="literal">/etc/docker/daemon.json</code>, you need to incorporate the changes into the new option <code class="literal">virtualisation.docker.daemon.settings</code>.</p></li><li class="listitem"><p>Ntopng (<code class="literal">services.ntopng</code>) is updated to 5.2.1 and uses a separate Redis instance if <code class="literal">system.stateVersion</code> is at least <code class="literal">22.05</code>. Existing setups shouldn’t be affected.</p></li><li class="listitem"><p>The backward compatibility in <code class="literal">services.wordpress</code> to configure sites with
the old interface has been removed. Please use <code class="literal">services.wordpress.sites</code>
instead.</p></li><li class="listitem"><p>The backward compatibility in <code class="literal">services.dokuwiki</code> to configure sites with the
old interface has been removed. Please use <code class="literal">services.dokuwiki.sites</code> instead.</p></li><li class="listitem"><p>opensmtpd-extras is no longer build with python2 scripting support due to python2 deprecation in nixpkgs</p></li><li class="listitem"><p><code class="literal">services.miniflux.adminCredentialFiles</code> is now required, instead of defaulting to <code class="literal">admin</code> and <code class="literal">password</code>.</p></li><li class="listitem"><p>The <code class="literal">taskserver</code> module no longer implicitly opens ports in the firewall
configuration. This is now controlled through the option
<code class="literal">services.taskserver.openFirewall</code>.</p></li><li class="listitem"><p>The <code class="literal">autorestic</code> package has been upgraded from 1.3.0 to 1.5.0 which introduces breaking changes in config file, check <a class="link" href="https://autorestic.vercel.app/migration/1.4_1.5"  target="_top">their migration guide</a> for more details.</p></li><li class="listitem"><p><code class="literal">teleport</code> has been upgraded to major version 9. Please see upstream <a class="link" href="https://goteleport.com/docs/setup/operations/upgrading/"  target="_top">upgrade instructions</a> and <a class="link" href="https://goteleport.com/docs/changelog/#900"  target="_top">release notes</a>.</p></li><li class="listitem"><p>For <code class="literal">pkgs.python3.pkgs.ipython</code>, its direct dependency <code class="literal">pkgs.python3.pkgs.matplotlib-inline</code>
(which is really an adapter to integrate matplotlib in ipython if it is installed) does
not depend on <code class="literal">pkgs.python3.pkgs.matplotlib</code> anymore.
This is closer to a non-Nix install of ipython.
This has the added benefit to reduce the closure size of <code class="literal">ipython</code> from ~400MB to ~160MB
(including ~100MB for python itself).</p></li><li class="listitem"><p><code class="literal">documentation.man</code> has been refactored to support choosing a man implementation other than GNU’s <code class="literal">man-db</code>. For this, <code class="literal">documentation.man.manualPages</code> has been renamed to <code class="literal">documentation.man.man-db.manualPages</code>. If you want to use the new alternative man implementation <code class="literal">mandoc</code>, add <code class="literal">documentation.man = { enable = true; man-db.enable = false; mandoc.enable = true; }</code> to your configuration.</p></li><li class="listitem"><p>Normal users (with <code class="literal">isNormalUser = true</code>) which have non-empty <code class="literal">subUidRanges</code> or <code class="literal">subGidRanges</code> set no longer have additional implicit ranges allocated. To enable automatic allocation back set <code class="literal">autoSubUidGidRange = true</code>.</p></li><li class="listitem"><p><code class="literal">idris2</code> now requires <code class="literal">--package</code> when using packages <code class="literal">contrib</code> and <code class="literal">network</code>, while previously these idris2 packages were automatically loaded.</p></li><li class="listitem"><p>The iputils package, which is installed by default, no longer provides the
legacy tools <code class="literal">tftpd</code> and <code class="literal">traceroute6</code>. More tools (<code class="literal">ninfod</code>, <code class="literal">rarpd</code>, and
<code class="literal">rdisc</code>) are going to be removed in the next release. See
<a class="link" href="https://github.com/iputils/iputils/releases/tag/20211215"  target="_top">upstream’s release notes</a>
for more details and available replacements.</p></li><li class="listitem"><p><code class="literal">services.thelounge.private</code> was removed in favor of <code class="literal">services.thelounge.public</code>, to follow with upstream changes.</p></li><li class="listitem"><p><code class="literal">pkgs.docbookrx</code> was removed since it’s unmaintained</p></li><li class="listitem"><p><code class="literal">pkgs._7zz</code> is now correctly licensed as LGPL3+ and BSD3 with optional unfree unRAR licensed code</p></li><li class="listitem"><p>The <code class="literal">vim.customize</code> function produced by <code class="literal">vimUtils.makeCustomizable</code> now has a slightly different interface:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>The wrapper now includes everything in the given Vim derivation if <code class="literal">name</code> is <code class="literal">&quot;vim&quot;</code> (the default). This makes the <code class="literal">wrapManual</code> argument obsolete, but this behavior can be overridden by setting the <code class="literal">standalone</code> argument.</p></li><li class="listitem"><p>All the executables present in the given derivation (or, in <code class="literal">standalone</code> mode, only the <code class="literal">*vim</code> ones) are wrapped. This makes the <code class="literal">wrapGui</code> argument obsolete.</p></li><li class="listitem"><p>The <code class="literal">vimExecutableName</code> and <code class="literal">gvimExecutableName</code> arguments were replaced by a single <code class="literal">executableName</code> argument in which the shell variable <code class="literal">$exe</code> can be used to refer to the wrapped executable’s name.</p></li></ul></div><p>See the comments in <code class="literal">pkgs/applications/editors/vim/plugins/vim-utils.nix</code> for more details.</p><p><code class="literal">vimUtils.vimWithRC</code> was removed. You should instead use <code class="literal">customize</code> on a Vim derivation, which now accepts <code class="literal">vimrcFile</code> and <code class="literal">gvimrcFile</code> arguments.</p></li><li class="listitem"><p><code class="literal">tilp2</code> was removed together with its module</p></li><li class="listitem"><p>The F-PROT antivirus (<code class="literal">fprot</code> package) and its service module were removed because it
reached <a class="link" href="https://kb.cyren.com/av-support/index.php?/Knowledgebase/Article/View/434/0/end-of-sale--end-of-life-for-f-prot-and-csam"  target="_top">end-of-life</a>.</p></li><li class="listitem"><p><code class="literal">bird1</code> and its modules <code class="literal">services.bird</code> as well as <code class="literal">services.bird6</code> have been removed. Upgrade to <code class="literal">services.bird2</code>.</p></li><li class="listitem"><p>The options <code class="literal">networking.interfaces.&lt;name&gt;.ipv4.routes</code> and <code class="literal">networking.interfaces.&lt;name&gt;.ipv6.routes</code> are no longer ignored when using networkd instead of the default scripted network backend by setting <code class="literal">networking.useNetworkd</code> to <code class="literal">true</code>.</p></li><li class="listitem"><p>The <code class="literal">miller</code> package has been upgraded from 5.10.3 to <a class="link" href="https://github.com/johnkerl/miller/releases/tag/v6.2.0"  target="_top">6.2.0</a>. See <a class="link" href="https://miller.readthedocs.io/en/latest/new-in-miller-6"  target="_top">What’s new in Miller 6</a>.</p></li><li class="listitem"><p>MultiMC has been replaced with the fork PrismLauncher due to upstream
developers being hostile to 3rd party package maintainers. PrismLauncher
removes all MultiMC branding and is aimed at providing proper 3rd party
packages like the one contained in Nixpkgs. This change affects the data
folder where game instances and other save and configuration files are stored.
Users with existing installations should rename <code class="literal">~/.local/share/multimc</code> to
<code class="literal">~/.local/share/PrismLauncher</code>. The main config file’s path has also moved
from <code class="literal">~/.local/share/multimc/multimc.cfg</code> to
<code class="literal">~/.local/share/PrismLauncher/prismlauncher.cfg</code>.</p></li><li class="listitem"><p><code class="literal">systemd-nspawn@.service</code> settings have been reverted to the default systemd behaviour. User namespaces are now activated by default. If you want to keep running nspawn containers without user namespaces you need to set <code class="literal">systemd.nspawn.&lt;name&gt;.execConfig.PrivateUsers = false</code></p></li><li class="listitem"><p><code class="literal">systemd-shutdown</code> is now properly linked on shutdown to unmount all filesystems and device mapper devices cleanly. This can be disabled using <code class="literal">systemd.shutdownRamfs.enable</code>.</p></li><li class="listitem"><p>The Tor SOCKS proxy is now actually disabled if <code class="literal">services.tor.client.enable</code> is set to <code class="literal">false</code> (the default). If you are using this functionality but didn’t change the setting or set it to <code class="literal">false</code>, you now need to set it to <code class="literal">true</code>.</p></li><li class="listitem"><p><code class="literal">services.github-runner</code> has been hardened.  Notably address families and
system calls have been restricted, which may adversely affect some kinds of
testing, e.g. using <code class="literal">AF_BLUETOOTH</code> to test bluetooth devices.</p></li><li class="listitem"><p>The terraform 0.12 compatibility has been removed and the <code class="literal">terraform.withPlugins</code> and <code class="literal">terraform-providers.mkProvider</code> implementations simplified. Providers now need to be stored under
<code class="literal">$out/libexec/terraform-providers/&lt;registry&gt;/&lt;owner&gt;/&lt;name&gt;/&lt;version&gt;/&lt;os&gt;_&lt;arch&gt;/terraform-provider-&lt;name&gt;_v&lt;version&gt;</code> (which mkProvider does).</p><p>This breaks back-compat so it’s not possible to mix-and-match with previous versions of nixpkgs. In exchange, it now becomes possible to use the providers from <a class="link" href="https://github.com/numtide/nixpkgs-terraform-providers-bin"  target="_top">nixpkgs-terraform-providers-bin</a> directly.</p></li><li class="listitem"><p>The <code class="literal">dendrite</code> package has been upgraded from 0.5.1 to
<a class="link" href="https://github.com/matrix-org/dendrite/releases/tag/v0.6.5"  target="_top">0.6.5</a>. Instances
configured with split sqlite databases, which has been the default
in NixOS, require merging of the federation sender and signing key
databases. See upstream <a class="link" href="https://github.com/matrix-org/dendrite/releases/tag/v0.6.0"  target="_top">release
notes</a>
on version 0.6.0 for details on database changes.</p></li><li class="listitem"><p>The existing <code class="literal">pkgs.opentelemetry-collector</code> has been moved to
<code class="literal">pkgs.opentelemetry-collector-contrib</code> to match the actual source being the
“contrib” edition. <code class="literal">pkgs.opentelemetry-collector</code> is now the actual core
release of opentelemetry-collector. If you use the community contributions
you should change the package you refer to. If you don’t need them update your
commands from <code class="literal">otelcontribcol</code> to <code class="literal">otelcorecol</code> and enjoy a 7x smaller binary.</p></li><li class="listitem"><p><code class="literal">services.zookeeper</code> has a new option <code class="literal">jre</code> for specifying the JRE to start
zookeeper with. It defaults to the JRE that <code class="literal">pkgs.zookeeper</code> was wrapped with,
instead of <code class="literal">pkgs.jre</code>. This changes the JRE to <code class="literal">pkgs.jdk11_headless</code> by default.</p></li><li class="listitem"><p><code class="literal">pkgs.pgadmin</code> now refers to <code class="literal">pkgs.pgadmin4</code>. <code class="literal">pgadmin3</code> has been removed.</p></li><li class="listitem"><p><code class="literal">pkgs.minetestclient_4</code> and <code class="literal">pkgs.minetestserver_4</code> have been removed, as the last 4.x release was in 2018. <code class="literal">pkgs.minetestclient</code> (equivalent to <code class="literal">pkgs.minetest</code> ) and <code class="literal">pkgs.minetestserver</code> can be used instead.</p></li><li class="listitem"><p><code class="literal">pkgs.noto-fonts-cjk</code> is now deprecated in favor of <code class="literal">pkgs.noto-fonts-cjk-sans</code>
and <code class="literal">pkgs.noto-fonts-cjk-serif</code> because they each have different release
schedules. To maintain compatibility with prior releases of Nixpkgs,
<code class="literal">pkgs.noto-fonts-cjk</code> is currently an alias of <code class="literal">pkgs.noto-fonts-cjk-sans</code> and
doesn’t include serif fonts.</p></li><li class="listitem"><p><code class="literal">pkgs.epgstation</code> has been upgraded from v1 to v2, resulting in incompatible
changes in the database scheme and configuration format.</p></li><li class="listitem"><p>Some top-level settings under <a class="link" href="options.html#opt-services.epgstation.enable"  >services.epgstation</a>
is now deprecated because it was redundant due to the same options being
present in <a class="link" href="options.html#opt-services.epgstation.settings"  >services.epgstation.settings</a>.</p></li><li class="listitem"><p>The option <code class="literal">services.epgstation.basicAuth</code> was removed because basic
authentication support was dropped by upstream.</p></li><li class="listitem"><p>The option <a class="link" href="options.html#opt-services.epgstation.database.passwordFile"  >services.epgstation.database.passwordFile</a>
no longer has a default value. Make sure to set this option explicitly before
upgrading. Change the database password if necessary.</p></li><li class="listitem"><p>The <a class="link" href="options.html#opt-services.epgstation.settings"  >services.epgstation.settings</a>
option now expects options for <code class="literal">config.yml</code> in EPGStation v2.</p></li><li class="listitem"><p>Existing data for the <a class="link" href="options.html#opt-services.epgstation.enable"  >services.epgstation</a>
module would have to be backed up prior to the upgrade. To back up existing
data to <code class="literal">/tmp/epgstation.bak</code>, run
<code class="literal">sudo -u epgstation epgstation run backup /tmp/epgstation.bak</code>.
To import that data after to the upgrade, run
<code class="literal">sudo -u epgstation epgstation run v1migrate /tmp/epgstation.bak</code></p></li><li class="listitem"><p><code class="literal">switch-to-configuration</code> (the script that is run when running <code class="literal">nixos-rebuild switch</code> for example) has been reworked</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>The interface that allows activation scripts to restart units has been streamlined. Restarting and reloading is now done by a single file <code class="literal">/run/nixos/activation-restart-list</code> that honors <code class="literal">restartIfChanged</code> and <code class="literal">reloadIfChanged</code> of the units.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square;"><li class="listitem"><p>Preferring to reload instead of restarting can still be achieved using <code class="literal">/run/nixos/activation-reload-list</code>.</p></li></ul></div></li><li class="listitem"><p>The script now uses a proper ini-file parser to parse systemd units. Some values are now only searched in one section instead of in the entire unit. This is only relevant for units that don’t use the NixOS systemd moule.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square;"><li class="listitem"><p><code class="literal">RefuseManualStop</code>, <code class="literal">X-OnlyManualStart</code>, <code class="literal">X-StopOnRemoval</code>, <code class="literal">X-StopOnReconfiguration</code> are only searched in the <code class="literal">[Unit]</code> section</p></li><li class="listitem"><p><code class="literal">X-ReloadIfChanged</code>, <code class="literal">X-RestartIfChanged</code>, <code class="literal">X-StopIfChanged</code> are only searched in the <code class="literal">[Service]</code> section</p></li></ul></div></li></ul></div></li><li class="listitem"><p>The <code class="literal">services.bookstack.cacheDir</code> option has been removed, since the
cache directory is now handled by systemd.</p></li><li class="listitem"><p>The <code class="literal">services.bookstack.extraConfig</code> option has been replaced by
<code class="literal">services.bookstack.config</code> which implements a
<a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md"  target="_top">settings-style</a>
configuration.</p></li><li class="listitem"><p><code class="literal">lib.assertMsg</code> and <code class="literal">lib.assertOneOf</code> no longer return <code class="literal">false</code> if the passed condition is <code class="literal">false</code>, <code class="literal">throw</code>ing the given error message instead (which makes the resulting error message less cluttered). This will not impact the behaviour of code using these functions as intended, namely as top-level wrapper for <code class="literal">assert</code> conditions.</p></li><li class="listitem"><p>The <code class="literal">vpnc</code> package has been changed to use GnuTLS instead of OpenSSL by default for licensing reasons.</p></li><li class="listitem"><p>The default version of <code class="literal">nextcloud</code> is <span class="strong"><strong>nextcloud24</strong></span>. Please note that it’s <span class="strong"><strong>not</strong></span> possible to upgrade
<code class="literal">nextcloud</code> across multiple major versions! This means it’s e.g. not possible to upgrade from <code class="literal">nextcloud22</code>
to <code class="literal">nextcloud24</code> in a single deploy and most <code class="literal">21.11</code> users will have to upgrade to <code class="literal">nextcloud23</code> first.</p></li><li class="listitem"><p><code class="literal">pkgs.vimPlugins.onedark-nvim</code> now refers to <a class="link" href="https://github.com/navarasu/onedark.nvim"  target="_top">navarasu/onedark.nvim</a>
(formerly refers to <a class="link" href="https://github.com/olimorris/onedarkpro.nvim"  target="_top">olimorris/onedarkpro.nvim</a>).</p></li><li class="listitem"><p><code class="literal">services.pipewire.enable</code> will default to enabling the WirePlumber session manager instead of pipewire-media-session.
pipewire-media-session is deprecated by upstream and not recommended, but can still be manually enabled by setting
<code class="literal">services.pipewire.media-session.enable</code> to <code class="literal">true</code> and <code class="literal">services.pipewire.wireplumber.enable</code> to <code class="literal">false</code>.</p></li><li class="listitem"><p><code class="literal">pkgs.makeDesktopItem</code> has been refactored to provide a more idiomatic API. Specifically:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>All valid options as of FDO Desktop Entry specification version 1.4 can now be passed in as explicit arguments</p></li><li class="listitem"><p><code class="literal">exec</code> can now be null, for entries that are not of type Application</p></li><li class="listitem"><p><code class="literal">mimeType</code> argument is renamed to <code class="literal">mimeTypes</code> for consistency</p></li><li class="listitem"><p><code class="literal">mimeTypes</code>, <code class="literal">categories</code>, <code class="literal">implements</code>, <code class="literal">keywords</code>, <code class="literal">onlyShowIn</code> and <code class="literal">notShowIn</code> take lists of strings instead of one string with semicolon separators</p></li><li class="listitem"><p><code class="literal">extraDesktopEntries</code> renamed to <code class="literal">extraConfig</code> for consistency</p></li><li class="listitem"><p>Actions should now be provided as an attrset <code class="literal">actions</code>, the <code class="literal">Actions</code> line will be autogenerated.</p></li><li class="listitem"><p><code class="literal">extraEntries</code> is removed.</p></li><li class="listitem"><p>Additional validation is added both at eval time and at build time.</p></li></ul></div><p>See the <code class="literal">vscode</code> package for a more detailed example.</p></li><li class="listitem"><p>Existing <code class="literal">resholve*</code> functions have been renamed and nested under <code class="literal">pkgs.resholve</code>. Update uses to:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">resholvePackage</code> -&gt; <code class="literal">resholve.mkDerivation</code></p></li><li class="listitem"><p><code class="literal">resholveScript</code> -&gt; <code class="literal">resholve.writeScript</code></p></li><li class="listitem"><p><code class="literal">resholveScriptBin</code> -&gt; <code class="literal">resholve.writeScriptBin</code></p></li></ul></div></li><li class="listitem"><p><code class="literal">pkgs.cosmopolitan</code> no longer provides the <code class="literal">cosmoc</code> command. It has been moved to <code class="literal">pkgs.cosmoc</code>.</p></li><li class="listitem"><p><code class="literal">pkgs.graalvmXX-ce</code> packages no longer provide support for Python/Ruby/WASM, instead focusing only in Java and Native Image Support. If you need to add support back, please see the <code class="literal">pkgs.graalvmCEPackages.mkGraal</code> function to create your own customized version of GraalVM with support for what you need.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-22.05-notable-changes" class="title" >Other Notable Changes   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The option <a class="link" href="options.html#opt-services.redis.servers"  >services.redis.servers</a> was added
to support per-application <code class="literal">redis-server</code> which is more secure since Redis databases
are only mere key prefixes without any configuration or ACL of their own.
Backward-compatibility is preserved by mapping old <code class="literal">services.redis.settings</code>
to <code class="literal">services.redis.servers.&quot;&quot;.settings</code>, but you are strongly encouraged
to name each <code class="literal">redis-server</code> instance after the application using it,
instead of keeping that nameless one.
Except for the nameless <code class="literal">services.redis.servers.&quot;&quot;</code>
still accessible at <code class="literal">127.0.0.1:6379</code>,
and to the members of the Unix group <code class="literal">redis</code>
through the Unix socket <code class="literal">/run/redis/redis.sock</code>,
all other <code class="literal">services.redis.servers.${serverName}</code>
are only accessible by default
to the members of the Unix group <code class="literal">redis-${serverName}</code>
through the Unix socket <code class="literal">/run/redis-${serverName}/redis.sock</code>.</p></li><li class="listitem"><p>The option <a class="link" href="options.html#opt-virtualisation.vmVariant"  >virtualisation.vmVariant</a> was added
to allow users to make changes to the <code class="literal">nixos-rebuild build-vm</code> configuration
that do not apply to their normal system.</p><p>The <code class="literal">config.system.build.vm</code> attribute now always exists and defaults to the
value from <code class="literal">vmVariant</code>. Configurations that import the <code class="literal">virtualisation/qemu-vm.nix</code>
module themselves will override this value, such that <code class="literal">vmVariant</code> is not used.</p><p>Similarly <a class="link" href="options.html#opt-virtualisation.vmVariantWithBootLoader"  >virtualisation.vmVariantWithBootloader</a> was added.</p></li><li class="listitem"><p>The configuration portion of the <code class="literal">nix-daemon</code> module has been reworked and exposed as <a class="link" href="options.html#opt-nix-settings"  target="_top">nix.settings</a>:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Legacy options have been mapped to the corresponding options under under <a class="link" href="options.html#opt-nix.settings"  target="_top">nix.settings</a> and will be deprecated when NixOS 21.11 reaches end of life.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-nix.buildMachines.publicHostKey"  target="_top">nix.buildMachines.publicHostKey</a> has been added.</p></li></ul></div></li><li class="listitem"><p><a class="link" href="https://kops.sigs.k8s.io"  target="_top"><code class="literal">kops</code></a> defaults to 1.23.2, which will enable <a class="link" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html"  target="_top">Instance Metadata Service Version 2</a> and require tokens on new clusters with Kubernetes &gt;= 1.22. This will increase security by default, but may break some types of workloads. The default behaviour for <code class="literal">spec.kubeDNS.nodeLocalDNS.forwardToKubeDNS</code> has changed from <code class="literal">true</code> to <code class="literal">false</code>. Cilium now has <code class="literal">disable-cnp-status-updates: true</code> by default. Set this to false if you rely on the CiliumNetworkPolicy status fields. Support for Kubernetes 1.17, the Lyft CNI, Weave CNI on Kubernetes &gt;= 1.23, CentOS 7 and 8, Debian 9, RHEL 7, and Ubuntu 16.05 (Xenial) has been removed. See the <a class="link" href="https://kops.sigs.k8s.io/releases/1.22-notes/"  target="_top">1.22 release notes</a> and <a class="link" href="https://kops.sigs.k8s.io/releases/1.23-notes/"  target="_top">1.23 release notes</a> for more details, including other significant changes.</p></li><li class="listitem"><p>Mattermost has been upgraded to extended support version 6.3 as the previously
packaged extended support version 5.37 is <a class="link" href="https://docs.mattermost.com/upgrade/extended-support-release.html"  target="_top">reaching end of life</a>.
Migration may take some time, see the <a class="link" href="https://docs.mattermost.com/install/self-managed-changelog.html#release-v6-3-extended-support-release"  target="_top">changelog</a>
and <a class="link" href="https://docs.mattermost.com/upgrade/important-upgrade-notes.html"  target="_top">important upgrade notes</a>.</p></li><li class="listitem"><p>The <code class="literal">writers.writePyPy2</code>/<code class="literal">writers.writePyPy3</code> and corresponding <code class="literal">writers.writePyPy2Bin</code>/<code class="literal">writers.writePyPy3Bin</code> convenience functions to create executable Python 2/3 scripts using the PyPy interpreter were added.</p></li><li class="listitem"><p>Some improvements have been made to the <code class="literal">hadoop</code> module:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>A <code class="literal">gatewayRole</code> option has been added, for deploying hadoop cluster configuration files to a node that does not have any active services</p></li><li class="listitem"><p>Support for older versions of hadoop have been added to the module</p></li><li class="listitem"><p>Overriding and extending site XML files has been made easier</p></li></ul></div></li><li class="listitem"><p>The auto-upgrade service now accepts persistent (default: true) parameter.
By default auto-upgrade will now run immediately if it would have been triggered at least
once during the time when the timer was inactive.</p></li><li class="listitem"><p>Mastodon now uses <code class="literal">services.redis.servers</code> to start a new redis server, instead of using a global redis server.
This improves compatibility with other services that use redis.</p><p>Note that this will recreate the redis database, although according to the <a class="link" href="https://docs.joinmastodon.org/admin/backups/"  target="_top">Mastodon docs</a>,
this is almost harmless:</p><div class="blockquote"><blockquote class="blockquote"><p>Losing the Redis database is almost harmless: The only irrecoverable data will be the contents of the Sidekiq queues and scheduled retries of previously failed jobs.
The home and list feeds are stored in Redis, but can be regenerated with tootctl.</p></blockquote></div><p>If you do want to save the redis database, you can use the following commands:</p><pre><code class="programlisting bash">redis-cli save
cp /var/lib/redis/dump.rdb &quot;/var/lib/redis-mastodon/dump.rdb&quot;
</code></pre></li><li class="listitem"><p>Peertube now uses services.redis.servers to start a new redis server, instead of using a global redis server.
This improves compatibility with other services that use redis.</p><p>Redis database is used for storage only cache and job queue. More information can be found here - <a class="link" href="https://docs.joinpeertube.org/contribute-architecture"  target="_top">Peertube architecture</a>.</p><p>If you do want to save the redis database, you can use the following commands before upgrade OS:</p><pre><code class="programlisting bash">redis-cli save
sudo mkdir /var/lib/redis-peertube
sudo cp /var/lib/redis/dump.rdb /var/lib/redis-peertube/dump.rdb
</code></pre></li><li class="listitem"><p>Added the <code class="literal">keter</code> NixOS module. Keter reverse proxies requests to your loaded application based on virtual hostnames.</p></li><li class="listitem"><p>If you are using Wayland you can choose to use the Ozone Wayland support
in Chrome and several Electron apps by setting the environment variable
<code class="literal">NIXOS_OZONE_WL=1</code> (for example via
<code class="literal">environment.sessionVariables.NIXOS_OZONE_WL = &quot;1&quot;</code>).
This is not enabled by default because Ozone Wayland is
still under heavy development and behavior is not always flawless.
Furthermore, not all Electron apps use the latest Electron versions.</p></li><li class="listitem"><p>A new option group <code class="literal">systemd.network.wait-online</code> was added, with options to configure <code class="literal">systemd-networkd-wait-online.service</code>:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">anyInterface</code> allows specifying that the network should be considered online when <span class="emphasis"><em>at least one</em></span> interface is online (useful on laptops)</p></li><li class="listitem"><p><code class="literal">timeout</code> defines how long to wait for the network to come online</p></li><li class="listitem"><p><code class="literal">extraArgs</code> for everything else</p></li></ul></div></li><li class="listitem"><p>The <code class="literal">influxdb2</code> package was split into <code class="literal">influxdb2-server</code> and
<code class="literal">influxdb2-cli</code>, matching the split that took place upstream. A
combined <code class="literal">influxdb2</code> package is still provided in this release for
backwards compatibility, but will be removed at a later date.</p></li><li class="listitem"><p>The <code class="literal">unifi</code> package was switched from <code class="literal">unifi6</code> to <code class="literal">unifi7</code>.
Direct downgrades from Unifi 7 to Unifi 6 are not possible and require restoring from a backup made by Unifi 6.</p></li><li class="listitem"><p><code class="literal">programs.zsh.autosuggestions.strategy</code> now takes a list of strings instead of a string.</p></li><li class="listitem"><p>The <code class="literal">asterisk</code> and <code class="literal">asterisk-stable</code> packages were switched from <code class="literal">asterisk_18</code> to the newly-packaged <code class="literal">asterisk_19</code>. Asterisk 13 and 17 have been removed as they have reached their end of life.</p></li><li class="listitem"><p>The <code class="literal">services.unifi.openPorts</code> option default value of <code class="literal">true</code> is now deprecated and will be changed to <code class="literal">false</code> in 22.11.
Configurations using this default will print a warning when rebuilt.</p></li><li class="listitem"><p>The <code class="literal">services.unifi-video.openPorts</code> option default value of <code class="literal">true</code> is now deprecated and will be changed to <code class="literal">false</code> in 22.11.
Configurations using this default will print a warning when rebuilt.</p></li><li class="listitem"><p><code class="literal">security.acme</code> certificates will now correctly check for CA
revocation before reaching their minimum age.</p></li><li class="listitem"><p>Removing domains from <code class="literal">security.acme.certs._name_.extraDomainNames</code>
will now correctly remove those domains during rebuild/renew.</p></li><li class="listitem"><p>MariaDB is now offered in several versions, not just the newest one.
So if you have a need for running MariaDB 10.4 for example, you can now just set <code class="literal">services.mysql.package = pkgs.mariadb_104;</code>.
In general, it is recommended to run the newest version, to get the newest features, while sticking with an LTS version will most likely provide a more stable experience.
Sometimes software is also incompatible with the newest version of MariaDB.</p></li><li class="listitem"><p>The option
<a class="link" href="options.html#opt-programs.ssh.enableAskPassword"  >programs.ssh.enableAskPassword</a> was
added, decoupling the setting of <code class="literal">SSH_ASKPASS</code> from
<code class="literal">services.xserver.enable</code>. This allows easy usage in non-X11 environments,
e.g. Wayland.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-programs.ssh.knownHosts"  >programs.ssh.knownHosts</a> has gained an <code class="literal">extraHostNames</code>
option to augment <code class="literal">hostNames</code>. It is now possible to use the attribute name of a <code class="literal">knownHosts</code>
entry as the primary host name and specify secondary host names using <code class="literal">extraHostNames</code> without
having to duplicate the primary host name.</p></li><li class="listitem"><p>The <code class="literal">services.stubby</code> module was converted to a <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md"  target="_top">settings-style</a> configuration.</p></li><li class="listitem"><p>The option
<a class="link" href="options.html#opt-services.xserver.desktopManager.runXdgAutostartIfNone"  >services.xserver.desktopManager.runXdgAutostartIfNone</a>
was added in order to automatically run XDG autostart files for sessions without a desktop manager.
This replaces helpers like the <code class="literal">dex</code> package.</p></li><li class="listitem"><p>When setting <a class="link" href="options.html#opt-i18n.inputMethod.enabled"  >i18n.inputMethod.enabled</a> to <code class="literal">fcitx5</code>,
it no longer creates corresponding systemd user services.
It now relies on XDG autostart files to start and work properly in your desktop sessions.
If you are using only a window manager without a desktop manager, you need to enable
<code class="literal">services.xserver.desktopManager.runXdgAutostartIfNone</code> or using the <code class="literal">dex</code> package to make <code class="literal">fcitx5</code> work.</p></li><li class="listitem"><p>The option <code class="literal">services.duplicati.dataDir</code> has been added to allow changing the location of duplicati’s files.</p></li><li class="listitem"><p>The options <code class="literal">boot.extraModprobeConfig</code> and <code class="literal">boot.blacklistedKernelModules</code> now also take effect in the initrd by copying the file <code class="literal">/etc/modprobe.d/nixos.conf</code> into the initrd.</p></li><li class="listitem"><p><code class="literal">nixos-generate-config</code> now puts the dhcp configuration in <code class="literal">hardware-configuration.nix</code> instead of <code class="literal">configuration.nix</code>.</p></li><li class="listitem"><p>ORY Kratos was updated to version 0.9.0-alpha.3, which introduces some breaking changes:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>All endpoints at the Admin API are now exposed at <code class="literal">/admin/</code>. For example, endpoint <code class="literal">https://kratos:4434/identities</code> is now exposed at <code class="literal">https://kratos:4434/admin/identities</code></p></li><li class="listitem"><p>Configuration key <code class="literal">selfservice.whitelisted_return_urls</code> has been renamed to <code class="literal">allowed_return_urls</code></p></li><li class="listitem"><p>The <code class="literal">password_identifier</code> form field of the password login strategy has been renamed to <code class="literal">identifier</code> to make compatibility with passwordless flows possible.</p></li><li class="listitem"><p>Instead of having a global <code class="literal">default_schema_url</code> which developers used to update their schema, you now need to define the <code class="literal">default_schema_id</code> which must reference schema ID in your config.</p></li><li class="listitem"><p>Calling <code class="literal">/self-service/recovery</code> without flow ID or with an invalid flow ID while authenticated will now respond with an error instead of redirecting to the default page.</p></li><li class="listitem"><p>If you are relying on the SQLite images, update your Docker Pull commands as follows:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square;"><li class="listitem"><p><code class="literal">docker pull oryd/kratos:{version}</code></p></li></ul></div></li><li class="listitem"><p>Additionally, all passwords now have to be at least 8 characters long.</p></li><li class="listitem"><p>For more details, see:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square;"><li class="listitem"><p><a class="link" href="https://github.com/ory/kratos/releases/tag/v0.8.1-alpha.1"  target="_top">Release Notes for v0.8.1-alpha-1</a></p></li><li class="listitem"><p><a class="link" href="https://github.com/ory/kratos/releases/tag/v0.8.2-alpha.1"  target="_top">Release Notes for v0.8.2-alpha-1</a></p></li><li class="listitem"><p><a class="link" href="https://github.com/ory/kratos/releases/tag/v0.9.0-alpha.1"  target="_top">Release Notes for v0.9.0-alpha-1</a></p></li><li class="listitem"><p><a class="link" href="https://github.com/ory/kratos/releases/tag/v0.9.0-alpha.3"  target="_top">Release Notes for v0.9.0-alpha-3</a></p></li></ul></div></li></ul></div></li><li class="listitem"><p><code class="literal">fetchFromSourcehut</code> now allows fetching repositories recursively
using <code class="literal">fetchgit</code> or <code class="literal">fetchhg</code> if the argument <code class="literal">fetchSubmodules</code>
is set to <code class="literal">true</code>.</p></li><li class="listitem"><p>A module for declarative configuration of openconnect VPN profiles was added under <code class="literal">networking.openconnect</code>.</p></li><li class="listitem"><p>The <code class="literal">element-desktop</code> package now has an <code class="literal">useKeytar</code> option (defaults to <code class="literal">true</code>),
which allows disabling <code class="literal">keytar</code> and in turn <code class="literal">libsecret</code> usage
(which binds to native credential managers / keychain libraries).</p></li><li class="listitem"><p>The option <code class="literal">services.thelounge.plugins</code> has been added to allow installing plugins for The Lounge. Plugins can be found in <code class="literal">pkgs.theLoungePlugins.plugins</code> and <code class="literal">pkgs.theLoungePlugins.themes</code>.</p></li><li class="listitem"><p>The option <code class="literal">services.xserver.videoDriver = [ &quot;nvidia&quot; ];</code> will now also install <a class="link" href="https://github.com/elFarto/nvidia-vaapi-driver"  target="_top">nvidia VA-API drivers</a> by default.</p></li><li class="listitem"><p>The <code class="literal">firmwareLinuxNonfree</code> package has been renamed to <code class="literal">linux-firmware</code>.</p></li><li class="listitem"><p>It is now possible to specify wordlists to include as handy to access environment variables using the <code class="literal">config.environment.wordlist</code> configuration options.</p></li><li class="listitem"><p>The <code class="literal">services.mbpfan</code> module was converted to a <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md"  target="_top">RFC 0042</a> configuration.</p></li><li class="listitem"><p>The default value for <code class="literal">programs.spacefm.settings.graphical_su</code> got unset. It previously pointed to <code class="literal">gksu</code> which has been removed.</p></li><li class="listitem"><p>The <a class="link" href="https://dino.im"  target="_top">Dino</a> XMPP client was updated to 0.3, adding support for audio and video calls.</p></li><li class="listitem"><p><code class="literal">services.mattermost.plugins</code> has been added to allow the declarative installation of Mattermost plugins.
Plugins are automatically repackaged using autoPatchelf.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.logrotate.enable"  >services.logrotate.enable</a> now defaults to true if any rotate path has
been defined, and some paths have been added by default.</p></li><li class="listitem"><p>The logrotate module also has been updated to freeform syntax: <code class="literal">services.logrotate.paths</code>
and <code class="literal">services.logrotate.extraConfig</code> will work, but issue deprecation
warnings and <a class="link" href="options.html#opt-services.logrotate.settings"  >services.logrotate.settings</a> should now be used instead.</p></li><li class="listitem"><p><code class="literal">security.pam.ussh</code> has been added, which allows authorizing PAM sessions based on SSH <span class="emphasis"><em>certificates</em></span> held within an SSH agent, using <a class="link" href="https://github.com/uber/pam-ussh"  target="_top">pam-ussh</a>.</p></li><li class="listitem"><p>The <code class="literal">vscode-extensions.ionide.ionide-fsharp</code> package has been updated to 6.0.0 and now requires .NET 6.0.</p></li><li class="listitem"><p>The <code class="literal">phpPackages.box</code> package has been updated from 2.7.5 to 3.16.0. See the <a class="link" href="https://github.com/box-project/box/blob/master/UPGRADE.md#from-27-to-30"  target="_top">upgrade guide</a> for more details.</p></li><li class="listitem"><p>The <code class="literal">zrepl</code> package has been updated from 0.4.0 to 0.5:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>The RPC protocol version was bumped; all zrepl daemons in a setup must be updated and restarted before replication can resume.</p></li><li class="listitem"><p>A bug involving encrypt-on-receive has been fixed. Read the <a class="link" href="https://zrepl.github.io/configuration/sendrecvoptions.html#job-recv-options-placeholder"  target="_top">zrepl documentation</a> and check the output of <code class="literal">zfs get -r encryption,zrepl:placeholder PATH_TO_ROOTFS</code> on the receiver.</p></li></ul></div></li><li class="listitem"><p>The <code class="literal">polybar</code> package has been updated from 3.5.7 to 3.6.2. See <a class="link" href="https://github.com/polybar/polybar/releases/tag/3.6.0"  target="_top">the changelog</a> for more details.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Breaking changes include changes to escaping rules in configuration values, changes in behavior when encountering invalid tag names, and changes to inter-process-messaging (IPC).</p></li></ul></div></li><li class="listitem"><p>Renamed option <code class="literal">services.openssh.challengeResponseAuthentication</code> to <code class="literal">services.openssh.kbdInteractiveAuthentication</code>.
Reason is that the old name has been deprecated upstream.
Using the old option name will still work, but produce a warning.</p></li><li class="listitem"><p><code class="literal">services.autorandr</code> now allows for adding hooks and profiles declaratively.</p></li><li class="listitem"><p>The <code class="literal">pomerium-cli</code> command has been moved out of the <code class="literal">pomerium</code> package into
the <code class="literal">pomerium-cli</code> package, following upstream’s repository split. If you are
using the <code class="literal">pomerium-cli</code> command, you should now install the <code class="literal">pomerium-cli</code>
package.</p></li><li class="listitem"><p>The option <code class="literal">services.networking.networkmanager.enableFccUnlock</code>
was added to support FCC unlock procedures. Since release 1.18.4, the ModemManager
daemon no longer automatically performs the FCC unlock procedure by default. See
<a class="link" href="https://modemmanager.org/docs/modemmanager/fcc-unlock/"  target="_top">the docs</a> for more details.</p></li><li class="listitem"><p><code class="literal">programs.tmux</code> has a new option <code class="literal">plugins</code> that accepts a list of packages from the <code class="literal">tmuxPlugins</code> group. The specified packages are added to the system and loaded by <code class="literal">tmux</code>.</p></li><li class="listitem"><p>The polkit service, available at <code class="literal">security.polkit.enable</code>, is now disabled by default. It will automatically be enabled through services and desktop environments as needed.</p></li><li class="listitem"><p><code class="literal">mercury</code> was updated to 22.01.1, which has some breaking changes (<a class="link" href="https://dl.mercurylang.org/release/release-notes-22.01.html"  target="_top">Mercury 22.01 news</a>).</p></li><li class="listitem"><p>xfsprogs was update to version 5.15, which enables inobtcount and bigtime by default on filesystem creation. Support for these features was added in kernel 5.10 and deemed stable in kernel 5.15.
If you want to be able to mount XFS filesystems created with this release of xfsprogs on kernel releases older than 5.10, you need to format them with <code class="literal">mkfs.xfs -m bigtime=0 -m inobtcount=0</code>.</p></li><li class="listitem"><p><code class="literal">services.xserver.desktopManager.xfce</code> now includes Xfce’s screen locker, <code class="literal">xfce4-screensaver</code> that is enabled by default. You can disable it by setting <code class="literal">false</code> to <a class="link" href="options.html#opt-services.xserver.desktopManager.xfce.enableScreensaver"  >services.xserver.desktopManager.xfce.enableScreensaver</a>.</p></li><li class="listitem"><p>The <code class="literal">hadoop</code> package has added support for <code class="literal">aarch64-linux</code> and <code class="literal">aarch64-darwin</code> as of 3.3.1 (<a class="link" href="https://github.com/NixOS/nixpkgs/pull/158613"  target="_top">#158613</a>).</p></li><li class="listitem"><p>The <code class="literal">R</code> package now builds again on <code class="literal">aarch64-darwin</code> (<a class="link" href="https://github.com/NixOS/nixpkgs/pull/158992"  target="_top">#158992</a>).</p></li><li class="listitem"><p>The <code class="literal">nss</code> package was split into <code class="literal">nss_esr</code> and <code class="literal">nss_latest</code>, with <code class="literal">nss</code> being an alias for <code class="literal">nss_esr</code>. This was done to ease maintenance of <code class="literal">nss</code> and dependent high-profile packages like <code class="literal">firefox</code>.</p></li><li class="listitem"><p>The default <code class="literal">scribus</code> version is now 1.5, while version 1.4 is still available as <code class="literal">scribus_1_4</code> (<a class="link" href="https://github.com/NixOS/nixpkgs/pull/172700"  target="_top">#172700</a>).</p></li><li class="listitem"><p>The Nextcloud module now supports to create a Mysql database automatically
with <code class="literal">services.nextcloud.database.createLocally</code> enabled.</p></li><li class="listitem"><p>The Nextcloud module now allows setting the value of the <code class="literal">max-age</code> directive of the <code class="literal">Strict-Transport-Security</code> HTTP header, which is now controlled by the <code class="literal">services.nextcloud.https</code> option, rather than <code class="literal">services.nginx.recommendedHttpHeaders</code>.</p></li><li class="listitem"><p>The <code class="literal">spark3</code> package has been updated from 3.1.2 to 3.2.1 (<a class="link" href="https://github.com/NixOS/nixpkgs/pull/160075"  target="_top">#160075</a>):</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Testing has been enabled for <code class="literal">aarch64-linux</code> in addition to <code class="literal">x86_64-linux</code>.</p></li><li class="listitem"><p>The <code class="literal">spark3</code> package is now usable on <code class="literal">aarch64-darwin</code> as a result of <a class="link" href="https://github.com/NixOS/nixpkgs/pull/158613"  target="_top">#158613</a> and <a class="link" href="https://github.com/NixOS/nixpkgs/pull/158992"  target="_top">#158992</a>.</p></li></ul></div></li><li class="listitem"><p>The option <code class="literal">services.snapserver.openFirewall</code> will no longer default to
<code class="literal">true</code> starting with NixOS 22.11. Enable it explicitly if you need to control
Snapserver remotely or connect streamig clients from other hosts.</p></li><li class="listitem"><p>The option <a class="link" href="options.html#opt-networking.useDHCP"  target="_top">networking.useDHCP</a> isn’t deprecated anymore.
When using <a class="link" href="options.html#opt-networking.useNetworkd"  target="_top"><code class="literal">systemd-networkd</code></a>, a generic
<code class="literal">.network</code>-unit is added which enables DHCP for each interface matching <code class="literal">en*</code>, <code class="literal">eth*</code>
or <code class="literal">wl*</code> with priority 99 (which means that it doesn’t have any effect if such an interface is matched
by a <code class="literal">.network-</code>unit with a lower priority). In case of scripted networking, no behavior
was changed.</p></li><li class="listitem"><p>The new <a class="link" href="https://nixos.org/manual/nixpkgs/stable/#sec-postgresqlTestHook"  target="_top"><code class="literal">postgresqlTestHook</code></a> runs a PostgreSQL server for the duration of package checks.</p></li><li class="listitem"><p><code class="literal">zfs</code> was updated from 2.1.4 to 2.1.5, enabling it to be used with Linux kernel 5.18.</p></li><li class="listitem"><p><code class="literal">stdenv.mkDerivation</code> now supports a self-referencing <code class="literal">finalAttrs:</code> parameter
containing the final <code class="literal">mkDerivation</code> arguments including overrides.
<code class="literal">drv.overrideAttrs</code> now supports two parameters <code class="literal">finalAttrs: previousAttrs:</code>.
This allows packaging configuration to be overridden in a consistent manner by
providing an alternative to <code class="literal">rec {}</code> syntax.</p><p>Additionally, <code class="literal">passthru</code> can now reference <code class="literal">finalAttrs.finalPackage</code> containing
the final package, including attributes such as the output paths and
<code class="literal">overrideAttrs</code>.</p><p>New language integrations can be simplified by overriding a “prototype”
package containing the language-specific logic. This removes the need for a
extra layer of overriding for the “generic builder” arguments, thus removing a
usability problem and source of error.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-21.11" class="title" style="clear: both">Release 21.11 (“Porcupine”, 2021/11/30)   </h2>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>Support is planned until the end of June 2022, handing over to 22.05.</p></li></ul></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-21.11-highlights" class="title" >Highlights   </h3>  </div> </div></div><p>In addition to numerous new and upgraded packages, this release has the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Nix has been updated to version 2.4, reference its <a class="link" href="https://discourse.nixos.org/t/nix-2-4-released/15822"  target="_top">release notes</a> for more information on what has changed. The previous version of Nix, 2.3.16, remains available for the time being in the <code class="literal">nix_2_3</code> package.</p></li><li class="listitem"><p><code class="literal">iptables</code> is now using <code class="literal">nf_tables</code> under the hood, by using <code class="literal">iptables-nft</code>,
similar to <a class="link" href="https://wiki.debian.org/nftables#Current_status"  target="_top">Debian</a> and
<a class="link" href="https://fedoraproject.org/wiki/Changes/iptables-nft-default"  target="_top">Fedora</a>.
This means, <code class="literal">ip[6]tables</code>, <code class="literal">arptables</code> and <code class="literal">ebtables</code> commands  will actually
show rules from some specific tables in the <code class="literal">nf_tables</code> kernel subsystem.
In case you’re migrating from an older release without rebooting, there might
be cases where you end up with iptable rules configured both in the legacy
<code class="literal">iptables</code> kernel backend, as well as in the <code class="literal">nf_tables</code> backend.
This can lead to confusing firewall behaviour. An <code class="literal">iptables-save</code> after
switching will complain about “iptables-legacy tables present”.
It’s probably best to reboot after the upgrade, or manually removing all
legacy iptables rules (via the <code class="literal">iptables-legacy</code> package).</p></li><li class="listitem"><p>systemd got an <code class="literal">nftables</code> backend, and configures (networkd) rules in their
own <code class="literal">io.systemd.*</code> tables. Check <code class="literal">nft list ruleset</code> to see these rules, not
<code class="literal">iptables-save</code> (which only shows <code class="literal">iptables</code>-created rules.</p></li><li class="listitem"><p>PHP now defaults to PHP 8.0, updated from 7.4.</p></li><li class="listitem"><p>kops now defaults to 1.21.1, which uses containerd as the default runtime.</p></li><li class="listitem"><p><code class="literal">python3</code> now defaults to Python 3.9, updated from Python 3.8.</p></li><li class="listitem"><p>PostgreSQL now defaults to major version 13.</p></li><li class="listitem"><p>spark now defaults to spark 3, updated from 2. A <a class="link" href="https://spark.apache.org/docs/latest/core-migration-guide.html#upgrading-from-core-24-to-30"  target="_top">migration guide</a> is available.</p></li><li class="listitem"><p>Improvements have been made to the Hadoop module and package:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>HDFS and YARN now support production-ready highly available deployments with automatic failover.</p></li><li class="listitem"><p>Hadoop now defaults to Hadoop 3, updated from 2.</p></li><li class="listitem"><p>JournalNode, ZKFS and HTTPFS services have been added.</p></li></ul></div></li><li class="listitem"><p>Activation scripts can now, optionally, be run during a <code class="literal">nixos-rebuild dry-activate</code> and can detect the dry activation by reading <code class="literal">$NIXOS_ACTION</code>.
This allows activation scripts to output what they would change if the activation was really run.
The users/modules activation script supports this and outputs some of is actions.</p></li><li class="listitem"><p>KDE Plasma now finally works on Wayland.</p></li><li class="listitem"><p>bash now defaults to major version 5.</p></li><li class="listitem"><p>Systemd was updated to version 249 (from 247).</p></li><li class="listitem"><p>Pantheon desktop has been updated to version 6. Due to changes of screen locker, if locking doesn’t work for you, please try <code class="literal">gsettings set org.gnome.desktop.lockdown disable-lock-screen false</code>.</p></li><li class="listitem"><p><code class="literal">kubernetes-helm</code> now defaults to 3.7.0, which introduced some breaking changes to the experimental OCI manifest format. See <a class="link" href="https://github.com/helm/community/blob/main/hips/hip-0006.md"  target="_top">HIP 6</a> for more details.
<code class="literal">helmfile</code> also defaults to 0.141.0, which is the minimum compatible version.</p></li><li class="listitem"><p>GNOME has been upgraded to 41. Please take a look at their <a class="link" href="https://help.gnome.org/misc/release-notes/41.0/"  target="_top">Release Notes</a> for details.</p></li><li class="listitem"><p>LXD support was greatly improved:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>building LXD images from configurations is now directly possible with just nixpkgs</p></li><li class="listitem"><p>hydra is now building nixOS LXD images that can be used standalone with full nixos-rebuild support</p></li></ul></div></li><li class="listitem"><p>OpenSSH was updated to version 8.8p1</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>This breaks connections to old SSH daemons as ssh-rsa host keys and ssh-rsa public keys that were signed with SHA-1 are disabled by default now</p></li><li class="listitem"><p>These can be re-enabled, see the <a class="link" href="https://www.openssh.com/txt/release-8.8"  target="_top">OpenSSH changelog</a> for details</p></li></ul></div></li><li class="listitem"><p>ORY Kratos was updated to version 0.8.0-alpha.3</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>This release requires you to run SQL migrations. Please, as always, create a backup of your database first!</p></li><li class="listitem"><p>The SDKs are now generated with tag v0alpha2 to reflect that some signatures have changed in a breaking fashion. Please update your imports from v0alpha1 to v0alpha2.</p></li><li class="listitem"><p>The SMTPS scheme used in courier config URL with cleartext/StartTLS/TLS SMTP connection types is now only supporting implicit TLS. For StartTLS and cleartext SMTP, please use the SMTP scheme instead.</p></li><li class="listitem"><p>for more details, see <a class="link" href="https://github.com/ory/kratos/releases/tag/v0.8.0-alpha.1"  target="_top">Release Notes</a>.</p></li></ul></div></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-21.11-new-services" class="title" >New Services   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://digint.ch/btrbk/index.html"  target="_top">btrbk</a>, a backup tool for btrfs subvolumes, taking advantage of btrfs specific capabilities to create atomic snapshots and transfer them incrementally to your backup locations. Available as <a class="link" href="options.html#opt-services.brtbk.instances"  target="_top">services.btrbk</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/xrelkd/clipcat/"  target="_top">clipcat</a>, an X11 clipboard manager written in Rust. Available at <a class="link" href="options.html#opt-services.clipcat.enable"  target="_top">services.clipcat</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/dexidp/dex"  target="_top">dex</a>, an OpenID Connect (OIDC) identity and OAuth 2.0 provider. Available at <a class="link" href="options.html#opt-services.dex.enable"  target="_top">services.dex</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/maxmind/geoipupdate"  target="_top">geoipupdate</a>, a GeoIP database updater from MaxMind. Available as <a class="link" href="options.html#opt-services.geoipupdate.enable"  target="_top">services.geoipupdate</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/jitsi/jibri"  target="_top">Jibri</a>, a service for recording or streaming a Jitsi Meet conference. Available as <a class="link" href="options.html#opt-services.jibri.enable"  target="_top">services.jibri</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.isc.org/kea/"  target="_top">Kea</a>, ISCs 2nd generation DHCP and DDNS server suite. Available at <a class="link" href="options.html#opt-services.kea.dhcp4"  target="_top">services.kea</a>.</p></li><li class="listitem"><p><a class="link" href="https://owncast.online/"  target="_top">owncast</a>, self-hosted video live streaming solution. Available at <a class="link" href="options.html#opt-services.owncast.enable"  target="_top">services.owncast</a>.</p></li><li class="listitem"><p><a class="link" href="https://joinpeertube.org/"  target="_top">PeerTube</a>, developed by Framasoft, is the free and decentralized alternative to video platforms. Available at <a class="link" href="options.html#opt-services.peertube.enable"  target="_top">services.peertube</a>.</p></li><li class="listitem"><p><a class="link" href="https://sr.ht"  target="_top">sourcehut</a>, a collection of tools useful for software development. Available as <a class="link" href="options.html#opt-services.sourcehut.enable"  target="_top">services.sourcehut</a>.</p></li><li class="listitem"><p><a class="link" href="https://download.pureftpd.org/pub/ucarp/README"  target="_top">ucarp</a>, an userspace implementation of the Common Address Redundancy Protocol (CARP). Available as <a class="link" href="options.html#opt-networking.ucarp.enable"  target="_top">networking.ucarp</a>.</p></li><li class="listitem"><p>Users of flashrom should migrate to <a class="link" href="options.html#opt-programs.flashrom.enable"  target="_top">programs.flashrom.enable</a> and add themselves to the <code class="literal">flashrom</code> group to be able to access programmers supported by flashrom.</p></li><li class="listitem"><p><a class="link" href="https://vikunja.io"  target="_top">vikunja</a>, a to-do list app. Available as <a class="link" href="options.html#opt-services.vikunja.enable"  >services.vikunja</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/evilsocket/opensnitch"  target="_top">opensnitch</a>, an application firewall. Available as <a class="link" href="options.html#opt-services.opensnitch.enable"  >services.opensnitch</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.snapraid.it/"  target="_top">snapraid</a>, a backup program for disk arrays.
Available as <a class="link" href="options.html#opt-services.snapraid.enable"  >snapraid</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/hockeypuck/hockeypuck"  target="_top">Hockeypuck</a>, a OpenPGP Key Server. Available as <a class="link" href="options.html#opt-services.hockeypuck.enable"  >services.hockeypuck</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/buildkite/buildkite-agent-metrics"  target="_top">buildkite-agent-metrics</a>, a command-line tool for collecting Buildkite agent metrics, now has a Prometheus exporter available as <a class="link" href="options.html#opt-services.prometheus.exporters.buildkite-agent.enable"  >services.prometheus.exporters.buildkite-agent</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/prometheus/influxdb_exporter"  target="_top">influxdb-exporter</a> a Prometheus exporter that exports metrics received on an InfluxDB compatible endpoint is now available as <a class="link" href="options.html#opt-services.prometheus.exporters.influxdb.enable"  >services.prometheus.exporters.influxdb</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/matrix-discord/mx-puppet-discord"  target="_top">mx-puppet-discord</a>, a discord puppeting bridge for matrix. Available as <a class="link" href="options.html#opt-services.mx-puppet-discord.enable"  >services.mx-puppet-discord</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.meshcommander.com/meshcentral2/overview"  target="_top">MeshCentral</a>, a remote administration service (“TeamViewer but self-hosted and with more features”) is now available with a package and a module: <a class="link" href="options.html#opt-services.meshcentral.enable"  >services.meshcentral.enable</a></p></li><li class="listitem"><p><a class="link" href="https://github.com/Arksine/moonraker"  target="_top">moonraker</a>, an API web server for Klipper.
Available as <a class="link" href="options.html#opt-services.moonraker.enable"  >moonraker</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/influxdata/influxdb"  target="_top">influxdb2</a>, a Scalable datastore for metrics, events, and real-time analytics. Available as <a class="link" href="options.html#opt-services.influxdb2.enable"  >services.influxdb2</a>.</p></li><li class="listitem"><p><a class="link" href="https://posativ.org/isso/"  target="_top">isso</a>, a commenting server similar to Disqus.
Available as <a class="link" href="options.html#opt-services.isso.enable"  >isso</a></p></li><li class="listitem"><p><a class="link" href="https://www.navidrome.org/"  target="_top">navidrome</a>, a personal music streaming server with
subsonic-compatible api. Available as <a class="link" href="options.html#opt-services.navidrome.enable"  >navidrome</a>.</p></li><li class="listitem"><p><a class="link" href="https://docs.fluidd.xyz/"  target="_top">fluidd</a>, a Klipper web interface for managing 3d printers using moonraker. Available as <a class="link" href="options.html#opt-services.fluidd.enable"  >fluidd</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/earnestly/sx"  target="_top">sx</a>, a simple alternative to both xinit and startx for starting a Xorg server. Available as <a class="link" href="options.html#opt-services.xserver.displayManager.sx.enable"  >services.xserver.displayManager.sx</a></p></li><li class="listitem"><p><a class="link" href="https://postfixadmin.sourceforge.io/"  target="_top">postfixadmin</a>, a web based virtual user administration interface for Postfix mail servers. Available as <a class="link" href="options.html#opt-services.postfixadmin.enable"  >postfixadmin</a>.</p></li><li class="listitem"><p><a class="link" href="https://wiki.servarr.com/prowlarr"  target="_top">prowlarr</a>, an indexer manager/proxy built on the popular arr .net/reactjs base stack <a class="link" href="options.html#opt-services.prowlarr.enable"  >services.prowlarr</a>.</p></li><li class="listitem"><p><a class="link" href="https://sr.ht/~emersion/soju"  target="_top">soju</a>, a user-friendly IRC bouncer. Available as <a class="link" href="options.html#opt-services.soju.enable"  target="_top">services.soju</a>.</p></li><li class="listitem"><p><a class="link" href="https://nats.io/"  target="_top">nats</a>, a high performance cloud and edge messaging system. Available as <a class="link" href="options.html#opt-services.nats.enable"  >services.nats</a>.</p></li><li class="listitem"><p><a class="link" href="https://git-scm.com"  target="_top">git</a>, a distributed version control system. Available as <a class="link" href="options.html#opt-programs.git.enable"  target="_top">programs.git</a>.</p></li><li class="listitem"><p><a class="link" href="https://domainaware.github.io/parsedmarc/"  target="_top">parsedmarc</a>, a service
which parses incoming <a class="link" href="https://dmarc.org/"  target="_top">DMARC</a> reports and stores
or sends them to a downstream service for further analysis.
Documented in <a class="link" href="index.html#module-services-parsedmarc" title="parsedmarc" >its manual entry</a>.</p></li><li class="listitem"><p><a class="link" href="https://spark.apache.org/"  target="_top">spark</a>, a unified analytics engine for large-scale data processing.</p></li><li class="listitem"><p><a class="link" href="https://github.com/JoseExposito/touchegg"  target="_top">touchegg</a>, a multi-touch gesture recognizer. Available as <a class="link" href="options.html#opt-services.touchegg.enable"  >services.touchegg</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/pantheon-tweaks/pantheon-tweaks"  target="_top">pantheon-tweaks</a>, an unofficial system settings panel for Pantheon. Available as <code class="literal">programs.pantheon-tweaks</code>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/DanielOgorchock/joycond"  target="_top">joycond</a>, a service that uses <code class="literal">hid-nintendo</code> to provide nintendo joycond pairing and better nintendo switch pro controller support.</p></li><li class="listitem"><p><a class="link" href="https://github.com/opensvc/multipath-tools"  target="_top">multipath</a>, the device mapper multipath (DM-MP) daemon. Available as <a class="link" href="options.html#opt-services.multipath.enable"  >services.multipath</a>.</p></li><li class="listitem"><p><a class="link" href="https://www.seafile.com/en/home/"  target="_top">seafile</a>, an open source file syncing &amp; sharing software. Available as <a class="link" href="options.html#opt-services.seafile.enable"  target="_top">services.seafile</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/mchehab/rasdaemon"  target="_top">rasdaemon</a>, a hardware error logging daemon. Available as <a class="link" href="options.html#opt-hardware.rasdaemon.enable"  >hardware.rasdaemon</a>.</p></li><li class="listitem"><p><code class="literal">code-server</code>-module now available</p></li><li class="listitem"><p><a class="link" href="https://github.com/xmrig/xmrig"  target="_top">xmrig</a>, a high performance, open source, cross platform RandomX, KawPow, CryptoNight and AstroBWT unified CPU/GPU miner and RandomX benchmark.</p></li><li class="listitem"><p>Auto nice daemons <a class="link" href="https://github.com/Nefelim4ag/Ananicy"  target="_top">ananicy</a> and <a class="link" href="https://gitlab.com/ananicy-cpp/ananicy-cpp/"  target="_top">ananicy-cpp</a>. Available as <a class="link" href="options.html#opt-services.ananicy.enable"  >services.ananicy</a>.</p></li><li class="listitem"><p><a class="link" href="https://github.com/prometheus-community/smartctl_exporter"  target="_top">smartctl_exporter</a>, a Prometheus exporter for <a class="link" href="https://en.wikipedia.org/wiki/S.M.A.R.T."  target="_top">S.M.A.R.T.</a> data. Available as <a class="link" href="options.html#opt-services.prometheus.exporters.smartctl.enable"  target="_top">services.prometheus.exporters.smartctl</a>.</p></li><li class="listitem"><p><a class="link" href="https://docs.twingate.com/docs/linux"  target="_top">twingate</a>, a high performance, easy to use zero trust solution that enables access to private resources from any device with better security than a VPN.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-21.11-incompatibilities" class="title" >Backward Incompatibilities   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The NixOS VM test framework, <code class="literal">pkgs.nixosTest</code>/<code class="literal">make-test-python.nix</code> (<code class="literal">pkgs.testers.nixosTest</code> since 22.05), now requires detaching commands such as <code class="literal">succeed(&quot;foo &amp;&quot;)</code> and <code class="literal">succeed(&quot;foo | xclip -i&quot;)</code> to close stdout.
This can be done with a redirect such as <code class="literal">succeed(&quot;foo &gt;&amp;2 &amp;&quot;)</code>. This breaking change was necessitated by a race condition causing tests to fail or hang.
It applies to all methods that invoke commands on the nodes, including <code class="literal">execute</code>, <code class="literal">succeed</code>, <code class="literal">fail</code>, <code class="literal">wait_until_succeeds</code>, <code class="literal">wait_until_fails</code>.</p></li><li class="listitem"><p>The <code class="literal">services.wakeonlan</code> option was removed, and replaced with <code class="literal">networking.interfaces.&lt;name&gt;.wakeOnLan</code>.</p></li><li class="listitem"><p>The <code class="literal">security.wrappers</code> option now requires to always specify an owner, group and whether the setuid/setgid bit should be set.
This is motivated by the fact that before NixOS 21.11, specifying either setuid or setgid but not owner/group resulted in wrappers owned by nobody/nogroup, which is unsafe.</p></li><li class="listitem"><p>Since <code class="literal">iptables</code> now uses <code class="literal">nf_tables</code> backend and <code class="literal">ipset</code> doesn’t support it, some applications (ferm, shorewall, firehol) may have limited functionality.</p></li><li class="listitem"><p>The <code class="literal">paperless</code> module and package have been removed. All users should migrate to the
successor <code class="literal">paperless-ng</code> instead. The Paperless project <a class="link" href="https://github.com/the-paperless-project/paperless/commit/9b0063c9731f7c5f65b1852cb8caff97f5e40ba4"  target="_top">has been
archived</a>
and advises all users to use <code class="literal">paperless-ng</code> instead.</p><p>Users can use the <code class="literal">services.paperless-ng</code> module as a replacement while noting the following incompatibilities:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">services.paperless.ocrLanguages</code> has no replacement. Users should migrate to <a class="link" href="options.html#opt-services.paperless-ng.extraConfig"  target="_top"><code class="literal">services.paperless-ng.extraConfig</code></a> instead:</p></li></ul></div><pre><code class="programlisting nix">{
  services.paperless-ng.extraConfig = {
    # Provide languages as ISO 639-2 codes
    # separated by a plus (+) sign.
    # https://en.wikipedia.org/wiki/List_of_ISO_639-2_codes
    PAPERLESS_OCR_LANGUAGE = &quot;deu+eng+jpn&quot;; # German &amp; English &amp; Japanse
  };
}
</code></pre><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>If you previously specified <code class="literal">PAPERLESS_CONSUME_MAIL_*</code> settings in
<code class="literal">services.paperless.extraConfig</code> you should remove those options now. You
now <span class="emphasis"><em>must</em></span> define those settings in the admin interface of paperless-ng.</p></li><li class="listitem"><p>Option <code class="literal">services.paperless.manage</code> no longer exists.
Use the script at <code class="literal">${services.paperless-ng.dataDir}/paperless-ng-manage</code> instead.
Note that this script only exists after the <code class="literal">paperless-ng</code> service has been
started at least once.</p></li><li class="listitem"><p>After switching to the new system configuration you should run the Django
management command to reindex your documents and optionally create a user,
if you don’t have one already.</p><p>To do so, enter the data directory (the value of
<code class="literal">services.paperless-ng.dataDir</code>, <code class="literal">/var/lib/paperless</code> by default), switch
to the paperless user and execute the management command like below:</p><pre><code class="programlisting">$ cd /var/lib/paperless
$ su paperless -s /bin/sh
$ ./paperless-ng-manage document_index reindex
# if not already done create a user account, paperless-ng requires a login
$ ./paperless-ng-manage createsuperuser
Username (leave blank to use &#x27;paperless&#x27;): my-user-name
Email address: me@example.com
Password: **********
Password (again): **********
Superuser created successfully.
</code></pre></li></ul></div></li><li class="listitem"><p>The <code class="literal">staticjinja</code> package has been upgraded from 1.0.4 to 4.1.1</p></li><li class="listitem"><p>Firefox v91 does not support addons with invalid signature anymore. Firefox ESR needs to be used for nix addon support.</p></li><li class="listitem"><p>The <code class="literal">erigon</code> ethereum node has moved to a new database format in <code class="literal">2021-05-04</code>, and requires a full resync</p></li><li class="listitem"><p>The <code class="literal">erigon</code> ethereum node has moved its database location in <code class="literal">2021-08-03</code>, users upgrading must manually move their chaindata (see <a class="link" href="https://github.com/ledgerwatch/erigon/releases/tag/v2021.08.03"  target="_top">release notes</a>).</p></li><li class="listitem"><p><a class="link" href="options.html#opt-users.users._name_.group"  target="_top">users.users.&lt;name&gt;.group</a> no longer defaults to <code class="literal">nogroup</code>, which was insecure. Out-of-tree modules are likely to require adaptation: instead of</p><pre><code class="programlisting nix">{
  users.users.foo = {
    isSystemUser = true;
  };
}
</code></pre><p>also create a group for your user:</p><pre><code class="programlisting nix">{
  users.users.foo = {
    isSystemUser = true;
    group = &quot;foo&quot;;
  };
  users.groups.foo = {};
}
</code></pre></li><li class="listitem"><p><code class="literal">services.geoip-updater</code> was broken and has been replaced by <a class="link" href="options.html#opt-services.geoipupdate.enable"  target="_top">services.geoipupdate</a>.</p></li><li class="listitem"><p><code class="literal">ihatemoney</code> has been updated to version 5.1.1 (<a class="link" href="https://github.com/spiral-project/ihatemoney/blob/5.1.1/CHANGELOG.rst"  target="_top">release notes</a>). If you serve ihatemoney by HTTP rather than HTTPS, you must set <a class="link" href="options.html#opt-services.ihatemoney.secureCookie"  target="_top">services.ihatemoney.secureCookie</a> to <code class="literal">false</code>.</p></li><li class="listitem"><p>PHP 7.3 is no longer supported due to upstream not supporting this version for the entire lifecycle of the 21.11 release.</p></li><li class="listitem"><p>Those making use of <code class="literal">buildBazelPackage</code> will need to regenerate the fetch hashes (preferred), or set <code class="literal">fetchConfigured = false;</code>.</p></li><li class="listitem"><p><code class="literal">consul</code> was upgraded to a new major release with breaking changes, see <a class="link" href="https://github.com/hashicorp/consul/releases/tag/v1.10.0"  target="_top">upstream changelog</a>.</p></li><li class="listitem"><p>fsharp41 has been removed in preference to use the latest dotnet-sdk</p></li><li class="listitem"><p>The following F#-related packages have been removed for being unmaintaned. Please use <code class="literal">fetchNuGet</code> for specific packages.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>ExtCore</p></li><li class="listitem"><p>Fake</p></li><li class="listitem"><p>Fantomas</p></li><li class="listitem"><p>FsCheck</p></li><li class="listitem"><p>FsCheck262</p></li><li class="listitem"><p>FsCheckNunit</p></li><li class="listitem"><p>FSharpAutoComplete</p></li><li class="listitem"><p>FSharpCompilerCodeDom</p></li><li class="listitem"><p>FSharpCompilerService</p></li><li class="listitem"><p>FSharpCompilerTools</p></li><li class="listitem"><p>FSharpCore302</p></li><li class="listitem"><p>FSharpCore3125</p></li><li class="listitem"><p>FSharpCore4001</p></li><li class="listitem"><p>FSharpCore4117</p></li><li class="listitem"><p>FSharpData</p></li><li class="listitem"><p>FSharpData225</p></li><li class="listitem"><p>FSharpDataSQLProvider</p></li><li class="listitem"><p>FSharpFormatting</p></li><li class="listitem"><p>FsLexYacc</p></li><li class="listitem"><p>FsLexYacc706</p></li><li class="listitem"><p>FsLexYaccRuntime</p></li><li class="listitem"><p>FsPickler</p></li><li class="listitem"><p>FsUnit</p></li><li class="listitem"><p>Projekt</p></li><li class="listitem"><p>Suave</p></li><li class="listitem"><p>UnionArgParser</p></li><li class="listitem"><p>ExcelDnaRegistration</p></li><li class="listitem"><p>MathNetNumerics</p></li></ul></div></li><li class="listitem"><p><code class="literal">programs.x2goserver</code> is now <code class="literal">services.x2goserver</code></p></li><li class="listitem"><p>The following dotnet-related packages have been removed for being unmaintaned. Please use <code class="literal">fetchNuGet</code> for specific packages.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Autofac</p></li><li class="listitem"><p>SystemValueTuple</p></li><li class="listitem"><p>MicrosoftDiaSymReader</p></li><li class="listitem"><p>MicrosoftDiaSymReaderPortablePdb</p></li><li class="listitem"><p>SystemCollectionsImmutable</p></li><li class="listitem"><p>SystemCollectionsImmutable131</p></li><li class="listitem"><p>SystemReflectionMetadata</p></li><li class="listitem"><p>NUnit350</p></li><li class="listitem"><p>Deedle</p></li><li class="listitem"><p>ExcelDna</p></li><li class="listitem"><p>GitVersionTree</p></li><li class="listitem"><p>NDeskOptions</p></li></ul></div></li></ul></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The <code class="literal">antlr</code> package now defaults to the 4.x release instead of the
old 2.7.7 version.</p></li><li class="listitem"><p>The <code class="literal">pulseeffects</code> package updated to <a class="link" href="https://github.com/wwmm/easyeffects/releases/tag/v6.0.0"  target="_top">version 4.x</a> and renamed to <code class="literal">easyeffects</code>.</p></li><li class="listitem"><p>The <code class="literal">libwnck</code> package now defaults to the 3.x release instead of the
old 2.31.0 version.</p></li><li class="listitem"><p>The <code class="literal">bitwarden_rs</code> packages and modules were renamed to <code class="literal">vaultwarden</code>
<a class="link" href="https://github.com/dani-garcia/vaultwarden/discussions/1642"  target="_top">following upstream</a>. More specifically,</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">pkgs.bitwarden_rs</code>, <code class="literal">pkgs.bitwarden_rs-sqlite</code>, <code class="literal">pkgs.bitwarden_rs-mysql</code> and
<code class="literal">pkgs.bitwarden_rs-postgresql</code> were renamed to <code class="literal">pkgs.vaultwarden</code>, <code class="literal">pkgs.vaultwarden-sqlite</code>,
<code class="literal">pkgs.vaultwarden-mysql</code> and <code class="literal">pkgs.vaultwarden-postgresql</code>, respectively.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square;"><li class="listitem"><p>Old names are preserved as aliases for backwards compatibility, but may be removed in the future.</p></li><li class="listitem"><p>The <code class="literal">bitwarden_rs</code> executable was also renamed to <code class="literal">vaultwarden</code> in all packages.</p></li></ul></div></li><li class="listitem"><p><code class="literal">pkgs.bitwarden_rs-vault</code> was renamed to <code class="literal">pkgs.vaultwarden-vault</code>.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square;"><li class="listitem"><p><code class="literal">pkgs.bitwarden_rs-vault</code> is preserved as an alias for backwards compatibility, but may be removed in the future.</p></li><li class="listitem"><p>The static files were moved from <code class="literal">/usr/share/bitwarden_rs</code> to <code class="literal">/usr/share/vaultwarden</code>.</p></li></ul></div></li><li class="listitem"><p>The <code class="literal">services.bitwarden_rs</code> config module was renamed to <code class="literal">services.vaultwarden</code>.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square;"><li class="listitem"><p><code class="literal">services.bitwarden_rs</code> is preserved as an alias for backwards compatibility, but may be removed in the future.</p></li></ul></div></li><li class="listitem"><p><code class="literal">systemd.services.bitwarden_rs</code>, <code class="literal">systemd.services.backup-bitwarden_rs</code> and <code class="literal">systemd.timers.backup-bitwarden_rs</code>
were renamed to <code class="literal">systemd.services.vaultwarden</code>, <code class="literal">systemd.services.backup-vaultwarden</code> and
<code class="literal">systemd.timers.backup-vaultwarden</code>, respectively.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: square;"><li class="listitem"><p>Old names are preserved as aliases for backwards compatibility, but may be removed in the future.</p></li></ul></div></li><li class="listitem"><p><code class="literal">users.users.bitwarden_rs</code> and <code class="literal">users.groups.bitwarden_rs</code> were renamed to <code class="literal">users.users.vaultwarden</code> and
<code class="literal">users.groups.vaultwarden</code>, respectively.</p></li><li class="listitem"><p>The data directory remains located at <code class="literal">/var/lib/bitwarden_rs</code>, for backwards compatibility.</p></li></ul></div></li></ul></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">yggdrasil</code> was upgraded to a new major release with breaking changes, see <a class="link" href="https://github.com/yggdrasil-network/yggdrasil-go/releases/tag/v0.4.0"  target="_top">upstream changelog</a>.</p></li><li class="listitem"><p><code class="literal">icingaweb2</code> was upgraded to a new release which requires a manual database upgrade, see <a class="link" href="https://github.com/Icinga/icingaweb2/releases/tag/v2.9.0"  target="_top">upstream changelog</a>.</p></li><li class="listitem"><p>The <code class="literal">isabelle</code> package has been upgraded from 2020 to 2021</p></li><li class="listitem"><p>the <code class="literal">mingw-64</code> package has been upgraded from 6.0.0 to 9.0.0</p></li><li class="listitem"><p><code class="literal">tt-rss</code> was upgraded to the commit on 2021-06-21, which has breaking changes. If you use <code class="literal">services.tt-rss.extraConfig</code> you should migrate to the <code class="literal">putenv</code>-style configuration. See <a class="link" href="https://community.tt-rss.org/t/rip-config-php-hello-classes-config-php/4337"  target="_top">this Discourse post</a> in the tt-rss forums for more details.</p></li><li class="listitem"><p>The following Visual Studio Code extensions were renamed to keep the naming convention uniform.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">bbenoist.Nix</code> -&gt; <code class="literal">bbenoist.nix</code></p></li><li class="listitem"><p><code class="literal">CoenraadS.bracket-pair-colorizer</code> -&gt; <code class="literal">coenraads.bracket-pair-colorizer</code></p></li><li class="listitem"><p><code class="literal">golang.Go</code> -&gt; <code class="literal">golang.go</code></p></li></ul></div></li><li class="listitem"><p><code class="literal">services.uptimed</code> now uses <code class="literal">/var/lib/uptimed</code> as its stateDirectory instead of <code class="literal">/var/spool/uptimed</code>. Make sure to move all files to the new directory.</p></li><li class="listitem"><p>Deprecated package aliases in <code class="literal">emacs.pkgs.*</code> have been removed. These aliases were remnants of the old Emacs package infrastructure. We now use exact upstream names wherever possible.</p></li><li class="listitem"><p><code class="literal">programs.neovim.runtime</code> switched to a <code class="literal">linkFarm</code> internally, making it impossible to use wildcards in the <code class="literal">source</code> argument.</p></li><li class="listitem"><p>The <code class="literal">openrazer</code> and <code class="literal">openrazer-daemon</code> packages as well as the <code class="literal">hardware.openrazer</code> module now require users to be members of the <code class="literal">openrazer</code> group instead of <code class="literal">plugdev</code>. With this change, users no longer need be granted the entire set of <code class="literal">plugdev</code> group permissions, which can include permissions other than those required by <code class="literal">openrazer</code>. This is desirable from a security point of view. The setting <a class="link" href="options.html#opt-services.hardware.openrazer.users"  target="_top"><code class="literal">hardware.openrazer.users</code></a> can be used to add users to the <code class="literal">openrazer</code> group.</p></li><li class="listitem"><p>The fontconfig service’s dpi option has been removed.
Fontconfig should use Xft settings by default so there’s no need to override one value in multiple places.
The user can set DPI via ~/.Xresources properly, or at the system level per monitor, or as a last resort at the system level with <code class="literal">services.xserver.dpi</code>.</p></li><li class="listitem"><p>The <code class="literal">yambar</code> package has been split into <code class="literal">yambar</code> and <code class="literal">yambar-wayland</code>, corresponding to the xorg and wayland backend respectively. Please switch to <code class="literal">yambar-wayland</code> if you are on wayland.</p></li><li class="listitem"><p>The <code class="literal">services.minio</code> module gained an additional option <code class="literal">consoleAddress</code>, that
configures the address and port the web UI is listening, it defaults to <code class="literal">:9001</code>.
To be able to access the web UI this port needs to be opened in the firewall.</p></li><li class="listitem"><p>The <code class="literal">varnish</code> package was upgraded from 6.3.x to 7.x. <code class="literal">varnish60</code> for the last LTS release is also still available.</p></li><li class="listitem"><p>The <code class="literal">kubernetes</code> package was upgraded to 1.22. The <code class="literal">kubernetes.apiserver.kubeletHttps</code> option was removed and HTTPS is always used.</p></li><li class="listitem"><p>The attribute <code class="literal">linuxPackages_latest_hardened</code> was dropped because the hardened patches
lag behind the upstream kernel which made version bumps harder. If you want to use
a hardened kernel, please pin it explicitly with a versioned attribute such as
<code class="literal">linuxPackages_5_10_hardened</code>.</p></li><li class="listitem"><p>The <code class="literal">nomad</code> package now defaults to a 1.1.x release instead of 1.0.x</p></li><li class="listitem"><p>If <code class="literal">exfat</code> is included in <code class="literal">boot.supportedFilesystems</code> and when using kernel 5.7
or later, the <code class="literal">exfatprogs</code> user-space utilities are used instead of <code class="literal">exfat</code>.</p></li><li class="listitem"><p>The <code class="literal">todoman</code> package was upgraded from 3.9.0 to 4.0.0. This introduces breaking changes in the <a class="link" href="https://todoman.readthedocs.io/en/stable/configure.html#configuration-file"  target="_top">configuration file</a> format.</p></li><li class="listitem"><p>The <code class="literal">datadog-agent</code>, <code class="literal">datadog-integrations-core</code> and <code class="literal">datadog-process-agent</code> packages
were upgraded from 6.11.2 to 7.30.2, git-2018-09-18 to 7.30.1 and 6.11.1 to 7.30.2,
respectively. As a result <code class="literal">services.datadog-agent</code> has had breaking changes to the
configuration file. For details, see the <a class="link" href="https://github.com/DataDog/datadog-agent/blob/main/CHANGELOG.rst"  target="_top">upstream changelog</a>.</p></li><li class="listitem"><p><code class="literal">opencv2</code> no longer includes the non-free libraries by default, and consequently <code class="literal">pfstools</code> no longer includes OpenCV support by default.  Both packages now support an <code class="literal">enableUnfree</code> option to re-enable this functionality.</p></li><li class="listitem"><p><code class="literal">services.xserver.displayManager.defaultSession = &quot;plasma5&quot;</code> does not work anymore, instead use either <code class="literal">&quot;plasma&quot;</code> for the Plasma X11 session or <code class="literal">&quot;plasmawayland&quot;</code> for the Plasma Wayland session.</p></li><li class="listitem"><p><code class="literal">boot.kernelParams</code> now only accepts one command line parameter per string. This change is aimed to reduce common mistakes like “param = 12”, which would be parsed as 3 parameters.</p></li><li class="listitem"><p><code class="literal">nix.daemonNiceLevel</code> and <code class="literal">nix.daemonIONiceLevel</code> have been removed in favour of the new options <a class="link" href="options.html#opt-nix.daemonCPUSchedPolicy"  target="_top"><code class="literal">nix.daemonCPUSchedPolicy</code></a>, <a class="link" href="options.html#opt-nix.daemonIOSchedClass"  target="_top"><code class="literal">nix.daemonIOSchedClass</code></a> and <a class="link" href="options.html#opt-nix.daemonIOSchedPriority"  target="_top"><code class="literal">nix.daemonIOSchedPriority</code></a>. Please refer to the options documentation and the <code class="literal">sched(7)</code> and <code class="literal">ioprio_set(2)</code> man pages for guidance on how to use them.</p></li><li class="listitem"><p>The <code class="literal">coursier</code> package’s binary was renamed from <code class="literal">coursier</code> to <code class="literal">cs</code>. Completions which haven’t worked for a while should now work with the renamed binary. To keep using <code class="literal">coursier</code>, you can create a shell alias.</p></li><li class="listitem"><p>The <code class="literal">services.mosquitto</code> module has been rewritten to support multiple listeners and per-listener configuration.
Module configurations from previous releases will no longer work and must be updated.</p></li><li class="listitem"><p>The <code class="literal">fluidsynth_1</code> attribute has been removed, as this legacy version is no longer needed in nixpkgs. The actively maintained 2.x series is available as <code class="literal">fluidsynth</code> unchanged.</p></li><li class="listitem"><p>Nextcloud 20 (<code class="literal">pkgs.nextcloud20</code>) has been dropped because it was EOLed by upstream in 2021-10.</p></li><li class="listitem"><p>The <code class="literal">virtualisation.pathsInNixDB</code> option was renamed
<a class="link" href="options.html#opt-virtualisation.additionalPaths"  target="_top"><code class="literal">virtualisation.additionalPaths</code></a>.</p></li><li class="listitem"><p>The <code class="literal">services.ddclient.password</code> option was removed, and replaced with <code class="literal">services.ddclient.passwordFile</code>.</p></li><li class="listitem"><p>The default GNAT version has been changed: The <code class="literal">gnat</code> attribute now points to <code class="literal">gnat12</code>
instead of <code class="literal">gnat9</code>.</p></li><li class="listitem"><p><code class="literal">retroArchCores</code> has been removed. This means that using <code class="literal">nixpkgs.config.retroarch</code> to customize RetroArch cores is not supported anymore. Instead, use package overrides, for example: <code class="literal">retroarch.override { cores = with libretro; [ citra snes9x ]; };</code>. Also, <code class="literal">retroarchFull</code> derivation is available for those who want to have all RetroArch cores available.</p></li><li class="listitem"><p>The Linux kernel for security reasons now restricts access to BPF syscalls via <code class="literal">BPF_UNPRIV_DEFAULT_OFF=y</code>. Unprivileged access can be reenabled via the <code class="literal">kernel.unprivileged_bpf_disabled</code> sysctl knob.</p></li><li class="listitem"><p><code class="literal">/usr</code> will always be included in the initial ramdisk. See the <code class="literal">fileSystems.&lt;name&gt;.neededForBoot</code> option.
If any files exist under <code class="literal">/usr</code> (which is not typical for NixOS), they will be included in the initial ramdisk, increasing its size to a possibly problematic extent.</p></li><li class="listitem"><p><code class="literal">pkgs.haskell-language-server</code> will now by default be linked dynamically to improve TemplateHaskell compatibility. To mitigate the increased closure size it will now by default only support our current default ghc (at the moment 9.0.2). Add other ghc versions via e.g. <code class="literal">pkgs.haskell-language-server.override { supportedGhcVersions = [ &quot;90&quot; &quot;92&quot; ]; }</code>.</p></li><li class="listitem"><p><code class="literal">pkgs.redis</code> is now built using the system jemalloc. This disables the experimental active defragmentation feature of redis. Users who require this feature can switch back to redis’ vendored version of jemalloc by setting <code class="literal">services.redis.package = pkgs.redis.override { useSystemJemalloc = false; };</code>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-21.11-notable-changes" class="title" >Other Notable Changes   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The linux kernel package infrastructure was moved out of <code class="literal">all-packages.nix</code>, and restructured. Linux related functions and attributes now live under the <code class="literal">pkgs.linuxKernel</code> attribute set.
In particular the versioned <code class="literal">linuxPackages_*</code> package sets (such as <code class="literal">linuxPackages_5_4</code>) and kernels from <code class="literal">pkgs</code> were moved there and now live under <code class="literal">pkgs.linuxKernel.packages.*</code>. The unversioned ones (such as <code class="literal">linuxPackages_latest</code>) remain untouched.</p></li><li class="listitem"><p>In NixOS virtual machines (QEMU), the <code class="literal">virtualisation</code> module has been updated with new options:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><a class="link" href="options.html#opt-virtualisation.forwardPorts"  target="_top"><code class="literal">forwardPorts</code></a> to configure IPv4 port forwarding,</p></li><li class="listitem"><p><a class="link" href="options.html#opt-virtualisation.sharedDirectories"  target="_top"><code class="literal">sharedDirectories</code></a> to set up shared host directories,</p></li><li class="listitem"><p><a class="link" href="options.html#opt-virtualisation.resolution"  target="_top"><code class="literal">resolution</code></a> to set the screen resolution,</p></li><li class="listitem"><p><a class="link" href="options.html#opt-virtualisation.useNixStoreImage"  target="_top"><code class="literal">useNixStoreImage</code></a> to use a disk image for the Nix store instead of 9P.</p></li></ul></div><p>In addition, the default <a class="link" href="options.html#opt-virtualisation.msize"  target="_top"><code class="literal">msize</code></a> parameter in 9P filesystems (including /nix/store and all shared directories) has been increased to 16K for improved performance.</p></li><li class="listitem"><p>The setting <a class="link" href="options.html#opt-services.openssh.logLevel"  target="_top"><code class="literal">services.openssh.logLevel</code></a> <code class="literal">&quot;VERBOSE&quot;</code> <code class="literal">&quot;INFO&quot;</code>. This brings NixOS in line with upstream and other Linux distributions, and reduces log spam on servers due to bruteforcing botnets.</p><p>However, if <a class="link" href="options.html#opt-services.fail2ban.enable"  target="_top"><code class="literal">services.fail2ban.enable</code></a> is <code class="literal">true</code>, the <code class="literal">fail2ban</code> will override the verbosity to <code class="literal">&quot;VERBOSE&quot;</code>, so that <code class="literal">fail2ban</code> can observe the failed login attempts from the SSH logs.</p></li><li class="listitem"><p>The <a class="link" href="options.html#opt-services.xserver.extraLayouts"  target="_top"><code class="literal">services.xserver.extraLayouts</code></a> no longer cause additional rebuilds when a layout is added or modified.</p></li><li class="listitem"><p>Sway: The terminal emulator <code class="literal">rxvt-unicode</code> is no longer installed by default via <code class="literal">programs.sway.extraPackages</code>. The current default configuration uses <code class="literal">alacritty</code> (and soon <code class="literal">foot</code>) so this is only an issue when using a customized configuration and not installing <code class="literal">rxvt-unicode</code> explicitly.</p></li><li class="listitem"><p><code class="literal">python3</code> now defaults to Python 3.9. Python 3.9 introduces many deprecation warnings, please look at the <a class="link" href="https://docs.python.org/3/whatsnew/3.9.html"  target="_top">What’s New In Python 3.9 post</a> for more information.</p></li><li class="listitem"><p><code class="literal">qtile</code> hase been updated from ‘0.16.0’ to ‘0.18.0’, please check <a class="link" href="https://github.com/qtile/qtile/blob/master/CHANGELOG"  target="_top">qtile changelog</a> for changes.</p></li><li class="listitem"><p>The <code class="literal">claws-mail</code> package now references the new GTK+ 3 release branch, major version 4. To use the GTK+ 2 releases, one can install the <code class="literal">claws-mail-gtk2</code> package.</p></li><li class="listitem"><p>The wordpress module provides a new interface which allows to use different webservers with the new option <a class="link" href="options.html#opt-services.wordpress.webserver"  target="_top"><code class="literal">services.wordpress.webserver</code></a>.  Currently <code class="literal">httpd</code>, <code class="literal">caddy</code> and <code class="literal">nginx</code> are supported. The definitions of wordpress sites should now be set in <a class="link" href="options.html#opt-services.wordpress.sites"  target="_top"><code class="literal">services.wordpress.sites</code></a>.</p><p>Sites definitions that use the old interface are automatically migrated in the new option. This backward compatibility will be removed in 22.05.</p></li><li class="listitem"><p>The dokuwiki module provides a new interface which allows to use different webservers with the new option <a class="link" href="options.html#opt-services.dokuwiki.webserver"  target="_top"><code class="literal">services.dokuwiki.webserver</code></a>.  Currently <code class="literal">caddy</code> and <code class="literal">nginx</code> are supported. The definitions of dokuwiki sites should now be set in <a class="link" href="options.html#opt-services.dokuwiki.sites"  target="_top"><code class="literal">services.dokuwiki.sites</code></a>.</p><p>Sites definitions that use the old interface are automatically migrated in the new option. This backward compatibility will be removed in 22.05.</p></li><li class="listitem"><p>The order of NSS (host) modules has been brought in line with upstream
recommendations:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>The <code class="literal">myhostname</code> module is placed before the <code class="literal">resolve</code> (optional) and <code class="literal">dns</code>
entries, but after <code class="literal">file</code> (to allow overriding via <code class="literal">/etc/hosts</code> /
<code class="literal">networking.extraHosts</code>, and prevent ISPs with catchall-DNS resolvers from
hijacking <code class="literal">.localhost</code> domains)</p></li><li class="listitem"><p>The <code class="literal">mymachines</code> module, which provides hostname resolution for local
containers (registered with <code class="literal">systemd-machined</code>) is placed to the front, to
make sure its mappings are preferred over other resolvers.</p></li><li class="listitem"><p>If systemd-networkd is enabled, the <code class="literal">resolve</code> module is placed before
<code class="literal">files</code> and <code class="literal">myhostname</code>, as it provides the same logic internally, with
caching.</p></li><li class="listitem"><p>The <code class="literal">mdns(_minimal)</code> module has been updated to the new priorities.</p></li></ul></div><p>If you use your own NSS host modules, make sure to update your priorities
according to these rules:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>NSS modules which should be queried before <code class="literal">resolved</code> DNS resolution should
use mkBefore.</p></li><li class="listitem"><p>NSS modules which should be queried after <code class="literal">resolved</code>, <code class="literal">files</code> and
<code class="literal">myhostname</code>, but before <code class="literal">dns</code> should use the default priority</p></li><li class="listitem"><p>NSS modules which should come after <code class="literal">dns</code> should use mkAfter.</p></li></ul></div></li><li class="listitem"><p>The <a class="link" href="options.html#opt-networking.wireless.enable"  target="_top">networking.wireless</a> module (based on wpa_supplicant) has been heavily reworked, solving a number of issues and adding useful features:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>The automatic discovery of wireless interfaces at boot has been made reliable again (issues <a class="link" href="https://github.com/NixOS/nixpkgs/issues/101963"  target="_top">#101963</a>, <a class="link" href="https://github.com/NixOS/nixpkgs/issues/23196"  target="_top">#23196</a>).</p></li><li class="listitem"><p>WPA3 and Fast BSS Transition (802.11r) are now enabled by default for all networks.</p></li><li class="listitem"><p>Secrets like pre-shared keys and passwords can now be handled safely, meaning without including them in a world-readable file (<code class="literal">wpa_supplicant.conf</code> under /nix/store).
This is achieved by storing the secrets in a secured <a class="link" href="options.html#opt-networking.wireless.environmentFile"  target="_top">environmentFile</a> and referring to them though environment variables that are expanded inside the configuration.</p></li><li class="listitem"><p>With multiple interfaces declared, independent wpa_supplicant daemons are started, one for each interface (the services are named <code class="literal">wpa_supplicant-wlan0</code>, <code class="literal">wpa_supplicant-wlan1</code>, etc.).</p></li><li class="listitem"><p>The generated <code class="literal">wpa_supplicant.conf</code> file is now formatted for easier reading.</p></li><li class="listitem"><p>A new <a class="link" href="options.html#opt-networking.wireless.scanOnLowSignal"  target="_top">scanOnLowSignal</a> option has been added to facilitate fast roaming between access points (enabled by default).</p></li><li class="listitem"><p>A new <a class="link" href="options.html#opt-networking.wireless.networks._name_.authProtocols"  target="_top">networks.&lt;name&gt;.authProtocols</a> option has been added to change the authentication protocols used when connecting to a network.</p></li></ul></div></li><li class="listitem"><p>The <a class="link" href="options.html#opt-networking.wireless.iwd.enable"  target="_top">networking.wireless.iwd</a> module has a new <a class="link" href="options.html#opt-networking.wireless.iwd.settings"  target="_top">networking.wireless.iwd.settings</a> option.</p></li><li class="listitem"><p>The <a class="link" href="options.html#opt-services.smokeping.host"  target="_top">services.smokeping.host</a> option was added and defaulted to <code class="literal">localhost</code>. Before, <code class="literal">smokeping</code> listened to all interfaces by default. NixOS defaults generally aim to provide non-Internet-exposed defaults for databases and internal monitoring tools, see e.g. <a class="link" href="https://github.com/NixOS/nixpkgs/issues/100192"  target="_top">#100192</a>. Further, the systemd service for <code class="literal">smokeping</code> got reworked defaults for increased operational stability, see <a class="link" href="https://github.com/NixOS/nixpkgs/pull/144127"  target="_top">PR #144127</a> for details.</p></li><li class="listitem"><p>The <a class="link" href="options.html#opt-services.syncoid.enable"  target="_top">services.syncoid.enable</a> module now properly drops ZFS permissions after usage. Before it delegated permissions to whole pools instead of datasets and didn’t clean up after execution. You can manually look this up for your pools by running <code class="literal">zfs allow your-pool-name</code> and use <code class="literal">zfs unallow syncoid your-pool-name</code> to clean this up.</p></li><li class="listitem"><p>Zfs: <code class="literal">latestCompatibleLinuxPackages</code> is now exported on the zfs package. One can use <code class="literal">boot.kernelPackages = config.boot.zfs.package.latestCompatibleLinuxPackages;</code> to always track the latest compatible kernel with a given version of zfs.</p></li><li class="listitem"><p>Nginx will use the value of <code class="literal">sslTrustedCertificate</code> if provided for a virtual host, even if <code class="literal">enableACME</code> is set. This is useful for providers not using the same certificate to sign OCSP responses and server certificates.</p></li><li class="listitem"><p><code class="literal">lib.formats.yaml</code>’s <code class="literal">generate</code> will not generate JSON anymore, but instead use more of the YAML-specific syntax.</p></li><li class="listitem"><p>MariaDB was upgraded from 10.5.x to 10.6.x. Please read the <a class="link" href="https://mariadb.com/kb/en/changes-improvements-in-mariadb-106/"  target="_top">upstream release notes</a> for changes and upgrade instructions.</p></li><li class="listitem"><p>The MariaDB C client library, also known as libmysqlclient or mariadb-connector-c, was upgraded from 3.1.x to 3.2.x. While this should hopefully not have any impact, this upgrade comes with some changes to default behavior, so you might want to review the <a class="link" href="https://mariadb.com/kb/en/changes-and-improvements-in-mariadb-connector-c-32/"  target="_top">upstream release notes</a>.</p></li><li class="listitem"><p>GNOME desktop environment now enables <code class="literal">QGnomePlatform</code> as the Qt platform theme, which should avoid crashes when opening file chooser dialogs in Qt apps by using XDG desktop portal. Additionally, it will make the apps fit better visually.</p></li><li class="listitem"><p><code class="literal">rofi</code> has been updated from ‘1.6.1’ to ‘1.7.0’, one important thing is the removal of the old xresources based configuration setup. Read more <a class="link" href="https://github.com/davatorium/rofi/blob/cb12e6fc058f4a0f4f/Changelog#L1"  target="_top">in rofi’s changelog</a>.</p></li><li class="listitem"><p>ipfs now defaults to not listening on you local network. This setting was change as server providers won’t accept port scanning on their private network. If you have several ipfs instances running on a network you own, feel free to change the setting <code class="literal">ipfs.localDiscovery = true;</code>. localDiscovery enables different instances to discover each other and share data.</p></li><li class="listitem"><p><code class="literal">lua</code> and <code class="literal">luajit</code> interpreters have been patched to avoid looking into /usr/lib
directories, thus increasing the purity of the build.</p></li><li class="listitem"><p>Three new options, <a class="link" href="options.html#opt-xdg.mime.addedAssociations"  >xdg.mime.addedAssociations</a>, <a class="link" href="options.html#opt-xdg.mime.defaultApplications"  >xdg.mime.defaultApplications</a>, and <a class="link" href="options.html#opt-xdg.mime.removedAssociations"  >xdg.mime.removedAssociations</a> have been added to the <a class="link" href="options.html#opt-xdg.mime.enable"  >xdg.mime</a> module to allow the configuration of <code class="literal">/etc/xdg/mimeapps.list</code>.</p></li><li class="listitem"><p>Kopia was upgraded from 0.8.x to 0.9.x. Please read the <a class="link" href="https://github.com/kopia/kopia/releases/tag/v0.9.0"  target="_top">upstream release notes</a> for changes and upgrade instructions.</p></li><li class="listitem"><p>The <code class="literal">systemd.network</code> module has gained support for the FooOverUDP link type.</p></li><li class="listitem"><p>The <code class="literal">networking</code> module has a new <code class="literal">networking.fooOverUDP</code> option to configure Foo-over-UDP encapsulations.</p></li><li class="listitem"><p><code class="literal">networking.sits</code> now supports Foo-over-UDP encapsulation.</p></li><li class="listitem"><p>The <code class="literal">virtualisation.libvirtd</code> module has been refactored and updated with new options:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">virtualisation.libvirtd.qemu*</code> options (e.g.: <code class="literal">virtualisation.libvirtd.qemuRunAsRoot</code>) were moved to <a class="link" href="options.html#opt-virtualisation.libvirtd.qemu"  target="_top"><code class="literal">virtualisation.libvirtd.qemu</code></a> submodule,</p></li><li class="listitem"><p>software TPM1/TPM2 support (e.g.: Windows 11 guests) (<a class="link" href="options.html#opt-virtualisation.libvirtd.qemu.swtpm"  target="_top"><code class="literal">virtualisation.libvirtd.qemu.swtpm</code></a>),</p></li><li class="listitem"><p>custom OVMF package (e.g.: <code class="literal">pkgs.OVMFFull</code> with HTTP, CSM and Secure Boot support) (<a class="link" href="options.html#opt-virtualisation.libvirtd.qemu.ovmf.package"  target="_top"><code class="literal">virtualisation.libvirtd.qemu.ovmf.package</code></a>).</p></li></ul></div></li><li class="listitem"><p>The <code class="literal">cawbird</code> Twitter client now uses its own API keys to count as different application than upstream builds. This is done to evade application-level rate limiting. While existing accounts continue to work, users may want to remove and re-register their account in the client to enjoy a better user experience and benefit from this change.</p></li><li class="listitem"><p>A new option <code class="literal">services.prometheus.enableReload</code> has been added which can be enabled to reload the prometheus service when its config file changes instead of restarting.</p></li><li class="listitem"><p>The option <code class="literal">services.prometheus.environmentFile</code> has been removed since it was causing <a class="link" href="https://github.com/NixOS/nixpkgs/issues/126083"  target="_top">issues</a> and Prometheus now has native support for secret files, i.e. <code class="literal">basic_auth.password_file</code> and <code class="literal">authorization.credentials_file</code>.</p></li><li class="listitem"><p>Dokuwiki now supports caddy! However</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>the nginx option has been removed, in the new configuration, please use the <code class="literal">dokuwiki.webserver = &quot;nginx&quot;</code> instead.</p></li><li class="listitem"><p>The “${hostname}” option has been deprecated, please use <code class="literal">dokuwiki.sites = [ &quot;${hostname}&quot; ]</code> instead</p></li></ul></div></li><li class="listitem"><p>The <a class="link" href="options.html#opt-services.unifi.enable"  target="_top">services.unifi</a> module has been reworked, solving a number of issues. This leads to several user facing changes:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>The <code class="literal">services.unifi.dataDir</code> option is removed and the data is now always located under <code class="literal">/var/lib/unifi/data</code>. This is done to make better use of systemd state direcotiry and thus making the service restart more reliable.</p></li><li class="listitem"><p>The unifi logs can now be found under: <code class="literal">/var/log/unifi</code> instead of <code class="literal">/var/lib/unifi/logs</code>.</p></li><li class="listitem"><p>The unifi run directory can now be found under: <code class="literal">/run/unifi</code> instead of <code class="literal">/var/lib/unifi/run</code>.</p></li></ul></div></li><li class="listitem"><p><code class="literal">security.pam.services.&lt;name&gt;.makeHomeDir</code> now uses <code class="literal">umask=0077</code> instead of <code class="literal">umask=0022</code> when creating the home directory.</p></li><li class="listitem"><p>Loki has had another release. Some default values have been changed for the configuration and some configuration options have been renamed. For more details, please check <a class="link" href="https://grafana.com/docs/loki/latest/upgrading/#240"  target="_top">the upgrade guide</a>.</p></li><li class="listitem"><p><code class="literal">julia</code> now refers to <code class="literal">julia-stable</code> instead of <code class="literal">julia-lts</code>. In practice this means it has been upgraded from <code class="literal">1.0.4</code> to <code class="literal">1.5.4</code>.</p></li><li class="listitem"><p>RetroArch has been upgraded from version <code class="literal">1.8.5</code> to <code class="literal">1.9.13.2</code>. Since the previous release was quite old, if you’re having issues after the upgrade, please delete your <code class="literal">$XDG_CONFIG_HOME/retroarch/retroarch.cfg</code> file.</p></li><li class="listitem"><p>hydrus has been upgraded from version <code class="literal">438</code> to <code class="literal">463</code>. Since upgrading between releases this old is advised against, be sure to have a backup of your data before upgrading. For details, see <a class="link" href="https://hydrusnetwork.github.io/hydrus/help/getting_started_installing.html#big_updates"  target="_top">the hydrus manual</a>.</p></li><li class="listitem"><p>More jdk and jre versions are now exposed via <code class="literal">java-packages.compiler</code>.</p></li><li class="listitem"><p>The sets <code class="literal">haskell.packages</code> and <code class="literal">haskell.compiler</code> now contain for every ghc version an attribute with the minor version dropped. E.g. for <code class="literal">ghc8107</code> there also now exists <code class="literal">ghc810</code>. Those attributes point to the same compilers and packagesets but have the advantage that e.g. <code class="literal">ghc92</code> stays stable when we update from <code class="literal">ghc925</code> to <code class="literal">ghc926</code>.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-21.05" class="title" style="clear: both">Release 21.05 (“Okapi”, 2021.05/31)   </h2>  </div> </div></div><p>Support is planned until the end of December 2021, handing over to 21.11.</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-21.05-highlights" class="title" >Highlights   </h3>  </div> </div></div><p>In addition to numerous new and upgraded packages, this release has the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Core version changes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>gcc: 9.3.0 -&gt; 10.3.0</p></li><li class="listitem"><p>glibc: 2.30 -&gt; 2.32</p></li><li class="listitem"><p>default linux: 5.4 -&gt; 5.10, all supported kernels available</p></li><li class="listitem"><p>mesa: 20.1.7 -&gt; 21.0.1</p></li></ul></div></li><li class="listitem"><p>Desktop Environments:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>GNOME: 3.36 -&gt; 40, see its <a class="link" href="https://help.gnome.org/misc/release-notes/40.0/"  target="_top">release notes</a></p></li><li class="listitem"><p>Plasma5: 5.18.5 -&gt; 5.21.3</p></li><li class="listitem"><p>kdeApplications: 20.08.1 -&gt; 20.12.3</p></li><li class="listitem"><p>cinnamon: 4.6 -&gt; 4.8.1</p></li></ul></div></li><li class="listitem"><p>Programming Languages and Frameworks:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p>Python optimizations were disabled again. Builds with optimizations enabled are not reproducible. Optimizations can now be enabled with an option.</p></li></ul></div></li><li class="listitem"><p>The linux_latest kernel was updated to the 5.13 series. It currently is not officially supported for use with the zfs filesystem. If you use zfs, you should use a different kernel version (either the LTS kernel, or track a specific one).</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-21.05-new-services" class="title" >New Services   </h3>  </div> </div></div><p>The following new services were added since the last release:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><a class="link" href="https://www.gnuradio.org/"  target="_top">GNURadio</a> 3.8 and 3.9 were <a class="link" href="https://github.com/NixOS/nixpkgs/issues/82263"  target="_top">finally</a> packaged, along with a rewrite to the Nix expressions, allowing users to override the features upstream supports selecting to compile or not to. Additionally, the attribute <code class="literal">gnuradio</code> (3.9), <code class="literal">gnuradio3_8</code> and <code class="literal">gnuradio3_7</code> now point to an externally wrapped by default derivations, that allow you to also add `extraPythonPackages` to the Python interpreter used by GNURadio. Missing environmental variables needed for operational GUI were also added (<a class="link" href="https://github.com/NixOS/nixpkgs/issues/75478"  target="_top">#75478</a>).</p></li><li class="listitem"><p><a class="link" href="https://www.keycloak.org/"  target="_top">Keycloak</a>, an open source identity and access management server with support for <a class="link" href="https://openid.net/connect/"  target="_top">OpenID Connect</a>, <a class="link" href="https://oauth.net/2/"  target="_top">OAUTH 2.0</a> and <a class="link" href="https://en.wikipedia.org/wiki/SAML_2.0"  target="_top">SAML 2.0</a>.</p><p>See the <a class="link" href="index.html#module-services-keycloak" title="Keycloak" >Keycloak section of the NixOS manual</a> for more information.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.samba-wsdd.enable"  target="_top">services.samba-wsdd.enable</a> Web Services Dynamic Discovery host daemon</p></li><li class="listitem"><p><a class="link" href="https://www.discourse.org/"  target="_top">Discourse</a>, a modern and open source discussion platform.</p><p>See the <a class="link" href="index.html#module-services-discourse" title="Discourse" >Discourse section of the NixOS manual</a> for more information.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.nebula.networks"  target="_top">services.nebula.networks</a> <a class="link" href="https://github.com/slackhq/nebula"  target="_top">Nebula VPN</a></p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-21.05-incompatibilities" class="title" >Backward Incompatibilities   </h3>  </div> </div></div><p>When upgrading from a previous release, please be aware of the following incompatible changes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>GNOME desktop environment was upgraded to 40, see the release notes for <a class="link" href="https://help.gnome.org/misc/release-notes/40.0/"  target="_top">40.0</a> and <a class="link" href="https://help.gnome.org/misc/release-notes/3.38/"  target="_top">3.38</a>. The <code class="literal">gnome3</code> attribute set has been renamed to <code class="literal">gnome</code> and so have been the NixOS options.</p></li><li class="listitem"><p>If you are using <code class="literal">services.udev.extraRules</code> to assign custom names to network interfaces, this may stop working due to a change in the initialisation of dhcpcd and systemd networkd. To avoid this, either move them to <code class="literal">services.udev.initrdRules</code> or see the new <a class="link" href="index.html#sec-custom-ifnames" title="Assigning custom names" >Assigning custom names</a> section of the NixOS manual for an example using networkd links.</p></li><li class="listitem"><p>The <code class="literal">security.hideProcessInformation</code> module has been removed. It was broken since the switch to cgroups-v2.</p></li><li class="listitem"><p>The <code class="literal">linuxPackages.ati_drivers_x11</code> kernel modules have been removed. The drivers only supported kernels prior to 4.2, and thus have become obsolete.</p></li><li class="listitem"><p>The <code class="literal">systemConfig</code> kernel parameter is no longer added to boot loader entries. It has been unused since September 2010, but if do have a system generation from that era, you will now be unable to boot into them.</p></li><li class="listitem"><p><code class="literal">systemd-journal2gelf</code> no longer parses json and expects the receiving system to handle it. How to achieve this with Graylog is described in this <a class="link" href="https://github.com/parse-nl/SystemdJournal2Gelf/issues/10"  target="_top">GitHub issue</a>.</p></li><li class="listitem"><p>If the <code class="literal">services.dbus</code> module is enabled, then the user D-Bus session is now always socket activated. The associated options <code class="literal">services.dbus.socketActivated</code> and <code class="literal">services.xserver.startDbusSession</code> have therefore been removed and you will receive a warning if they are present in your configuration. This change makes the user D-Bus session available also for non-graphical logins.</p></li><li class="listitem"><p>The <code class="literal">networking.wireless.iwd</code> module now installs the upstream-provided 80-iwd.link file, which sets the NamePolicy= for all wlan devices to “keep kernel”, to avoid race conditions between iwd and networkd. If you don’t want this, you can set <code class="literal">systemd.network.links.&quot;80-iwd&quot; = lib.mkForce {}</code>.</p></li><li class="listitem"><p><code class="literal">rubyMinimal</code> was removed due to being unused and unusable. The default ruby interpreter includes JIT support, which makes it reference it’s compiler. Since JIT support is probably needed by some Gems, it was decided to enable this feature with all cc references by default, and allow to build a Ruby derivation without references to cc, by setting <code class="literal">jitSupport = false;</code> in an overlay. See <a class="link" href="https://github.com/NixOS/nixpkgs/pull/90151"  target="_top">#90151</a> for more info.</p></li><li class="listitem"><p>Setting <code class="literal">services.openssh.authorizedKeysFiles</code> now also affects which keys <code class="literal">security.pam.enableSSHAgentAuth</code> will use. WARNING: If you are using these options in combination do make sure that any key paths you use are present in <code class="literal">services.openssh.authorizedKeysFiles</code>!</p></li><li class="listitem"><p>The option <code class="literal">fonts.enableFontDir</code> has been renamed to <a class="link" href="options.html#opt-fonts.fontDir.enable"  target="_top">fonts.fontDir.enable</a>. The path of font directory has also been changed to <code class="literal">/run/current-system/sw/share/X11/fonts</code>, for consistency with other X11 resources.</p></li><li class="listitem"><p>A number of options have been renamed in the kicad interface. <code class="literal">oceSupport</code> has been renamed to <code class="literal">withOCE</code>, <code class="literal">withOCCT</code> has been renamed to <code class="literal">withOCC</code>, <code class="literal">ngspiceSupport</code> has been renamed to <code class="literal">withNgspice</code>, and <code class="literal">scriptingSupport</code> has been renamed to <code class="literal">withScripting</code>. Additionally, <code class="literal">kicad/base.nix</code> no longer provides default argument values since these are provided by <code class="literal">kicad/default.nix</code>.</p></li><li class="listitem"><p>The socket for the <code class="literal">pdns-recursor</code> module was moved from <code class="literal">/var/lib/pdns-recursor</code> to <code class="literal">/run/pdns-recursor</code> to match upstream.</p></li><li class="listitem"><p>Paperwork was updated to version 2. The on-disk format slightly changed, and it is not possible to downgrade from Paperwork 2 back to Paperwork 1.3. Back your documents up before upgrading. See <a class="link" href="https://forum.openpaper.work/t/paperwork-2-0/112/5"  target="_top">this thread</a> for more details.</p></li><li class="listitem"><p>PowerDNS has been updated from <code class="literal">4.2.x</code> to <code class="literal">4.3.x</code>. Please be sure to review the <a class="link" href="https://doc.powerdns.com/authoritative/upgrading.html#x-to-4-3-0"  target="_top">Upgrade Notes</a> provided by upstream before upgrading. Worth specifically noting is that the service now runs entirely as a dedicated <code class="literal">pdns</code> user, instead of starting as <code class="literal">root</code> and dropping privileges, as well as the default <code class="literal">socket-dir</code> location changing from <code class="literal">/var/lib/powerdns</code> to <code class="literal">/run/pdns</code>.</p></li><li class="listitem"><p>The <code class="literal">mediatomb</code> service is now using by default the new and maintained fork <code class="literal">gerbera</code> package instead of the unmaintained <code class="literal">mediatomb</code> package. If you want to keep the old behavior, you must declare it with:</p><pre><code class="programlisting nix">{
  services.mediatomb.package = pkgs.mediatomb;
}
</code></pre><p>One new option <code class="literal">openFirewall</code> has been introduced which defaults to false. If you relied on the service declaration to add the firewall rules itself before, you should now declare it with:</p><pre><code class="programlisting nix">{
  services.mediatomb.openFirewall = true;
}
</code></pre></li><li class="listitem"><p>xfsprogs was update from 4.19 to 5.11. It now enables reflink support by default on filesystem creation. Support for reflinks was added with an experimental status to kernel 4.9 and deemed stable in kernel 4.16. If you want to be able to mount XFS filesystems created with this release of xfsprogs on kernel releases older than those, you need to format them with <code class="literal">mkfs.xfs -m reflink=0</code>.</p></li><li class="listitem"><p>The uWSGI server is now built with POSIX capabilities. As a consequence, root is no longer required in emperor mode and the service defaults to running as the unprivileged <code class="literal">uwsgi</code> user. Any additional capability can be added via the new option <a class="link" href="options.html#opt-services.uwsgi.capabilities"  target="_top">services.uwsgi.capabilities</a>. The previous behaviour can be restored by setting:</p><pre><code class="programlisting nix">{
  services.uwsgi.user = &quot;root&quot;;
  services.uwsgi.group = &quot;root&quot;;
  services.uwsgi.instance =
    {
      uid = &quot;uwsgi&quot;;
      gid = &quot;uwsgi&quot;;
    };
}
</code></pre><p>Another incompatibility from the previous release is that vassals running under a different user or group need to use <code class="literal">immediate-{uid,gid}</code> instead of the usual <code class="literal">uid,gid</code> options.</p></li><li class="listitem"><p>btc1 has been abandoned upstream, and removed.</p></li><li class="listitem"><p>cpp_ethereum (aleth) has been abandoned upstream, and removed.</p></li><li class="listitem"><p>riak-cs package removed along with <code class="literal">services.riak-cs</code> module.</p></li><li class="listitem"><p>stanchion package removed along with <code class="literal">services.stanchion</code> module.</p></li><li class="listitem"><p>mutt has been updated to a new major version (2.x), which comes with some backward incompatible changes that are described in the <a class="link" href="http://www.mutt.org/relnotes/2.0/"  target="_top">release notes for Mutt 2.0</a>.</p></li><li class="listitem"><p><code class="literal">vim</code> and <code class="literal">neovim</code> switched to Python 3, dropping all Python 2 support.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-networking.wireguard.interfaces"  target="_top">networking.wireguard.interfaces.&lt;name&gt;.generatePrivateKeyFile</a>, which is off by default, had a <code class="literal">chmod</code> race condition fixed. As an aside, the parent directory’s permissions were widened, and the key files were made owner-writable. This only affects newly created keys. However, if the exact permissions are important for your setup, read <a class="link" href="https://github.com/NixOS/nixpkgs/pull/121294"  target="_top">#121294</a>.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-boot.zfs.forceImportAll"  target="_top">boot.zfs.forceImportAll</a> previously did nothing, but has been fixed. However its default has been changed to <code class="literal">false</code> to preserve the existing default behaviour. If you have this explicitly set to <code class="literal">true</code>, please note that your non-root pools will now be forcibly imported.</p></li><li class="listitem"><p>openafs now points to openafs_1_8, which is the new stable release. OpenAFS 1.6 was removed.</p></li><li class="listitem"><p>The WireGuard module gained a new option <code class="literal">networking.wireguard.interfaces.&lt;name&gt;.peers.*.dynamicEndpointRefreshSeconds</code> that implements refreshing the IP of DNS-based endpoints periodically (which WireGuard itself <a class="link" href="https://lists.zx2c4.com/pipermail/wireguard/2017-November/002028.html"  target="_top">cannot do</a>).</p></li><li class="listitem"><p>MariaDB has been updated to 10.5. Before you upgrade, it would be best to take a backup of your database and read <a class="link" href="https://mariadb.com/kb/en/upgrading-from-mariadb-104-to-mariadb-105/#incompatible-changes-between-104-and-105"  target="_top"> Incompatible Changes Between 10.4 and 10.5</a>. After the upgrade you will need to run <code class="literal">mysql_upgrade</code>.</p></li><li class="listitem"><p>The TokuDB storage engine dropped in mariadb 10.5 and removed in mariadb 10.6. It is recommended to switch to RocksDB. See also <a class="link" href="https://mariadb.com/kb/en/tokudb/"  target="_top">TokuDB</a> and <a class="link" href="https://jira.mariadb.org/browse/MDEV-19780"  target="_top">MDEV-19780: Remove the TokuDB storage engine</a>.</p></li><li class="listitem"><p>The <code class="literal">openldap</code> module now has support for OLC-style configuration, users of the <code class="literal">configDir</code> option may wish to migrate. If you continue to use <code class="literal">configDir</code>, ensure that <code class="literal">olcPidFile</code> is set to <code class="literal">/run/slapd/slapd.pid</code>.</p><p>As a result, <code class="literal">extraConfig</code> and <code class="literal">extraDatabaseConfig</code> are removed. To help with migration, you can convert your <code class="literal">slapd.conf</code> file to OLC configuration with the following script (find the location of this configuration file by running <code class="literal">systemctl status openldap</code>, it is the <code class="literal">-f</code> option.</p><pre><code class="programlisting ShellSession">$ TMPDIR=$(mktemp -d)
$ slaptest -f /path/to/slapd.conf -F $TMPDIR
$ slapcat -F $TMPDIR -n0 -H &#x27;ldap:///???(!(objectClass=olcSchemaConfig))&#x27;
</code></pre><p>This will dump your current configuration in LDIF format, which should be straightforward to convert into Nix settings. This does not show your schema configuration, as this is unnecessarily verbose for users of the default schemas and <code class="literal">slaptest</code> is buggy with schemas directly in the config file.</p></li><li class="listitem"><p>Amazon EC2 and OpenStack Compute (nova) images now re-fetch instance meta data and user data from the instance metadata service (IMDS) on each boot. For example: stopping an EC2 instance, changing its user data, and restarting the instance will now cause it to fetch and apply the new user data.</p><div class="warning"><h3 class="title">Warning</h3><p>Specifically, <code class="literal">/etc/ec2-metadata</code> is re-populated on each boot. Some NixOS scripts that read from this directory are guarded to only run if the files they want to manipulate do not already exist, and so will not re-apply their changes if the IMDS response changes. Examples: <code class="literal">root</code>’s SSH key is only added if <code class="literal">/root/.ssh/authorized_keys</code> does not exist, and SSH host keys are only set from user data if they do not exist in <code class="literal">/etc/ssh</code>.</p></div></li><li class="listitem"><p>The <code class="literal">rspamd</code> services is now sandboxed. It is run as a dynamic user instead of root, so secrets and other files may have to be moved or their permissions may have to be fixed. The sockets are now located in <code class="literal">/run/rspamd</code> instead of <code class="literal">/run</code>.</p></li><li class="listitem"><p>Enabling the Tor client no longer silently also enables and configures Privoxy, and the <code class="literal">services.tor.client.privoxy.enable</code> option has been removed. To enable Privoxy, and to configure it to use Tor’s faster port, use the following configuration:</p><pre><code class="programlisting nix">{
  opt-services.privoxy.enable = true;
  opt-services.privoxy.enableTor = true;
}
</code></pre></li><li class="listitem"><p>The <code class="literal">services.tor</code> module has a new exhaustively typed <a class="link" href="options.html#opt-services.tor.settings"  target="_top">services.tor.settings</a> option following RFC 0042; backward compatibility with old options has been preserved when aliasing was possible. The corresponding systemd service has been hardened, but there is a chance that the service still requires more permissions, so please report any related trouble on the bugtracker. Onion services v3 are now supported in <a class="link" href="options.html#opt-services.tor.relay.onionServices"  target="_top">services.tor.relay.onionServices</a>. A new <a class="link" href="options.html#opt-services.tor.openFirewall"  target="_top">services.tor.openFirewall</a> option as been introduced for allowing connections on all the TCP ports configured.</p></li><li class="listitem"><p>The options <code class="literal">services.slurm.dbdserver.storagePass</code> and <code class="literal">services.slurm.dbdserver.configFile</code> have been removed. Use <code class="literal">services.slurm.dbdserver.storagePassFile</code> instead to provide the database password. Extra config options can be given via the option <code class="literal">services.slurm.dbdserver.extraConfig</code>. The actual configuration file is created on the fly on startup of the service. This avoids that the password gets exposed in the nix store.</p></li><li class="listitem"><p>The <code class="literal">wafHook</code> hook does not wrap Python anymore. Packages depending on <code class="literal">wafHook</code> need to include any Python into their <code class="literal">nativeBuildInputs</code>.</p></li><li class="listitem"><p>Starting with version 1.7.0, the project formerly named <code class="literal">CodiMD</code> is now named <code class="literal">HedgeDoc</code>. New installations will no longer use the old name for users, state directories and such, this needs to be considered when moving state to a more recent NixOS installation. Based on <a class="link" href="options.html#opt-system.stateVersion"  target="_top">system.stateVersion</a>, existing installations will continue to work.</p></li><li class="listitem"><p>The fish-foreign-env package has been replaced with fishPlugins.foreign-env, in which the fish functions have been relocated to the <code class="literal">vendor_functions.d</code> directory to be loaded automatically.</p></li><li class="listitem"><p>The prometheus json exporter is now managed by the prometheus community. Together with additional features some backwards incompatibilities were introduced. Most importantly the exporter no longer accepts a fixed command-line parameter to specify the URL of the endpoint serving JSON. It now expects this URL to be passed as an URL parameter, when scraping the exporter’s <code class="literal">/probe</code> endpoint. In the prometheus scrape configuration the scrape target might look like this:</p><pre><code class="programlisting">http://some.json-exporter.host:7979/probe?target=https://example.com/some/json/endpoint
</code></pre><p>Existing configuration for the exporter needs to be updated, but can partially be re-used. Documentation is available in the upstream repository and a small example for NixOS is available in the corresponding NixOS test.</p><p>These changes also affect <a class="link" href="options.html#opt-services.prometheus.exporters.rspamd.enable"  target="_top">services.prometheus.exporters.rspamd.enable</a>, which is just a preconfigured instance of the json exporter.</p><p>For more information, take a look at the <a class="link" href="https://github.com/prometheus-community/json_exporter"  target="_top"> official documentation</a> of the json_exporter.</p></li><li class="listitem"><p>Androidenv was updated, removing the <code class="literal">includeDocs</code> and <code class="literal">lldbVersions</code> arguments. Docs only covered a single version of the Android SDK, LLDB is now bundled with the NDK, and both are no longer available to download from the Android package repositories. Additionally, since the package lists have been updated, some older versions of Android packages may not be bundled. If you depend on older versions of Android packages, we recommend overriding the repo.</p><p>Android packages are now loaded from a repo.json file created by parsing Android repo XML files. The arguments <code class="literal">repoJson</code> and <code class="literal">repoXmls</code> have been added to allow overriding the built-in androidenv repo.json with your own. Additionally, license files are now written to allow compatibility with Gradle-based tools, and the <code class="literal">extraLicenses</code> argument has been added to accept more SDK licenses if your project requires it. See the androidenv documentation for more details.</p></li><li class="listitem"><p>The attribute <code class="literal">mpi</code> is now consistently used to provide a default, system-wide MPI implementation. The default implementation is openmpi, which has been used before by all derivations affects by this change. Note that all packages that have used <code class="literal">mpi ? null</code> in the input for optional MPI builds, have been changed to the boolean input parameter <code class="literal">useMpi</code> to enable building with MPI. Building all packages with <code class="literal">mpich</code> instead of the default <code class="literal">openmpi</code> can now be achieved like this:</p><pre><code class="programlisting nix">self: super:
{
  mpi = super.mpich;
}
</code></pre></li><li class="listitem"><p>The Searx module has been updated with the ability to configure the service declaratively and uWSGI integration. The option <code class="literal">services.searx.configFile</code> has been renamed to <a class="link" href="options.html#opt-services.searx.settingsFile"  target="_top">services.searx.settingsFile</a> for consistency with the new <a class="link" href="options.html#opt-services.searx.settings"  target="_top">services.searx.settings</a>. In addition, the <code class="literal">searx</code> uid and gid reservations have been removed since they were not necessary: the service is now running with a dynamically allocated uid.</p></li><li class="listitem"><p>The libinput module has been updated with the ability to configure mouse and touchpad settings separately. The options in <code class="literal">services.xserver.libinput</code> have been renamed to <code class="literal">services.xserver.libinput.touchpad</code>, while there is a new <code class="literal">services.xserver.libinput.mouse</code> for mouse related configuration.</p><p>Since touchpad options no longer apply to all devices, you may want to replicate your touchpad configuration in mouse section.</p></li><li class="listitem"><p>ALSA OSS emulation (<code class="literal">sound.enableOSSEmulation</code>) is now disabled by default.</p></li><li class="listitem"><p>Thinkfan as been updated to <code class="literal">1.2.x</code>, which comes with a new YAML based configuration format. For this reason, several NixOS options of the thinkfan module have been changed to non-backward compatible types. In addition, a new <a class="link" href="options.html#opt-services.thinkfan.settings"  target="_top">services.thinkfan.settings</a> option has been added.</p><p>Please read the <a class="link" href="https://github.com/vmatare/thinkfan#readme"  target="_top"> thinkfan documentation</a> before updating.</p></li><li class="listitem"><p>Adobe Flash Player support has been dropped from the tree. In particular, the following packages no longer support it:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>chromium</p></li><li class="listitem"><p>firefox</p></li><li class="listitem"><p>qt48</p></li><li class="listitem"><p>qt5.qtwebkit</p></li></ul></div><p>Additionally, packages flashplayer and hal-flash were removed along with the <code class="literal">services.flashpolicyd</code> module.</p></li><li class="listitem"><p>The <code class="literal">security.rngd</code> module has been removed. It was disabled by default in 20.09 as it was functionally redundant with krngd in the linux kernel. It is not necessary for any device that the kernel recognises as an hardware RNG, as it will automatically run the krngd task to periodically collect random data from the device and mix it into the kernel’s RNG.</p><p>The default SMTP port for GitLab has been changed to <code class="literal">25</code> from its previous default of <code class="literal">465</code>. If you depended on this default, you should now set the <a class="link" href="options.html#opt-services.gitlab.smtp.port"  target="_top">services.gitlab.smtp.port</a> option.</p></li><li class="listitem"><p>The default version of ImageMagick has been updated from 6 to 7. You can use imagemagick6, imagemagick6_light, and imagemagick6Big if you need the older version.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.xserver.videoDrivers"  target="_top">services.xserver.videoDrivers</a> no longer uses the deprecated <code class="literal">cirrus</code> and <code class="literal">vesa</code> device dependent X drivers by default. It also enables both <code class="literal">amdgpu</code> and <code class="literal">nouveau</code> drivers by default now.</p></li><li class="listitem"><p>The <code class="literal">kindlegen</code> package is gone, because it is no longer supported or hosted by Amazon. Sadly, its replacement, Kindle Previewer, has no Linux support. However, there are other ways to generate MOBI files. See <a class="link" href="https://github.com/NixOS/nixpkgs/issues/96439"  target="_top">the discussion</a> for more info.</p></li><li class="listitem"><p>The apacheKafka packages are now built with version-matched JREs. Versions 2.6 and above, the ones that recommend it, use jdk11, while versions below remain on jdk8. The NixOS service has been adjusted to start the service using the same version as the package, adjustable with the new <a class="link" href="options.html#opt-services.apache-kafka.jre"  target="_top">services.apache-kafka.jre</a> option. Furthermore, the default list of <a class="link" href="options.html#opt-services.apache-kafka.jvmOptions"  target="_top">services.apache-kafka.jvmOptions</a> have been removed. You should set your own according to the <a class="link" href="https://kafka.apache.org/documentation/#java"  target="_top">upstream documentation</a> for your Kafka version.</p></li><li class="listitem"><p>The kodi package has been modified to allow concise addon management. Consider the following configuration from previous releases of NixOS to install kodi, including the kodiPackages.inputstream-adaptive and kodiPackages.vfs-sftp addons:</p><pre><code class="programlisting nix">{
  environment.systemPackages = [
    pkgs.kodi
  ];

  nixpkgs.config.kodi = {
    enableInputStreamAdaptive = true;
    enableVFSSFTP = true;
  };
}
</code></pre><p>All Kodi <code class="literal">config</code> flags have been removed, and as a result the above configuration should now be written as:</p><pre><code class="programlisting nix">{
  environment.systemPackages = [
    (pkgs.kodi.withPackages (p: with p; [
      inputstream-adaptive
      vfs-sftp
    ]))
  ];
}
</code></pre></li><li class="listitem"><p><code class="literal">environment.defaultPackages</code> now includes the nano package. If pkgs.nano is not added to the list, make sure another editor is installed and the <code class="literal">EDITOR</code> environment variable is set to it. Environment variables can be set using <code class="literal">environment.variables</code>.</p></li><li class="listitem"><p><code class="literal">services.minio.dataDir</code> changed type to a list of paths, required for specifying multiple data directories for using with erasure coding. Currently, the service doesn’t enforce nor checks the correct number of paths to correspond to minio requirements.</p></li><li class="listitem"><p>All CUDA toolkit versions prior to CUDA 10 have been removed.</p></li><li class="listitem"><p>The kbdKeymaps package was removed since dvp and neo are now included in kbd. If you want to use the Programmer Dvorak Keyboard Layout, you have to use <code class="literal">dvorak-programmer</code> in <code class="literal">console.keyMap</code> now instead of <code class="literal">dvp</code>. In <code class="literal">services.xserver.xkbVariant</code> it’s still <code class="literal">dvp</code>.</p></li><li class="listitem"><p>The babeld service is now being run as an unprivileged user. To achieve that the module configures <code class="literal">skip-kernel-setup true</code> and takes care of setting forwarding and rp_filter sysctls by itself as well as for each interface in <code class="literal">services.babeld.interfaces</code>.</p></li><li class="listitem"><p>The <code class="literal">services.zigbee2mqtt.config</code> option has been renamed to <code class="literal">services.zigbee2mqtt.settings</code> and now follows <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md"  target="_top">RFC 0042</a>.</p></li></ul></div><p>The yadm dotfile manager has been updated from 2.x to 3.x, which has new (XDG) default locations for some data/state files. Most yadm commands will fail and print a legacy path warning (which describes how to upgrade/migrate your repository). If you have scripts, daemons, scheduled jobs, shell profiles, etc. that invoke yadm, expect them to fail or misbehave until you perform this migration and prepare accordingly.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Instead of determining <code class="literal">services.radicale.package</code> automatically based on <code class="literal">system.stateVersion</code>, the latest version is always used because old versions are not officially supported.</p><p>Furthermore, Radicale’s systemd unit was hardened which might break some deployments. In particular, a non-default <code class="literal">filesystem_folder</code> has to be added to <code class="literal">systemd.services.radicale.serviceConfig.ReadWritePaths</code> if the deprecated <code class="literal">services.radicale.config</code> is used.</p></li><li class="listitem"><p>In the <code class="literal">security.acme</code> module, use of <code class="literal">--reuse-key</code> parameter for Lego has been removed. It was introduced for HKPK, but this security feature is now deprecated. It is a better security practice to rotate key pairs instead of always keeping the same. If you need to keep this parameter, you can add it back using <code class="literal">extraLegoRenewFlags</code> as an option for the appropriate certificate.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-21.05-notable-changes" class="title" >Other Notable Changes   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">stdenv.lib</code> has been deprecated and will break eval in 21.11. Please use <code class="literal">pkgs.lib</code> instead. See <a class="link" href="https://github.com/NixOS/nixpkgs/issues/108938"  target="_top">#108938</a> for details.</p></li><li class="listitem"><p><a class="link" href="https://www.gnuradio.org/"  target="_top">GNURadio</a> has a <code class="literal">pkgs</code> attribute set, and there’s a <code class="literal">gnuradio.callPackage</code> function that extends <code class="literal">pkgs</code> with a <code class="literal">mkDerivation</code>, and a <code class="literal">mkDerivationWith</code>, like Qt5. Now all <code class="literal">gnuradio.pkgs</code> are defined with <code class="literal">gnuradio.callPackage</code> and some packages that depend on gnuradio are defined with this as well.</p></li><li class="listitem"><p><a class="link" href="https://www.privoxy.org/"  target="_top">Privoxy</a> has been updated to version 3.0.32 (See <a class="link" href="https://lists.privoxy.org/pipermail/privoxy-announce/2021-February/000007.html"  target="_top">announcement</a>). Compared to the previous release, Privoxy has gained support for HTTPS inspection (still experimental), Brotli decompression, several new filters and lots of bug fixes, including security ones. In addition, the package is now built with compression and external filters support, which were previously disabled.</p><p>Regarding the NixOS module, new options for HTTPS inspection have been added and <code class="literal">services.privoxy.extraConfig</code> has been replaced by the new <a class="link" href="options.html#opt-services.privoxy.settings"  target="_top">services.privoxy.settings</a> (See <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md"  target="_top">RFC 0042</a> for the motivation).</p></li><li class="listitem"><p><a class="link" href="https://kodi.tv/"  target="_top">Kodi</a> has been updated to version 19.1 “Matrix”. See the <a class="link" href="https://kodi.tv/article/kodi-19-0-matrix-release"  target="_top">announcement</a> for further details.</p></li><li class="listitem"><p>The <code class="literal">services.packagekit.backend</code> option has been removed as it only supported a single setting which would always be the default. Instead new <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md"  target="_top">RFC 0042</a> compliant <a class="link" href="options.html#opt-services.packagekit.settings"  target="_top">services.packagekit.settings</a> and <a class="link" href="options.html#opt-services.packagekit.vendorSettings"  target="_top">services.packagekit.vendorSettings</a> options have been introduced.</p></li><li class="listitem"><p><a class="link" href="https://nginx.org"  target="_top">Nginx</a> has been updated to stable version 1.20.0. Now nginx uses the zlib-ng library by default.</p></li><li class="listitem"><p>KDE Gear (formerly KDE Applications) is upgraded to 21.04, see its <a class="link" href="https://kde.org/announcements/gear/21.04/"  target="_top">release notes</a> for details.</p><p>The <code class="literal">kdeApplications</code> package set is now <code class="literal">kdeGear</code>, in keeping with the new name. The old name remains for compatibility, but it is deprecated.</p></li><li class="listitem"><p><a class="link" href="https://libreswan.org/"  target="_top">Libreswan</a> has been updated to version 4.4. The package now includes example configurations and manual pages by default. The NixOS module has been changed to use the upstream systemd units and write the configuration in the <code class="literal">/etc/ipsec.d/ </code> directory. In addition, two new options have been added to specify connection policies (<a class="link" href="options.html#opt-services.libreswan.policies"  target="_top">services.libreswan.policies</a>) and disable send/receive redirects (<a class="link" href="options.html#opt-services.libreswan.disableRedirects"  target="_top">services.libreswan.disableRedirects</a>).</p></li><li class="listitem"><p>The Mailman NixOS module (<code class="literal">services.mailman</code>) has a new option <a class="link" href="options.html#opt-services.mailman.enablePostfix"  target="_top">services.mailman.enablePostfix</a>, defaulting to true, that controls integration with Postfix.</p><p>If this option is disabled, default MTA config becomes not set and you should set the options in <code class="literal">services.mailman.settings.mta</code> according to the desired configuration as described in <a class="link" href="https://mailman.readthedocs.io/en/latest/src/mailman/docs/mta.html"  target="_top">Mailman documentation</a>.</p></li><li class="listitem"><p>The default-version of <code class="literal">nextcloud</code> is nextcloud21. Please note that it’s <span class="emphasis"><em>not</em></span> possible to upgrade <code class="literal">nextcloud</code> across multiple major versions! This means that it’s e.g. not possible to upgrade from nextcloud18 to nextcloud20 in a single deploy and most <code class="literal">20.09</code> users will have to upgrade to nextcloud20 first.</p><p>The package can be manually upgraded by setting <a class="link" href="options.html#opt-services.nextcloud.package"  target="_top">services.nextcloud.package</a> to nextcloud21.</p></li><li class="listitem"><p>The setting <a class="link" href="options.html#opt-services.redis.bind"  target="_top">services.redis.bind</a> defaults to <code class="literal">127.0.0.1</code> now, making Redis listen on the loopback interface only, and not all public network interfaces.</p></li><li class="listitem"><p>NixOS now emits a deprecation warning if systemd’s <code class="literal">StartLimitInterval</code> setting is used in a <code class="literal">serviceConfig</code> section instead of in a <code class="literal">unitConfig</code>; that setting is deprecated and now undocumented for the service section by systemd upstream, but still effective and somewhat buggy there, which can be confusing. See <a class="link" href="https://github.com/NixOS/nixpkgs/issues/45785"  target="_top">#45785</a> for details.</p><p>All services should use <a class="link" href="options.html#opt-systemd.services._name_.startLimitIntervalSec"  target="_top">systemd.services.<span class="emphasis"><em>name</em></span>.startLimitIntervalSec</a> or <code class="literal">StartLimitIntervalSec</code> in <a class="link" href="options.html#opt-systemd.services._name_.unitConfig"  target="_top">systemd.services.<span class="emphasis"><em>name</em></span>.unitConfig</a> instead.</p></li><li class="listitem"><p>The <code class="literal">mediatomb</code> service declares new options. It also adapts existing options so the configuration generation is now lazy. The existing option <code class="literal">customCfg</code> (defaults to false), when enabled, stops the service configuration generation completely. It then expects the users to provide their own correct configuration at the right location (whereas the configuration was generated and not used at all before). The new option <code class="literal">transcodingOption</code> (defaults to no) allows a generated configuration. It makes the mediatomb service pulls the necessary runtime dependencies in the nix store (whereas it was generated with hardcoded values before). The new option <code class="literal">mediaDirectories</code> allows the users to declare autoscan media directories from their nixos configuration:</p><pre><code class="programlisting nix">{
  services.mediatomb.mediaDirectories = [
    { path = &quot;/var/lib/mediatomb/pictures&quot;; recursive = false; hidden-files = false; }
    { path = &quot;/var/lib/mediatomb/audio&quot;; recursive = true; hidden-files = false; }
  ];
}
</code></pre></li><li class="listitem"><p>The Unbound DNS resolver service (<code class="literal">services.unbound</code>) has been refactored to allow reloading, control sockets and to fix startup ordering issues.</p><p>It is now possible to enable a local UNIX control socket for unbound by setting the <a class="link" href="options.html#opt-services.unbound.localControlSocketPath"  target="_top">services.unbound.localControlSocketPath</a> option.</p><p>Previously we just applied a very minimal set of restrictions and trusted unbound to properly drop root privs and capabilities.</p><p>As of this we are (for the most part) just using the upstream example unit file for unbound. The main difference is that we start unbound as <code class="literal">unbound</code> user with the required capabilities instead of letting unbound do the chroot &amp; uid/gid changes.</p><p>The upstream unit configuration this is based on is a lot stricter with all kinds of permissions then our previous variant. It also came with the default of having the <code class="literal">Type</code> set to <code class="literal">notify</code>, therefore we are now also using the <code class="literal">unbound-with-systemd</code> package here. Unbound will start up, read the configuration files and start listening on the configured ports before systemd will declare the unit <code class="literal">active (running)</code>. This will likely help with startup order and the occasional race condition during system activation where the DNS service is started but not yet ready to answer queries. Services depending on <code class="literal">nss-lookup.target</code> or <code class="literal">unbound.service</code> are now be able to use unbound when those targets have been reached.</p><p>Additionally to the much stricter runtime environment the <code class="literal">/dev/urandom</code> mount lines we previously had in the code (that randomly failed during the stop-phase) have been removed as systemd will take care of those for us.</p><p>The <code class="literal">preStart</code> script is now only required if we enabled the trust anchor updates (which are still enabled by default).</p><p>Another benefit of the refactoring is that we can now issue reloads via either <code class="literal">pkill -HUP unbound</code> and <code class="literal">systemctl reload unbound</code> to reload the running configuration without taking the daemon offline. A prerequisite of this was that unbound configuration is available on a well known path on the file system. We are using the path <code class="literal">/etc/unbound/unbound.conf</code> as that is the default in the CLI tooling which in turn enables us to use <code class="literal">unbound-control</code> without passing a custom configuration location.</p><p>The module has also been reworked to be <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0042-config-option.md"  target="_top">RFC 0042</a> compliant. As such, <code class="literal">services.unbound.extraConfig</code> has been removed and replaced by <a class="link" href="options.html#opt-services.unbound.settings"  target="_top">services.unbound.settings</a>. <code class="literal">services.unbound.interfaces</code> has been renamed to <code class="literal">services.unbound.settings.server.interface</code>.</p><p><code class="literal">services.unbound.forwardAddresses</code> and <code class="literal">services.unbound.allowedAccess</code> have also been changed to use the new settings interface. You can follow the instructions when executing <code class="literal">nixos-rebuild</code> to upgrade your configuration to use the new interface.</p></li><li class="listitem"><p>The <code class="literal">services.dnscrypt-proxy2</code> module now takes the upstream’s example configuration and updates it with the user’s settings. An option has been added to restore the old behaviour if you prefer to declare the configuration from scratch.</p></li><li class="listitem"><p>NixOS now defaults to the unified cgroup hierarchy (cgroupsv2). See the <a class="link" href="https://www.redhat.com/sysadmin/fedora-31-control-group-v2"  target="_top">Fedora Article for 31</a> for details on why this is desirable, and how it impacts containers.</p><p>If you want to run containers with a runtime that does not yet support cgroupsv2, you can switch back to the old behaviour by setting <a class="link" href="options.html#opt-systemd.enableUnifiedCgroupHierarchy"  target="_top">systemd.enableUnifiedCgroupHierarchy</a> = <code class="literal">false</code>; and rebooting.</p></li><li class="listitem"><p>PulseAudio was upgraded to 14.0, with changes to the handling of default sinks. See its <a class="link" href="https://www.freedesktop.org/wiki/Software/PulseAudio/Notes/14.0/"  target="_top">release notes</a>.</p></li><li class="listitem"><p>GNOME users may wish to delete their <code class="literal">~/.config/pulse</code> due to the changes to stream routing logic. See <a class="link" href="https://gitlab.freedesktop.org/pulseaudio/pulseaudio/-/issues/832"  target="_top">PulseAudio bug 832</a> for more information.</p></li><li class="listitem"><p>The zookeeper package does not provide <code class="literal">zooInspector.sh</code> anymore, as that “contrib” has been dropped from upstream releases.</p></li><li class="listitem"><p>In the ACME module, the data used to build the hash for the account directory has changed to accommodate new features to reduce account rate limit issues. This will trigger new account creation on the first rebuild following this update. No issues are expected to arise from this, thanks to the new account creation handling.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-users.users._name_.createHome"  target="_top">users.users.<span class="emphasis"><em>name</em></span>.createHome</a> now always ensures home directory permissions to be <code class="literal">0700</code>. Permissions had previously been ignored for already existing home directories, possibly leaving them readable by others. The option’s description was incorrect regarding ownership management and has been simplified greatly.</p></li><li class="listitem"><p>When defining a new user, one of <a class="link" href="options.html#opt-users.users._name_.isNormalUser"  target="_top">users.users.<span class="emphasis"><em>name</em></span>.isNormalUser</a> and <a class="link" href="options.html#opt-users.users._name_.isSystemUser"  target="_top">users.users.<span class="emphasis"><em>name</em></span>.isSystemUser</a> is now required. This is to prevent accidentally giving a UID above 1000 to system users, which could have unexpected consequences, like running user activation scripts for system users. Note that users defined with an explicit UID below 500 are exempted from this check, as <a class="link" href="options.html#opt-users.users._name_.isSystemUser"  target="_top">users.users.<span class="emphasis"><em>name</em></span>.isSystemUser</a> has no effect for those.</p></li><li class="listitem"><p>The <code class="literal">security.apparmor</code> module, for the <a class="link" href="https://gitlab.com/apparmor/apparmor/-/wikis/Documentation"  target="_top">AppArmor</a> Mandatory Access Control system, has been substantially improved along with related tools, so that module maintainers can now more easily write AppArmor profiles for NixOS. The most notable change on the user-side is the new option <a class="link" href="options.html#opt-security.apparmor.policies"  target="_top">security.apparmor.policies</a>, replacing the previous <code class="literal">profiles</code> option to provide a way to disable a profile and to select whether to confine in enforce mode (default) or in complain mode (see <code class="literal">journalctl -b --grep apparmor</code>). Security-minded users may also want to enable <a class="link" href="options.html#opt-security.apparmor.killUnconfinedConfinables"  target="_top">security.apparmor.killUnconfinedConfinables</a>, at the cost of having some of their processes killed when updating to a NixOS version introducing new AppArmor profiles.</p></li><li class="listitem"><p>The GNOME desktop manager once again installs gnome.epiphany by default.</p></li><li class="listitem"><p>NixOS now generates empty <code class="literal">/etc/netgroup</code>. <code class="literal">/etc/netgroup</code> defines network-wide groups and may affect to setups using NIS.</p></li><li class="listitem"><p>Platforms, like <code class="literal">stdenv.hostPlatform</code>, no longer have a <code class="literal">platform</code> attribute. It has been (mostly) flattened away:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">platform.gcc</code> is now <code class="literal">gcc</code></p></li><li class="listitem"><p><code class="literal">platform.kernel*</code> is now <code class="literal">linux-kernel.*</code></p></li></ul></div><p>Additionally, <code class="literal">platform.kernelArch</code> moved to the top level as <code class="literal">linuxArch</code> to match the other <code class="literal">*Arch</code> variables.</p><p>The <code class="literal">platform</code> grouping of these things never meant anything, and was just a historial/implementation artifact that was overdue removal.</p></li><li class="listitem"><p><code class="literal">services.restic</code> now uses a dedicated cache directory for every backup defined in <code class="literal">services.restic.backups</code>. The old global cache directory, <code class="literal">/root/.cache/restic</code>, is now unused and can be removed to free up disk space.</p></li><li class="listitem"><p><code class="literal">isync</code>: The <code class="literal">isync</code> compatibility wrapper was removed and the Master/Slave terminology has been deprecated and should be replaced with Far/Near in the configuration file.</p></li><li class="listitem"><p>The nix-gc service now accepts randomizedDelaySec (default: 0) and persistent (default: true) parameters. By default nix-gc will now run immediately if it would have been triggered at least once during the time when the timer was inactive.</p></li><li class="listitem"><p>The <code class="literal">rustPlatform.buildRustPackage</code> function is split into several hooks: cargoSetupHook to set up vendoring for Cargo-based projects, cargoBuildHook to build a project using Cargo, cargoInstallHook to install a project using Cargo, and cargoCheckHook to run tests in Cargo-based projects. With this change, mixed-language projects can use the relevant hooks within builders other than <code class="literal">buildRustPackage</code>. However, these changes also required several API changes to <code class="literal">buildRustPackage</code> itself:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>The <code class="literal">target</code> argument was removed. Instead, <code class="literal">buildRustPackage</code> will always use the same target as the C/C++ compiler that is used.</p></li><li class="listitem"><p>The <code class="literal">cargoParallelTestThreads</code> argument was removed. Parallel tests are now disabled through <code class="literal">dontUseCargoParallelTests</code>.</p></li></ul></div></li><li class="listitem"><p>The <code class="literal">rustPlatform.maturinBuildHook</code> hook was added. This hook can be used with <code class="literal">buildPythonPackage</code> to build Python packages that are written in Rust and use Maturin as their build tool.</p></li><li class="listitem"><p>Kubernetes has <a class="link" href="https://kubernetes.io/blog/2020/12/02/dont-panic-kubernetes-and-docker/"  target="_top">deprecated docker</a> as container runtime. As a consequence, the Kubernetes module now has support for configuration of custom remote container runtimes and enables containerd by default. Note that containerd is more strict regarding container image OCI-compliance. As an example, images with CMD or ENTRYPOINT defined as strings (not lists) will fail on containerd, while working fine on docker. Please test your setup and container images with containerd prior to upgrading.</p></li><li class="listitem"><p>The GitLab module now has support for automatic backups. A schedule can be set with the <a class="link" href="options.html#opt-services.gitlab.backup.startAt"  target="_top">services.gitlab.backup.startAt</a> option.</p></li><li class="listitem"><p>Prior to this release, systemd would also read system units from an undocumented <code class="literal">/etc/systemd-mutable/system</code> path. This path has been dropped from the defaults. That path (or others) can be re-enabled by adding it to the <a class="link" href="options.html#opt-boot.extraSystemdUnitPaths"  target="_top">boot.extraSystemdUnitPaths</a> list.</p></li><li class="listitem"><p>PostgreSQL 9.5 is scheduled EOL during the 21.05 life cycle and has been removed.</p></li><li class="listitem"><p><a class="link" href="https://www.xfce.org/"  target="_top">Xfce4</a> relies on GIO/GVfs for userspace virtual filesystem access in applications like <a class="link" href="https://docs.xfce.org/xfce/thunar/"  target="_top">thunar</a> and <a class="link" href="https://docs.xfce.org/apps/gigolo/"  target="_top">gigolo</a>. For that to work, the gvfs nixos service is enabled by default, and it can be configured with the specific package that provides GVfs. Until now Xfce4 was setting it to use a lighter version of GVfs (without support for samba). To avoid conflicts with other desktop environments this setting has been dropped. Users that still want it should add the following to their system configuration:</p><pre><code class="programlisting nix">{
  services.gvfs.package = pkgs.gvfs.override { samba = null; };
}
</code></pre></li><li class="listitem"><p>The newly enabled <code class="literal">systemd-pstore.service</code> now automatically evacuates crashdumps and panic logs from the persistent storage to <code class="literal">/var/lib/systemd/pstore</code>. This prevents NVRAM from filling up, which ensures the latest diagnostic data is always stored and alleviates problems with writing new boot configurations.</p></li><li class="listitem"><p>Nixpkgs now contains <a class="link" href="https://github.com/NixOS/nixpkgs/pull/118232"  target="_top">automatically packaged GNOME Shell extensions</a> from the <a class="link" href="https://extensions.gnome.org/"  target="_top">GNOME Extensions</a> portal. You can find them, filed by their UUID, under <code class="literal">gnome38Extensions</code> attribute for GNOME 3.38 and under <code class="literal">gnome40Extensions</code> for GNOME 40. Finally, the <code class="literal">gnomeExtensions</code> attribute contains extensions for the latest GNOME Shell version in Nixpkgs, listed under a more human-friendly name. The unqualified attribute scope also contains manually packaged extensions. Note that the automatically packaged extensions are provided for convenience and are not checked or guaranteed to work.</p></li><li class="listitem"><p>Erlang/OTP versions older than R21 got dropped. We also dropped the cuter package, as it was purely an example of how to build a package. We also dropped <code class="literal">lfe_1_2</code> as it could not build with R21+. Moving forward, we expect to only support 3 yearly releases of OTP.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-20.09" class="title" style="clear: both">Release 20.09 (“Nightingale”, 2020.10/27)   </h2>  </div> </div></div><p>Support is planned until the end of June 2021, handing over to 21.05. (Plans <a class="link" href="https://github.com/NixOS/rfcs/blob/master/rfcs/0080-nixos-release-schedule.md#core-changes"  target="_top"> have shifted</a> by two months since release of 20.09.)</p><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-20.09-highlights" class="title" >Highlights   </h3>  </div> </div></div><p>In addition to 7349 new, 14442 updated, and 8181 removed packages, this release has the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Core version changes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>gcc: 9.2.0 -&gt; 9.3.0</p></li><li class="listitem"><p>glibc: 2.30 -&gt; 2.31</p></li><li class="listitem"><p>linux: still defaults to 5.4.x, all supported kernels available</p></li><li class="listitem"><p>mesa: 19.3.5 -&gt; 20.1.7</p></li></ul></div></li><li class="listitem"><p>Desktop Environments:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>plasma5: 5.17.5 -&gt; 5.18.5</p></li><li class="listitem"><p>kdeApplications: 19.12.3 -&gt; 20.08.1</p></li><li class="listitem"><p>gnome3: 3.34 -&gt; 3.36, see its <a class="link" href="https://help.gnome.org/misc/release-notes/3.36/"  target="_top">release notes</a></p></li><li class="listitem"><p>cinnamon: added at 4.6</p></li><li class="listitem"><p>NixOS now distributes an official <a class="link" href="https://nixos.org/download.html#nixos-iso"  target="_top">GNOME ISO</a></p></li></ul></div></li><li class="listitem"><p>Programming Languages and Frameworks:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>Agda ecosystem was heavily reworked (see more details below)</p></li><li class="listitem"><p>PHP now defaults to PHP 7.4, updated from 7.3</p></li><li class="listitem"><p>PHP 7.2 is no longer supported due to upstream not supporting this version for the entire lifecycle of the 20.09 release</p></li><li class="listitem"><p>Python 3 now defaults to Python 3.8 instead of 3.7</p></li><li class="listitem"><p>Python 3.5 reached its upstream EOL at the end of September 2020: it has been removed from the list of available packages</p></li></ul></div></li><li class="listitem"><p>Databases and Service Monitoring:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>MariaDB has been updated to 10.4, MariaDB Galera to 26.4. Please read the related upgrade instructions under <a class="link" href="release-notes.html#sec-release-20.09-incompatibilities" title="Backward Incompatibilities" >backwards incompatibilities</a> before upgrading.</p></li><li class="listitem"><p>Zabbix now defaults to 5.0, updated from 4.4. Please read related sections under <a class="link" href="release-notes.html#sec-release-20.09-incompatibilities" title="Backward Incompatibilities" >backwards compatibilities</a> before upgrading.</p></li></ul></div></li><li class="listitem"><p>Major module changes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>Quickly configure a complete, private, self-hosted video conferencing solution with the new Jitsi Meet module.</p></li><li class="listitem"><p>Two new options, <a class="link" href="options.html#opt-services.openssh.authorizedKeysCommand"  target="_top">authorizedKeysCommand</a> and <a class="link" href="options.html#opt-services.openssh.authorizedKeysCommandUser"  target="_top">authorizedKeysCommandUser</a>, have been added to the <code class="literal">openssh</code> module. If you have <code class="literal">AuthorizedKeysCommand</code> in your <a class="link" href="options.html#opt-services.openssh.extraConfig"  target="_top">services.openssh.extraConfig</a> you should make use of these new options instead.</p></li><li class="listitem"><p>There is a new module for Podman (<code class="literal">virtualisation.podman</code>), a drop-in replacement for the Docker command line.</p></li><li class="listitem"><p>The new <code class="literal">virtualisation.containers</code> module manages configuration shared by the CRI-O and Podman modules.</p></li><li class="listitem"><p>Declarative Docker containers are renamed from <code class="literal">docker-containers</code> to <code class="literal">virtualisation.oci-containers.containers</code>. This is to make it possible to use <code class="literal">podman</code> instead of <code class="literal">docker</code>.</p></li><li class="listitem"><p>The new option <a class="link" href="options.html#opt-documentation.man.generateCaches"  target="_top">documentation.man.generateCaches</a> has been added to automatically generate the <code class="literal">man-db</code> caches, which are needed by utilities like <code class="literal">whatis</code> and <code class="literal">apropos</code>. The caches are generated during the build of the NixOS configuration: since this can be expensive when a large number of packages are installed, the feature is disabled by default.</p></li><li class="listitem"><p><code class="literal">services.postfix.sslCACert</code> was replaced by <code class="literal">services.postfix.tlsTrustedAuthorities</code> which now defaults to system certificate authorities.</p></li><li class="listitem"><p>The various documented workarounds to use steam have been converted to a module. <code class="literal">programs.steam.enable</code> enables steam, controller support and the workarounds.</p></li><li class="listitem"><p>Support for built-in LCDs in various pieces of Logitech hardware (keyboards and USB speakers). <code class="literal">hardware.logitech.lcd.enable</code> enables support for all hardware supported by the <a class="link" href="https://sourceforge.net/projects/g15daemon/"  target="_top">g15daemon project</a>.</p></li><li class="listitem"><p>The GRUB module gained support for basic password protection, which allows to restrict non-default entries in the boot menu to one or more users. The users and passwords are defined via the option <code class="literal">boot.loader.grub.users</code>. Note: Password support is only available in GRUB version 2.</p></li></ul></div></li><li class="listitem"><p>NixOS module changes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>The NixOS module system now supports freeform modules as a mix between <code class="literal">types.attrsOf</code> and <code class="literal">types.submodule</code>. These allow you to explicitly declare a subset of options while still permitting definitions without an associated option. See <a class="xref" href="index.html#sec-freeform-modules" title="Freeform modules" >the section called “Freeform modules”</a> for how to use them.</p></li><li class="listitem"><p>Following its deprecation in 20.03, the Perl NixOS test driver has been removed. All remaining tests have been ported to the Python test framework. Code outside nixpkgs using <code class="literal">make-test.nix</code> or <code class="literal">testing.nix</code> needs to be ported to <code class="literal">make-test-python.nix</code> and <code class="literal">testing-python.nix</code> respectively.</p></li><li class="listitem"><p>Subordinate GID and UID mappings are now set up automatically for all normal users. This will make container tools like Podman work as non-root users out of the box.</p></li></ul></div></li><li class="listitem"><p>Starting with this release, the hydra-build-result <code class="literal">nixos-YY.MM</code> branches no longer exist in the <a class="link" href="https://github.com/nixos/nixpkgs-channels"  target="_top">deprecated nixpkgs-channels repository</a>. These branches are now in <a class="link" href="https://github.com/nixos/nixpkgs"  target="_top">the main nixpkgs repository</a>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-20.09-new-services" class="title" >New Services   </h3>  </div> </div></div><p>In addition to 1119 new, 118 updated, and 476 removed options; 61 new modules were added since the last release:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Hardware:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><a class="link" href="options.html#opt-hardware.system76.firmware-daemon.enable"  target="_top">hardware.system76.firmware-daemon.enable</a> adds easy support of system76 firmware</p></li><li class="listitem"><p><a class="link" href="options.html#opt-hardware.uinput.enable"  target="_top">hardware.uinput.enable</a> loads uinput kernel module</p></li><li class="listitem"><p><a class="link" href="options.html#opt-hardware.video.hidpi.enable"  target="_top">hardware.video.hidpi.enable</a> enable good defaults for HiDPI displays</p></li><li class="listitem"><p><a class="link" href="options.html#opt-hardware.wooting.enable"  target="_top">hardware.wooting.enable</a> support for Wooting keyboards</p></li><li class="listitem"><p><a class="link" href="options.html#opt-hardware.xpadneo.enable"  target="_top">hardware.xpadneo.enable</a> xpadneo driver for Xbox One wireless controllers</p></li></ul></div></li><li class="listitem"><p>Programs:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><a class="link" href="options.html#opt-programs.hamster.enable"  target="_top">programs.hamster.enable</a> enable hamster time tracking</p></li><li class="listitem"><p><a class="link" href="options.html#opt-programs.steam.enable"  target="_top">programs.steam.enable</a> adds easy enablement of steam and related system configuration</p></li></ul></div></li><li class="listitem"><p>Security:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><a class="link" href="options.html#opt-security.doas.enable"  target="_top">security.doas.enable</a> alternative to sudo, allows non-root users to execute commands as root</p></li><li class="listitem"><p><a class="link" href="options.html#opt-security.tpm2.enable"  target="_top">security.tpm2.enable</a> add Trusted Platform Module 2 support</p></li></ul></div></li><li class="listitem"><p>System:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><a class="link" href="options.html#opt-boot.initrd.network.openvpn.enable"  target="_top">boot.initrd.network.openvpn.enable</a> start an OpenVPN client during initrd boot</p></li></ul></div></li><li class="listitem"><p>Virtualization:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><a class="link" href="options.html#opt-boot.enableContainers"  target="_top">boot.enableContainers</a> use nixos-containers</p></li><li class="listitem"><p><a class="link" href="options.html#opt-virtualisation.oci-containers.containers"  target="_top">virtualisation.oci-containers.containers</a> run OCI (Docker) containers</p></li><li class="listitem"><p><a class="link" href="options.html#opt-virtualisation.podman.enable"  target="_top">virtualisation.podman.enable</a> daemonless container engine</p></li></ul></div></li><li class="listitem"><p>Services:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">services.ankisyncd.enable</code> Anki sync server</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.bazarr.enable"  target="_top">services.bazarr.enable</a> Subtitle manager for Sonarr and Radarr</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.biboumi.enable"  target="_top">services.biboumi.enable</a> Biboumi XMPP gateway to IRC</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.blockbook-frontend"  target="_top">services.blockbook-frontend</a> Blockbook-frontend, a service for the Trezor wallet</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.cage.enable"  target="_top">services.cage.enable</a> Wayland cage service</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.convos.enable"  target="_top">services.convos.enable</a> IRC daemon, which can be accessed through the browser</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.engelsystem.enable"  target="_top">services.engelsystem.enable</a> Tool for coordinating volunteers and shifts on large events</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.espanso.enable"  target="_top">services.espanso.enable</a> text-expander written in rust</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.foldingathome.enable"  target="_top">services.foldingathome.enable</a> Folding@home client</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.gerrit.enable"  target="_top">services.gerrit.enable</a> Web-based team code collaboration tool</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.go-neb.enable"  target="_top">services.go-neb.enable</a> Matrix bot</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.hardware.xow.enable"  target="_top">services.hardware.xow.enable</a> xow as a systemd service</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.hercules-ci-agent.enable"  target="_top">services.hercules-ci-agent.enable</a> Hercules CI build agent</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.jicofo.enable"  target="_top">services.jicofo.enable</a> Jitsi Conference Focus, component of Jitsi Meet</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.jirafeau.enable"  target="_top">services.jirafeau.enable</a> A web file repository</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.jitsi-meet.enable"  target="_top">services.jitsi-meet.enable</a> Secure, simple and scalable video conferences</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.jitsi-videobridge.enable"  target="_top">services.jitsi-videobridge.enable</a> Jitsi Videobridge, a WebRTC compatible router</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.jupyterhub.enable"  target="_top">services.jupyterhub.enable</a> Jupyterhub development server</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.k3s.enable"  target="_top">services.k3s.enable</a> Lightweight Kubernetes distribution</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.magic-wormhole-mailbox-server.enable"  target="_top">services.magic-wormhole-mailbox-server.enable</a> Magic Wormhole Mailbox Server</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.malcontent.enable"  target="_top">services.malcontent.enable</a> Parental Control support</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.matrix-appservice-discord.enable"  target="_top">services.matrix-appservice-discord.enable</a> Matrix and Discord bridge</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.mautrix-telegram.enable"  target="_top">services.mautrix-telegram.enable</a> Matrix-Telegram puppeting/relaybot bridge</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.mirakurun.enable"  target="_top">services.mirakurun.enable</a> Japanese DTV Tuner Server Service</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.molly-brown.enable"  target="_top">services.molly-brown.enable</a> Molly-Brown Gemini server</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.mullvad-vpn.enable"  target="_top">services.mullvad-vpn.enable</a> Mullvad VPN daemon</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.ncdns.enable"  target="_top">services.ncdns.enable</a> Namecoin to DNS bridge</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.nextdns.enable"  target="_top">services.nextdns.enable</a> NextDNS to DoH Proxy service</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.nix-store-gcs-proxy"  target="_top">services.nix-store-gcs-proxy</a> Google storage bucket to be used as a nix store</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.onedrive.enable"  target="_top">services.onedrive.enable</a> OneDrive sync service</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.pinnwand.enable"  target="_top">services.pinnwand.enable</a> Pastebin-like service</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.pixiecore.enable"  target="_top">services.pixiecore.enable</a> Manage network booting of machines</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.privacyidea.enable"  target="_top">services.privacyidea.enable</a> Privacy authentication server</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.quorum.enable"  target="_top">services.quorum.enable</a> Quorum blockchain daemon</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.robustirc-bridge.enable"  target="_top">services.robustirc-bridge.enable</a> RobustIRC bridge</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.rss-bridge.enable"  target="_top">services.rss-bridge.enable</a> Generate RSS and Atom feeds</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.rtorrent.enable"  target="_top">services.rtorrent.enable</a> rTorrent service</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.smartdns.enable"  target="_top">services.smartdns.enable</a> SmartDNS DNS server</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.sogo.enable"  target="_top">services.sogo.enable</a> SOGo groupware</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.teeworlds.enable"  target="_top">services.teeworlds.enable</a> Teeworlds game server</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.torque.mom.enable"  target="_top">services.torque.mom.enable</a> torque computing node</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.torque.server.enable"  target="_top">services.torque.server.enable</a> torque server</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.tuptime.enable"  target="_top">services.tuptime.enable</a> A total uptime service</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.urserver.enable"  target="_top">services.urserver.enable</a> X11 remote server</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.wasabibackend.enable"  target="_top">services.wasabibackend.enable</a> Wasabi backend service</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.yubikey-agent.enable"  target="_top">services.yubikey-agent.enable</a> Yubikey agent</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.zigbee2mqtt.enable"  target="_top">services.zigbee2mqtt.enable</a> Zigbee to MQTT bridge</p></li></ul></div></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-20.09-incompatibilities" class="title" >Backward Incompatibilities   </h3>  </div> </div></div><p>When upgrading from a previous release, please be aware of the following incompatible changes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>MariaDB has been updated to 10.4, MariaDB Galera to 26.4. Before you upgrade, it would be best to take a backup of your database. For MariaDB Galera Cluster, see <a class="link" href="https://mariadb.com/kb/en/upgrading-from-mariadb-103-to-mariadb-104-with-galera-cluster/"  target="_top">Upgrading from MariaDB 10.3 to MariaDB 10.4 with Galera Cluster</a> instead. Before doing the upgrade read <a class="link" href="https://mariadb.com/kb/en/upgrading-from-mariadb-103-to-mariadb-104/#incompatible-changes-between-103-and-104"  target="_top">Incompatible Changes Between 10.3 and 10.4</a>. After the upgrade you will need to run <code class="literal">mysql_upgrade</code>. MariaDB 10.4 introduces a number of changes to the authentication process, intended to make things easier and more intuitive. See <a class="link" href="https://mariadb.com/kb/en/authentication-from-mariadb-104/"  target="_top">Authentication from MariaDB 10.4</a>. unix_socket auth plugin does not use a password, and uses the connecting user’s UID instead. When a new MariaDB data directory is initialized, two MariaDB users are created and can be used with new unix_socket auth plugin, as well as traditional mysql_native_password plugin: root@localhost and mysql@localhost. To actually use the traditional mysql_native_password plugin method, one must run the following:</p><pre><code class="programlisting nix">{
services.mysql.initialScript = pkgs.writeText &quot;mariadb-init.sql&quot; &#x27;&#x27;
  ALTER USER root@localhost IDENTIFIED VIA mysql_native_password USING PASSWORD(&quot;verysecret&quot;);
&#x27;&#x27;;
}
</code></pre><p>When MariaDB data directory is just upgraded (not initialized), the users are not created or modified.</p></li><li class="listitem"><p>MySQL server is now started with additional systemd sandbox/hardening options for better security. The PrivateTmp, ProtectHome, and ProtectSystem options may be problematic when MySQL is attempting to read from or write to your filesystem anywhere outside of its own state directory, for example when calling <code class="literal">LOAD DATA INFILE or SELECT * INTO OUTFILE</code>. In this scenario a variant of the following may be required: - allow MySQL to read from /home and /tmp directories when using <code class="literal">LOAD DATA INFILE</code></p><pre><code class="programlisting nix">{
  systemd.services.mysql.serviceConfig.ProtectHome = lib.mkForce &quot;read-only&quot;;
}
</code></pre><p>- allow MySQL to write to custom folder <code class="literal">/var/data</code> when using <code class="literal">SELECT * INTO OUTFILE</code>, assuming the mysql user has write access to <code class="literal">/var/data</code></p><pre><code class="programlisting nix">{
  systemd.services.mysql.serviceConfig.ReadWritePaths = [ &quot;/var/data&quot; ];
}
</code></pre><p>The MySQL service no longer runs its <code class="literal">systemd</code> service startup script as <code class="literal">root</code> anymore. A dedicated non <code class="literal">root</code> super user account is required for operation. This means users with an existing MySQL or MariaDB database server are required to run the following SQL statements as a super admin user before upgrading:</p><pre><code class="programlisting SQL">CREATE USER IF NOT EXISTS &#x27;mysql&#x27;@&#x27;localhost&#x27; identified with unix_socket;
GRANT ALL PRIVILEGES ON *.* TO &#x27;mysql&#x27;@&#x27;localhost&#x27; WITH GRANT OPTION;
</code></pre><p>If you use MySQL instead of MariaDB please replace <code class="literal">unix_socket</code> with <code class="literal">auth_socket</code>. If you have changed the value of <a class="link" href="options.html#opt-services.mysql.user"  target="_top">services.mysql.user</a> from the default of <code class="literal">mysql</code> to a different user please change <code class="literal">&#x27;mysql&#x27;@&#x27;localhost&#x27;</code> to the corresponding user instead.</p></li><li class="listitem"><p>Zabbix now defaults to 5.0, updated from 4.4. Please carefully read through <a class="link" href="https://www.zabbix.com/documentation/current/manual/installation/upgrade/sources"  target="_top">the upgrade guide</a> and apply any changes required. Be sure to take special note of the section on <a class="link" href="https://www.zabbix.com/documentation/current/manual/installation/upgrade_notes_500#enabling_extended_range_of_numeric_float_values"  target="_top">enabling extended range of numeric (float) values</a> as you will need to apply this database migration manually.</p><p>If you are using Zabbix Server with a MySQL or MariaDB database you should note that using a character set of <code class="literal">utf8</code> and a collate of <code class="literal">utf8_bin</code> has become mandatory with this release. See the upstream <a class="link" href="https://support.zabbix.com/browse/ZBX-17357"  target="_top">issue</a> for further discussion. Before upgrading you should check the character set and collation used by your database and ensure they are correct:</p><pre><code class="programlisting SQL">SELECT
  default_character_set_name,
  default_collation_name
FROM
  information_schema.schemata
WHERE
  schema_name = &#x27;zabbix&#x27;;
</code></pre><p>If these values are not correct you should take a backup of your database and convert the character set and collation as required. Here is an <a class="link" href="https://www.zabbix.com/forum/zabbix-help/396573-reinstall-after-upgrade?p=396891#post396891"  target="_top">example</a> of how to do so, taken from the Zabbix forums:</p><pre><code class="programlisting SQL">ALTER DATABASE `zabbix` DEFAULT CHARACTER SET utf8 COLLATE utf8_bin;

-- the following will produce a list of SQL commands you should subsequently execute
SELECT CONCAT(&quot;ALTER TABLE &quot;, TABLE_NAME,&quot; CONVERT TO CHARACTER SET utf8 COLLATE utf8_bin;&quot;) AS ExecuteTheString
FROM information_schema.`COLUMNS`
WHERE table_schema = &quot;zabbix&quot; AND COLLATION_NAME = &quot;utf8_general_ci&quot;;
</code></pre></li><li class="listitem"><p>maxx package removed along with <code class="literal">services.xserver.desktopManager.maxx</code> module. Please migrate to cdesktopenv and <code class="literal">services.xserver.desktopManager.cde</code> module.</p></li><li class="listitem"><p>The <a class="link" href="options.html#opt-services.matrix-synapse.enable"  target="_top">matrix-synapse</a> module no longer includes optional dependencies by default, they have to be added through the <a class="link" href="options.html#opt-services.matrix-synapse.plugins"  target="_top">plugins</a> option.</p></li><li class="listitem"><p><code class="literal">buildGoModule</code> now internally creates a vendor directory in the source tree for downloaded modules instead of using go’s <a class="link" href="https://golang.org/cmd/go/#hdr-Module_proxy_protocol"  target="_top">module proxy protocol</a>. This storage format is simpler and therefore less likely to break with future versions of go. As a result <code class="literal">buildGoModule</code> switched from <code class="literal">modSha256</code> to the <code class="literal">vendorSha256</code> attribute to pin fetched version data.</p></li><li class="listitem"><p>Grafana is now built without support for phantomjs by default. Phantomjs support has been <a class="link" href="https://grafana.com/docs/grafana/latest/guides/whats-new-in-v6-4/"  target="_top">deprecated in Grafana</a> and the phantomjs project is <a class="link" href="https://github.com/ariya/phantomjs/issues/15344#issue-302015362"  target="_top">currently unmaintained</a>. It can still be enabled by providing <code class="literal">phantomJsSupport = true</code> to the package instantiation:</p><pre><code class="programlisting nix">{
  services.grafana.package = pkgs.grafana.overrideAttrs (oldAttrs: rec {
    phantomJsSupport = true;
  });
}
</code></pre></li><li class="listitem"><p>The <a class="link" href="options.html#opt-services.supybot.enable"  target="_top">supybot</a> module now uses <code class="literal">/var/lib/supybot</code> as its default <a class="link" href="options.html#opt-services.supybot.stateDir"  target="_top">stateDir</a> path if <code class="literal">stateVersion</code> is 20.09 or higher. It also enables a number of <a class="link" href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#Sandboxing"  target="_top">systemd sandboxing options</a> which may possibly interfere with some plugins. If this is the case you can disable the options through attributes in <code class="literal">systemd.services.supybot.serviceConfig</code>.</p></li><li class="listitem"><p>The <code class="literal">security.duosec.skey</code> option, which stored a secret in the nix store, has been replaced by a new <a class="link" href="options.html#opt-security.duosec.secretKeyFile"  target="_top">security.duosec.secretKeyFile</a> option for better security.</p><p><code class="literal">security.duosec.ikey</code> has been renamed to <a class="link" href="options.html#opt-security.duosec.integrationKey"  target="_top">security.duosec.integrationKey</a>.</p></li><li class="listitem"><p><code class="literal">vmware</code> has been removed from the <code class="literal">services.x11.videoDrivers</code> defaults. For VMWare guests set <code class="literal">virtualisation.vmware.guest.enable</code> to <code class="literal">true</code> which will include the appropriate drivers.</p></li><li class="listitem"><p>The initrd SSH support now uses OpenSSH rather than Dropbear to allow the use of Ed25519 keys and other OpenSSH-specific functionality. Host keys must now be in the OpenSSH format, and at least one pre-generated key must be specified.</p><p>If you used the <code class="literal">boot.initrd.network.ssh.host*Key</code> options, you’ll get an error explaining how to convert your host keys and migrate to the new <code class="literal">boot.initrd.network.ssh.hostKeys</code> option. Otherwise, if you don’t have any host keys set, you’ll need to generate some; see the <code class="literal">hostKeys</code> option documentation for instructions.</p></li><li class="listitem"><p>Since this release there’s an easy way to customize your PHP install to get a much smaller base PHP with only wanted extensions enabled. See the following snippet installing a smaller PHP with the extensions <code class="literal">imagick</code>, <code class="literal">opcache</code>, <code class="literal">pdo</code> and <code class="literal">pdo_mysql</code> loaded:</p><pre><code class="programlisting nix">{
  environment.systemPackages = [
    (pkgs.php.withExtensions
      ({ all, ... }: with all; [
        imagick
        opcache
        pdo
        pdo_mysql
      ])
    )
  ];
}
</code></pre><p>The default <code class="literal">php</code> attribute hasn’t lost any extensions. The <code class="literal">opcache</code> extension has been added. All upstream PHP extensions are available under php.extensions.&lt;name?&gt;.</p><p>All PHP <code class="literal">config</code> flags have been removed for the following reasons:</p></li><li class="listitem"><p>The updated <code class="literal">php</code> attribute is now easily customizable to your liking by using <code class="literal">php.withExtensions</code> or <code class="literal">php.buildEnv</code> instead of writing config files or changing configure flags.</p></li><li class="listitem"><p>The remaining configuration flags can now be set directly on the <code class="literal">php</code> attribute. For example, instead of</p><pre><code class="programlisting nix">php.override {
  config.php.embed = true;
  config.php.apxs2 = false;
}
</code></pre><p>you should now write</p><pre><code class="programlisting nix">php.override {
  embedSupport = true;
  apxs2Support = false;
}
</code></pre></li><li class="listitem"><p>The ACME module has been overhauled for simplicity and maintainability. Cert generation now implicitly uses the <code class="literal">acme</code> user, and the <code class="literal">security.acme.certs._name_.user</code> option has been removed. Instead, certificate access from other services is now managed through group permissions. The module no longer runs lego twice under certain conditions, and will correctly renew certificates if their configuration is changed. Services which reload nginx and httpd after certificate renewal are now properly configured too so you no longer have to do this manually if you are using HTTPS enabled virtual hosts. A mechanism for regenerating certs on demand has also been added and documented.</p></li><li class="listitem"><p>Gollum received a major update to version 5.x and you may have to change some links in your wiki when migrating from gollum 4.x. More information can be found <a class="link" href="https://github.com/gollum/gollum/wiki/5.0-release-notes#migrating-your-wiki"  target="_top">here</a>.</p></li><li class="listitem"><p>Deluge 2.x was added and is used as default for new NixOS installations where stateVersion is &gt;= 20.09. If you are upgrading from a previous NixOS version, you can set <code class="literal">service.deluge.package = pkgs.deluge-2_x</code> to upgrade to Deluge 2.x and migrate the state to the new format. Be aware that backwards state migrations are not supported by Deluge.</p></li><li class="listitem"><p>Nginx web server now starting with additional sandbox/hardening options. By default, write access to <code class="literal">/var/log/nginx</code> and <code class="literal">/var/cache/nginx</code> is allowed. To allow writing to other folders, use <code class="literal">systemd.services.nginx.serviceConfig.ReadWritePaths</code></p><pre><code class="programlisting nix">{
  systemd.services.nginx.serviceConfig.ReadWritePaths = [ &quot;/var/www&quot; ];
}
</code></pre><p>Nginx is also started with the systemd option <code class="literal">ProtectHome = mkDefault true;</code> which forbids it to read anything from <code class="literal">/home</code>, <code class="literal">/root</code> and <code class="literal">/run/user</code> (see <a class="link" href="https://www.freedesktop.org/software/systemd/man/systemd.exec.html#ProtectHome="  target="_top">ProtectHome docs</a> for details). If you require serving files from home directories, you may choose to set e.g.</p><pre><code class="programlisting nix">{
  systemd.services.nginx.serviceConfig.ProtectHome = &quot;read-only&quot;;
}
</code></pre></li><li class="listitem"><p>The NixOS options <code class="literal">nesting.clone</code> and <code class="literal">nesting.children</code> have been deleted, and replaced with named <a class="link" href="options.html#opt-specialisation"  target="_top">specialisation</a> configurations.</p><p>Replace a <code class="literal">nesting.clone</code> entry with:</p><pre><code class="programlisting nix">{
  specialisation.example-sub-configuration = {
    configuration = {
      # ...
    };
  };
}
</code></pre><p>Replace a <code class="literal">nesting.children</code> entry with:</p><pre><code class="programlisting nix">{
  specialisation.example-sub-configuration = {
    inheritParentConfig = false;
    configuration = {
      # ...
    };
  };
}
</code></pre><p>To switch to a specialised configuration at runtime you need to run:</p><pre><code class="programlisting ShellSession">$ sudo /run/current-system/specialisation/example-sub-configuration/bin/switch-to-configuration test
</code></pre><p>Before you would have used:</p><pre><code class="programlisting ShellSession">$ sudo /run/current-system/fine-tune/child-1/bin/switch-to-configuration test
</code></pre></li><li class="listitem"><p>The Nginx log directory has been moved to <code class="literal">/var/log/nginx</code>, the cache directory to <code class="literal">/var/cache/nginx</code>. The option <code class="literal">services.nginx.stateDir</code> has been removed.</p></li><li class="listitem"><p>The httpd web server previously started its main process as root privileged, then ran worker processes as a less privileged identity user. This was changed to start all of httpd as a less privileged user (defined by <a class="link" href="options.html#opt-services.httpd.user"  target="_top">services.httpd.user</a> and <a class="link" href="options.html#opt-services.httpd.group"  target="_top">services.httpd.group</a>). As a consequence, all files that are needed for httpd to run (included configuration fragments, SSL certificates and keys, etc.) must now be readable by this less privileged user/group.</p><p>The default value for <a class="link" href="options.html#opt-services.httpd.mpm"  target="_top">services.httpd.mpm</a> has been changed from <code class="literal">prefork</code> to <code class="literal">event</code>. Along with this change the default value for <a class="link" href="options.html#opt-services.httpd.virtualHosts"  target="_top">services.httpd.virtualHosts.&lt;name&gt;.http2</a> has been set to <code class="literal">true</code>.</p></li><li class="listitem"><p>The <code class="literal">systemd-networkd</code> option <code class="literal">systemd.network.networks.&lt;name&gt;.dhcp.CriticalConnection</code> has been removed following upstream systemd’s deprecation of the same. It is recommended to use <code class="literal">systemd.network.networks.&lt;name&gt;.networkConfig.KeepConfiguration</code> instead. See systemd.network 5 for details.</p></li><li class="listitem"><p>The <code class="literal">systemd-networkd</code> option <code class="literal">systemd.network.networks._name_.dhcpConfig</code> has been renamed to <a class="link" href="options.html#opt-systemd.network.networks._name_.dhcpV4Config"  target="_top">systemd.network.networks.<span class="emphasis"><em>name</em></span>.dhcpV4Config</a> following upstream systemd’s documentation change. See systemd.network 5 for details.</p></li><li class="listitem"><p>In the <code class="literal">picom</code> module, several options that accepted floating point numbers encoded as strings (for example <a class="link" href="options.html#opt-services.picom.activeOpacity"  target="_top">services.picom.activeOpacity</a>) have been changed to the (relatively) new native <code class="literal">float</code> type. To migrate your configuration remove the quotes around the numbers.</p></li><li class="listitem"><p>When using <code class="literal">buildBazelPackage</code> from Nixpkgs, <code class="literal">flat</code> hash mode is now used for dependencies instead of <code class="literal">recursive</code>. This is to better allow using hashed mirrors where needed. As a result, these hashes will have changed.</p></li><li class="listitem"><p>The syntax of the PostgreSQL configuration file is now checked at build time. If your configuration includes a file inaccessible inside the build sandbox, set <code class="literal">services.postgresql.checkConfig</code> to <code class="literal">false</code>.</p></li><li class="listitem"><p>The rkt module has been removed, it was archived by upstream.</p></li><li class="listitem"><p>The <a class="link" href="https://bazaar.canonical.com"  target="_top">Bazaar</a> VCS is unmaintained and, as consequence of the Python 2 EOL, the packages <code class="literal">bazaar</code> and <code class="literal">bazaarTools</code> were removed. Breezy, the backward compatible fork of Bazaar (see the <a class="link" href="https://www.jelmer.uk/breezy-intro.html"  target="_top">announcement</a>), was packaged as <code class="literal">breezy</code> and can be used instead.</p><p>Regarding Nixpkgs, <code class="literal">fetchbzr</code>, <code class="literal">nix-prefetch-bzr</code> and Bazaar support in Hydra will continue to work through Breezy.</p></li><li class="listitem"><p>In addition to the hostname, the fully qualified domain name (FQDN), which consists of <code class="literal">${networking.hostName}</code> and <code class="literal">${networking.domain}</code> is now added to <code class="literal">/etc/hosts</code>, to allow local FQDN resolution, as used by the <code class="literal">hostname --fqdn</code> command and other applications that try to determine the FQDN. These new entries take precedence over entries from the DNS which could cause regressions in some very specific setups. Additionally the hostname is now resolved to <code class="literal">127.0.0.2</code> instead of <code class="literal">127.0.1.1</code> to be consistent with what <code class="literal">nss-myhostname</code> (from systemd) returns. The old behaviour can e.g. be restored by using <code class="literal">networking.hosts = lib.mkForce { &quot;127.0.1.1&quot; = [ config.networking.hostName ]; };</code>.</p></li><li class="listitem"><p>The hostname (<code class="literal">networking.hostName</code>) must now be a valid DNS label (see RFC 1035, RFC 1123) and as such must not contain the domain part. This means that the hostname must start with a letter or digit, end with a letter or digit, and have as interior characters only letters, digits, and hyphen. The maximum length is 63 characters. Additionally it is recommended to only use lower-case characters. If (e.g. for legacy reasons) a FQDN is required as the Linux kernel network node hostname (<code class="literal">uname --nodename</code>) the option <code class="literal">boot.kernel.sysctl.&quot;kernel.hostname&quot;</code> can be used as a workaround (but be aware of the 64 character limit).</p></li><li class="listitem"><p>The GRUB specific option <code class="literal">boot.loader.grub.extraInitrd</code> has been replaced with the generic option <code class="literal">boot.initrd.secrets</code>. This option creates a secondary initrd from the specified files, rather than using a manually created initrd file. Due to an existing bug with <code class="literal">boot.loader.grub.extraInitrd</code>, it is not possible to directly boot an older generation that used that option. It is still possible to rollback to that generation if the required initrd file has not been deleted.</p></li><li class="listitem"><p>The <a class="link" href="https://github.com/okTurtles/dnschain"  target="_top">DNSChain</a> package and NixOS module have been removed from Nixpkgs as the software is unmaintained and can’t be built. For more information see issue <a class="link" href="https://github.com/NixOS/nixpkgs/issues/89205"  target="_top">#89205</a>.</p></li><li class="listitem"><p>In the <code class="literal">resilio</code> module, <a class="link" href="options.html#opt-services.resilio.httpListenAddr"  target="_top">services.resilio.httpListenAddr</a> has been changed to listen to <code class="literal">[::1]</code> instead of <code class="literal">0.0.0.0</code>.</p></li><li class="listitem"><p><code class="literal">sslh</code> has been updated to version <code class="literal">1.21</code>. The <code class="literal">ssl</code> probe must be renamed to <code class="literal">tls</code> in <a class="link" href="options.html#opt-services.sslh.appendConfig"  target="_top">services.sslh.appendConfig</a>.</p></li><li class="listitem"><p>Users of <a class="link" href="http://openafs.org"  target="_top">OpenAFS 1.6</a> must upgrade their services to OpenAFS 1.8! In this release, the OpenAFS package version 1.6.24 is marked broken but can be used during transition to OpenAFS 1.8.x. Use the options <code class="literal">services.openafsClient.packages.module</code>, <code class="literal">services.openafsClient.packages.programs</code> and <code class="literal">services.openafsServer.package</code> to select a different OpenAFS package. OpenAFS 1.6 will be removed in the next release. The package <code class="literal">openafs</code> and the service options will then silently point to the OpenAFS 1.8 release.</p><p>See also the OpenAFS <a class="link" href="http://docs.openafs.org/AdminGuide/index.html"  target="_top">Administrator Guide</a> for instructions. Beware of the following when updating servers:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>The storage format of the server key has changed and the key must be converted before running the new release.</p></li><li class="listitem"><p>When updating multiple database servers, turn off the database servers from the highest IP down to the lowest with resting periods in between. Start up in reverse order. Do not concurrently run database servers working with different OpenAFS releases!</p></li><li class="listitem"><p>Update servers first, then clients.</p></li></ul></div></li><li class="listitem"><p>Radicale’s default package has changed from 2.x to 3.x. An upgrade checklist can be found <a class="link" href="https://github.com/Kozea/Radicale/blob/3.0.x/NEWS.md#upgrade-checklist"  target="_top">here</a>. You can use the newer version in the NixOS service by setting the <code class="literal">package</code> to <code class="literal">radicale3</code>, which is done automatically if <code class="literal">stateVersion</code> is 20.09 or higher.</p></li><li class="listitem"><p><code class="literal">udpt</code> experienced a complete rewrite from C++ to rust. The configuration format changed from ini to toml. The new configuration documentation can be found at <a class="link" href="https://naim94a.github.io/udpt/config.html"  target="_top">the official website</a> and example configuration is packaged in <code class="literal">${udpt}/share/udpt/udpt.toml</code>.</p></li><li class="listitem"><p>We now have a unified <a class="link" href="options.html#opt-services.xserver.displayManager.autoLogin"  target="_top">services.xserver.displayManager.autoLogin</a> option interface to be used for every display-manager in NixOS.</p></li><li class="listitem"><p>The <code class="literal">bitcoind</code> module has changed to multi-instance, using submodules. Therefore, it is now mandatory to name each instance. To use this new multi-instance config with an existing bitcoind data directory and user, you have to adjust the original config, e.g.:</p><pre><code class="programlisting nix">{
  services.bitcoind = {
    enable = true;
    extraConfig = &quot;...&quot;;
    # ...
  };
}
</code></pre><p>To something similar:</p><pre><code class="programlisting nix">{
  services.bitcoind.mainnet = {
    enable = true;
    dataDir = &quot;/var/lib/bitcoind&quot;;
    user = &quot;bitcoin&quot;;
    extraConfig = &quot;...&quot;;
    # ...
  };
}
</code></pre><p>The key settings are:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">dataDir</code> - to continue using the same data directory.</p></li><li class="listitem"><p><code class="literal">user</code> - to continue using the same user so that bitcoind maintains access to its files.</p></li></ul></div></li><li class="listitem"><p>Graylog introduced a change in the LDAP server certificate validation behaviour for version 3.3.3 which might break existing setups. When updating Graylog from a version before 3.3.3 make sure to check the Graylog <a class="link" href="https://www.graylog.org/post/announcing-graylog-v3-3-3"  target="_top">release info</a> for information on how to avoid the issue.</p></li><li class="listitem"><p>The <code class="literal">dokuwiki</code> module has changed to multi-instance, using submodules. Therefore, it is now mandatory to name each instance. Moreover, forcing SSL by default has been dropped, so <code class="literal">nginx.forceSSL</code> and <code class="literal">nginx.enableACME</code> are no longer set to <code class="literal">true</code>. To continue using your service with the original SSL settings, you have to adjust the original config, e.g.:</p><pre><code class="programlisting nix">{
  services.dokuwiki = {
    enable = true;
    # ...
  };
}
</code></pre><p>To something similar:</p><pre><code class="programlisting nix">{
  services.dokuwiki.&quot;mywiki&quot; = {
    enable = true;
    nginx = {
      forceSSL = true;
      enableACME = true;
    };
    # ...
  };
}
</code></pre><p>The base package has also been upgraded to the 2020-07-29 “Hogfather” release. Plugins might be incompatible or require upgrading.</p></li><li class="listitem"><p>The <a class="link" href="options.html#opt-services.postgresql.dataDir"  target="_top">services.postgresql.dataDir</a> option is now set to <code class="literal">&quot;/var/lib/postgresql/${cfg.package.psqlSchema}&quot;</code> regardless of your <a class="link" href="options.html#opt-system.stateVersion"  target="_top">system.stateVersion</a>. Users with an existing postgresql install that have a <a class="link" href="options.html#opt-system.stateVersion"  target="_top">system.stateVersion</a> of <code class="literal">17.03</code> or below should double check what the value of their <a class="link" href="options.html#opt-services.postgresql.dataDir"  target="_top">services.postgresql.dataDir</a> option is (<code class="literal">/var/db/postgresql</code>) and then explicitly set this value to maintain compatibility:</p><pre><code class="programlisting nix">{
  services.postgresql.dataDir = &quot;/var/db/postgresql&quot;;
}
</code></pre><p>The postgresql module now expects there to be a database super user account called <code class="literal">postgres</code> regardless of your <a class="link" href="options.html#opt-system.stateVersion"  target="_top">system.stateVersion</a>. Users with an existing postgresql install that have a <a class="link" href="options.html#opt-system.stateVersion"  target="_top">system.stateVersion</a> of <code class="literal">17.03</code> or below should run the following SQL statements as a database super admin user before upgrading:</p><pre><code class="programlisting SQL">CREATE ROLE postgres LOGIN SUPERUSER;
</code></pre></li><li class="listitem"><p>The USBGuard module now removes options and instead hardcodes values for <code class="literal">IPCAccessControlFiles</code>, <code class="literal">ruleFiles</code>, and <code class="literal">auditFilePath</code>. Audit logs can be found in the journal.</p></li><li class="listitem"><p>The NixOS module system now evaluates option definitions more strictly, allowing it to detect a larger set of problems. As a result, what previously evaluated may not do so anymore. See <a class="link" href="https://github.com/NixOS/nixpkgs/pull/82743#issuecomment-674520472"  target="_top">the PR that changed this</a> for more info.</p></li><li class="listitem"><p>For NixOS configuration options, the type <code class="literal">loaOf</code>, after its initial deprecation in release 20.03, has been removed. In NixOS and Nixpkgs options using this type have been converted to <code class="literal">attrsOf</code>. For more information on this change have look at these links: <a class="link" href="https://github.com/NixOS/nixpkgs/issues/1800"  target="_top">issue #1800</a>, <a class="link" href="https://github.com/NixOS/nixpkgs/pull/63103"  target="_top">PR #63103</a>.</p></li><li class="listitem"><p><code class="literal">config.systemd.services.${name}.path</code> now returns a list of paths instead of a colon-separated string.</p></li><li class="listitem"><p>Caddy module now uses Caddy v2 by default. Caddy v1 can still be used by setting <a class="link" href="options.html#opt-services.caddy.package"  target="_top">services.caddy.package</a> to <code class="literal">pkgs.caddy1</code>.</p><p>New option <a class="link" href="options.html#opt-services.caddy.adapter"  target="_top">services.caddy.adapter</a> has been added.</p></li><li class="listitem"><p>The <a class="link" href="options.html#opt-services.jellyfin.enable"  target="_top">jellyfin</a> module will use and stay on the Jellyfin version <code class="literal">10.5.5</code> if <code class="literal">stateVersion</code> is lower than <code class="literal">20.09</code>. This is because significant changes were made to the database schema, and it is highly recommended to backup your instance before upgrading. After making your backup, you can upgrade to the latest version either by setting your <code class="literal">stateVersion</code> to <code class="literal">20.09</code> or higher, or set the <code class="literal">services.jellyfin.package</code> to <code class="literal">pkgs.jellyfin</code>. If you do not wish to upgrade Jellyfin, but want to change your <code class="literal">stateVersion</code>, you can set the value of <code class="literal">services.jellyfin.package</code> to <code class="literal">pkgs.jellyfin_10_5</code>.</p></li><li class="listitem"><p>The <code class="literal">security.rngd</code> service is now disabled by default. This choice was made because there’s krngd in the linux kernel space making it (for most usecases) functionally redundant.</p></li><li class="listitem"><p>The <code class="literal">hardware.nvidia.optimus_prime.enable</code> service has been renamed to <code class="literal">hardware.nvidia.prime.sync.enable</code> and has many new enhancements. Related nvidia prime settings may have also changed.</p></li><li class="listitem"><p>The package nextcloud17 has been removed and nextcloud18 was marked as insecure since both of them will <a class="link" href="https://docs.nextcloud.com/server/19/admin_manual/release_schedule.html"  target="_top"> will be EOL (end of life) within the lifetime of 20.09</a>.</p><p>It’s necessary to upgrade to nextcloud19:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>From nextcloud17, you have to upgrade to nextcloud18 first as Nextcloud doesn’t allow going multiple major revisions forward in a single upgrade. This is possible by setting <a class="link" href="options.html#opt-services.nextcloud.package"  target="_top">services.nextcloud.package</a> to nextcloud18.</p></li><li class="listitem"><p>From nextcloud18, it’s possible to directly upgrade to nextcloud19 by setting <a class="link" href="options.html#opt-services.nextcloud.package"  target="_top">services.nextcloud.package</a> to nextcloud19.</p></li></ul></div></li><li class="listitem"><p>The GNOME desktop manager no longer default installs gnome3.epiphany. It was chosen to do this as it has a usability breaking issue (see issue <a class="link" href="https://github.com/NixOS/nixpkgs/issues/98819"  target="_top">#98819</a>) that makes it unsuitable to be a default app.</p><div class="note"><h3 class="title">Note</h3><p>Issue <a class="link" href="https://github.com/NixOS/nixpkgs/issues/98819"  target="_top">#98819</a> is now fixed and gnome3.epiphany is once again installed by default.</p></div></li><li class="listitem"><p>If you want to manage the configuration of wpa_supplicant outside of NixOS you must ensure that none of <a class="link" href="options.html#opt-networking.wireless.networks"  target="_top">networking.wireless.networks</a>, <a class="link" href="options.html#opt-networking.wireless.extraConfig"  target="_top">networking.wireless.extraConfig</a> or <a class="link" href="options.html#opt-networking.wireless.userControlled.enable"  target="_top">networking.wireless.userControlled.enable</a> is being used or <code class="literal">true</code>. Using any of those options will cause wpa_supplicant to be started with a NixOS generated configuration file instead of your own.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-20.09-notable-changes" class="title" >Other Notable Changes   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>SD images are now compressed by default using <code class="literal">zstd</code>. The compression for ISO images has also been changed to <code class="literal">zstd</code>, but ISO images are still not compressed by default.</p></li><li class="listitem"><p><code class="literal">services.journald.rateLimitBurst</code> was updated from <code class="literal">1000</code> to <code class="literal">10000</code> to follow the new upstream systemd default.</p></li><li class="listitem"><p>The notmuch package moves its emacs-related binaries and emacs lisp files to a separate output. They’re not part of the default <code class="literal">out</code> output anymore - if you relied on the <code class="literal">notmuch-emacs-mua</code> binary or the emacs lisp files, access them via the <code class="literal">notmuch.emacs</code> output.</p></li><li class="listitem"><p>Device tree overlay support was improved in <a class="link" href="https://github.com/NixOS/nixpkgs/pull/79370"  target="_top">#79370</a> and now uses <a class="link" href="options.html#opt-hardware.deviceTree.kernelPackage"  target="_top">hardware.deviceTree.kernelPackage</a> instead of <code class="literal">hardware.deviceTree.base</code>. <a class="link" href="options.html#opt-hardware.deviceTree.overlays"  target="_top">hardware.deviceTree.overlays</a> configuration was extended to support <code class="literal">.dts</code> files with symbols. Device trees can now be filtered by setting <a class="link" href="options.html#opt-hardware.deviceTree.filter"  target="_top">hardware.deviceTree.filter</a> option.</p></li><li class="listitem"><p>The default output of <code class="literal">buildGoPackage</code> is now <code class="literal">$out</code> instead of <code class="literal">$bin</code>.</p></li><li class="listitem"><p><code class="literal">buildGoModule</code> <code class="literal">doCheck</code> now defaults to <code class="literal">true</code>.</p></li><li class="listitem"><p>Packages built using <code class="literal">buildRustPackage</code> now use <code class="literal">release</code> mode for the <code class="literal">checkPhase</code> by default.</p><p>Please note that Rust packages utilizing a custom build/install procedure (e.g. by using a <code class="literal">Makefile</code>) or test suites that rely on the structure of the <code class="literal">target/</code> directory may break due to those assumptions. For further information, please read the Rust section in the Nixpkgs manual.</p></li><li class="listitem"><p>The cc- and binutils-wrapper’s “infix salt” and <code class="literal">_BUILD_</code> and <code class="literal">_TARGET_</code> user infixes have been replaced with with a “suffix salt” and suffixes and <code class="literal">_FOR_BUILD</code> and <code class="literal">_FOR_TARGET</code>. This matches the autotools convention for env vars which standard for these things, making interfacing with other tools easier.</p></li><li class="listitem"><p>Additional Git documentation (HTML and text files) is now available via the <code class="literal">git-doc</code> package.</p></li><li class="listitem"><p>Default algorithm for ZRAM swap was changed to <code class="literal">zstd</code>.</p></li><li class="listitem"><p>The installer now enables sshd by default. This improves installation on headless machines especially ARM single-board-computer. To login through ssh, either a password or an ssh key must be set for the root user or the nixos user.</p></li><li class="listitem"><p>The scripted networking system now uses <code class="literal">.link</code> files in <code class="literal">/etc/systemd/network</code> to configure mac address and link MTU, instead of the sometimes buggy <code class="literal">network-link-*</code> units, which have been removed. Bringing the interface up has been moved to the beginning of the <code class="literal">network-addresses-*</code> unit. Note this doesn’t require <code class="literal">systemd-networkd</code> - it’s udev that parses <code class="literal">.link</code> files. Extra care needs to be taken in the presence of <a class="link" href="https://wiki.debian.org/NetworkInterfaceNames#THE_.22PERSISTENT_NAMES.22_SCHEME"  target="_top">legacy udev rules</a> to rename interfaces, as MAC Address and MTU defined in these options can only match on the original link name. In such cases, you most likely want to create a <code class="literal">10-*.link</code> file through <a class="link" href="options.html#opt-systemd.network.links"  target="_top">systemd.network.links</a> and set both name and MAC Address / MTU there.</p></li><li class="listitem"><p>Grafana received a major update to version 7.x. A plugin is now needed for image rendering support, and plugins must now be signed by default. More information can be found <a class="link" href="https://grafana.com/docs/grafana/latest/installation/upgrading/#upgrading-to-v7-0"  target="_top">in the Grafana documentation</a>.</p></li><li class="listitem"><p>The <code class="literal">hardware.u2f</code> module, which was installing udev rules was removed, as udev gained native support to handle FIDO security tokens.</p></li><li class="listitem"><p>The <code class="literal">services.transmission</code> module was enhanced with the new options: <a class="link" href="options.html#opt-services.transmission.credentialsFile"  target="_top">services.transmission.credentialsFile</a>, <a class="link" href="options.html#opt-services.transmission.openFirewall"  target="_top">services.transmission.openFirewall</a>, and <a class="link" href="options.html#opt-services.transmission.performanceNetParameters"  target="_top">services.transmission.performanceNetParameters</a>.</p><p><code class="literal">transmission-daemon</code> is now started with additional systemd sandbox/hardening options for better security. Please <a class="link" href="https://github.com/NixOS/nixpkgs/issues"  target="_top">report</a> any use case where this is not working well. In particular, the <code class="literal">RootDirectory</code> option newly set forbids uploading or downloading a torrent outside of the default directory configured at <a class="link" href="options.html#opt-services.transmission.settings"  target="_top">settings.download-dir</a>. If you really need Transmission to access other directories, you must include those directories into the <code class="literal">BindPaths</code> of the service:</p><pre><code class="programlisting nix">{
  systemd.services.transmission.serviceConfig.BindPaths = [ &quot;/path/to/alternative/download-dir&quot; ];
}
</code></pre><p>Also, connection to the RPC (Remote Procedure Call) of <code class="literal">transmission-daemon</code> is now only available on the local network interface by default. Use:</p><pre><code class="programlisting nix">{
  services.transmission.settings.rpc-bind-address = &quot;0.0.0.0&quot;;
}
</code></pre><p>to get the previous behavior of listening on all network interfaces.</p></li><li class="listitem"><p>With this release <code class="literal">systemd-networkd</code> (when enabled through <a class="link" href="options.html#opt-networking.useNetworkd"  target="_top">networking.useNetworkd</a>) has it’s netlink socket created through a <code class="literal">systemd.socket</code> unit. This gives us control over socket buffer sizes and other parameters. For larger setups where networkd has to create a lot of (virtual) devices the default buffer size (currently 128MB) is not enough.</p><p>On a machine with &gt;100 virtual interfaces (e.g., wireguard tunnels, VLANs, …), that all have to be brought up during system startup, the receive buffer size will spike for a brief period. Eventually some of the message will be dropped since there is not enough (permitted) buffer space available.</p><p>By having <code class="literal">systemd-networkd</code> start with a netlink socket created by <code class="literal">systemd</code> we can configure the <code class="literal">ReceiveBufferSize=</code> parameter in the socket options (i.e. <code class="literal">systemd.sockets.systemd-networkd.socketOptions.ReceiveBufferSize</code>) without recompiling <code class="literal">systemd-networkd</code>.</p><p>Since the actual memory requirements depend on hardware, timing, exact configurations etc. it isn’t currently possible to infer a good default from within the NixOS module system. Administrators are advised to monitor the logs of <code class="literal">systemd-networkd</code> for <code class="literal">rtnl: kernel receive buffer overrun</code> spam and increase the memory limit as they see fit.</p><p>Note: Increasing the <code class="literal">ReceiveBufferSize=</code> doesn’t allocate any memory. It just increases the upper bound on the kernel side. The memory allocation depends on the amount of messages that are queued on the kernel side of the netlink socket.</p></li><li class="listitem"><p>Specifying <a class="link" href="options.html#opt-services.dovecot2.mailboxes"  target="_top">mailboxes</a> in the dovecot2 module as a list is deprecated and will break eval in 21.05. Instead, an attribute-set should be specified where the <code class="literal">name</code> should be the key of the attribute.</p><p>This means that a configuration like this</p><pre><code class="programlisting nix">{
  services.dovecot2.mailboxes = [
    { name = &quot;Junk&quot;;
      auto = &quot;create&quot;;
    }
  ];
}
</code></pre><p>should now look like this:</p><pre><code class="programlisting nix">{
  services.dovecot2.mailboxes = {
    Junk.auto = &quot;create&quot;;
  };
}
</code></pre></li><li class="listitem"><p>netbeans was upgraded to 12.0 and now defaults to OpenJDK 11. This might cause problems if your projects depend on packages that were removed in Java 11.</p></li><li class="listitem"><p>nextcloud has been updated to <a class="link" href="https://nextcloud.com/blog/nextcloud-hub-brings-productivity-to-home-office/"  target="_top">v19</a>.</p><p>If you have an existing installation, please make sure that you’re on nextcloud18 before upgrading to nextcloud19 since Nextcloud doesn’t support upgrades across multiple major versions.</p></li><li class="listitem"><p>The <code class="literal">nixos-run-vms</code> script now deletes the previous run machines states on test startup. You can use the <code class="literal">--keep-vm-state</code> flag to match the previous behaviour and keep the same VM state between different test runs.</p></li><li class="listitem"><p>The <a class="link" href="options.html#opt-nix.buildMachines"  target="_top">nix.buildMachines</a> option is now type-checked. There are no functional changes, however this may require updating some configurations to use correct types for all attributes.</p></li><li class="listitem"><p>The <code class="literal">fontconfig</code> module stopped generating config and cache files for fontconfig 2.10.x, the <code class="literal">/etc/fonts/fonts.conf</code> now belongs to the latest fontconfig, just like on other Linux distributions, and we will <a class="link" href="https://github.com/NixOS/nixpkgs/pull/95358"  target="_top">no longer</a> be versioning the config directories.</p><p>Fontconfig 2.10.x was removed from Nixpkgs since it hasn’t been used in any Nixpkgs package for years now.</p></li><li class="listitem"><p>Nginx module <code class="literal">nginxModules.fastcgi-cache-purge</code> renamed to official name <code class="literal">nginxModules.cache-purge</code>. Nginx module <code class="literal">nginxModules.ngx_aws_auth</code> renamed to official name <code class="literal">nginxModules.aws-auth</code>.</p></li><li class="listitem"><p>The option <code class="literal">defaultPackages</code> was added. It installs the packages perl, rsync and strace for now. They were added unconditionally to <code class="literal">systemPackages</code> before, but are not strictly necessary for a minimal NixOS install. You can set it to an empty list to have a more minimal system. Be aware that some functionality might still have an impure dependency on those packages, so things might break.</p></li><li class="listitem"><p>The <code class="literal">undervolt</code> option no longer needs to apply its settings every 30s. If they still become undone, open an issue and restore the previous behaviour using <code class="literal">undervolt.useTimer</code>.</p></li><li class="listitem"><p>Agda has been heavily reworked.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">agda.mkDerivation</code> has been heavily changed and is now located at agdaPackages.mkDerivation.</p></li><li class="listitem"><p>New top-level packages agda and <code class="literal">agda.withPackages</code> have been added, the second of which sets up agda with access to chosen libraries.</p></li><li class="listitem"><p>All agda libraries now live under <code class="literal">agdaPackages</code>.</p></li><li class="listitem"><p>Many broken libraries have been removed.</p></li></ul></div><p>See the <a class="link" href="https://nixos.org/nixpkgs/manual/#agda"  target="_top">new documentation</a> for more information.</p></li><li class="listitem"><p>The <code class="literal">deepin</code> package set has been removed from nixpkgs. It was a work in progress to package the <a class="link" href="https://www.deepin.org/en/dde/"  target="_top">Deepin Desktop Environment (DDE)</a>, including libraries, tools and applications, and it was still missing a service to launch the desktop environment. It has shown to no longer be a feasible goal due to reasons discussed in <a class="link" href="https://github.com/NixOS/nixpkgs/issues/94870"  target="_top">issue #94870</a>. The package <code class="literal">netease-cloud-music</code> has also been removed, as it depends on libraries from deepin.</p></li><li class="listitem"><p>The <code class="literal">opendkim</code> module now uses systemd sandboxing features to limit the exposure of the system towards the opendkim service.</p></li><li class="listitem"><p>Kubernetes has been upgraded to 1.19.1, which also means that the golang version to build it has been bumped to 1.15. This may have consequences for your existing clusters and their certificates. Please consider <a class="link" href="https://relnotes.k8s.io/?markdown=93264"  target="_top"> the release notes for Kubernetes 1.19 carefully </a> before upgrading.</p></li><li class="listitem"><p>For AMD GPUs, Vulkan can now be used by adding <code class="literal">amdvlk</code> to <code class="literal">hardware.opengl.extraPackages</code>.</p></li><li class="listitem"><p>Similarly, still for AMD GPUs, the ROCm OpenCL stack can now be used by adding <code class="literal">rocm-opencl-icd</code> to <code class="literal">hardware.opengl.extraPackages</code>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-20.09-contributions" class="title" >Contributions   </h3>  </div> </div></div><p>I, Jonathan Ringer, would like to thank the following individuals for their work on nixpkgs. This release could not be done without the hard work of the NixOS community. There were 31282 contributions across 1313 contributors.</p><div class="orderedlist"><ol class="orderedlist "  type="1"><li class="listitem"><p>2288 Mario Rodas</p></li><li class="listitem"><p>1837 Frederik Rietdijk</p></li><li class="listitem"><p>946 Jörg Thalheim</p></li><li class="listitem"><p>925 Maximilian Bosch</p></li><li class="listitem"><p>687 Jonathan Ringer</p></li><li class="listitem"><p>651 Jan Tojnar</p></li><li class="listitem"><p>622 Daniël de Kok</p></li><li class="listitem"><p>605 WORLDofPEACE</p></li><li class="listitem"><p>597 Florian Klink</p></li><li class="listitem"><p>528 José Romildo Malaquias</p></li><li class="listitem"><p>281 volth</p></li><li class="listitem"><p>101 Robert Scott</p></li><li class="listitem"><p>86 Tim Steinbach</p></li><li class="listitem"><p>76 WORLDofPEACE</p></li><li class="listitem"><p>49 Maximilian Bosch</p></li><li class="listitem"><p>42 Thomas Tuegel</p></li><li class="listitem"><p>37 Doron Behar</p></li><li class="listitem"><p>36 Vladimír Čunát</p></li><li class="listitem"><p>27 Jonathan Ringer</p></li><li class="listitem"><p>27 Maciej Krüger</p></li></ol></div><p>I, Jonathan Ringer, would also like to personally thank @WORLDofPEACE for their help in mentoring me on the release process. Special thanks also goes to Thomas Tuegel for helping immensely with stabilizing Qt, KDE, and Plasma5; I would also like to thank Robert Scott for his numerous fixes and pull request reviews.</p>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-20.03" class="title" style="clear: both">Release 20.03 (“Markhor”, 2020.04/20)   </h2>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-20.03-highlights" class="title" >Highlights   </h3>  </div> </div></div><p>In addition to numerous new and upgraded packages, this release has the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Support is planned until the end of October 2020, handing over to 20.09.</p></li><li class="listitem"><p>Core version changes:</p><p>gcc: 8.3.0 -&gt; 9.2.0</p><p>glibc: 2.27 -&gt; 2.30</p><p>linux: 4.19 -&gt; 5.4</p><p>mesa: 19.1.5 -&gt; 19.3.3</p><p>openssl: 1.0.2u -&gt; 1.1.1d</p></li><li class="listitem"><p>Desktop version changes:</p><p>plasma5: 5.16.5 -&gt; 5.17.5</p><p>kdeApplications: 19.08.2 -&gt; 19.12.3</p><p>gnome3: 3.32 -&gt; 3.34</p><p>pantheon: 5.0 -&gt; 5.1.3</p></li><li class="listitem"><p>Linux kernel is updated to branch 5.4 by default (from 4.19).</p></li><li class="listitem"><p>Grub is updated to 2.04, adding support for booting from F2FS filesystems and Btrfs volumes using zstd compression. Note that some users have been unable to boot after upgrading to 2.04 - for more information, please see <a class="link" href="https://github.com/NixOS/nixpkgs/issues/61718#issuecomment-617618503"  target="_top">this discussion</a>.</p></li><li class="listitem"><p>Postgresql for NixOS service now defaults to v11.</p></li><li class="listitem"><p>The graphical installer image starts the graphical session automatically. Before you’d be greeted by a tty and asked to enter <code class="literal">systemctl start display-manager</code>. It is now possible to disable the display-manager from running by selecting the <code class="literal">Disable display-manager</code> quirk in the boot menu.</p></li><li class="listitem"><p>GNOME 3 has been upgraded to 3.34. Please take a look at their <a class="link" href="https://help.gnome.org/misc/release-notes/3.34"  target="_top">Release Notes</a> for details.</p></li><li class="listitem"><p>If you enable the Pantheon Desktop Manager via <a class="link" href="options.html#opt-services.xserver.desktopManager.pantheon.enable"  target="_top">services.xserver.desktopManager.pantheon.enable</a>, we now default to also use <a class="link" href="https://blog.elementary.io/say-hello-to-the-new-greeter/"  target="_top"> Pantheon’s newly designed greeter </a>. Contrary to NixOS’s usual update policy, Pantheon will receive updates during the cycle of NixOS 20.03 when backwards compatible.</p></li><li class="listitem"><p>By default zfs pools will now be trimmed on a weekly basis. Trimming is only done on supported devices (i.e. NVME or SSDs) and should improve throughput and lifetime of these devices. It is controlled by the <code class="literal">services.zfs.trim.enable</code> varname. The zfs scrub service (<code class="literal">services.zfs.autoScrub.enable</code>) and the zfs autosnapshot service (<code class="literal">services.zfs.autoSnapshot.enable</code>) are now only enabled if zfs is set in <code class="literal">config.boot.initrd.supportedFilesystems</code> or <code class="literal">config.boot.supportedFilesystems</code>. These lists will automatically contain zfs as soon as any zfs mountpoint is configured in <code class="literal">fileSystems</code>.</p></li><li class="listitem"><p><code class="literal">nixos-option</code> has been rewritten in C++, speeding it up, improving correctness, and adding a <code class="literal">-r</code> option which prints all options and their values recursively.</p></li><li class="listitem"><p><code class="literal">services.xserver.desktopManager.default</code> and <code class="literal">services.xserver.windowManager.default</code> options were replaced by a single <a class="link" href="options.html#opt-services.xserver.displayManager.defaultSession"  target="_top">services.xserver.displayManager.defaultSession</a> option to improve support for upstream session files. If you used something like:</p><pre><code class="programlisting nix">{
  services.xserver.desktopManager.default = &quot;xfce&quot;;
  services.xserver.windowManager.default = &quot;icewm&quot;;
}
</code></pre><p>you should change it to:</p><pre><code class="programlisting nix">{
  services.xserver.displayManager.defaultSession = &quot;xfce+icewm&quot;;
}
</code></pre></li><li class="listitem"><p>The testing driver implementation in NixOS is now in Python <code class="literal">make-test-python.nix</code>. This was done by Jacek Galowicz (<a class="link" href="https://github.com/tfc"  target="_top">@tfc</a>), and with the collaboration of Julian Stecklina (<a class="link" href="https://github.com/blitz"  target="_top">@blitz</a>) and Jana Traue (<a class="link" href="https://github.com/jtraue"  target="_top">@jtraue</a>). All documentation has been updated to use this testing driver, and a vast majority of the 286 tests in NixOS were ported to python driver. In 20.09 the Perl driver implementation, <code class="literal">make-test.nix</code>, is slated for removal. This should give users of the NixOS integration framework a transitory period to rewrite their tests to use the Python implementation. Users of the Perl driver will see this warning everytime they use it:</p><pre><code class="programlisting ShellSession">$ warning: Perl VM tests are deprecated and will be removed for 20.09.
Please update your tests to use the python test driver.
See https://github.com/NixOS/nixpkgs/pull/71684 for details.
</code></pre><p>API compatibility is planned to be kept for at least the next release with the perl driver.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-20.03-new-services" class="title" >New Services   </h3>  </div> </div></div><p>The following new services were added since the last release:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The kubernetes kube-proxy now supports a new hostname configuration <code class="literal">services.kubernetes.proxy.hostname</code> which has to be set if the hostname of the node should be non default.</p></li><li class="listitem"><p>UPower’s configuration is now managed by NixOS and can be customized via <code class="literal">services.upower</code>.</p></li><li class="listitem"><p>To use Geary you should enable <a class="link" href="options.html#opt-programs.geary.enable"  target="_top">programs.geary.enable</a> instead of just adding it to <a class="link" href="options.html#opt-environment.systemPackages"  target="_top">environment.systemPackages</a>. It was created so Geary could function properly outside of GNOME.</p></li><li class="listitem"><p><code class="literal">./config/console.nix</code></p></li><li class="listitem"><p><code class="literal">./hardware/brillo.nix</code></p></li><li class="listitem"><p><code class="literal">./hardware/tuxedo-keyboard.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/bandwhich.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/bash-my-aws.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/liboping.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/traceroute.nix</code></p></li><li class="listitem"><p><code class="literal">./services/backup/sanoid.nix</code></p></li><li class="listitem"><p><code class="literal">./services/backup/syncoid.nix</code></p></li><li class="listitem"><p><code class="literal">./services/backup/zfs-replication.nix</code></p></li><li class="listitem"><p><code class="literal">./services/continuous-integration/buildkite-agents.nix</code></p></li><li class="listitem"><p><code class="literal">./services/databases/victoriametrics.nix</code></p></li><li class="listitem"><p><code class="literal">./services/desktops/gnome3/gnome-initial-setup.nix</code></p></li><li class="listitem"><p><code class="literal">./services/desktops/neard.nix</code></p></li><li class="listitem"><p><code class="literal">./services/games/openarena.nix</code></p></li><li class="listitem"><p><code class="literal">./services/hardware/fancontrol.nix</code></p></li><li class="listitem"><p><code class="literal">./services/mail/sympa.nix</code></p></li><li class="listitem"><p><code class="literal">./services/misc/freeswitch.nix</code></p></li><li class="listitem"><p><code class="literal">./services/misc/mame.nix</code></p></li><li class="listitem"><p><code class="literal">./services/monitoring/do-agent.nix</code></p></li><li class="listitem"><p><code class="literal">./services/monitoring/prometheus/xmpp-alerts.nix</code></p></li><li class="listitem"><p><code class="literal">./services/network-filesystems/orangefs/server.nix</code></p></li><li class="listitem"><p><code class="literal">./services/network-filesystems/orangefs/client.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/3proxy.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/corerad.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/go-shadowsocks2.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/ntp/openntpd.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/shorewall.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/shorewall6.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/spacecookie.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/trickster.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/v2ray.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/xandikos.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/yggdrasil.nix</code></p></li><li class="listitem"><p><code class="literal">./services/web-apps/dokuwiki.nix</code></p></li><li class="listitem"><p><code class="literal">./services/web-apps/gotify-server.nix</code></p></li><li class="listitem"><p><code class="literal">./services/web-apps/grocy.nix</code></p></li><li class="listitem"><p><code class="literal">./services/web-apps/ihatemoney</code></p></li><li class="listitem"><p><code class="literal">./services/web-apps/moinmoin.nix</code></p></li><li class="listitem"><p><code class="literal">./services/web-apps/trac.nix</code></p></li><li class="listitem"><p><code class="literal">./services/web-apps/trilium.nix</code></p></li><li class="listitem"><p><code class="literal">./services/web-apps/shiori.nix</code></p></li><li class="listitem"><p><code class="literal">./services/web-servers/ttyd.nix</code></p></li><li class="listitem"><p><code class="literal">./services/x11/picom.nix</code></p></li><li class="listitem"><p><code class="literal">./services/x11/hardware/digimend.nix</code></p></li><li class="listitem"><p><code class="literal">./services/x11/imwheel.nix</code></p></li><li class="listitem"><p><code class="literal">./virtualisation/cri-o.nix</code></p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-20.03-incompatibilities" class="title" >Backward Incompatibilities   </h3>  </div> </div></div><p>When upgrading from a previous release, please be aware of the following incompatible changes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The dhcpcd package <a class="link" href="https://roy.marples.name/archives/dhcpcd-discuss/0002621.html"  target="_top"> does not request IPv4 addresses for tap and bridge interfaces anymore by default</a>. In order to still get an address on a bridge interface, one has to disable <code class="literal">networking.useDHCP</code> and explicitly enable <code class="literal">networking.interfaces.&lt;name&gt;.useDHCP</code> on every interface, that should get an address via DHCP. This way, dhcpcd is configured in an explicit way about which interface to run on.</p></li><li class="listitem"><p>GnuPG is now built without support for a graphical passphrase entry by default. Please enable the <code class="literal">gpg-agent</code> user service via the NixOS option <code class="literal">programs.gnupg.agent.enable</code>. Note that upstream recommends using <code class="literal">gpg-agent</code> and will spawn a <code class="literal">gpg-agent</code> on the first invocation of GnuPG anyway.</p></li><li class="listitem"><p>The <code class="literal">dynamicHosts</code> option has been removed from the <a class="link" href="options.html#opt-networking.networkmanager.enable"  target="_top">NetworkManager</a> module. Allowing (multiple) regular users to override host entries affecting the whole system opens up a huge attack vector. There seem to be very rare cases where this might be useful. Consider setting system-wide host entries using <a class="link" href="options.html#opt-networking.hosts"  target="_top">networking.hosts</a>, provide them via the DNS server in your network, or use <a class="link" href="options.html#opt-environment.etc"  target="_top">environment.etc</a> to add a file into <code class="literal">/etc/NetworkManager/dnsmasq.d</code> reconfiguring <code class="literal">hostsdir</code>.</p></li><li class="listitem"><p>The <code class="literal">99-main.network</code> file was removed. Matching all network interfaces caused many breakages, see <a class="link" href="https://github.com/NixOS/nixpkgs/pull/18962"  target="_top">#18962</a> and <a class="link" href="https://github.com/NixOS/nixpkgs/pull/71106"  target="_top">#71106</a>.</p><p>We already don’t support the global <a class="link" href="options.html#opt-networking.useDHCP"  target="_top">networking.useDHCP</a>, <a class="link" href="options.html#opt-networking.defaultGateway"  target="_top">networking.defaultGateway</a> and <a class="link" href="options.html#opt-networking.defaultGateway6"  target="_top">networking.defaultGateway6</a> options if <a class="link" href="options.html#opt-networking.useNetworkd"  target="_top">networking.useNetworkd</a> is enabled, but direct users to configure the per-device <a class="link" href="options.html#opt-networking.interfaces"  target="_top">networking.interfaces.&lt;name&gt;…</a> options.</p></li><li class="listitem"><p>The stdenv now runs all bash with <code class="literal">set -u</code>, to catch the use of undefined variables. Before, it itself used <code class="literal">set -u</code> but was careful to unset it so other packages’ code ran as before. Now, all bash code is held to the same high standard, and the rather complex stateful manipulation of the options can be discarded.</p></li><li class="listitem"><p>The SLIM Display Manager has been removed, as it has been unmaintained since 2013. Consider migrating to a different display manager such as LightDM (current default in NixOS), SDDM, GDM, or using the startx module which uses Xinitrc.</p></li><li class="listitem"><p>The Way Cooler wayland compositor has been removed, as the project has been officially canceled. There are no more <code class="literal">way-cooler</code> attribute and <code class="literal">programs.way-cooler</code> options.</p></li><li class="listitem"><p>The BEAM package set has been deleted. You will only find there the different interpreters. You should now use the different build tools coming with the languages with sandbox mode disabled.</p></li><li class="listitem"><p>There is now only one Xfce package-set and module. This means that attributes <code class="literal">xfce4-14</code> and <code class="literal">xfceUnstable</code> all now point to the latest Xfce 4.14 packages. And in the future NixOS releases will be the latest released version of Xfce available at the time of the release’s development (if viable).</p></li><li class="listitem"><p>The <a class="link" href="options.html#opt-services.phpfpm.pools"  target="_top">phpfpm</a> module now sets <code class="literal">PrivateTmp=true</code> in its systemd units for better process isolation. If you rely on <code class="literal">/tmp</code> being shared with other services, explicitly override this by setting <code class="literal">serviceConfig.PrivateTmp</code> to <code class="literal">false</code> for each phpfpm unit.</p></li><li class="listitem"><p>KDE’s old multimedia framework Phonon no longer supports Qt 4. For that reason, Plasma desktop also does not have <code class="literal">enableQt4Support</code> option any more.</p></li><li class="listitem"><p>The BeeGFS module has been removed.</p></li><li class="listitem"><p>The osquery module has been removed.</p></li><li class="listitem"><p>Going forward, <code class="literal">~/bin</code> in the users home directory will no longer be in <code class="literal">PATH</code> by default. If you depend on this you should set the option <code class="literal">environment.homeBinInPath</code> to <code class="literal">true</code>. The aforementioned option was added this release.</p></li><li class="listitem"><p>The <code class="literal">buildRustCrate</code> infrastructure now produces <code class="literal">lib</code> outputs in addition to the <code class="literal">out</code> output. This has led to drastically reduced closure sizes for some rust crates since development dependencies are now in the <code class="literal">lib</code> output.</p></li><li class="listitem"><p>Pango was upgraded to 1.44, which no longer uses freetype for font loading. This means that type1 and bitmap fonts are no longer supported in applications relying on Pango for font rendering (notably, GTK application). See <a class="link" href="https://gitlab.gnome.org/GNOME/pango/issues/386"  target="_top"> upstream issue</a> for more information.</p></li><li class="listitem"><p>The <code class="literal">roundcube</code> module has been hardened.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>The password of the database is not written world readable in the store any more. If <code class="literal">database.host</code> is set to <code class="literal">localhost</code>, then a unix user of the same name as the database will be created and PostreSQL peer authentication will be used, removing the need for a password. Otherwise, a password is still needed and can be provided with the new option <code class="literal">database.passwordFile</code>, which should be set to the path of a file containing the password and readable by the user <code class="literal">nginx</code> only. The <code class="literal">database.password</code> option is insecure and deprecated. Usage of this option will print a warning.</p></li><li class="listitem"><p>A random <code class="literal">des_key</code> is set by default in the configuration of roundcube, instead of using the hardcoded and insecure default. To ensure a clean migration, all users will be logged out when you upgrade to this release.</p></li></ul></div></li><li class="listitem"><p>The packages <code class="literal">openobex</code> and <code class="literal">obexftp</code> are no longer installed when enabling Bluetooth via <code class="literal">hardware.bluetooth.enable</code>.</p></li><li class="listitem"><p>The <code class="literal">dump1090</code> derivation has been changed to use FlightAware’s dump1090 as its upstream. However, this version does not have an internal webserver anymore. The assets in the <code class="literal">share/dump1090</code> directory of the derivation can be used in conjunction with an external webserver to replace this functionality.</p></li><li class="listitem"><p>The fourStore and fourStoreEndpoint modules have been removed.</p></li><li class="listitem"><p>Polkit no longer has the user of uid 0 (root) as an admin identity. We now follow the upstream default of only having every member of the wheel group admin privileged. Before it was root and members of wheel. The positive outcome of this is pkexec GUI popups or terminal prompts will no longer require the user to choose between two essentially equivalent choices (whether to perform the action as themselves with wheel permissions, or as the root user).</p></li><li class="listitem"><p>NixOS containers no longer build NixOS manual by default. This saves evaluation time, especially if there are many declarative containers defined. Note that this is already done when <code class="literal">&lt;nixos/modules/profiles/minimal.nix&gt;</code> module is included in container config.</p></li><li class="listitem"><p>The <code class="literal">kresd</code> services deprecates the <code class="literal">interfaces</code> option in favor of the <code class="literal">listenPlain</code> option which requires full <a class="link" href="https://www.freedesktop.org/software/systemd/man/systemd.socket.html#ListenStream="  target="_top">systemd.socket compatible</a> declaration which always include a port.</p></li><li class="listitem"><p>Virtual console options have been reorganized and can be found under a single top-level attribute: <code class="literal">console</code>. The full set of changes is as follows:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">i18n.consoleFont</code> renamed to <a class="link" href="options.html#opt-console.font"  target="_top">console.font</a></p></li><li class="listitem"><p><code class="literal">i18n.consoleKeyMap</code> renamed to <a class="link" href="options.html#opt-console.keyMap"  target="_top">console.keyMap</a></p></li><li class="listitem"><p><code class="literal">i18n.consoleColors</code> renamed to <a class="link" href="options.html#opt-console.colors"  target="_top">console.colors</a></p></li><li class="listitem"><p><code class="literal">i18n.consolePackages</code> renamed to <a class="link" href="options.html#opt-console.packages"  target="_top">console.packages</a></p></li><li class="listitem"><p><code class="literal">i18n.consoleUseXkbConfig</code> renamed to <a class="link" href="options.html#opt-console.useXkbConfig"  target="_top">console.useXkbConfig</a></p></li><li class="listitem"><p><code class="literal">boot.earlyVconsoleSetup</code> renamed to <a class="link" href="options.html#opt-console.earlySetup"  target="_top">console.earlySetup</a></p></li><li class="listitem"><p><code class="literal">boot.extraTTYs</code> renamed to <code class="literal">console.extraTTYs</code>.</p></li></ul></div></li><li class="listitem"><p>The <a class="link" href="options.html#opt-services.awstats.enable"  target="_top">awstats</a> module has been rewritten to serve stats via static html pages, updated on a timer, over <a class="link" href="options.html#opt-services.nginx.virtualHosts"  target="_top">nginx</a>, instead of dynamic cgi pages over <a class="link" href="options.html#opt-services.httpd.enable"  target="_top">apache</a>.</p><p>Minor changes will be required to migrate existing configurations. Details of the required changes can seen by looking through the <a class="link" href="options.html#opt-services.awstats.enable"  target="_top">awstats</a> module.</p></li><li class="listitem"><p>The httpd module no longer provides options to support serving web content without defining a virtual host. As a result of this the <a class="link" href="options.html#opt-services.httpd.logPerVirtualHost"  target="_top">services.httpd.logPerVirtualHost</a> option now defaults to <code class="literal">true</code> instead of <code class="literal">false</code>. Please update your configuration to make use of <a class="link" href="options.html#opt-services.httpd.virtualHosts"  target="_top">services.httpd.virtualHosts</a>.</p><p>The <a class="link" href="options.html#opt-services.httpd.virtualHosts"  target="_top">services.httpd.virtualHosts.&lt;name&gt;</a> option has changed type from a list of submodules to an attribute set of submodules, better matching <a class="link" href="options.html#opt-services.nginx.virtualHosts"  target="_top">services.nginx.virtualHosts.&lt;name&gt;</a>.</p><p>This change comes with the addition of the following options which mimic the functionality of their <code class="literal">nginx</code> counterparts: <a class="link" href="options.html#opt-services.httpd.virtualHosts"  target="_top">services.httpd.virtualHosts.&lt;name&gt;.addSSL</a>, <a class="link" href="options.html#opt-services.httpd.virtualHosts"  target="_top">services.httpd.virtualHosts.&lt;name&gt;.forceSSL</a>, <a class="link" href="options.html#opt-services.httpd.virtualHosts"  target="_top">services.httpd.virtualHosts.&lt;name&gt;.onlySSL</a>, <a class="link" href="options.html#opt-services.httpd.virtualHosts"  target="_top">services.httpd.virtualHosts.&lt;name&gt;.enableACME</a>, <a class="link" href="options.html#opt-services.httpd.virtualHosts"  target="_top">services.httpd.virtualHosts.&lt;name&gt;.acmeRoot</a>, and <a class="link" href="options.html#opt-services.httpd.virtualHosts"  target="_top">services.httpd.virtualHosts.&lt;name&gt;.useACMEHost</a>.</p></li><li class="listitem"><p>For NixOS configuration options, the <code class="literal">loaOf</code> type has been deprecated and will be removed in a future release. In nixpkgs, options of this type will be changed to <code class="literal">attrsOf</code> instead. If you were using one of these in your configuration, you will see a warning suggesting what changes will be required.</p><p>For example, <a class="link" href="options.html#opt-users.users"  target="_top">users.users</a> is a <code class="literal">loaOf</code> option that is commonly used as follows:</p><pre><code class="programlisting nix">{
  users.users =
    [ { name = &quot;me&quot;;
        description = &quot;My personal user.&quot;;
        isNormalUser = true;
      }
    ];
}
</code></pre><p>This should be rewritten by removing the list and using the value of <code class="literal">name</code> as the name of the attribute set:</p><pre><code class="programlisting nix">{
  users.users.me =
    { description = &quot;My personal user.&quot;;
      isNormalUser = true;
    };
}
</code></pre><p>For more information on this change have look at these links: <a class="link" href="https://github.com/NixOS/nixpkgs/issues/1800"  target="_top">issue #1800</a>, <a class="link" href="https://github.com/NixOS/nixpkgs/pull/63103"  target="_top">PR #63103</a>.</p></li><li class="listitem"><p>For NixOS modules, the types <code class="literal">types.submodule</code> and <code class="literal">types.submoduleWith</code> now support paths as allowed values, similar to how <code class="literal">imports</code> supports paths. Because of this, if you have a module that defines an option of type <code class="literal">either (submodule ...) path</code>, it will break since a path is now treated as the first type instead of the second. To fix this, change the type to <code class="literal">either path (submodule ...)</code>.</p></li><li class="listitem"><p>The <a class="link" href="options.html#opt-services.buildkite-agents"  target="_top">Buildkite Agent</a> module and corresponding packages have been updated to 3.x, and to support multiple instances of the agent running at the same time. This means you will have to rename <code class="literal">services.buildkite-agent</code> to <code class="literal">services.buildkite-agents.&lt;name&gt;</code>. Furthermore, the following options have been changed:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">services.buildkite-agent.meta-data</code> has been renamed to <a class="link" href="options.html#opt-services.buildkite-agents"  target="_top">services.buildkite-agents.&lt;name&gt;.tags</a>, to match upstreams naming for 3.x. Its type has also changed - it now accepts an attrset of strings.</p></li><li class="listitem"><p>The<code class="literal">services.buildkite-agent.openssh.publicKeyPath</code> option has been removed, as it’s not necessary to deploy public keys to clone private repositories.</p></li><li class="listitem"><p><code class="literal">services.buildkite-agent.openssh.privateKeyPath</code> has been renamed to <a class="link" href="options.html#opt-services.buildkite-agents"  target="_top">buildkite-agents.&lt;name&gt;.privateSshKeyPath</a>, as the whole <code class="literal">openssh</code> now only contained that single option.</p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.buildkite-agents"  target="_top">services.buildkite-agents.&lt;name&gt;.shell</a> has been introduced, allowing to specify a custom shell to be used.</p></li></ul></div></li><li class="listitem"><p>The <code class="literal">citrix_workspace_19_3_0</code> package has been removed as it will be EOLed within the lifespan of 20.03. For further information, please refer to the <a class="link" href="https://www.citrix.com/de-de/support/product-lifecycle/milestones/receiver.html"  target="_top">support and maintenance information</a> from upstream.</p></li><li class="listitem"><p>The <code class="literal">gcc5</code> and <code class="literal">gfortran5</code> packages have been removed.</p></li><li class="listitem"><p>The <code class="literal">services.xserver.displayManager.auto</code> module has been removed. It was only intended for use in internal NixOS tests, and gave the false impression of it being a special display manager when it’s actually LightDM. Please use the <code class="literal">services.xserver.displayManager.lightdm.autoLogin</code> options instead, or any other display manager in NixOS as they all support auto-login. If you used this module specifically because it permitted root auto-login you can override the lightdm-autologin pam module like:</p><pre><code class="programlisting nix">{
  security.pam.services.lightdm-autologin.text = lib.mkForce &#x27;&#x27;
      auth     requisite pam_nologin.so
      auth     required  pam_succeed_if.so quiet
      auth     required  pam_permit.so

      account  include   lightdm

      password include   lightdm

      session  include   lightdm
  &#x27;&#x27;;
}
</code></pre><p>The difference is the:</p><pre><code class="programlisting">auth required pam_succeed_if.so quiet
</code></pre><p>line, where default it’s:</p><pre><code class="programlisting"> auth required pam_succeed_if.so uid &gt;= 1000 quiet
</code></pre><p>not permitting users with uid’s below 1000 (like root). All other display managers in NixOS are configured like this.</p></li><li class="listitem"><p>There have been lots of improvements to the Mailman module. As a result,</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>The <code class="literal">services.mailman.hyperkittyBaseUrl</code> option has been renamed to <a class="link" href="options.html#opt-services.mailman.hyperkitty.baseUrl"  target="_top">services.mailman.hyperkitty.baseUrl</a>.</p></li><li class="listitem"><p>The <code class="literal">services.mailman.hyperkittyApiKey</code> option has been removed. This is because having an option for the Hyperkitty API key meant that the API key would be stored in the world-readable Nix store, which was a security vulnerability. A new Hyperkitty API key will be generated the first time the new Hyperkitty service is run, and it will then be persisted outside of the Nix store. To continue using Hyperkitty, you must set <a class="link" href="options.html#opt-services.mailman.hyperkitty.enable"  target="_top">services.mailman.hyperkitty.enable</a> to <code class="literal">true</code>.</p></li><li class="listitem"><p>Additionally, some Postfix configuration must now be set manually instead of automatically by the Mailman module:</p><pre><code class="programlisting nix">{
  services.postfix.relayDomains = [ &quot;hash:/var/lib/mailman/data/postfix_domains&quot; ];
  services.postfix.config.transport_maps = [ &quot;hash:/var/lib/mailman/data/postfix_lmtp&quot; ];
  services.postfix.config.local_recipient_maps = [ &quot;hash:/var/lib/mailman/data/postfix_lmtp&quot; ];
}
</code></pre><p>This is because some users may want to include other values in these lists as well, and this was not possible if they were set automatically by the Mailman module. It would not have been possible to just concatenate values from multiple modules each setting the values they needed, because the order of elements in the list is significant.</p></li></ul></div></li><li class="listitem"><p>The LLVM versions 3.5, 3.9 and 4 (including the corresponding CLang versions) have been dropped.</p></li><li class="listitem"><p>The <code class="literal">networking.interfaces.*.preferTempAddress</code> option has been replaced by <code class="literal">networking.interfaces.*.tempAddress</code>. The new option allows better control of the IPv6 temporary addresses, including completely disabling them for interfaces where they are not needed.</p></li><li class="listitem"><p>Rspamd was updated to version 2.2. Read <a class="link" href="https://rspamd.com/doc/migration.html#migration-to-rspamd-20"  target="_top"> the upstream migration notes</a> carefully. Please be especially aware that some modules were removed and the default Bayes backend is now Redis.</p></li><li class="listitem"><p>The <code class="literal">*psu</code> versions of oraclejdk8 have been removed as they aren’t provided by upstream anymore.</p></li><li class="listitem"><p>The <code class="literal">services.dnscrypt-proxy</code> module has been removed as it used the deprecated version of dnscrypt-proxy. We’ve added <a class="link" href="options.html#opt-services.dnscrypt-proxy2.enable"  target="_top">services.dnscrypt-proxy2.enable</a> to use the supported version. This module supports configuration via the Nix attribute set <a class="link" href="options.html#opt-services.dnscrypt-proxy2.settings"  target="_top">services.dnscrypt-proxy2.settings</a>, or by passing a TOML configuration file via <a class="link" href="options.html#opt-services.dnscrypt-proxy2.configFile"  target="_top">services.dnscrypt-proxy2.configFile</a>.</p><pre><code class="programlisting nix">{
  # Example configuration:
  services.dnscrypt-proxy2.enable = true;
  services.dnscrypt-proxy2.settings = {
    listen_addresses = [ &quot;127.0.0.1:43&quot; ];
    sources.public-resolvers = {
      urls = [ &quot;https://download.dnscrypt.info/resolvers-list/v2/public-resolvers.md&quot; ];
      cache_file = &quot;public-resolvers.md&quot;;
      minisign_key = &quot;RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3&quot;;
      refresh_delay = 72;
    };
  };

  services.dnsmasq.enable = true;
  services.dnsmasq.servers = [ &quot;127.0.0.1#43&quot; ];
}
</code></pre></li><li class="listitem"><p><code class="literal">qesteidutil</code> has been deprecated in favor of <code class="literal">qdigidoc</code>.</p></li><li class="listitem"><p>sqldeveloper_18 has been removed as it’s not maintained anymore, sqldeveloper has been updated to version <code class="literal">19.4</code>. Please note that this means that this means that the oraclejdk is now required. For further information please read the <a class="link" href="https://www.oracle.com/technetwork/developer-tools/sql-developer/downloads/sqldev-relnotes-194-5908846.html"  target="_top">release notes</a>.</p></li><li class="listitem"><p>Haskell <code class="literal">env</code> and <code class="literal">shellFor</code> dev shell environments now organize dependencies the same way as regular builds. In particular, rather than receiving all the different lists of dependencies mashed together as one big list, and then partitioning into Haskell and non-Hakell dependencies, they work from the original many different dependency parameters and don’t need to algorithmically partition anything.</p><p>This means that if you incorrectly categorize a dependency, e.g. non-Haskell library dependency as a <code class="literal">buildDepends</code> or run-time Haskell dependency as a <code class="literal">setupDepends</code>, whereas things would have worked before they may not work now.</p></li><li class="listitem"><p>The gcc-snapshot-package has been removed. It’s marked as broken for &gt;2 years and used to point to a fairly old snapshot from the gcc7-branch.</p></li><li class="listitem"><p>The nixos-build-vms8 -script now uses the python test-driver.</p></li><li class="listitem"><p>The riot-web package now accepts configuration overrides as an attribute set instead of a string. A formerly used JSON configuration can be converted to an attribute set with <code class="literal">builtins.fromJSON</code>.</p><p>The new default configuration also disables automatic guest account registration and analytics to improve privacy. The previous behavior can be restored by setting <code class="literal">config.riot-web.conf = { disable_guests = false; piwik = true; }</code>.</p></li><li class="listitem"><p>Stand-alone usage of <code class="literal">Upower</code> now requires <code class="literal">services.upower.enable</code> instead of just installing into <a class="link" href="options.html#opt-environment.systemPackages"  target="_top">environment.systemPackages</a>.</p></li><li class="listitem"><p>nextcloud has been updated to <code class="literal">v18.0.2</code>. This means that users from NixOS 19.09 can’t upgrade directly since you can only move one version forward and 19.09 uses <code class="literal">v16.0.8</code>.</p><p>To provide a safe upgrade-path and to circumvent similar issues in the future, the following measures were taken:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>The pkgs.nextcloud-attribute has been removed and replaced with versioned attributes (currently pkgs.nextcloud17 and pkgs.nextcloud18). With this change major-releases can be backported without breaking stuff and to make upgrade-paths easier.</p></li><li class="listitem"><p>Existing setups will be detected using <a class="link" href="options.html#opt-system.stateVersion"  target="_top">system.stateVersion</a>: by default, nextcloud17 will be used, but will raise a warning which notes that after that deploy it’s recommended to update to the latest stable version (nextcloud18) by declaring the newly introduced setting <a class="link" href="options.html#opt-services.nextcloud.package"  target="_top">services.nextcloud.package</a>.</p></li><li class="listitem"><p>Users with an overlay (e.g. to use nextcloud at version <code class="literal">v18</code> on <code class="literal">19.09</code>) will get an evaluation error by default. This is done to ensure that our <a class="link" href="options.html#opt-services.nextcloud.package"  target="_top">package</a>-option doesn’t select an older version by accident. It’s recommended to use pkgs.nextcloud18 or to set <a class="link" href="options.html#opt-services.nextcloud.package"  target="_top">package</a> to pkgs.nextcloud explicitly.</p></li></ul></div><div class="warning"><h3 class="title">Warning</h3><p>Please note that if you’re coming from <code class="literal">19.03</code> or older, you have to manually upgrade to <code class="literal">19.09</code> first to upgrade your server to Nextcloud v16.</p></div></li><li class="listitem"><p>Hydra has gained a massive performance improvement due to <a class="link" href="https://github.com/NixOS/hydra/pull/710"  target="_top">some database schema changes</a> by adding several IDs and better indexing. However, it’s necessary to upgrade Hydra in multiple steps:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>At first, an older version of Hydra needs to be deployed which adds those (nullable) columns. When having set <a class="link" href="options.html#opt-system.stateVersion"  target="_top">stateVersion </a> to a value older than <code class="literal">20.03</code>, this package will be selected by default from the module when upgrading. Otherwise, the package can be deployed using the following config:</p><pre><code class="programlisting nix">{ pkgs, ... }: {
  services.hydra.package = pkgs.hydra-migration;
}
</code></pre></li></ul></div></li><li class="listitem"><p>Automatically fill the newly added ID columns on the server by running the following command:</p><pre><code class="programlisting ShellSession">$ hydra-backfill-ids
</code></pre><div class="warning"><h3 class="title">Warning</h3><p>Please note that this process can take a while depending on your database-size!</p></div></li><li class="listitem"><p>Deploy a newer version of Hydra to activate the DB optimizations. This can be done by using hydra-unstable. This package already includes <a class="link" href="https://github.com/nixos/rfcs/pull/49"  target="_top">flake-support</a> and is therefore compiled against pkgs.nixFlakes.</p><div class="warning"><h3 class="title">Warning</h3><p>If your <a class="link" href="options.html#opt-system.stateVersion"  target="_top">stateVersion</a> is set to <code class="literal">20.03</code> or greater, hydra-unstable will be used automatically! This will break your setup if you didn’t run the migration.</p></div><p>Please note that Hydra is currently not available with nixStable as this doesn’t compile anymore.</p><div class="warning"><h3 class="title">Warning</h3><p>pkgs.hydra has been removed to ensure a graceful database-migration using the dedicated package-attributes. If you still have pkgs.hydra defined in e.g. an overlay, an assertion error will be thrown. To circumvent this, you need to set <a class="link" href="options.html#opt-services.hydra.package"  target="_top">services.hydra.package</a> to pkgs.hydra explicitly and make sure you know what you’re doing!</p></div></li><li class="listitem"><p>The TokuDB storage engine will be disabled in mariadb 10.5. It is recommended to switch to RocksDB. See also <a class="link" href="https://mariadb.com/kb/en/tokudb/"  target="_top">TokuDB</a>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-20.03-notable-changes" class="title" >Other Notable Changes   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>SD images are now compressed by default using <code class="literal">bzip2</code>.</p></li><li class="listitem"><p>The nginx web server previously started its master process as root privileged, then ran worker processes as a less privileged identity user (the <code class="literal">nginx</code> user). This was changed to start all of nginx as a less privileged user (defined by <code class="literal">services.nginx.user</code> and <code class="literal">services.nginx.group</code>). As a consequence, all files that are needed for nginx to run (included configuration fragments, SSL certificates and keys, etc.) must now be readable by this less privileged user/group.</p><p>To continue to use the old approach, you can configure:</p><pre><code class="programlisting nix">{
  services.nginx.appendConfig = let cfg = config.services.nginx; in &#x27;&#x27;user ${cfg.user} ${cfg.group};&#x27;&#x27;;
  systemd.services.nginx.serviceConfig.User = lib.mkForce &quot;root&quot;;
}
</code></pre></li><li class="listitem"><p>OpenSSH has been upgraded from 7.9 to 8.1, improving security and adding features but with potential incompatibilities. Consult the <a class="link" href="https://www.openssh.com/txt/release-8.1"  target="_top"> release announcement</a> for more information.</p></li><li class="listitem"><p><code class="literal">PRETTY_NAME</code> in <code class="literal">/etc/os-release</code> now uses the short rather than full version string.</p></li><li class="listitem"><p>The ACME module has switched from simp-le to <a class="link" href="https://github.com/go-acme/lego"  target="_top">lego</a> which allows us to support DNS-01 challenges and wildcard certificates. The following options have been added: <a class="link" href="options.html#opt-security.acme.acceptTerms"  target="_top">security.acme.acceptTerms</a>, <a class="link" href="options.html#opt-security.acme.certs"  target="_top">security.acme.certs.&lt;name&gt;.dnsProvider</a>, <a class="link" href="options.html#opt-security.acme.certs"  target="_top">security.acme.certs.&lt;name&gt;.credentialsFile</a>, <a class="link" href="options.html#opt-security.acme.certs"  target="_top">security.acme.certs.&lt;name&gt;.dnsPropagationCheck</a>. As well as this, the options <code class="literal">security.acme.acceptTerms</code> and either <code class="literal">security.acme.email</code> or <code class="literal">security.acme.certs.&lt;name&gt;.email</code> must be set in order to use the ACME module. Certificates will be regenerated on activation, no account or certificate will be migrated from simp-le. In particular private keys will not be preserved. However, the credentials for simp-le are preserved and thus it is possible to roll back to previous versions without breaking certificate generation. Note also that in contrary to simp-le a new private key is recreated at each renewal by default, which can have consequences if you embed your public key in apps.</p></li><li class="listitem"><p>It is now possible to unlock LUKS-Encrypted file systems using a FIDO2 token via <code class="literal">boot.initrd.luks.fido2Support</code>.</p></li><li class="listitem"><p>Predictably named network interfaces get renamed in stage-1. This means that it is possible to use the proper interface name for e.g. Dropbear setups.</p><p>For further reference, please read <a class="link" href="https://github.com/NixOS/nixpkgs/pull/68953"  target="_top">#68953</a> or the corresponding <a class="link" href="https://discourse.nixos.org/t/predictable-network-interface-names-in-initrd/4055"  target="_top">discourse thread</a>.</p></li><li class="listitem"><p>The matrix-synapse-package has been updated to <a class="link" href="https://github.com/matrix-org/synapse/releases/tag/v1.11.1"  target="_top">v1.11.1</a>. Due to <a class="link" href="https://github.com/matrix-org/synapse/releases/tag/v1.10.0rc1"  target="_top">stricter requirements</a> for database configuration when using postgresql, the automated database setup of the module has been removed to avoid any further edge-cases.</p><p>matrix-synapse expects <code class="literal">postgresql</code>-databases to have the options <code class="literal">LC_COLLATE</code> and <code class="literal">LC_CTYPE</code> set to <a class="link" href="https://www.postgresql.org/docs/12/locale.html"  target="_top"><code class="literal">&#x27;C&#x27;</code></a> which basically instructs <code class="literal">postgresql</code> to ignore any locale-based preferences.</p><p>Depending on your setup, you need to incorporate one of the following changes in your setup to upgrade to 20.03:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>If you use <code class="literal">sqlite3</code> you don’t need to do anything.</p></li><li class="listitem"><p>If you use <code class="literal">postgresql</code> on a different server, you don’t need to change anything as well since this module was never designed to configure remote databases.</p></li><li class="listitem"><p>If you use <code class="literal">postgresql</code> and configured your synapse initially on <code class="literal">19.09</code> or older, you need to enable postgresql-support explicitly:</p><pre><code class="programlisting nix">{ ... }: {
  services.matrix-synapse = {
    enable = true;
    /* and all the other config you&#x27;ve defined here */
  };
  services.postgresql.enable = true;
}
</code></pre></li></ul></div></li><li class="listitem"><p>If you deploy a fresh matrix-synapse, you need to configure the database yourself (e.g. by using the <a class="link" href="options.html#opt-services.postgresql.initialScript"  target="_top">services.postgresql.initialScript</a> option). An example for this can be found in the <a class="link" href="index.html#module-services-matrix" title="Matrix" >documentation of the Matrix module</a>.</p></li><li class="listitem"><p>If you initially deployed your matrix-synapse on <code class="literal">nixos-unstable</code> <span class="emphasis"><em>after</em></span> the <code class="literal">19.09</code>-release, your database is misconfigured due to a regression in NixOS. For now, matrix-synapse will startup with a warning, but it’s recommended to reconfigure the database to set the values <code class="literal">LC_COLLATE</code> and <code class="literal">LC_CTYPE</code> to <a class="link" href="https://www.postgresql.org/docs/12/locale.html"  target="_top"><code class="literal">&#x27;C&#x27;</code></a>.</p></li><li class="listitem"><p>The <a class="link" href="options.html#opt-systemd.network.links"  target="_top">systemd.network.links</a> option is now respected even when <a class="link" href="options.html#opt-systemd.network.enable"  target="_top">systemd-networkd</a> is disabled. This mirrors the behaviour of systemd - It’s udev that parses <code class="literal">.link</code> files, not <code class="literal">systemd-networkd</code>.</p></li><li class="listitem"><p>mongodb has been updated to version <code class="literal">3.4.24</code>.</p><div class="warning"><h3 class="title">Warning</h3><p>Please note that mongodb has been relicensed under their own <a class="link" href="https://www.mongodb.com/licensing/server-side-public-license/faq"  target="_top"><code class="literal"> sspl</code></a>-license. Since it’s not entirely free and not OSI-approved, it’s listed as non-free. This means that Hydra doesn’t provide prebuilt mongodb-packages and needs to be built locally.</p></div></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-19.09" class="title" style="clear: both">Release 19.09 (“Loris”, 2019/10/09)   </h2>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-19.09-highlights" class="title" >Highlights   </h3>  </div> </div></div><p>In addition to numerous new and upgraded packages, this release has the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>End of support is planned for end of April 2020, handing over to 20.03.</p></li><li class="listitem"><p>Nix has been updated to 2.3; see its <a class="link" href="https://nixos.org/nix/manual/#ssec-relnotes-2.3"  target="_top">release notes</a>.</p></li><li class="listitem"><p>Core version changes:</p><p>systemd: 239 -&gt; 243</p><p>gcc: 7 -&gt; 8</p><p>glibc: 2.27 (unchanged)</p><p>linux: 4.19 LTS (unchanged)</p><p>openssl: 1.0 -&gt; 1.1</p></li><li class="listitem"><p>Desktop version changes:</p><p>plasma5: 5.14 -&gt; 5.16</p><p>gnome3: 3.30 -&gt; 3.32</p></li><li class="listitem"><p>PHP now defaults to PHP 7.3, updated from 7.2.</p></li><li class="listitem"><p>PHP 7.1 is no longer supported due to upstream not supporting this version for the entire lifecycle of the 19.09 release.</p></li><li class="listitem"><p>The binfmt module is now easier to use. Additional systems can be added through <code class="literal">boot.binfmt.emulatedSystems</code>. For instance, <code class="literal">boot.binfmt.emulatedSystems = [ &quot;wasm32-wasi&quot; &quot;x86_64-windows&quot; &quot;aarch64-linux&quot; ];</code> will set up binfmt interpreters for each of those listed systems.</p></li><li class="listitem"><p>The installer now uses a less privileged <code class="literal">nixos</code> user whereas before we logged in as root. To gain root privileges use <code class="literal">sudo -i</code> without a password.</p></li><li class="listitem"><p>We’ve updated to Xfce 4.14, which brings a new module <code class="literal">services.xserver.desktopManager.xfce4-14</code>. If you’d like to upgrade, please switch from the <code class="literal">services.xserver.desktopManager.xfce</code> module as it will be deprecated in a future release. They’re incompatibilities with the current Xfce module; it doesn’t support <code class="literal">thunarPlugins</code> and it isn’t recommended to use <code class="literal">services.xserver.desktopManager.xfce</code> and <code class="literal">services.xserver.desktopManager.xfce4-14</code> simultaneously or to downgrade from Xfce 4.14 after upgrading.</p></li><li class="listitem"><p>The GNOME 3 desktop manager module sports an interface to enable/disable core services, applications, and optional GNOME packages like games.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">services.gnome3.core-os-services.enable</code></p></li><li class="listitem"><p><code class="literal">services.gnome3.core-shell.enable</code></p></li><li class="listitem"><p><code class="literal">services.gnome3.core-utilities.enable</code></p></li><li class="listitem"><p><code class="literal">services.gnome3.games.enable</code></p></li></ul></div><p>With these options we hope to give users finer grained control over their systems. Prior to this change you’d either have to manually disable options or use <code class="literal">environment.gnome3.excludePackages</code> which only excluded the optional applications. <code class="literal">environment.gnome3.excludePackages</code> is now unguarded, it can exclude any package installed with <code class="literal">environment.systemPackages</code> in the GNOME 3 module.</p></li><li class="listitem"><p>Orthogonal to the previous changes to the GNOME 3 desktop manager module, we’ve updated all default services and applications to match as close as possible to a default reference GNOME 3 experience.</p><p><span class="strong"><strong>The following changes were enacted in <code class="literal">services.gnome3.core-utilities.enable</code></strong></span></p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">accerciser</code></p></li><li class="listitem"><p><code class="literal">dconf-editor</code></p></li><li class="listitem"><p><code class="literal">evolution</code></p></li><li class="listitem"><p><code class="literal">gnome-documents</code></p></li><li class="listitem"><p><code class="literal">gnome-nettool</code></p></li><li class="listitem"><p><code class="literal">gnome-power-manager</code></p></li><li class="listitem"><p><code class="literal">gnome-todo</code></p></li><li class="listitem"><p><code class="literal">gnome-tweaks</code></p></li><li class="listitem"><p><code class="literal">gnome-usage</code></p></li><li class="listitem"><p><code class="literal">gucharmap</code></p></li><li class="listitem"><p><code class="literal">nautilus-sendto</code></p></li><li class="listitem"><p><code class="literal">vinagre</code></p></li><li class="listitem"><p><code class="literal">cheese</code></p></li><li class="listitem"><p><code class="literal">geary</code></p></li></ul></div><p><span class="strong"><strong>The following changes were enacted in <code class="literal">services.gnome3.core-shell.enable</code></strong></span></p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">gnome-color-manager</code></p></li><li class="listitem"><p><code class="literal">orca</code></p></li><li class="listitem"><p><code class="literal">services.avahi.enable</code></p></li></ul></div></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-19.09-new-services" class="title" >New Services   </h3>  </div> </div></div><p>The following new services were added since the last release:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">./programs/dwm-status.nix</code></p></li><li class="listitem"><p>The new <code class="literal">hardware.printers</code> module allows to declaratively configure CUPS printers via the <code class="literal">ensurePrinters</code> and <code class="literal">ensureDefaultPrinter</code> options. <code class="literal">ensurePrinters</code> will never delete existing printers, but will make sure that the given printers are configured as declared.</p></li><li class="listitem"><p>There is a new <a class="link" href="options.html#opt-services.system-config-printer.enable"  target="_top">services.system-config-printer.enable</a> and <a class="link" href="options.html#opt-programs.system-config-printer.enable"  target="_top">programs.system-config-printer.enable</a> module for the program of the same name. If you previously had <code class="literal">system-config-printer</code> enabled through some other means you should migrate to using one of these modules.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">services.xserver.desktopManager.plasma5</code></p></li><li class="listitem"><p><code class="literal">services.xserver.desktopManager.gnome3</code></p></li><li class="listitem"><p><code class="literal">services.xserver.desktopManager.pantheon</code></p></li><li class="listitem"><p><code class="literal">services.xserver.desktopManager.mate</code> Note Mate uses <code class="literal">programs.system-config-printer</code> as it doesn’t use it as a service, but its graphical interface directly.</p></li></ul></div></li><li class="listitem"><p><a class="link" href="options.html#opt-services.blueman.enable"  target="_top">services.blueman.enable</a> has been added. If you previously had blueman installed via <code class="literal">environment.systemPackages</code> please migrate to using the NixOS module, as this would result in an insufficiently configured blueman.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-19.09-incompatibilities" class="title" >Backward Incompatibilities   </h3>  </div> </div></div><p>When upgrading from a previous release, please be aware of the following incompatible changes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Buildbot no longer supports Python 2, as support was dropped upstream in version 2.0.0. Configurations may need to be modified to make them compatible with Python 3.</p></li><li class="listitem"><p>PostgreSQL now uses <code class="literal">/run/postgresql</code> as its socket directory instead of <code class="literal">/tmp</code>. So if you run an application like eg. Nextcloud, where you need to use the Unix socket path as the database host name, you need to change it accordingly.</p></li><li class="listitem"><p>PostgreSQL 9.4 is scheduled EOL during the 19.09 life cycle and has been removed.</p></li><li class="listitem"><p>The options <code class="literal">services.prometheus.alertmanager.user</code> and <code class="literal">services.prometheus.alertmanager.group</code> have been removed because the alertmanager service is now using systemd’s <a class="link" href="http://0pointer.net/blog/dynamic-users-with-systemd.html"  target="_top"> DynamicUser mechanism</a> which obviates these options.</p></li><li class="listitem"><p>The NetworkManager systemd unit was renamed back from network-manager.service to NetworkManager.service for better compatibility with other applications expecting this name. The same applies to ModemManager where modem-manager.service is now called ModemManager.service again.</p></li><li class="listitem"><p>The <code class="literal">services.nzbget.configFile</code> and <code class="literal">services.nzbget.openFirewall</code> options were removed as they are managed internally by the nzbget. The <code class="literal">services.nzbget.dataDir</code> option hadn’t actually been used by the module for some time and so was removed as cleanup.</p></li><li class="listitem"><p>The <code class="literal">services.mysql.pidDir</code> option was removed, as it was only used by the wordpress apache-httpd service to wait for mysql to have started up. This can be accomplished by either describing a dependency on mysql.service (preferred) or waiting for the (hardcoded) <code class="literal">/run/mysqld/mysql.sock</code> file to appear.</p></li><li class="listitem"><p>The <code class="literal">services.emby.enable</code> module has been removed, see <code class="literal">services.jellyfin.enable</code> instead for a free software fork of Emby. See the Jellyfin documentation: <a class="link" href="https://jellyfin.readthedocs.io/en/latest/administrator-docs/migrate-from-emby/"  target="_top"> Migrating from Emby to Jellyfin </a></p></li><li class="listitem"><p>IPv6 Privacy Extensions are now enabled by default for undeclared interfaces. The previous behaviour was quite misleading — even though the default value for <code class="literal">networking.interfaces.*.preferTempAddress</code> was <code class="literal">true</code>, undeclared interfaces would not prefer temporary addresses. Now, interfaces not mentioned in the config will prefer temporary addresses. EUI64 addresses can still be set as preferred by explicitly setting the option to <code class="literal">false</code> for the interface in question.</p></li><li class="listitem"><p>Since Bittorrent Sync was superseded by Resilio Sync in 2016, the <code class="literal">bittorrentSync</code>, <code class="literal">bittorrentSync14</code>, and <code class="literal">bittorrentSync16</code> packages have been removed in favor of <code class="literal">resilio-sync</code>.</p><p>The corresponding module, <code class="literal">services.btsync</code> has been replaced by the <code class="literal">services.resilio</code> module.</p></li><li class="listitem"><p>The httpd service no longer attempts to start the postgresql service. If you have come to depend on this behaviour then you can preserve the behavior with the following configuration: <code class="literal">systemd.services.httpd.after = [ &quot;postgresql.service&quot; ];</code></p><p>The option <code class="literal">services.httpd.extraSubservices</code> has been marked as deprecated. You may still use this feature, but it will be removed in a future release of NixOS. You are encouraged to convert any httpd subservices you may have written to a full NixOS module.</p><p>Most of the httpd subservices packaged with NixOS have been replaced with full NixOS modules including LimeSurvey, WordPress, and Zabbix. These modules can be enabled using the <code class="literal">services.limesurvey.enable</code>, <code class="literal">services.mediawiki.enable</code>, <code class="literal">services.wordpress.enable</code>, and <code class="literal">services.zabbixWeb.enable</code> options.</p></li><li class="listitem"><p>The option <code class="literal">systemd.network.networks.&lt;name&gt;.routes.*.routeConfig.GatewayOnlink</code> was renamed to <code class="literal">systemd.network.networks.&lt;name&gt;.routes.*.routeConfig.GatewayOnLink</code> (capital <code class="literal">L</code>). This follows <a class="link" href="https://github.com/systemd/systemd/commit/9cb8c5593443d24c19e40bfd4fc06d672f8c554c"  target="_top"> upstreams renaming </a> of the setting.</p></li><li class="listitem"><p>As of this release the NixOps feature <code class="literal">autoLuks</code> is deprecated. It no longer works with our systemd version without manual intervention.</p><p>Whenever the usage of the module is detected the evaluation will fail with a message explaining why and how to deal with the situation.</p><p>A new knob named <code class="literal">nixops.enableDeprecatedAutoLuks</code> has been introduced to disable the eval failure and to acknowledge the notice was received and read. If you plan on using the feature please note that it might break with subsequent updates.</p><p>Make sure you set the <code class="literal">_netdev</code> option for each of the file systems referring to block devices provided by the autoLuks module. Not doing this might render the system in a state where it doesn’t boot anymore.</p><p>If you are actively using the <code class="literal">autoLuks</code> module please let us know in <a class="link" href="https://github.com/NixOS/nixpkgs/issues/62211"  target="_top">issue #62211</a>.</p></li><li class="listitem"><p>The setopt declarations will be evaluated at the end of <code class="literal">/etc/zshrc</code>, so any code in <a class="link" href="options.html#opt-programs.zsh.interactiveShellInit"  target="_top">programs.zsh.interactiveShellInit</a>, <a class="link" href="options.html#opt-programs.zsh.loginShellInit"  target="_top">programs.zsh.loginShellInit</a> and <a class="link" href="options.html#opt-programs.zsh.promptInit"  target="_top">programs.zsh.promptInit</a> may break if it relies on those options being set.</p></li><li class="listitem"><p>The <code class="literal">prometheus-nginx-exporter</code> package now uses the official exporter provided by NGINX Inc. Its metrics are differently structured and are incompatible to the old ones. For information about the metrics, have a look at the <a class="link" href="https://github.com/nginxinc/nginx-prometheus-exporter"  target="_top">official repo</a>.</p></li><li class="listitem"><p>The <code class="literal">shibboleth-sp</code> package has been updated to version 3. It is largely backward compatible, for further information refer to the <a class="link" href="https://wiki.shibboleth.net/confluence/display/SP3/ReleaseNotes"  target="_top">release notes</a> and <a class="link" href="https://wiki.shibboleth.net/confluence/display/SP3/UpgradingFromV2"  target="_top">upgrade guide</a>.</p><p>Nodejs 8 is scheduled EOL under the lifetime of 19.09 and has been dropped.</p></li><li class="listitem"><p>By default, prometheus exporters are now run with <code class="literal">DynamicUser</code> enabled. Exporters that need a real user, now run under a separate user and group which follow the pattern <code class="literal">&lt;exporter-name&gt;-exporter</code>, instead of the previous default <code class="literal">nobody</code> and <code class="literal">nogroup</code>. Only some exporters are affected by the latter, namely the exporters <code class="literal">dovecot</code>, <code class="literal">node</code>, <code class="literal">postfix</code> and <code class="literal">varnish</code>.</p></li><li class="listitem"><p>The <code class="literal">ibus-qt</code> package is not installed by default anymore when <a class="link" href="options.html#opt-i18n.inputMethod.enabled"  target="_top">i18n.inputMethod.enabled</a> is set to <code class="literal">ibus</code>. If IBus support in Qt 4.x applications is required, add the <code class="literal">ibus-qt</code> package to your <a class="link" href="options.html#opt-environment.systemPackages"  target="_top">environment.systemPackages</a> manually.</p></li><li class="listitem"><p>The CUPS Printing service now uses socket-based activation by default, only starting when needed. The previous behavior can be restored by setting <code class="literal">services.cups.startWhenNeeded</code> to <code class="literal">false</code>.</p></li><li class="listitem"><p>The <code class="literal">services.systemhealth</code> module has been removed from nixpkgs due to lack of maintainer.</p></li><li class="listitem"><p>The <code class="literal">services.mantisbt</code> module has been removed from nixpkgs due to lack of maintainer.</p></li><li class="listitem"><p>Squid 3 has been removed and the <code class="literal">squid</code> derivation now refers to Squid 4.</p></li><li class="listitem"><p>The <code class="literal">services.pdns-recursor.extraConfig</code> option has been replaced by <code class="literal">services.pdns-recursor.settings</code>. The new option allows setting extra configuration while being better type-checked and mergeable.</p></li><li class="listitem"><p>No service depends on <code class="literal">keys.target</code> anymore which is a systemd target that indicates if all <a class="link" href="https://nixos.org/nixops/manual/#idm140737322342384"  target="_top">NixOps keys</a> were successfully uploaded. Instead, <code class="literal">&lt;key-name&gt;-key.service</code> should be used to define a dependency of a key in a service. The full issue behind the <code class="literal">keys.target</code> dependency is described at <a class="link" href="https://github.com/NixOS/nixpkgs/issues/67265"  target="_top">NixOS/nixpkgs#67265</a>.</p><p>The following services are affected by this:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><a class="link" href="options.html#opt-services.dovecot2.enable"  target="_top"><code class="literal">services.dovecot2</code></a></p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.nsd.enable"  target="_top"><code class="literal">services.nsd</code></a></p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.softether.enable"  target="_top"><code class="literal">services.softether</code></a></p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.strongswan.enable"  target="_top"><code class="literal">services.strongswan</code></a></p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.strongswan-swanctl.enable"  target="_top"><code class="literal">services.strongswan-swanctl</code></a></p></li><li class="listitem"><p><a class="link" href="options.html#opt-services.httpd.enable"  target="_top"><code class="literal">services.httpd</code></a></p></li></ul></div></li><li class="listitem"><p>The <code class="literal">security.acme.directory</code> option has been replaced by a read-only <code class="literal">security.acme.certs.&lt;cert&gt;.directory</code> option for each certificate you define. This will be a subdirectory of <code class="literal">/var/lib/acme</code>. You can use this read-only option to figure out where the certificates are stored for a specific certificate. For example, the <code class="literal">services.nginx.virtualhosts.&lt;name&gt;.enableACME</code> option will use this directory option to find the certs for the virtual host.</p><p><code class="literal">security.acme.preDelay</code> and <code class="literal">security.acme.activationDelay</code> options have been removed. To execute a service before certificates are provisioned or renewed add a <code class="literal">RequiredBy=acme-${cert}.service</code> to any service.</p><p>Furthermore, the acme module will not automatically add a dependency on <code class="literal">lighttpd.service</code> anymore. If you are using certificates provided by letsencrypt for lighttpd, then you should depend on the certificate service <code class="literal">acme-${cert}.service&gt;</code> manually.</p><p>For nginx, the dependencies are still automatically managed when <code class="literal">services.nginx.virtualhosts.&lt;name&gt;.enableACME</code> is enabled just like before. What changed is that nginx now directly depends on the specific certificates that it needs, instead of depending on the catch-all <code class="literal">acme-certificates.target</code>. This target unit was also removed from the codebase. This will mean nginx will no longer depend on certificates it isn’t explicitly managing and fixes a bug with certificate renewal ordering racing with nginx restarting which could lead to nginx getting in a broken state as described at <a class="link" href="https://github.com/NixOS/nixpkgs/issues/60180"  target="_top">NixOS/nixpkgs#60180</a>.</p></li><li class="listitem"><p>The old deprecated <code class="literal">emacs</code> package sets have been dropped. What used to be called <code class="literal">emacsPackagesNg</code> is now called <code class="literal">emacsPackages</code>.</p></li><li class="listitem"><p><code class="literal">services.xserver.desktopManager.xterm</code> is now disabled by default if <code class="literal">stateVersion</code> is 19.09 or higher. Previously the xterm desktopManager was enabled when xserver was enabled, but it isn’t useful for all people so it didn’t make sense to have any desktopManager enabled default.</p></li><li class="listitem"><p>The WeeChat plugin <code class="literal">pkgs.weechatScripts.weechat-xmpp</code> has been removed as it doesn’t receive any updates from upstream and depends on outdated Python2-based modules.</p></li><li class="listitem"><p>Old unsupported versions (<code class="literal">logstash5</code>, <code class="literal">kibana5</code>, <code class="literal">filebeat5</code>, <code class="literal">heartbeat5</code>, <code class="literal">metricbeat5</code>, <code class="literal">packetbeat5</code>) of the ELK-stack and Elastic beats have been removed.</p></li><li class="listitem"><p>For NixOS 19.03, both Prometheus 1 and 2 were available to allow for a seamless transition from version 1 to 2 with existing setups. Because Prometheus 1 is no longer developed, it was removed. Prometheus 2 is now configured with <code class="literal">services.prometheus</code>.</p></li><li class="listitem"><p>Citrix Receiver (<code class="literal">citrix_receiver</code>) has been dropped in favor of Citrix Workspace (<code class="literal">citrix_workspace</code>).</p></li><li class="listitem"><p>The <code class="literal">services.gitlab</code> module has had its literal secret options (<code class="literal">services.gitlab.smtp.password</code>, <code class="literal">services.gitlab.databasePassword</code>, <code class="literal">services.gitlab.initialRootPassword</code>, <code class="literal">services.gitlab.secrets.secret</code>, <code class="literal">services.gitlab.secrets.db</code>, <code class="literal">services.gitlab.secrets.otp</code> and <code class="literal">services.gitlab.secrets.jws</code>) replaced by file-based versions (<code class="literal">services.gitlab.smtp.passwordFile</code>, <code class="literal">services.gitlab.databasePasswordFile</code>, <code class="literal">services.gitlab.initialRootPasswordFile</code>, <code class="literal">services.gitlab.secrets.secretFile</code>, <code class="literal">services.gitlab.secrets.dbFile</code>, <code class="literal">services.gitlab.secrets.otpFile</code> and <code class="literal">services.gitlab.secrets.jwsFile</code>). This was done so that secrets aren’t stored in the world-readable nix store, but means that for each option you’ll have to create a file with the same exact string, add “File” to the end of the option name, and change the definition to a string pointing to the corresponding file; e.g. <code class="literal">services.gitlab.databasePassword = &quot;supersecurepassword&quot;</code> becomes <code class="literal">services.gitlab.databasePasswordFile = &quot;/path/to/secret_file&quot;</code> where the file <code class="literal">secret_file</code> contains the string <code class="literal">supersecurepassword</code>.</p><p>The state path (<code class="literal">services.gitlab.statePath</code>) now has the following restriction: no parent directory can be owned by any other user than <code class="literal">root</code> or the user specified in <code class="literal">services.gitlab.user</code>; i.e. if <code class="literal">services.gitlab.statePath</code> is set to <code class="literal">/var/lib/gitlab/state</code>, <code class="literal">gitlab</code> and all parent directories must be owned by either <code class="literal">root</code> or the user specified in <code class="literal">services.gitlab.user</code>.</p></li><li class="listitem"><p>The <code class="literal">networking.useDHCP</code> option is unsupported in combination with <code class="literal">networking.useNetworkd</code> in anticipation of defaulting to it. It has to be set to <code class="literal">false</code> and enabled per interface with <code class="literal">networking.interfaces.&lt;name&gt;.useDHCP = true;</code></p></li><li class="listitem"><p>The Twitter client <code class="literal">corebird</code> has been dropped as <a class="link" href="https://www.patreon.com/posts/corebirds-future-18921328"  target="_top">it is discontinued and does not work against the new Twitter API</a>. Please use the fork <code class="literal">cawbird</code> instead which has been adapted to the API changes and is still maintained.</p></li><li class="listitem"><p>The <code class="literal">nodejs-11_x</code> package has been removed as it’s EOLed by upstream.</p></li><li class="listitem"><p>Because of the systemd upgrade, systemd-timesyncd will no longer work if <code class="literal">system.stateVersion</code> is not set correctly. When upgrading from NixOS 19.03, please make sure that <code class="literal">system.stateVersion</code> is set to <code class="literal">&quot;19.03&quot;</code>, or lower if the installation dates back to an earlier version of NixOS.</p></li><li class="listitem"><p>Due to the short lifetime of non-LTS kernel releases package attributes like <code class="literal">linux_5_1</code>, <code class="literal">linux_5_2</code> and <code class="literal">linux_5_3</code> have been removed to discourage dependence on specific non-LTS kernel versions in stable NixOS releases. Going forward, versioned attributes like <code class="literal">linux_4_9</code> will exist for LTS versions only. Please use <code class="literal">linux_latest</code> or <code class="literal">linux_testing</code> if you depend on non-LTS releases. Keep in mind that <code class="literal">linux_latest</code> and <code class="literal">linux_testing</code> will change versions under the hood during the lifetime of a stable release and might include breaking changes.</p></li><li class="listitem"><p>Because of the systemd upgrade, some network interfaces might change their name. For details see <a class="link" href="https://www.freedesktop.org/software/systemd/man/systemd.net-naming-scheme.html#History"  target="_top"> upstream docs</a> or <a class="link" href="https://github.com/NixOS/nixpkgs/issues/71086"  target="_top"> our ticket</a>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-19.09-notable-changes" class="title" >Other Notable Changes   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The <code class="literal">documentation</code> module gained an option named <code class="literal">documentation.nixos.includeAllModules</code> which makes the generated configuration.nix 5 manual page include all options from all NixOS modules included in a given <code class="literal">configuration.nix</code> configuration file. Currently, it is set to <code class="literal">false</code> by default as enabling it frequently prevents evaluation. But the plan is to eventually have it set to <code class="literal">true</code> by default. Please set it to <code class="literal">true</code> now in your <code class="literal">configuration.nix</code> and fix all the bugs it uncovers.</p></li><li class="listitem"><p>The <code class="literal">vlc</code> package gained support for Chromecast streaming, enabled by default. TCP port 8010 must be open for it to work, so something like <code class="literal">networking.firewall.allowedTCPPorts = [ 8010 ];</code> may be required in your configuration. Also consider enabling <a class="link" href="https://wiki.nixos.org/wiki/Accelerated_Video_Playback"  target="_top"> Accelerated Video Playback</a> for better transcoding performance.</p></li><li class="listitem"><p>The following changes apply if the <code class="literal">stateVersion</code> is changed to 19.09 or higher. For <code class="literal">stateVersion = &quot;19.03&quot;</code> or lower the old behavior is preserved.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">solr.package</code> defaults to <code class="literal">pkgs.solr_8</code>.</p></li></ul></div></li><li class="listitem"><p>The <code class="literal">hunspellDicts.fr-any</code> dictionary now ships with <code class="literal">fr_FR.{aff,dic}</code> which is linked to <code class="literal">fr-toutesvariantes.{aff,dic}</code>.</p></li><li class="listitem"><p>The <code class="literal">mysql</code> service now runs as <code class="literal">mysql</code> user. Previously, systemd did execute it as root, and mysql dropped privileges itself. This includes <code class="literal">ExecStartPre=</code> and <code class="literal">ExecStartPost=</code> phases. To accomplish that, runtime and data directory setup was delegated to RuntimeDirectory and tmpfiles.</p></li><li class="listitem"><p>With the upgrade to systemd version 242 the <code class="literal">systemd-timesyncd</code> service is no longer using <code class="literal">DynamicUser=yes</code>. In order for the upgrade to work we rely on an activation script to move the state from the old to the new directory. The older directory (prior <code class="literal">19.09</code>) was <code class="literal">/var/lib/private/systemd/timesync</code>.</p><p>As long as the <code class="literal">system.config.stateVersion</code> is below <code class="literal">19.09</code> the state folder will migrated to its proper location (<code class="literal">/var/lib/systemd/timesync</code>), if required.</p></li><li class="listitem"><p>The package <code class="literal">avahi</code> is now built to look up service definitions from <code class="literal">/etc/avahi/services</code> instead of its output directory in the nix store. Accordingly the module <code class="literal">avahi</code> now supports custom service definitions via <code class="literal">services.avahi.extraServiceFiles</code>, which are then placed in the aforementioned directory. See avahi.service5 for more information on custom service definitions.</p></li><li class="listitem"><p>Since version 0.1.19, <code class="literal">cargo-vendor</code> honors package includes that are specified in the <code class="literal">Cargo.toml</code> file of Rust crates. <code class="literal">rustPlatform.buildRustPackage</code> uses <code class="literal">cargo-vendor</code> to collect and build dependent crates. Since this change in <code class="literal">cargo-vendor</code> changes the set of vendored files for most Rust packages, the hash that use used to verify the dependencies, <code class="literal">cargoSha256</code>, also changes.</p><p>The <code class="literal">cargoSha256</code> hashes of all in-tree derivations that use <code class="literal">buildRustPackage</code> have been updated to reflect this change. However, third-party derivations that use <code class="literal">buildRustPackage</code> may have to be updated as well.</p></li><li class="listitem"><p>The <code class="literal">consul</code> package was upgraded past version <code class="literal">1.5</code>, so its deprecated legacy UI is no longer available.</p></li><li class="listitem"><p>The default resample-method for PulseAudio has been changed from the upstream default <code class="literal">speex-float-1</code> to <code class="literal">speex-float-5</code>. Be aware that low-powered ARM-based and MIPS-based boards will struggle with this so you’ll need to set <code class="literal">hardware.pulseaudio.daemon.config.resample-method</code> back to <code class="literal">speex-float-1</code>.</p></li><li class="listitem"><p>The <code class="literal">phabricator</code> package and associated <code class="literal">httpd.extraSubservice</code>, as well as the <code class="literal">phd</code> service have been removed from nixpkgs due to lack of maintainer.</p></li><li class="listitem"><p>The <code class="literal">mercurial</code> <code class="literal">httpd.extraSubservice</code> has been removed from nixpkgs due to lack of maintainer.</p></li><li class="listitem"><p>The <code class="literal">trac</code> <code class="literal">httpd.extraSubservice</code> has been removed from nixpkgs because it was unmaintained.</p></li><li class="listitem"><p>The <code class="literal">foswiki</code> package and associated <code class="literal">httpd.extraSubservice</code> have been removed from nixpkgs due to lack of maintainer.</p></li><li class="listitem"><p>The <code class="literal">tomcat-connector</code> <code class="literal">httpd.extraSubservice</code> has been removed from nixpkgs.</p></li><li class="listitem"><p>It’s now possible to change configuration in <a class="link" href="options.html#opt-services.nextcloud.enable"  target="_top">services.nextcloud</a> after the initial deploy since all config parameters are persisted in an additional config file generated by the module. Previously core configuration like database parameters were set using their imperative installer after creating <code class="literal">/var/lib/nextcloud</code>.</p></li><li class="listitem"><p>There exists now <code class="literal">lib.forEach</code>, which is like <code class="literal">map</code>, but with arguments flipped. When mapping function body spans many lines (or has nested <code class="literal">map</code>s), it is often hard to follow which list is modified.</p><p>Previous solution to this problem was either to use <code class="literal">lib.flip map</code> idiom or extract that anonymous mapping function to a named one. Both can still be used but <code class="literal">lib.forEach</code> is preferred over <code class="literal">lib.flip map</code>.</p><p>The <code class="literal">/etc/sysctl.d/nixos.conf</code> file containing all the options set via <a class="link" href="options.html#opt-boot.kernel.sysctl"  target="_top">boot.kernel.sysctl</a> was moved to <code class="literal">/etc/sysctl.d/60-nixos.conf</code>, as sysctl.d5 recommends prefixing all filenames in <code class="literal">/etc/sysctl.d</code> with a two-digit number and a dash to simplify the ordering of the files.</p></li><li class="listitem"><p>We now install the sysctl snippets shipped with systemd.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>Loose reverse path filtering</p></li><li class="listitem"><p>Source route filtering</p></li><li class="listitem"><p><code class="literal">fq_codel</code> as a packet scheduler (this helps to fight bufferbloat)</p></li></ul></div><p>This also configures the kernel to pass core dumps to <code class="literal">systemd-coredump</code>, and restricts the SysRq key combinations to the sync command only. These sysctl snippets can be found in <code class="literal">/etc/sysctl.d/50-*.conf</code>, and overridden via <a class="link" href="options.html#opt-boot.kernel.sysctl"  target="_top">boot.kernel.sysctl</a> (which will place the parameters in <code class="literal">/etc/sysctl.d/60-nixos.conf</code>).</p></li><li class="listitem"><p>Core dumps are now processed by <code class="literal">systemd-coredump</code> by default. <code class="literal">systemd-coredump</code> behaviour can still be modified via <code class="literal">systemd.coredump.extraConfig</code>. To stick to the old behaviour (having the kernel dump to a file called <code class="literal">core</code> in the working directory), without piping it through <code class="literal">systemd-coredump</code>, set <code class="literal">systemd.coredump.enable</code> to <code class="literal">false</code>.</p></li><li class="listitem"><p><code class="literal">systemd.packages</code> option now also supports generators and shutdown scripts. Old <code class="literal">systemd.generator-packages</code> option has been removed.</p></li><li class="listitem"><p>The <code class="literal">rmilter</code> package was removed with associated module and options due deprecation by upstream developer. Use <code class="literal">rspamd</code> in proxy mode instead.</p></li><li class="listitem"><p>systemd cgroup accounting via the <a class="link" href="options.html#opt-systemd.enableCgroupAccounting"  target="_top">systemd.enableCgroupAccounting</a> option is now enabled by default. It now also enables the more recent Block IO and IP accounting features.</p></li><li class="listitem"><p>We no longer enable custom font rendering settings with <code class="literal">fonts.fontconfig.penultimate.enable</code> by default. The defaults from fontconfig are sufficient.</p></li><li class="listitem"><p>The <code class="literal">crashplan</code> package and the <code class="literal">crashplan</code> service have been removed from nixpkgs due to crashplan shutting down the service, while the <code class="literal">crashplansb</code> package and <code class="literal">crashplan-small-business</code> service have been removed from nixpkgs due to lack of maintainer.</p><p>The <a class="link" href="options.html#opt-services.redis.enable"  target="_top">redis module</a> was hardcoded to use the <code class="literal">redis</code> user, <code class="literal">/run/redis</code> as runtime directory and <code class="literal">/var/lib/redis</code> as state directory. Note that the NixOS module for Redis now disables kernel support for Transparent Huge Pages (THP), because this features causes major performance problems for Redis, e.g. (https://redis.io/topics/latency).</p></li><li class="listitem"><p>Using <code class="literal">fonts.enableDefaultFonts</code> adds a default emoji font <code class="literal">noto-fonts-emoji</code>.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">services.xserver.enable</code></p></li><li class="listitem"><p><code class="literal">programs.sway.enable</code></p></li><li class="listitem"><p><code class="literal">programs.way-cooler.enable</code></p></li><li class="listitem"><p><code class="literal">services.xrdp.enable</code></p></li></ul></div></li><li class="listitem"><p>The <code class="literal">altcoins</code> categorization of packages has been removed. You now access these packages at the top level, ie. <code class="literal">nix-shell -p dogecoin</code> instead of <code class="literal">nix-shell -p altcoins.dogecoin</code>, etc.</p></li><li class="listitem"><p>Ceph has been upgraded to v14.2.1. See the <a class="link" href="https://ceph.com/releases/v14-2-0-nautilus-released/"  target="_top">release notes</a> for details. The mgr dashboard as well as osds backed by loop-devices is no longer explicitly supported by the package and module. Note: There’s been some issues with python-cherrypy, which is used by the dashboard and prometheus mgr modules (and possibly others), hence 0000-dont-check-cherrypy-version.patch.</p></li><li class="listitem"><p><code class="literal">pkgs.weechat</code> is now compiled against <code class="literal">pkgs.python3</code>. Weechat also recommends <a class="link" href="https://weechat.org/scripts/python3/"  target="_top">to use Python3 in their docs.</a></p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-19.03" class="title" style="clear: both">Release 19.03 (“Koi”, 2019/04/11)   </h2>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-19.03-highlights" class="title" >Highlights   </h3>  </div> </div></div><p>In addition to numerous new and upgraded packages, this release has the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>End of support is planned for end of October 2019, handing over to 19.09.</p></li><li class="listitem"><p>The default Python 3 interpreter is now CPython 3.7 instead of CPython 3.6.</p></li><li class="listitem"><p>Added the Pantheon desktop environment. It can be enabled through <code class="literal">services.xserver.desktopManager.pantheon.enable</code>.</p><div class="note"><h3 class="title">Note</h3><p>By default, <code class="literal">services.xserver.desktopManager.pantheon</code> enables LightDM as a display manager, as pantheon’s screen locking implementation relies on it.
Because of that it is recommended to leave LightDM enabled. If you’d like to disable it anyway, set <code class="literal">services.xserver.displayManager.lightdm.enable</code> to <code class="literal">false</code> and enable your preferred display manager.</p></div><p>Also note that Pantheon’s LightDM greeter is not enabled by default, because it has numerous issues in NixOS and isn’t optimal for use here yet.</p></li><li class="listitem"><p>A major refactoring of the Kubernetes module has been completed. Refactorings primarily focus on decoupling components and enhancing security. Two-way TLS and RBAC has been enabled by default for all components, which slightly changes the way the module is configured. See: <a class="xref" href="index.html#sec-kubernetes" title="Kubernetes" ><em>Kubernetes</em></a> for details.</p></li><li class="listitem"><p>There is now a set of <code class="literal">confinement</code> options for <code class="literal">systemd.services</code>, which allows to restrict services into a chroot 2 ed environment that only contains the store paths from the runtime closure of the service.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-19.03-new-services" class="title" >New Services   </h3>  </div> </div></div><p>The following new services were added since the last release:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">./programs/nm-applet.nix</code></p></li><li class="listitem"><p>There is a new <code class="literal">security.googleOsLogin</code> module for using <a class="link" href="https://cloud.google.com/compute/docs/instances/managing-instance-access"  target="_top">OS Login</a> to manage SSH access to Google Compute Engine instances, which supersedes the imperative and broken <code class="literal">google-accounts-daemon</code> used in <code class="literal">nixos/modules/virtualisation/google-compute-config.nix</code>.</p></li><li class="listitem"><p><code class="literal">./services/misc/beanstalkd.nix</code></p></li><li class="listitem"><p>There is a new <code class="literal">services.cockroachdb</code> module for running CockroachDB databases. NixOS now ships with CockroachDB 2.1.x as well, available on <code class="literal">x86_64-linux</code> and <code class="literal">aarch64-linux</code>.</p></li><li class="listitem"><p><code class="literal">./security/duosec.nix</code></p></li><li class="listitem"><p>The <a class="link" href="https://duo.com/docs/duounix"  target="_top">PAM module for Duo Security</a> has been enabled for use. One can configure it using the <code class="literal">security.duosec</code> options along with the corresponding PAM option in <code class="literal">security.pam.services.&lt;name?&gt;.duoSecurity.enable</code>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-19.03-incompatibilities" class="title" >Backward Incompatibilities   </h3>  </div> </div></div><p>When upgrading from a previous release, please be aware of the following incompatible changes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The minimum version of Nix required to evaluate Nixpkgs is now 2.0.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>For users of NixOS 18.03 and 19.03, NixOS defaults to Nix 2.0, but supports using Nix 1.11 by setting <code class="literal">nix.package = pkgs.nix1;</code>. If this option is set to a Nix 1.11 package, you will need to either unset the option or upgrade it to Nix 2.0.</p></li><li class="listitem"><p>For users of NixOS 17.09, you will first need to upgrade Nix by setting <code class="literal">nix.package = pkgs.nixStable2;</code> and run <code class="literal">nixos-rebuild switch</code> as the <code class="literal">root</code> user.</p></li><li class="listitem"><p>For users of a daemon-less Nix installation on Linux or macOS, you can upgrade Nix by running <code class="literal">curl -L https://nixos.org/nix/install | sh</code>, or prior to doing a channel update, running <code class="literal">nix-env -iA nix</code>. If you have already run a channel update and Nix is no longer able to evaluate Nixpkgs, the error message printed should provide adequate directions for upgrading Nix.</p></li><li class="listitem"><p>For users of the Nix daemon on macOS, you can upgrade Nix by running <code class="literal">sudo -i sh -c &#x27;nix-channel --update &amp;&amp; nix-env -iA nixpkgs.nix&#x27;; sudo launchctl stop org.nixos.nix-daemon; sudo launchctl start org.nixos.nix-daemon</code>.</p></li></ul></div></li><li class="listitem"><p>The <code class="literal">buildPythonPackage</code> function now sets <code class="literal">strictDeps = true</code> to help distinguish between native and non-native dependencies in order to improve cross-compilation compatibility. Note however that this may break user expressions.</p></li><li class="listitem"><p>The <code class="literal">buildPythonPackage</code> function now sets <code class="literal">LANG = C.UTF-8</code> to enable Unicode support. The <code class="literal">glibcLocales</code> package is no longer needed as a build input.</p></li><li class="listitem"><p>The Syncthing state and configuration data has been moved from <code class="literal">services.syncthing.dataDir</code> to the newly defined <code class="literal">services.syncthing.configDir</code>, which default to <code class="literal">/var/lib/syncthing/.config/syncthing</code>. This change makes possible to share synced directories using ACLs without Syncthing resetting the permission on every start.</p></li><li class="listitem"><p>The <code class="literal">ntp</code> module now has sane default restrictions. If you’re relying on the previous defaults, which permitted all queries and commands from all firewall-permitted sources, you can set <code class="literal">services.ntp.restrictDefault</code> and <code class="literal">services.ntp.restrictSource</code> to <code class="literal">[]</code>.</p></li><li class="listitem"><p>Package <code class="literal">rabbitmq_server</code> is renamed to <code class="literal">rabbitmq-server</code>.</p></li><li class="listitem"><p>The <code class="literal">light</code> module no longer uses setuid binaries, but udev rules. As a consequence users of that module have to belong to the <code class="literal">video</code> group in order to use the executable (i.e. <code class="literal">users.users.yourusername.extraGroups = [&quot;video&quot;];</code>).</p></li><li class="listitem"><p>Buildbot now supports Python 3 and its packages have been moved to <code class="literal">pythonPackages</code>. The options <code class="literal">services.buildbot-master.package</code> and <code class="literal">services.buildbot-worker.package</code> can be used to select the Python 2 or 3 version of the package.</p></li><li class="listitem"><p>Options <code class="literal">services.znc.confOptions.networks.name.userName</code> and <code class="literal">services.znc.confOptions.networks.name.modulePackages</code> were removed. They were never used for anything and can therefore safely be removed.</p></li><li class="listitem"><p>Package <code class="literal">wasm</code> has been renamed <code class="literal">proglodyte-wasm</code>. The package <code class="literal">wasm</code> will be pointed to <code class="literal">ocamlPackages.wasm</code> in 19.09, so make sure to update your configuration if you want to keep <code class="literal">proglodyte-wasm</code></p></li><li class="listitem"><p>When the <code class="literal">nixpkgs.pkgs</code> option is set, NixOS will no longer ignore the <code class="literal">nixpkgs.overlays</code> option. The old behavior can be recovered by setting <code class="literal">nixpkgs.overlays = lib.mkForce [];</code>.</p></li><li class="listitem"><p>OpenSMTPD has been upgraded to version 6.4.0p1. This release makes backwards-incompatible changes to the configuration file format. See <code class="literal">man smtpd.conf</code> for more information on the new file format.</p></li><li class="listitem"><p>The versioned <code class="literal">postgresql</code> have been renamed to use underscore number separators. For example, <code class="literal">postgresql96</code> has been renamed to <code class="literal">postgresql_9_6</code>.</p></li><li class="listitem"><p>Package <code class="literal">consul-ui</code> and passthrough <code class="literal">consul.ui</code> have been removed. The package <code class="literal">consul</code> now uses upstream releases that vendor the UI into the binary. See <a class="link" href="https://github.com/NixOS/nixpkgs/pull/48714#issuecomment-433454834"  target="_top">#48714</a> for details.</p></li><li class="listitem"><p>Slurm introduces the new option <code class="literal">services.slurm.stateSaveLocation</code>, which is now set to <code class="literal">/var/spool/slurm</code> by default (instead of <code class="literal">/var/spool</code>). Make sure to move all files to the new directory or to set the option accordingly.</p><p>The slurmctld now runs as user <code class="literal">slurm</code> instead of <code class="literal">root</code>. If you want to keep slurmctld running as <code class="literal">root</code>, set <code class="literal">services.slurm.user = root</code>.</p><p>The options <code class="literal">services.slurm.nodeName</code> and <code class="literal">services.slurm.partitionName</code> are now sets of strings to correctly reflect that fact that each of these options can occur more than once in the configuration.</p></li><li class="listitem"><p>The <code class="literal">solr</code> package has been upgraded from 4.10.3 to 7.5.0 and has undergone some major changes. The <code class="literal">services.solr</code> module has been updated to reflect these changes. Please review http://lucene.apache.org/solr/ carefully before upgrading.</p></li><li class="listitem"><p>Package <code class="literal">ckb</code> is renamed to <code class="literal">ckb-next</code>, and options <code class="literal">hardware.ckb.*</code> are renamed to <code class="literal">hardware.ckb-next.*</code>.</p></li><li class="listitem"><p>The option <code class="literal">services.xserver.displayManager.job.logToFile</code> which was previously set to <code class="literal">true</code> when using the display managers <code class="literal">lightdm</code>, <code class="literal">sddm</code> or <code class="literal">xpra</code> has been reset to the default value (<code class="literal">false</code>).</p></li><li class="listitem"><p>Network interface indiscriminate NixOS firewall options (<code class="literal">networking.firewall.allow*</code>) are now preserved when also setting interface specific rules such as <code class="literal">networking.firewall.interfaces.en0.allow*</code>. These rules continue to use the pseudo device “default” (<code class="literal">networking.firewall.interfaces.default.*</code>), and assigning to this pseudo device will override the (<code class="literal">networking.firewall.allow*</code>) options.</p></li><li class="listitem"><p>The <code class="literal">nscd</code> service now disables all caching of <code class="literal">passwd</code> and <code class="literal">group</code> databases by default. This was interfering with the correct functioning of the <code class="literal">libnss_systemd.so</code> module which is used by <code class="literal">systemd</code> to manage uids and usernames in the presence of <code class="literal">DynamicUser=</code> in systemd services. This was already the default behaviour in presence of <code class="literal">services.sssd.enable = true</code> because nscd caching would interfere with <code class="literal">sssd</code> in unpredictable ways as well. Because we’re using nscd not for caching, but for convincing glibc to find NSS modules in the nix store instead of an absolute path, we have decided to disable caching globally now, as it’s usually not the behaviour the user wants and can lead to surprising behaviour. Furthermore, negative caching of host lookups is also disabled now by default. This should fix the issue of dns lookups failing in the presence of an unreliable network.</p><p>If the old behaviour is desired, this can be restored by setting the <code class="literal">services.nscd.config</code> option with the desired caching parameters.</p><pre><code class="programlisting nix">{
  services.nscd.config =
  &#x27;&#x27;
  server-user             nscd
  threads                 1
  paranoia                no
  debug-level             0

  enable-cache            passwd          yes
  positive-time-to-live   passwd          600
  negative-time-to-live   passwd          20
  suggested-size          passwd          211
  check-files             passwd          yes
  persistent              passwd          no
  shared                  passwd          yes

  enable-cache            group           yes
  positive-time-to-live   group           3600
  negative-time-to-live   group           60
  suggested-size          group           211
  check-files             group           yes
  persistent              group           no
  shared                  group           yes

  enable-cache            hosts           yes
  positive-time-to-live   hosts           600
  negative-time-to-live   hosts           5
  suggested-size          hosts           211
  check-files             hosts           yes
  persistent              hosts           no
  shared                  hosts           yes
  &#x27;&#x27;;
}
</code></pre><p>See <a class="link" href="https://github.com/NixOS/nixpkgs/pull/50316"  target="_top">#50316</a> for details.</p></li><li class="listitem"><p>GitLab Shell previously used the nix store paths for the <code class="literal">gitlab-shell</code> command in its <code class="literal">authorized_keys</code> file, which might stop working after garbage collection. To circumvent that, we regenerated that file on each startup. As <code class="literal">gitlab-shell</code> has now been changed to use <code class="literal">/var/run/current-system/sw/bin/gitlab-shell</code>, this is not necessary anymore, but there might be leftover lines with a nix store path. Regenerate the <code class="literal">authorized_keys</code> file via <code class="literal">sudo -u git -H gitlab-rake gitlab:shell:setup</code> in that case.</p></li><li class="listitem"><p>The <code class="literal">pam_unix</code> account module is now loaded with its control field set to <code class="literal">required</code> instead of <code class="literal">sufficient</code>, so that later PAM account modules that might do more extensive checks are being executed. Previously, the whole account module verification was exited prematurely in case a nss module provided the account name to <code class="literal">pam_unix</code>. The LDAP and SSSD NixOS modules already add their NSS modules when enabled. In case your setup breaks due to some later PAM account module previously shadowed, or failing NSS lookups, please file a bug. You can get back the old behaviour by manually setting <code class="literal">security.pam.services.&lt;name?&gt;.text</code>.</p></li><li class="listitem"><p>The <code class="literal">pam_unix</code> password module is now loaded with its control field set to <code class="literal">sufficient</code> instead of <code class="literal">required</code>, so that password managed only by later PAM password modules are being executed. Previously, for example, changing an LDAP account’s password through PAM was not possible: the whole password module verification was exited prematurely by <code class="literal">pam_unix</code>, preventing <code class="literal">pam_ldap</code> to manage the password as it should.</p></li><li class="listitem"><p><code class="literal">fish</code> has been upgraded to 3.0. It comes with a number of improvements and backwards incompatible changes. See the <code class="literal">fish</code> <a class="link" href="https://github.com/fish-shell/fish-shell/releases/tag/3.0.0"  target="_top">release notes</a> for more information.</p></li><li class="listitem"><p>The ibus-table input method has had a change in config format, which causes all previous settings to be lost. See <a class="link" href="https://github.com/mike-fabian/ibus-table/commit/f9195f877c5212fef0dfa446acb328c45ba5852b"  target="_top">this commit message</a> for details.</p></li><li class="listitem"><p>NixOS module system type <code class="literal">types.optionSet</code> and <code class="literal">lib.mkOption</code> argument <code class="literal">options</code> are deprecated. Use <code class="literal">types.submodule</code> instead. (<a class="link" href="https://github.com/NixOS/nixpkgs/pull/54637"  target="_top">#54637</a>)</p></li><li class="listitem"><p><code class="literal">matrix-synapse</code> has been updated to version 0.99. It will <a class="link" href="https://github.com/matrix-org/synapse/pull/4509"  target="_top">no longer generate a self-signed certificate on first launch</a> and will be <a class="link" href="https://matrix.org/blog/2019/02/05/synapse-0-99-0/"  target="_top">the last version to accept self-signed certificates</a>. As such, it is now recommended to use a proper certificate verified by a root CA (for example Let’s Encrypt). The new <a class="link" href="index.html#module-services-matrix" title="Matrix" >manual chapter on Matrix</a> contains a working example of using nginx as a reverse proxy in front of <code class="literal">matrix-synapse</code>, using Let’s Encrypt certificates.</p></li><li class="listitem"><p><code class="literal">mailutils</code> now works by default when <code class="literal">sendmail</code> is not in a setuid wrapper. As a consequence, the <code class="literal">sendmailPath</code> argument, having lost its main use, has been removed.</p></li><li class="listitem"><p><code class="literal">graylog</code> has been upgraded from version 2.* to 3.*. Some setups making use of extraConfig (especially those exposing Graylog via reverse proxies) need to be updated as upstream removed/replaced some settings. See <a class="link" href="http://docs.graylog.org/en/3.0/pages/upgrade/graylog-3.0.html#simplified-http-interface-configuration"  target="_top">Upgrading Graylog</a> for details.</p></li><li class="listitem"><p>The option <code class="literal">users.ldap.bind.password</code> was renamed to <code class="literal">users.ldap.bind.passwordFile</code>, and needs to be readable by the <code class="literal">nslcd</code> user. Same applies to the new <code class="literal">users.ldap.daemon.rootpwmodpwFile</code> option.</p></li><li class="listitem"><p><code class="literal">nodejs-6_x</code> is end-of-life. <code class="literal">nodejs-6_x</code>, <code class="literal">nodejs-slim-6_x</code> and <code class="literal">nodePackages_6_x</code> are removed.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-19.03-notable-changes" class="title" >Other Notable Changes   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The <code class="literal">services.matomo</code> module gained the option <code class="literal">services.matomo.package</code> which determines the used Matomo version.</p><p>The Matomo module now also comes with the systemd service <code class="literal">matomo-archive-processing.service</code> and a timer that automatically triggers archive processing every hour. This means that you can safely <a class="link" href="https://matomo.org/docs/setup-auto-archiving/#disable-browser-triggers-for-matomo-archiving-and-limit-matomo-reports-to-updating-every-hour"  target="_top"> disable browser triggers for Matomo archiving </a> at <code class="literal">Administration &gt; System &gt; General Settings</code>.</p><p>Additionally, you can enable to <a class="link" href="https://matomo.org/docs/privacy/#step-2-delete-old-visitors-logs"  target="_top"> delete old visitor logs </a> at <code class="literal">Administration &gt; System &gt; Privacy</code>, but make sure that you run <code class="literal">systemctl start matomo-archive-processing.service</code> at least once without errors if you have already collected data before, so that the reports get archived before the source data gets deleted.</p></li><li class="listitem"><p><code class="literal">composableDerivation</code> along with supporting library functions has been removed.</p></li><li class="listitem"><p>The deprecated <code class="literal">truecrypt</code> package has been removed and <code class="literal">truecrypt</code> attribute is now an alias for <code class="literal">veracrypt</code>. VeraCrypt is backward-compatible with TrueCrypt volumes. Note that <code class="literal">cryptsetup</code> also supports loading TrueCrypt volumes.</p></li><li class="listitem"><p>The Kubernetes DNS addons, kube-dns, has been replaced with CoreDNS. This change is made in accordance with Kubernetes making CoreDNS the official default starting from <a class="link" href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.11.md#sig-cluster-lifecycle"  target="_top">Kubernetes v1.11</a>. Please beware that upgrading DNS-addon on existing clusters might induce minor downtime while the DNS-addon terminates and re-initializes. Also note that the DNS-service now runs with 2 pod replicas by default. The desired number of replicas can be configured using: <code class="literal">services.kubernetes.addons.dns.replicas</code>.</p></li><li class="listitem"><p>The quassel-webserver package and module was removed from nixpkgs due to the lack of maintainers.</p></li><li class="listitem"><p>The manual gained a <a class="link" href="index.html#module-services-matrix" title="Matrix" > new chapter on self-hosting <code class="literal">matrix-synapse</code> and <code class="literal">riot-web</code> </a>, the most prevalent server and client implementations for the <a class="link" href="https://matrix.org/"  target="_top">Matrix</a> federated communication network.</p></li><li class="listitem"><p>The astah-community package was removed from nixpkgs due to it being discontinued and the downloads not being available anymore.</p></li><li class="listitem"><p>The httpd service now saves log files with a .log file extension by default for easier integration with the logrotate service.</p></li><li class="listitem"><p>The owncloud server packages and httpd subservice module were removed from nixpkgs due to the lack of maintainers.</p></li><li class="listitem"><p>It is possible now to uze ZRAM devices as general purpose ephemeral block devices, not only as swap. Using more than 1 device as ZRAM swap is no longer recommended, but is still possible by setting <code class="literal">zramSwap.swapDevices</code> explicitly.</p><p>ZRAM algorithm can be changed now.</p><p>Changes to ZRAM algorithm are applied during <code class="literal">nixos-rebuild switch</code>, so make sure you have enough swap space on disk to survive ZRAM device rebuild. Alternatively, use <code class="literal">nixos-rebuild boot; reboot</code>.</p></li><li class="listitem"><p>Flat volumes are now disabled by default in <code class="literal">hardware.pulseaudio</code>. This has been done to prevent applications, which are unaware of this feature, setting their volumes to 100% on startup causing harm to your audio hardware and potentially your ears.</p><div class="note"><h3 class="title">Note</h3><p>With this change application specific volumes are relative to the master volume which can be adjusted independently, whereas before they were absolute; meaning that in effect, it scaled the device-volume with the volume of the loudest application.</p></div></li><li class="listitem"><p>The <a class="link" href="https://github.com/DanielAdolfsson/ndppd"  target="_top"><code class="literal">ndppd</code></a> module now supports <a class="link" href="options.html#opt-services.ndppd.enable"  target="_top">all config options</a> provided by the current upstream version as service options. Additionally the <code class="literal">ndppd</code> package doesn’t contain the systemd unit configuration from upstream anymore, the unit is completely configured by the NixOS module now.</p></li><li class="listitem"><p>New installs of NixOS will default to the Redmine 4.x series unless otherwise specified in <code class="literal">services.redmine.package</code> while existing installs of NixOS will default to the Redmine 3.x series.</p></li><li class="listitem"><p>The <a class="link" href="options.html#opt-services.grafana.enable"  target="_top">Grafana module</a> now supports declarative <a class="link" href="http://docs.grafana.org/administration/provisioning/"  target="_top">datasource and dashboard</a> provisioning.</p></li><li class="listitem"><p>The use of insecure ports on kubernetes has been deprecated. Thus options: <code class="literal">services.kubernetes.apiserver.port</code> and <code class="literal">services.kubernetes.controllerManager.port</code> has been renamed to <code class="literal">.insecurePort</code>, and default of both options has changed to 0 (disabled).</p></li><li class="listitem"><p>Note that the default value of <code class="literal">services.kubernetes.apiserver.bindAddress</code> has changed from 127.0.0.1 to 0.0.0.0, allowing the apiserver to be accessible from outside the master node itself. If the apiserver insecurePort is enabled, it is strongly recommended to only bind on the loopback interface. See: <code class="literal">services.kubernetes.apiserver.insecurebindAddress</code>.</p></li><li class="listitem"><p>The option <code class="literal">services.kubernetes.apiserver.allowPrivileged</code> and <code class="literal">services.kubernetes.kubelet.allowPrivileged</code> now defaults to false. Disallowing privileged containers on the cluster.</p></li><li class="listitem"><p>The kubernetes module does no longer add the kubernetes package to <code class="literal">environment.systemPackages</code> implicitly.</p></li><li class="listitem"><p>The <code class="literal">intel</code> driver has been removed from the default list of <a class="link" href="options.html#opt-services.xserver.videoDrivers"  target="_top">X.org video drivers</a>. The <code class="literal">modesetting</code> driver should take over automatically, it is better maintained upstream and has less problems with advanced X11 features. This can lead to a change in the output names used by <code class="literal">xrandr</code>. Some performance regressions on some GPU models might happen. Some OpenCL and VA-API applications might also break (Beignet seems to provide OpenCL support with <code class="literal">modesetting</code> driver, too). Kernel mode setting API does not support backlight control, so <code class="literal">xbacklight</code> tool will not work; backlight level can be controlled directly via <code class="literal">/sys/</code> or with <code class="literal">brightnessctl</code>. Users who need this functionality more than multi-output XRandR are advised to add `intel` to `videoDrivers` and report an issue (or provide additional details in an existing one)</p></li><li class="listitem"><p>Openmpi has been updated to version 4.0.0, which removes some deprecated MPI-1 symbols. This may break some older applications that still rely on those symbols. An upgrade guide can be found <a class="link" href="https://www.open-mpi.org/faq/?category=mpi-removed"  target="_top">here</a>.</p><p>The nginx package now relies on OpenSSL 1.1 and supports TLS 1.3 by default. You can set the protocols used by the nginx service using <a class="link" href="options.html#opt-services.nginx.sslProtocols"  target="_top">services.nginx.sslProtocols</a>.</p></li><li class="listitem"><p>A new subcommand <code class="literal">nixos-rebuild edit</code> was added.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-18.09" class="title" style="clear: both">Release 18.09 (“Jellyfish”, 2018/10/05)   </h2>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-18.09-highlights" class="title" >Highlights   </h3>  </div> </div></div><p>In addition to numerous new and upgraded packages, this release has the following notable updates:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>End of support is planned for end of April 2019, handing over to 19.03.</p></li><li class="listitem"><p>Platform support: x86_64-linux and x86_64-darwin as always. Support for aarch64-linux is as with the previous releases, not equivalent to the x86-64-linux release, but with efforts to reach parity.</p></li><li class="listitem"><p>Nix has been updated to 2.1; see its <a class="link" href="https://nixos.org/nix/manual/#ssec-relnotes-2.1"  target="_top">release notes</a>.</p></li><li class="listitem"><p>Core versions: linux: 4.14 LTS (unchanged), glibc: 2.26 → 2.27, gcc: 7 (unchanged), systemd: 237 → 239.</p></li><li class="listitem"><p>Desktop version changes: gnome: 3.26 → 3.28, (KDE) plasma-desktop: 5.12 → 5.13.</p></li></ul></div><p>Notable changes and additions for 18.09 include:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Support for wrapping binaries using <code class="literal">firejail</code> has been added through <code class="literal">programs.firejail.wrappedBinaries</code>.</p><p>For example</p><pre><code class="programlisting nix">{
  programs.firejail = {
    enable = true;
    wrappedBinaries = {
      firefox = &quot;${lib.getBin pkgs.firefox}/bin/firefox&quot;;
      mpv = &quot;${lib.getBin pkgs.mpv}/bin/mpv&quot;;
    };
  };
}
</code></pre><p>This will place <code class="literal">firefox</code> and <code class="literal">mpv</code> binaries in the global path wrapped by firejail.</p></li><li class="listitem"><p>User channels are now in the default <code class="literal">NIX_PATH</code>, allowing users to use their personal <code class="literal">nix-channel</code> defined channels in <code class="literal">nix-build</code> and <code class="literal">nix-shell</code> commands, as well as in imports like <code class="literal">import &lt;mychannel&gt;</code>.</p><p>For example</p><pre><code class="programlisting ShellSession">$ nix-channel --add https://nixos.org/channels/nixpkgs-unstable nixpkgsunstable
$ nix-channel --update
$ nix-build &#x27;&lt;nixpkgsunstable&gt;&#x27; -A gitFull
$ nix run -f &#x27;&lt;nixpkgsunstable&gt;&#x27; gitFull
$ nix-instantiate -E &#x27;(import &lt;nixpkgsunstable&gt; {}).gitFull&#x27;
</code></pre></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-18.09-new-services" class="title" >New Services   </h3>  </div> </div></div><p>A curated selection of new services that were added since the last release:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The <code class="literal">services.cassandra</code> module has been reworked and was rewritten from scratch. The service has succeeding tests for the versions 2.1, 2.2, 3.0 and 3.11 of <a class="link" href="https://cassandra.apache.org/"  target="_top">Apache Cassandra</a>.</p></li><li class="listitem"><p>There is a new <code class="literal">services.foundationdb</code> module for deploying <a class="link" href="https://www.foundationdb.org"  target="_top">FoundationDB</a> clusters.</p></li><li class="listitem"><p>When enabled the <code class="literal">iproute2</code> will copy the files expected by ip route (e.g., <code class="literal">rt_tables</code>) in <code class="literal">/etc/iproute2</code>. This allows to write aliases for routing tables for instance.</p></li><li class="listitem"><p><code class="literal">services.strongswan-swanctl</code> is a modern replacement for <code class="literal">services.strongswan</code>. You can use either one of them to setup IPsec VPNs but not both at the same time.</p><p><code class="literal">services.strongswan-swanctl</code> uses the <a class="link" href="https://wiki.strongswan.org/projects/strongswan/wiki/swanctl"  target="_top">swanctl</a> command which uses the modern <a class="link" href="https://github.com/strongswan/strongswan/blob/master/src/libcharon/plugins/vici/README.md"  target="_top">vici</a> <span class="emphasis"><em>Versatile IKE Configuration Interface</em></span>. The deprecated <code class="literal">ipsec</code> command used in <code class="literal">services.strongswan</code> is using the legacy <a class="link" href="https://github.com/strongswan/strongswan/blob/master/README_LEGACY.md"  target="_top">stroke configuration interface</a>.</p></li><li class="listitem"><p>The new <code class="literal">services.elasticsearch-curator</code> service periodically curates or manages, your Elasticsearch indices and snapshots.</p></li></ul></div><p>Every new services:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">./config/xdg/autostart.nix</code></p></li><li class="listitem"><p><code class="literal">./config/xdg/icons.nix</code></p></li><li class="listitem"><p><code class="literal">./config/xdg/menus.nix</code></p></li><li class="listitem"><p><code class="literal">./config/xdg/mime.nix</code></p></li><li class="listitem"><p><code class="literal">./hardware/brightnessctl.nix</code></p></li><li class="listitem"><p><code class="literal">./hardware/onlykey.nix</code></p></li><li class="listitem"><p><code class="literal">./hardware/video/uvcvideo/default.nix</code></p></li><li class="listitem"><p><code class="literal">./misc/documentation.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/firejail.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/iftop.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/sedutil.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/singularity.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/xss-lock.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/zsh/zsh-autosuggestions.nix</code></p></li><li class="listitem"><p><code class="literal">./services/admin/oxidized.nix</code></p></li><li class="listitem"><p><code class="literal">./services/backup/duplicati.nix</code></p></li><li class="listitem"><p><code class="literal">./services/backup/restic.nix</code></p></li><li class="listitem"><p><code class="literal">./services/backup/restic-rest-server.nix</code></p></li><li class="listitem"><p><code class="literal">./services/cluster/hadoop/default.nix</code></p></li><li class="listitem"><p><code class="literal">./services/databases/aerospike.nix</code></p></li><li class="listitem"><p><code class="literal">./services/databases/monetdb.nix</code></p></li><li class="listitem"><p><code class="literal">./services/desktops/bamf.nix</code></p></li><li class="listitem"><p><code class="literal">./services/desktops/flatpak.nix</code></p></li><li class="listitem"><p><code class="literal">./services/desktops/zeitgeist.nix</code></p></li><li class="listitem"><p><code class="literal">./services/development/bloop.nix</code></p></li><li class="listitem"><p><code class="literal">./services/development/jupyter/default.nix</code></p></li><li class="listitem"><p><code class="literal">./services/hardware/lcd.nix</code></p></li><li class="listitem"><p><code class="literal">./services/hardware/undervolt.nix</code></p></li><li class="listitem"><p><code class="literal">./services/misc/clipmenu.nix</code></p></li><li class="listitem"><p><code class="literal">./services/misc/gitweb.nix</code></p></li><li class="listitem"><p><code class="literal">./services/misc/serviio.nix</code></p></li><li class="listitem"><p><code class="literal">./services/misc/safeeyes.nix</code></p></li><li class="listitem"><p><code class="literal">./services/misc/sysprof.nix</code></p></li><li class="listitem"><p><code class="literal">./services/misc/weechat.nix</code></p></li><li class="listitem"><p><code class="literal">./services/monitoring/datadog-agent.nix</code></p></li><li class="listitem"><p><code class="literal">./services/monitoring/incron.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/dnsdist.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/freeradius.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/hans.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/morty.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/ndppd.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/ocserv.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/owamp.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/quagga.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/shadowsocks.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/stubby.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/zeronet.nix</code></p></li><li class="listitem"><p><code class="literal">./services/security/certmgr.nix</code></p></li><li class="listitem"><p><code class="literal">./services/security/cfssl.nix</code></p></li><li class="listitem"><p><code class="literal">./services/security/oauth2_proxy_nginx.nix</code></p></li><li class="listitem"><p><code class="literal">./services/web-apps/virtlyst.nix</code></p></li><li class="listitem"><p><code class="literal">./services/web-apps/youtrack.nix</code></p></li><li class="listitem"><p><code class="literal">./services/web-servers/hitch/default.nix</code></p></li><li class="listitem"><p><code class="literal">./services/web-servers/hydron.nix</code></p></li><li class="listitem"><p><code class="literal">./services/web-servers/meguca.nix</code></p></li><li class="listitem"><p><code class="literal">./services/web-servers/nginx/gitweb.nix</code></p></li><li class="listitem"><p><code class="literal">./virtualisation/kvmgt.nix</code></p></li><li class="listitem"><p><code class="literal">./virtualisation/qemu-guest-agent.nix</code></p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-18.09-incompatibilities" class="title" >Backward Incompatibilities   </h3>  </div> </div></div><p>When upgrading from a previous release, please be aware of the following incompatible changes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Some licenses that were incorrectly not marked as unfree now are. This is the case for:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>cc-by-nc-sa-20: Creative Commons Attribution Non Commercial Share Alike 2.0</p></li><li class="listitem"><p>cc-by-nc-sa-25: Creative Commons Attribution Non Commercial Share Alike 2.5</p></li><li class="listitem"><p>cc-by-nc-sa-30: Creative Commons Attribution Non Commercial Share Alike 3.0</p></li><li class="listitem"><p>cc-by-nc-sa-40: Creative Commons Attribution Non Commercial Share Alike 4.0</p></li><li class="listitem"><p>cc-by-nd-30: Creative Commons Attribution-No Derivative Works v3.00</p></li><li class="listitem"><p>msrla: Microsoft Research License Agreement</p></li></ul></div></li><li class="listitem"><p>The deprecated <code class="literal">services.cassandra</code> module has seen a complete rewrite. (See above.)</p></li><li class="listitem"><p><code class="literal">lib.strict</code> is removed. Use <code class="literal">builtins.seq</code> instead.</p></li><li class="listitem"><p>The <code class="literal">clementine</code> package points now to the free derivation. <code class="literal">clementineFree</code> is removed now and <code class="literal">clementineUnfree</code> points to the package which is bundled with the unfree <code class="literal">libspotify</code> package.</p></li><li class="listitem"><p>The <code class="literal">netcat</code> package is now taken directly from OpenBSD’s <code class="literal">libressl</code>, instead of relying on Debian’s fork. The new version should be very close to the old version, but there are some minor differences. Importantly, flags like -b, -q, -C, and -Z are no longer accepted by the nc command.</p></li><li class="listitem"><p>The <code class="literal">services.docker-registry.extraConfig</code> object doesn’t contain environment variables anymore. Instead it needs to provide an object structure that can be mapped onto the YAML configuration defined in <a class="link" href="https://github.com/docker/distribution/blob/v2.6.2/docs/configuration.md"  target="_top">the <code class="literal">docker/distribution</code> docs</a>.</p></li><li class="listitem"><p><code class="literal">gnucash</code> has changed from version 2.4 to 3.x. If you’ve been using <code class="literal">gnucash</code> (version 2.4) instead of <code class="literal">gnucash26</code> (version 2.6) you must open your Gnucash data file(s) with <code class="literal">gnucash26</code> and then save them to upgrade the file format. Then you may use your data file(s) with Gnucash 3.x. See the upgrade <a class="link" href="https://wiki.gnucash.org/wiki/FAQ#Using_Different_Versions.2C_Up_And_Downgrade"  target="_top">documentation</a>. Gnucash 2.4 is still available under the attribute <code class="literal">gnucash24</code>.</p></li><li class="listitem"><p><code class="literal">services.munge</code> now runs as user (and group) <code class="literal">munge</code> instead of root. Make sure the key file is accessible to the daemon.</p></li><li class="listitem"><p><code class="literal">dockerTools.buildImage</code> now uses <code class="literal">null</code> as default value for <code class="literal">tag</code>, which indicates that the nix output hash will be used as tag.</p></li><li class="listitem"><p>The ELK stack: <code class="literal">elasticsearch</code>, <code class="literal">logstash</code> and <code class="literal">kibana</code> has been upgraded from 2.* to 6.3.*. The 2.* versions have been <a class="link" href="https://www.elastic.co/support/eol"  target="_top">unsupported since last year</a> so they have been removed. You can still use the 5.* versions under the names <code class="literal">elasticsearch5</code>, <code class="literal">logstash5</code> and <code class="literal">kibana5</code>.</p><p>The elastic beats: <code class="literal">filebeat</code>, <code class="literal">heartbeat</code>, <code class="literal">metricbeat</code> and <code class="literal">packetbeat</code> have had the same treatment: they now target 6.3.* as well. The 5.* versions are available under the names: <code class="literal">filebeat5</code>, <code class="literal">heartbeat5</code>, <code class="literal">metricbeat5</code> and <code class="literal">packetbeat5</code></p><p>The ELK-6.3 stack now comes with <a class="link" href="https://www.elastic.co/products/x-pack/open"  target="_top">X-Pack by default</a>. Since X-Pack is licensed under the <a class="link" href="https://github.com/elastic/elasticsearch/blob/master/licenses/ELASTIC-LICENSE.txt"  target="_top">Elastic License</a> the ELK packages now have an unfree license. To use them you need to specify <code class="literal">allowUnfree = true;</code> in your nixpkgs configuration.</p><p>Fortunately there is also a free variant of the ELK stack without X-Pack. The packages are available under the names: <code class="literal">elasticsearch-oss</code>, <code class="literal">logstash-oss</code> and <code class="literal">kibana-oss</code>.</p></li><li class="listitem"><p>Options <code class="literal">boot.initrd.luks.devices.name.yubikey.ramfsMountPoint</code> <code class="literal">boot.initrd.luks.devices.name.yubikey.storage.mountPoint</code> were removed. <code class="literal">luksroot.nix</code> module never supported more than one YubiKey at a time anyway, hence those options never had any effect. You should be able to remove them from your config without any issues.</p></li><li class="listitem"><p><code class="literal">stdenv.system</code> and <code class="literal">system</code> in nixpkgs now refer to the host platform instead of the build platform. For native builds this is not change, let alone a breaking one. For cross builds, it is a breaking change, and <code class="literal">stdenv.buildPlatform.system</code> can be used instead for the old behavior. They should be using that anyways for clarity.</p></li><li class="listitem"><p>Groups <code class="literal">kvm</code> and <code class="literal">render</code> are introduced now, as systemd requires them.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-18.09-notable-changes" class="title" >Other Notable Changes   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">dockerTools.pullImage</code> relies on image digest instead of image tag to download the image. The <code class="literal">sha256</code> of a pulled image has to be updated.</p></li><li class="listitem"><p><code class="literal">lib.attrNamesToStr</code> has been deprecated. Use more specific concatenation (<code class="literal">lib.concat(Map)StringsSep</code>) instead.</p></li><li class="listitem"><p><code class="literal">lib.addErrorContextToAttrs</code> has been deprecated. Use <code class="literal">builtins.addErrorContext</code> directly.</p></li><li class="listitem"><p><code class="literal">lib.showVal</code> has been deprecated. Use <code class="literal">lib.traceSeqN</code> instead.</p></li><li class="listitem"><p><code class="literal">lib.traceXMLVal</code> has been deprecated. Use <code class="literal">lib.traceValFn builtins.toXml</code> instead.</p></li><li class="listitem"><p><code class="literal">lib.traceXMLValMarked</code> has been deprecated. Use <code class="literal">lib.traceValFn (x: str + builtins.toXML x)</code> instead.</p></li><li class="listitem"><p>The <code class="literal">pkgs</code> argument to NixOS modules can now be set directly using <code class="literal">nixpkgs.pkgs</code>. Previously, only the <code class="literal">system</code>, <code class="literal">config</code> and <code class="literal">overlays</code> arguments could be used to influence <code class="literal">pkgs</code>.</p></li><li class="listitem"><p>A NixOS system can now be constructed more easily based on a preexisting invocation of Nixpkgs. For example:</p><pre><code class="programlisting nix">{
  inherit (pkgs.nixos {
    boot.loader.grub.enable = false;
    fileSystems.&quot;/&quot;.device = &quot;/dev/xvda1&quot;;
  }) toplevel kernel initialRamdisk manual;
}
</code></pre><p>This benefits evaluation performance, lets you write Nixpkgs packages that depend on NixOS images and is consistent with a deployment architecture that would be centered around Nixpkgs overlays.</p></li><li class="listitem"><p><code class="literal">lib.traceValIfNot</code> has been deprecated. Use <code class="literal">if/then/else</code> and <code class="literal">lib.traceValSeq</code> instead.</p></li><li class="listitem"><p><code class="literal">lib.traceCallXml</code> has been deprecated. Please complain if you use the function regularly.</p></li><li class="listitem"><p>The attribute <code class="literal">lib.nixpkgsVersion</code> has been deprecated in favor of <code class="literal">lib.version</code>. Please refer to the discussion in <a class="link" href="https://github.com/NixOS/nixpkgs/pull/39416#discussion_r183845745"  target="_top">NixOS/nixpkgs#39416</a> for further reference.</p></li><li class="listitem"><p><code class="literal">lib.recursiveUpdateUntil</code> was not acting according to its specification. It has been fixed to act according to the docstring, and a test has been added.</p></li><li class="listitem"><p>The module for <code class="literal">security.dhparams</code> has two new options now:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">security.dhparams.stateless</code></span></dt><dd><p>Puts the generated Diffie-Hellman parameters into the Nix store instead of managing them in a stateful manner in <code class="literal">/var/lib/dhparams</code>.</p></dd><dt><span class="term"><code class="literal">security.dhparams.defaultBitSize</code></span></dt><dd><p>The default bit size to use for the generated Diffie-Hellman parameters.</p></dd></dl></div><div class="note"><h3 class="title">Note</h3><p>The path to the actual generated parameter files should now be queried using <code class="literal">config.security.dhparams.params.name.path</code> because it might be either in the Nix store or in a directory configured by <code class="literal">security.dhparams.path</code>.</p></div><div class="note"><h3 class="title">Note</h3><p><span class="strong"><strong>For developers:</strong></span></p><p>Module implementers should not set a specific bit size in order to let users configure it by themselves if they want to have a different bit size than the default (2048).</p><p>An example usage of this would be:</p><pre><code class="programlisting nix">{ config, ... }:

{
  security.dhparams.params.myservice = {};
  environment.etc.&quot;myservice.conf&quot;.text = &#x27;&#x27;
    dhparams = ${config.security.dhparams.params.myservice.path}
  &#x27;&#x27;;
}
</code></pre></div></li><li class="listitem"><p><code class="literal">networking.networkmanager.useDnsmasq</code> has been deprecated. Use <code class="literal">networking.networkmanager.dns</code> instead.</p></li><li class="listitem"><p>The Kubernetes package has been bumped to major version 1.11. Please consult the <a class="link" href="https://github.com/kubernetes/kubernetes/blob/release-1.11/CHANGELOG-1.11.md"  target="_top">release notes</a> for details on new features and api changes.</p></li><li class="listitem"><p>The option <code class="literal">services.kubernetes.apiserver.admissionControl</code> was renamed to <code class="literal">services.kubernetes.apiserver.enableAdmissionPlugins</code>.</p></li><li class="listitem"><p>Recommended way to access the Kubernetes Dashboard is via HTTPS (TLS) Therefore; public service port for the dashboard has changed to 443 (container port 8443) and scheme to https.</p></li><li class="listitem"><p>The option <code class="literal">services.kubernetes.apiserver.address</code> was renamed to <code class="literal">services.kubernetes.apiserver.bindAddress</code>. Note that the default value has changed from 127.0.0.1 to 0.0.0.0.</p></li><li class="listitem"><p>The option <code class="literal">services.kubernetes.apiserver.publicAddress</code> was not used and thus has been removed.</p></li><li class="listitem"><p>The option <code class="literal">services.kubernetes.addons.dashboard.enableRBAC</code> was renamed to <code class="literal">services.kubernetes.addons.dashboard.rbac.enable</code>.</p></li><li class="listitem"><p>The Kubernetes Dashboard now has only minimal RBAC permissions by default. If dashboard cluster-admin rights are desired, set <code class="literal">services.kubernetes.addons.dashboard.rbac.clusterAdmin</code> to true. On existing clusters, in order for the revocation of privileges to take effect, the current ClusterRoleBinding for kubernetes-dashboard must be manually removed: <code class="literal">kubectl delete clusterrolebinding kubernetes-dashboard</code></p></li><li class="listitem"><p>The <code class="literal">programs.screen</code> module provides allows to configure <code class="literal">/etc/screenrc</code>, however the module behaved fairly counterintuitive as the config exists, but the package wasn’t available. Since 18.09 <code class="literal">pkgs.screen</code> will be added to <code class="literal">environment.systemPackages</code>.</p></li><li class="listitem"><p>The module <code class="literal">services.networking.hostapd</code> now uses WPA2 by default.</p></li><li class="listitem"><p><code class="literal">s6Dns</code>, <code class="literal">s6Networking</code>, <code class="literal">s6LinuxUtils</code> and <code class="literal">s6PortableUtils</code> renamed to <code class="literal">s6-dns</code>, <code class="literal">s6-networking</code>, <code class="literal">s6-linux-utils</code> and <code class="literal">s6-portable-utils</code> respectively.</p></li><li class="listitem"><p>The module option <code class="literal">nix.useSandbox</code> is now defaulted to <code class="literal">true</code>.</p></li><li class="listitem"><p>The config activation script of <code class="literal">nixos-rebuild</code> now <a class="link" href="https://www.freedesktop.org/software/systemd/man/systemctl.html#Manager%20Lifecycle%20Commands"  target="_top">reloads</a> all user units for each authenticated user.</p></li><li class="listitem"><p>The default display manager is now LightDM. To use SLiM set <code class="literal">services.xserver.displayManager.slim.enable</code> to <code class="literal">true</code>.</p></li><li class="listitem"><p>NixOS option descriptions are now automatically broken up into individual paragraphs if the text contains two consecutive newlines, so it’s no longer necessary to use <code class="literal">&lt;/para&gt;&lt;para&gt;</code> to start a new paragraph.</p></li><li class="listitem"><p>Top-level <code class="literal">buildPlatform</code>, <code class="literal">hostPlatform</code>, and <code class="literal">targetPlatform</code> in Nixpkgs are deprecated. Please use their equivalents in <code class="literal">stdenv</code> instead: <code class="literal">stdenv.buildPlatform</code>, <code class="literal">stdenv.hostPlatform</code>, and <code class="literal">stdenv.targetPlatform</code>.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-18.03" class="title" style="clear: both">Release 18.03 (“Impala”, 2018/04/04)   </h2>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-18.03-highlights" class="title" >Highlights   </h3>  </div> </div></div><p>In addition to numerous new and upgraded packages, this release has the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>End of support is planned for end of October 2018, handing over to 18.09.</p></li><li class="listitem"><p>Platform support: x86_64-linux and x86_64-darwin since release time (the latter isn’t NixOS, really). Binaries for aarch64-linux are available, but no channel exists yet, as it’s waiting for some test fixes, etc.</p></li><li class="listitem"><p>Nix now defaults to 2.0; see its <a class="link" href="https://nixos.org/nix/manual/#ssec-relnotes-2.0"  target="_top">release notes</a>.</p></li><li class="listitem"><p>Core version changes: linux: 4.9 -&gt; 4.14, glibc: 2.25 -&gt; 2.26, gcc: 6 -&gt; 7, systemd: 234 -&gt; 237.</p></li><li class="listitem"><p>Desktop version changes: gnome: 3.24 -&gt; 3.26, (KDE) plasma-desktop: 5.10 -&gt; 5.12.</p></li><li class="listitem"><p>MariaDB 10.2, updated from 10.1, is now the default MySQL implementation. While upgrading a few changes have been made to the infrastructure involved:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">libmysql</code> has been deprecated, please use <code class="literal">mysql.connector-c</code> instead, a compatibility passthru has been added to the MySQL packages.</p></li><li class="listitem"><p>The <code class="literal">mysql57</code> package has a new <code class="literal">static</code> output containing the static libraries including <code class="literal">libmysqld.a</code></p></li></ul></div></li><li class="listitem"><p>PHP now defaults to PHP 7.2, updated from 7.1.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-18.03-new-services" class="title" >New Services   </h3>  </div> </div></div><p>The following new services were added since the last release:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">./config/krb5/default.nix</code></p></li><li class="listitem"><p><code class="literal">./hardware/digitalbitbox.nix</code></p></li><li class="listitem"><p><code class="literal">./misc/label.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/ccache.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/criu.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/digitalbitbox/default.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/less.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/npm.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/plotinus.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/rootston.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/systemtap.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/sway.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/udevil.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/way-cooler.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/yabar.nix</code></p></li><li class="listitem"><p><code class="literal">./programs/zsh/zsh-autoenv.nix</code></p></li><li class="listitem"><p><code class="literal">./services/backup/borgbackup.nix</code></p></li><li class="listitem"><p><code class="literal">./services/backup/crashplan-small-business.nix</code></p></li><li class="listitem"><p><code class="literal">./services/desktops/dleyna-renderer.nix</code></p></li><li class="listitem"><p><code class="literal">./services/desktops/dleyna-server.nix</code></p></li><li class="listitem"><p><code class="literal">./services/desktops/pipewire.nix</code></p></li><li class="listitem"><p><code class="literal">./services/desktops/gnome3/chrome-gnome-shell.nix</code></p></li><li class="listitem"><p><code class="literal">./services/desktops/gnome3/tracker-miners.nix</code></p></li><li class="listitem"><p><code class="literal">./services/hardware/fwupd.nix</code></p></li><li class="listitem"><p><code class="literal">./services/hardware/interception-tools.nix</code></p></li><li class="listitem"><p><code class="literal">./services/hardware/u2f.nix</code></p></li><li class="listitem"><p><code class="literal">./services/hardware/usbmuxd.nix</code></p></li><li class="listitem"><p><code class="literal">./services/mail/clamsmtp.nix</code></p></li><li class="listitem"><p><code class="literal">./services/mail/dkimproxy-out.nix</code></p></li><li class="listitem"><p><code class="literal">./services/mail/pfix-srsd.nix</code></p></li><li class="listitem"><p><code class="literal">./services/misc/gitea.nix</code></p></li><li class="listitem"><p><code class="literal">./services/misc/home-assistant.nix</code></p></li><li class="listitem"><p><code class="literal">./services/misc/ihaskell.nix</code></p></li><li class="listitem"><p><code class="literal">./services/misc/logkeys.nix</code></p></li><li class="listitem"><p><code class="literal">./services/misc/novacomd.nix</code></p></li><li class="listitem"><p><code class="literal">./services/misc/osrm.nix</code></p></li><li class="listitem"><p><code class="literal">./services/misc/plexpy.nix</code></p></li><li class="listitem"><p><code class="literal">./services/misc/pykms.nix</code></p></li><li class="listitem"><p><code class="literal">./services/misc/tzupdate.nix</code></p></li><li class="listitem"><p><code class="literal">./services/monitoring/fusion-inventory.nix</code></p></li><li class="listitem"><p><code class="literal">./services/monitoring/prometheus/exporters.nix</code></p></li><li class="listitem"><p><code class="literal">./services/network-filesystems/beegfs.nix</code></p></li><li class="listitem"><p><code class="literal">./services/network-filesystems/davfs2.nix</code></p></li><li class="listitem"><p><code class="literal">./services/network-filesystems/openafs/client.nix</code></p></li><li class="listitem"><p><code class="literal">./services/network-filesystems/openafs/server.nix</code></p></li><li class="listitem"><p><code class="literal">./services/network-filesystems/ceph.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/aria2.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/monero.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/nghttpx/default.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/nixops-dns.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/rxe.nix</code></p></li><li class="listitem"><p><code class="literal">./services/networking/stunnel.nix</code></p></li><li class="listitem"><p><code class="literal">./services/web-apps/matomo.nix</code></p></li><li class="listitem"><p><code class="literal">./services/web-apps/restya-board.nix</code></p></li><li class="listitem"><p><code class="literal">./services/web-servers/mighttpd2.nix</code></p></li><li class="listitem"><p><code class="literal">./services/x11/fractalart.nix</code></p></li><li class="listitem"><p><code class="literal">./system/boot/binfmt.nix</code></p></li><li class="listitem"><p><code class="literal">./system/boot/grow-partition.nix</code></p></li><li class="listitem"><p><code class="literal">./tasks/filesystems/ecryptfs.nix</code></p></li><li class="listitem"><p><code class="literal">./virtualisation/hyperv-guest.nix</code></p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-18.03-incompatibilities" class="title" >Backward Incompatibilities   </h3>  </div> </div></div><p>When upgrading from a previous release, please be aware of the following incompatible changes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">sound.enable</code> now defaults to false.</p></li><li class="listitem"><p>Dollar signs in options under <code class="literal">services.postfix</code> are passed verbatim to Postfix, which will interpret them as the beginning of a parameter expression. This was already true for string-valued options in the previous release, but not for list-valued options. If you need to pass literal dollar signs through Postfix, double them.</p></li><li class="listitem"><p>The <code class="literal">postage</code> package (for web-based PostgreSQL administration) has been renamed to <code class="literal">pgmanage</code>. The corresponding module has also been renamed. To migrate please rename all <code class="literal">services.postage</code> options to <code class="literal">services.pgmanage</code>.</p></li><li class="listitem"><p>Package attributes starting with a digit have been prefixed with an underscore sign. This is to avoid quoting in the configuration and other issues with command-line tools like <code class="literal">nix-env</code>. The change affects the following packages:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">2048-in-terminal</code> → <code class="literal">_2048-in-terminal</code></p></li><li class="listitem"><p><code class="literal">90secondportraits</code> → <code class="literal">_90secondportraits</code></p></li><li class="listitem"><p><code class="literal">2bwm</code> → <code class="literal">_2bwm</code></p></li><li class="listitem"><p><code class="literal">389-ds-base</code> → <code class="literal">_389-ds-base</code></p></li></ul></div></li><li class="listitem"><p><span class="strong"><strong>The OpenSSH service no longer enables support for DSA keys by default, which could cause a system lock out. Update your keys or, unfavorably, re-enable DSA support manually.</strong></span></p><p>DSA support was <a class="link" href="https://www.openssh.com/legacy.html"  target="_top">deprecated in OpenSSH 7.0</a>, due to it being too weak. To re-enable support, add <code class="literal">PubkeyAcceptedKeyTypes +ssh-dss</code> to the end of your <code class="literal">services.openssh.extraConfig</code>.</p><p>After updating the keys to be stronger, anyone still on a pre-17.03 version is safe to jump to 17.03, as vetted <a class="link" href="https://search.nix.gsc.io/?q=stateVersion"  target="_top">here</a>.</p></li><li class="listitem"><p>The <code class="literal">openssh</code> package now includes Kerberos support by default; the <code class="literal">openssh_with_kerberos</code> package is now a deprecated alias. If you do not want Kerberos support, you can do <code class="literal">openssh.override { withKerberos = false; }</code>. Note, this also applies to the <code class="literal">openssh_hpn</code> package.</p></li><li class="listitem"><p><code class="literal">cc-wrapper</code> has been split in two; there is now also a <code class="literal">bintools-wrapper</code>. The most commonly used files in <code class="literal">nix-support</code> are now split between the two wrappers. Some commonly used ones, like <code class="literal">nix-support/dynamic-linker</code>, are duplicated for backwards compatibility, even though they rightly belong only in <code class="literal">bintools-wrapper</code>. Other more obscure ones are just moved.</p></li><li class="listitem"><p>The propagation logic has been changed. The new logic, along with new types of dependencies that go with, is thoroughly documented in the “Specifying dependencies” section of the “Standard Environment” chapter of the nixpkgs manual. The old logic isn’t but is easy to describe: dependencies were propagated as the same type of dependency no matter what. In practice, that means that many <code class="literal">propagatedNativeBuildInputs</code> should instead be <code class="literal">propagatedBuildInputs</code>. Thankfully, that was and is the least used type of dependency. Also, it means that some <code class="literal">propagatedBuildInputs</code> should instead be <code class="literal">depsTargetTargetPropagated</code>. Other types dependencies should be unaffected.</p></li><li class="listitem"><p><code class="literal">lib.addPassthru drv passthru</code> is removed. Use <code class="literal">lib.extendDerivation true passthru drv</code> instead.</p></li><li class="listitem"><p>The <code class="literal">memcached</code> service no longer accept dynamic socket paths via <code class="literal">services.memcached.socket</code>. Unix sockets can be still enabled by <code class="literal">services.memcached.enableUnixSocket</code> and will be accessible at <code class="literal">/run/memcached/memcached.sock</code>.</p></li><li class="listitem"><p>The <code class="literal">hardware.amdHybridGraphics.disable</code> option was removed for lack of a maintainer. If you still need this module, you may wish to include a copy of it from an older version of nixos in your imports.</p></li><li class="listitem"><p>The merging of config options for <code class="literal">services.postfix.config</code> was buggy. Previously, if other options in the Postfix module like <code class="literal">services.postfix.useSrs</code> were set and the user set config options that were also set by such options, the resulting config wouldn’t include all options that were needed. They are now merged correctly. If config options need to be overridden, <code class="literal">lib.mkForce</code> or <code class="literal">lib.mkOverride</code> can be used.</p></li><li class="listitem"><p>The following changes apply if the <code class="literal">stateVersion</code> is changed to 18.03 or higher. For <code class="literal">stateVersion = &quot;17.09&quot;</code> or lower the old behavior is preserved.</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: circle;"><li class="listitem"><p><code class="literal">matrix-synapse</code> uses postgresql by default instead of sqlite. Migration instructions can be found <a class="link" href="https://github.com/matrix-org/synapse/blob/master/docs/postgres.rst#porting-from-sqlite"  target="_top"> here </a>.</p></li></ul></div></li><li class="listitem"><p>The <code class="literal">jid</code> package has been removed, due to maintenance overhead of a go package having non-versioned dependencies.</p></li><li class="listitem"><p>When using <code class="literal">services.xserver.libinput</code> (enabled by default in GNOME), it now handles all input devices, not just touchpads. As a result, you might need to re-evaluate any custom Xorg configuration. In particular, <code class="literal">Option &quot;XkbRules&quot; &quot;base&quot;</code> may result in broken keyboard layout.</p></li><li class="listitem"><p>The <code class="literal">attic</code> package was removed. A maintained fork called <a class="link" href="https://www.borgbackup.org/"  target="_top">Borg</a> should be used instead. Migration instructions can be found <a class="link" href="http://borgbackup.readthedocs.io/en/stable/usage/upgrade.html#attic-and-borg-0-xx-to-borg-1-x"  target="_top">here</a>.</p></li><li class="listitem"><p>The Piwik analytics software was renamed to Matomo:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>The package <code class="literal">pkgs.piwik</code> was renamed to <code class="literal">pkgs.matomo</code>.</p></li><li class="listitem"><p>The service <code class="literal">services.piwik</code> was renamed to <code class="literal">services.matomo</code>.</p></li><li class="listitem"><p>The data directory <code class="literal">/var/lib/piwik</code> was renamed to <code class="literal">/var/lib/matomo</code>. All files will be moved automatically on first startup, but you might need to adjust your backup scripts.</p></li><li class="listitem"><p>The default <code class="literal">serverName</code> for the nginx configuration changed from <code class="literal">piwik.${config.networking.hostName}</code> to <code class="literal">matomo.${config.networking.hostName}.${config.networking.domain}</code> if <code class="literal">config.networking.domain</code> is set, <code class="literal">matomo.${config.networking.hostName}</code> if it is not set. If you change your <code class="literal">serverName</code>, remember you’ll need to update the <code class="literal">trustedHosts[]</code> array in <code class="literal">/var/lib/matomo/config/config.ini.php</code> as well.</p></li><li class="listitem"><p>The <code class="literal">piwik</code> user was renamed to <code class="literal">matomo</code>. The service will adjust ownership automatically for files in the data directory. If you use unix socket authentication, remember to give the new <code class="literal">matomo</code> user access to the database and to change the <code class="literal">username</code> to <code class="literal">matomo</code> in the <code class="literal">[database]</code> section of <code class="literal">/var/lib/matomo/config/config.ini.php</code>.</p></li><li class="listitem"><p>If you named your database `piwik`, you might want to rename it to `matomo` to keep things clean, but this is neither enforced nor required.</p></li></ul></div></li><li class="listitem"><p><code class="literal">nodejs-4_x</code> is end-of-life. <code class="literal">nodejs-4_x</code>, <code class="literal">nodejs-slim-4_x</code> and <code class="literal">nodePackages_4_x</code> are removed.</p></li><li class="listitem"><p>The <code class="literal">pump.io</code> NixOS module was removed. It is now maintained as an <a class="link" href="https://github.com/rvl/pump.io-nixos"  target="_top">external module</a>.</p></li><li class="listitem"><p>The Prosody XMPP server has received a major update. The following modules were renamed:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">services.prosody.modules.httpserver</code> is now <code class="literal">services.prosody.modules.http_files</code></p></li><li class="listitem"><p><code class="literal">services.prosody.modules.console</code> is now <code class="literal">services.prosody.modules.admin_telnet</code></p></li></ul></div><p>Many new modules are now core modules, most notably <code class="literal">services.prosody.modules.carbons</code> and <code class="literal">services.prosody.modules.mam</code>.</p><p>The better-performing <code class="literal">libevent</code> backend is now enabled by default.</p><p><code class="literal">withCommunityModules</code> now passes through the modules to <code class="literal">services.prosody.extraModules</code>. Use <code class="literal">withOnlyInstalledCommunityModules</code> for modules that should not be enabled directly, e.g <code class="literal">lib_ldap</code>.</p></li><li class="listitem"><p>All prometheus exporter modules are now defined as submodules. The exporters are configured using <code class="literal">services.prometheus.exporters</code>.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-18.03-notable-changes" class="title" >Other Notable Changes   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>ZNC option <code class="literal">services.znc.mutable</code> now defaults to <code class="literal">true</code>. That means that old configuration is not overwritten by default when update to the znc options are made.</p></li><li class="listitem"><p>The option <code class="literal">networking.wireless.networks.&lt;name&gt;.auth</code> has been added for wireless networks with WPA-Enterprise authentication. There is also a new <code class="literal">extraConfig</code> option to directly configure <code class="literal">wpa_supplicant</code> and <code class="literal">hidden</code> to connect to hidden networks.</p></li><li class="listitem"><p>In the module <code class="literal">networking.interfaces.&lt;name&gt;</code> the following options have been removed:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p><code class="literal">ipAddress</code></p></li><li class="listitem"><p><code class="literal">ipv6Address</code></p></li><li class="listitem"><p><code class="literal">prefixLength</code></p></li><li class="listitem"><p><code class="literal">ipv6PrefixLength</code></p></li><li class="listitem"><p><code class="literal">subnetMask</code></p></li></ul></div><p>To assign static addresses to an interface the options <code class="literal">ipv4.addresses</code> and <code class="literal">ipv6.addresses</code> should be used instead. The options <code class="literal">ip4</code> and <code class="literal">ip6</code> have been renamed to <code class="literal">ipv4.addresses</code> <code class="literal">ipv6.addresses</code> respectively. The new options <code class="literal">ipv4.routes</code> and <code class="literal">ipv6.routes</code> have been added to set up static routing.</p></li><li class="listitem"><p>The option <code class="literal">services.logstash.listenAddress</code> is now <code class="literal">127.0.0.1</code> by default. Previously the default behaviour was to listen on all interfaces.</p></li><li class="listitem"><p><code class="literal">services.btrfs.autoScrub</code> has been added, to periodically check btrfs filesystems for data corruption. If there’s a correct copy available, it will automatically repair corrupted blocks.</p></li><li class="listitem"><p><code class="literal">displayManager.lightdm.greeters.gtk.clock-format.</code> has been added, the clock format string (as expected by strftime, e.g. <code class="literal">%H:%M</code>) to use with the lightdm gtk greeter panel.</p><p>If set to null the default clock format is used.</p></li><li class="listitem"><p><code class="literal">displayManager.lightdm.greeters.gtk.indicators</code> has been added, a list of allowed indicator modules to use with the lightdm gtk greeter panel.</p><p>Built-in indicators include <code class="literal">~a11y</code>, <code class="literal">~language</code>, <code class="literal">~session</code>, <code class="literal">~power</code>, <code class="literal">~clock</code>, <code class="literal">~host</code>, <code class="literal">~spacer</code>. Unity indicators can be represented by short name (e.g. <code class="literal">sound</code>, <code class="literal">power</code>), service file name, or absolute path.</p><p>If set to <code class="literal">null</code> the default indicators are used.</p><p>In order to have the previous default configuration add</p><pre><code class="programlisting nix">{
  services.xserver.displayManager.lightdm.greeters.gtk.indicators = [
    &quot;~host&quot; &quot;~spacer&quot;
    &quot;~clock&quot; &quot;~spacer&quot;
    &quot;~session&quot;
    &quot;~language&quot;
    &quot;~a11y&quot;
    &quot;~power&quot;
  ];
}
</code></pre><p>to your <code class="literal">configuration.nix</code>.</p></li><li class="listitem"><p>The NixOS test driver supports user services declared by <code class="literal">systemd.user.services</code>. The methods <code class="literal">waitForUnit</code>, <code class="literal">getUnitInfo</code>, <code class="literal">startJob</code> and <code class="literal">stopJob</code> provide an optional <code class="literal">$user</code> argument for that purpose.</p></li><li class="listitem"><p>Enabling bash completion on NixOS, <code class="literal">programs.bash.enableCompletion</code>, will now also enable completion for the Nix command line tools by installing the <a class="link" href="https://github.com/hedning/nix-bash-completions"  target="_top">nix-bash-completions</a> package.</p></li><li class="listitem"><p>The vim/kakoune plugin updater now reads from a CSV file: check <code class="literal">pkgs/applications/editors/vim/plugins/vim-plugin-names</code> out to see the new format</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-17.09" class="title" style="clear: both">Release 17.09 (“Hummingbird”, 2017/09/??)   </h2>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-17.09-highlights" class="title" >Highlights   </h3>  </div> </div></div><p>In addition to numerous new and upgraded packages, this release has the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The GNOME version is now 3.24. KDE Plasma was upgraded to 5.10, KDE Applications to 17.08.1 and KDE Frameworks to 5.37.</p></li><li class="listitem"><p>The user handling now keeps track of deallocated UIDs/GIDs. When a user or group is revived, this allows it to be allocated the UID/GID it had before. A consequence is that UIDs and GIDs are no longer reused.</p></li><li class="listitem"><p>The module option <code class="literal">services.xserver.xrandrHeads</code> now causes the first head specified in this list to be set as the primary head. Apart from that, it’s now possible to also set additional options by using an attribute set, for example:</p><pre><code class="programlisting nix">{ services.xserver.xrandrHeads = [
    &quot;HDMI-0&quot;
    {
      output = &quot;DVI-0&quot;;
      primary = true;
      monitorConfig = &#x27;&#x27;
        Option &quot;Rotate&quot; &quot;right&quot;
      &#x27;&#x27;;
    }
  ];
}
</code></pre><p>This will set the <code class="literal">DVI-0</code> output to be the primary head, even though <code class="literal">HDMI-0</code> is the first head in the list.</p></li><li class="listitem"><p>The handling of SSL in the <code class="literal">services.nginx</code> module has been cleaned up, renaming the misnamed <code class="literal">enableSSL</code> to <code class="literal">onlySSL</code> which reflects its original intention. This is not to be used with the already existing <code class="literal">forceSSL</code> which creates a second non-SSL virtual host redirecting to the SSL virtual host. This by chance had worked earlier due to specific implementation details. In case you had specified both please remove the <code class="literal">enableSSL</code> option to keep the previous behaviour.</p><p>Another <code class="literal">addSSL</code> option has been introduced to configure both a non-SSL virtual host and an SSL virtual host with the same configuration.</p><p>Options to configure <code class="literal">resolver</code> options and <code class="literal">upstream</code> blocks have been introduced. See their information for further details.</p><p>The <code class="literal">port</code> option has been replaced by a more generic <code class="literal">listen</code> option which makes it possible to specify multiple addresses, ports and SSL configs dependant on the new SSL handling mentioned above.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-17.09-new-services" class="title" >New Services   </h3>  </div> </div></div><p>The following new services were added since the last release:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">config/fonts/fontconfig-penultimate.nix</code></p></li><li class="listitem"><p><code class="literal">config/fonts/fontconfig-ultimate.nix</code></p></li><li class="listitem"><p><code class="literal">config/terminfo.nix</code></p></li><li class="listitem"><p><code class="literal">hardware/sensor/iio.nix</code></p></li><li class="listitem"><p><code class="literal">hardware/nitrokey.nix</code></p></li><li class="listitem"><p><code class="literal">hardware/raid/hpsa.nix</code></p></li><li class="listitem"><p><code class="literal">programs/browserpass.nix</code></p></li><li class="listitem"><p><code class="literal">programs/gnupg.nix</code></p></li><li class="listitem"><p><code class="literal">programs/qt5ct.nix</code></p></li><li class="listitem"><p><code class="literal">programs/slock.nix</code></p></li><li class="listitem"><p><code class="literal">programs/thefuck.nix</code></p></li><li class="listitem"><p><code class="literal">security/auditd.nix</code></p></li><li class="listitem"><p><code class="literal">security/lock-kernel-modules.nix</code></p></li><li class="listitem"><p><code class="literal">service-managers/docker.nix</code></p></li><li class="listitem"><p><code class="literal">service-managers/trivial.nix</code></p></li><li class="listitem"><p><code class="literal">services/admin/salt/master.nix</code></p></li><li class="listitem"><p><code class="literal">services/admin/salt/minion.nix</code></p></li><li class="listitem"><p><code class="literal">services/audio/slimserver.nix</code></p></li><li class="listitem"><p><code class="literal">services/cluster/kubernetes/default.nix</code></p></li><li class="listitem"><p><code class="literal">services/cluster/kubernetes/dns.nix</code></p></li><li class="listitem"><p><code class="literal">services/cluster/kubernetes/dashboard.nix</code></p></li><li class="listitem"><p><code class="literal">services/continuous-integration/hail.nix</code></p></li><li class="listitem"><p><code class="literal">services/databases/clickhouse.nix</code></p></li><li class="listitem"><p><code class="literal">services/databases/postage.nix</code></p></li><li class="listitem"><p><code class="literal">services/desktops/gnome3/gnome-disks.nix</code></p></li><li class="listitem"><p><code class="literal">services/desktops/gnome3/gpaste.nix</code></p></li><li class="listitem"><p><code class="literal">services/logging/SystemdJournal2Gelf.nix</code></p></li><li class="listitem"><p><code class="literal">services/logging/heartbeat.nix</code></p></li><li class="listitem"><p><code class="literal">services/logging/journalwatch.nix</code></p></li><li class="listitem"><p><code class="literal">services/logging/syslogd.nix</code></p></li><li class="listitem"><p><code class="literal">services/mail/mailhog.nix</code></p></li><li class="listitem"><p><code class="literal">services/mail/nullmailer.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/airsonic.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/autorandr.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/exhibitor.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/fstrim.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/gollum.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/irkerd.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/jackett.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/radarr.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/snapper.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/osquery.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/prometheus/collectd-exporter.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/prometheus/fritzbox-exporter.nix</code></p></li><li class="listitem"><p><code class="literal">services/network-filesystems/kbfs.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/dnscache.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/fireqos.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/iwd.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/keepalived/default.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/keybase.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/lldpd.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/matterbridge.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/squid.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/tinydns.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/xrdp.nix</code></p></li><li class="listitem"><p><code class="literal">services/security/shibboleth-sp.nix</code></p></li><li class="listitem"><p><code class="literal">services/security/sks.nix</code></p></li><li class="listitem"><p><code class="literal">services/security/sshguard.nix</code></p></li><li class="listitem"><p><code class="literal">services/security/torify.nix</code></p></li><li class="listitem"><p><code class="literal">services/security/usbguard.nix</code></p></li><li class="listitem"><p><code class="literal">services/security/vault.nix</code></p></li><li class="listitem"><p><code class="literal">services/system/earlyoom.nix</code></p></li><li class="listitem"><p><code class="literal">services/system/saslauthd.nix</code></p></li><li class="listitem"><p><code class="literal">services/web-apps/nexus.nix</code></p></li><li class="listitem"><p><code class="literal">services/web-apps/pgpkeyserver-lite.nix</code></p></li><li class="listitem"><p><code class="literal">services/web-apps/piwik.nix</code></p></li><li class="listitem"><p><code class="literal">services/web-servers/lighttpd/collectd.nix</code></p></li><li class="listitem"><p><code class="literal">services/web-servers/minio.nix</code></p></li><li class="listitem"><p><code class="literal">services/x11/display-managers/xpra.nix</code></p></li><li class="listitem"><p><code class="literal">services/x11/xautolock.nix</code></p></li><li class="listitem"><p><code class="literal">tasks/filesystems/bcachefs.nix</code></p></li><li class="listitem"><p><code class="literal">tasks/powertop.nix</code></p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-17.09-incompatibilities" class="title" >Backward Incompatibilities   </h3>  </div> </div></div><p>When upgrading from a previous release, please be aware of the following incompatible changes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><span class="strong"><strong>In an Qemu-based virtualization environment, the network interface names changed from i.e. <code class="literal">enp0s3</code> to <code class="literal">ens3</code>.</strong></span></p><p>This is due to a kernel configuration change. The new naming is consistent with those of other Linux distributions with systemd. See <a class="link" href="https://github.com/NixOS/nixpkgs/issues/29197"  target="_top">#29197</a> for more information.</p><p>A machine is affected if the <code class="literal">virt-what</code> tool either returns <code class="literal">qemu</code> or <code class="literal">kvm</code> <span class="emphasis"><em>and</em></span> has interface names used in any part of its NixOS configuration, in particular if a static network configuration with <code class="literal">networking.interfaces</code> is used.</p><p>Before rebooting affected machines, please ensure:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>Change the interface names in your NixOS configuration. The first interface will be called <code class="literal">ens3</code>, the second one <code class="literal">ens8</code> and starting from there incremented by 1.</p></li><li class="listitem"><p>After changing the interface names, rebuild your system with <code class="literal">nixos-rebuild boot</code> to activate the new configuration after a reboot. If you switch to the new configuration right away you might lose network connectivity! If using <code class="literal">nixops</code>, deploy with <code class="literal">nixops deploy --force-reboot</code>.</p></li></ul></div></li><li class="listitem"><p>The following changes apply if the <code class="literal">stateVersion</code> is changed to 17.09 or higher. For <code class="literal">stateVersion = &quot;17.03&quot;</code> or lower the old behavior is preserved.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: circle;"><li class="listitem"><p>The <code class="literal">postgres</code> default version was changed from 9.5 to 9.6.</p></li><li class="listitem"><p>The <code class="literal">postgres</code> superuser name has changed from <code class="literal">root</code> to <code class="literal">postgres</code> to more closely follow what other Linux distributions are doing.</p></li><li class="listitem"><p>The <code class="literal">postgres</code> default <code class="literal">dataDir</code> has changed from <code class="literal">/var/db/postgres</code> to <code class="literal">/var/lib/postgresql/$psqlSchema</code> where $psqlSchema is 9.6 for example.</p></li><li class="listitem"><p>The <code class="literal">mysql</code> default <code class="literal">dataDir</code> has changed from <code class="literal">/var/mysql</code> to <code class="literal">/var/lib/mysql</code>.</p></li><li class="listitem"><p>Radicale’s default package has changed from 1.x to 2.x. Instructions to migrate can be found <a class="link" href="http://radicale.org/1to2/"  target="_top"> here </a>. It is also possible to use the newer version by setting the <code class="literal">package</code> to <code class="literal">radicale2</code>, which is done automatically when <code class="literal">stateVersion</code> is 17.09 or higher. The <code class="literal">extraArgs</code> option has been added to allow passing the data migration arguments specified in the instructions; see the <code class="literal">radicale.nix</code> NixOS test for an example migration.</p></li></ul></div></li><li class="listitem"><p>The <code class="literal">aiccu</code> package was removed. This is due to SixXS <a class="link" href="https://www.sixxs.net/main/"  target="_top"> sunsetting</a> its IPv6 tunnel.</p></li><li class="listitem"><p>The <code class="literal">fanctl</code> package and <code class="literal">fan</code> module have been removed due to the developers not upstreaming their iproute2 patches and lagging with compatibility to recent iproute2 versions.</p></li><li class="listitem"><p>Top-level <code class="literal">idea</code> package collection was renamed. All JetBrains IDEs are now at <code class="literal">jetbrains</code>.</p></li><li class="listitem"><p><code class="literal">flexget</code>’s state database cannot be upgraded to its new internal format, requiring removal of any existing <code class="literal">db-config.sqlite</code> which will be automatically recreated.</p></li><li class="listitem"><p>The <code class="literal">ipfs</code> service now doesn’t ignore the <code class="literal">dataDir</code> option anymore. If you’ve ever set this option to anything other than the default you’ll have to either unset it (so the default gets used) or migrate the old data manually with</p><pre><code class="programlisting ShellSession">dataDir=&lt;valueOfDataDir&gt;
mv /var/lib/ipfs/.ipfs/* $dataDir
rmdir /var/lib/ipfs/.ipfs
</code></pre></li><li class="listitem"><p>The <code class="literal">caddy</code> service was previously using an extra <code class="literal">.caddy</code> directory in the data directory specified with the <code class="literal">dataDir</code> option. The contents of the <code class="literal">.caddy</code> directory are now expected to be in the <code class="literal">dataDir</code>.</p></li><li class="listitem"><p>The <code class="literal">ssh-agent</code> user service is not started by default anymore. Use <code class="literal">programs.ssh.startAgent</code> to enable it if needed. There is also a new <code class="literal">programs.gnupg.agent</code> module that creates a <code class="literal">gpg-agent</code> user service. It can also serve as a SSH agent if <code class="literal">enableSSHSupport</code> is set.</p></li><li class="listitem"><p>The <code class="literal">services.tinc.networks.&lt;name&gt;.listenAddress</code> option had a misleading name that did not correspond to its behavior. It now correctly defines the ip to listen for incoming connections on. To keep the previous behaviour, use <code class="literal">services.tinc.networks.&lt;name&gt;.bindToAddress</code> instead. Refer to the description of the options for more details.</p></li><li class="listitem"><p><code class="literal">tlsdate</code> package and module were removed. This is due to the project being dead and not building with openssl 1.1.</p></li><li class="listitem"><p><code class="literal">wvdial</code> package and module were removed. This is due to the project being dead and not building with openssl 1.1.</p></li><li class="listitem"><p><code class="literal">cc-wrapper</code>’s setup-hook now exports a number of environment variables corresponding to binutils binaries, (e.g. <code class="literal">LD</code>, <code class="literal">STRIP</code>, <code class="literal">RANLIB</code>, etc). This is done to prevent packages’ build systems guessing, which is harder to predict, especially when cross-compiling. However, some packages have broken due to this—their build systems either not supporting, or claiming to support without adequate testing, taking such environment variables as parameters.</p></li><li class="listitem"><p><code class="literal">services.firefox.syncserver</code> now runs by default as a non-root user. To accommodate this change, the default sqlite database location has also been changed. Migration should work automatically. Refer to the description of the options for more details.</p></li><li class="listitem"><p>The <code class="literal">compiz</code> window manager and package was removed. The system support had been broken for several years.</p></li><li class="listitem"><p>Touchpad support should now be enabled through <code class="literal">libinput</code> as <code class="literal">synaptics</code> is now deprecated. See the option <code class="literal">services.xserver.libinput.enable</code>.</p></li><li class="listitem"><p>grsecurity/PaX support has been dropped, following upstream’s decision to cease free support. See <a class="link" href="https://grsecurity.net/passing_the_baton.php"  target="_top"> upstream’s announcement</a> for more information. No complete replacement for grsecurity/PaX is available presently.</p></li><li class="listitem"><p><code class="literal">services.mysql</code> now has declarative configuration of databases and users with the <code class="literal">ensureDatabases</code> and <code class="literal">ensureUsers</code> options.</p><p>These options will never delete existing databases and users, especially not when the value of the options are changed.</p><p>The MySQL users will be identified using <a class="link" href="https://mariadb.com/kb/en/library/authentication-plugin-unix-socket/"  target="_top"> Unix socket authentication</a>. This authenticates the Unix user with the same name only, and that without the need for a password.</p><p>If you have previously created a MySQL <code class="literal">root</code> user <span class="emphasis"><em>with a password</em></span>, you will need to add <code class="literal">root</code> user for unix socket authentication before using the new options. This can be done by running the following SQL script:</p><pre><code class="programlisting SQL">CREATE USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;&#x27;;
GRANT ALL PRIVILEGES ON *.* TO &#x27;root&#x27;@&#x27;%&#x27; WITH GRANT OPTION;
FLUSH PRIVILEGES;

-- Optionally, delete the password-authenticated user:
-- DROP USER &#x27;root&#x27;@&#x27;localhost&#x27;;
</code></pre></li><li class="listitem"><p><code class="literal">services.mysqlBackup</code> now works by default without any user setup, including for users other than <code class="literal">mysql</code>.</p><p>By default, the <code class="literal">mysql</code> user is no longer the user which performs the backup. Instead a system account <code class="literal">mysqlbackup</code> is used.</p><p>The <code class="literal">mysqlBackup</code> service is also now using systemd timers instead of <code class="literal">cron</code>.</p><p>Therefore, the <code class="literal">services.mysqlBackup.period</code> option no longer exists, and has been replaced with <code class="literal">services.mysqlBackup.calendar</code>, which is in the format of <a class="link" href="https://www.freedesktop.org/software/systemd/man/systemd.time.html#Calendar%20Events"  target="_top">systemd.time(7)</a>.</p><p>If you expect to be sent an e-mail when the backup fails, consider using a script which monitors the systemd journal for errors. Regretfully, at present there is no built-in functionality for this.</p><p>You can check that backups still work by running <code class="literal">systemctl start mysql-backup</code> then <code class="literal">systemctl status mysql-backup</code>.</p></li><li class="listitem"><p>Templated systemd services e.g <code class="literal">container@name</code> are now handled correctly when switching to a new configuration, resulting in them being reloaded.</p></li><li class="listitem"><p>Steam: the <code class="literal">newStdcpp</code> parameter was removed and should not be needed anymore.</p></li><li class="listitem"><p>Redis has been updated to version 4 which mandates a cluster mass-restart, due to changes in the network handling, in order to ensure compatibility with networks NATing traffic.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-17.09-notable-changes" class="title" >Other Notable Changes   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Modules can now be disabled by using <a class="link" href="https://nixos.org/nixpkgs/manual/#sec-replace-modules"  target="_top"> disabledModules</a>, allowing another to take it’s place. This can be used to import a set of modules from another channel while keeping the rest of the system on a stable release.</p></li><li class="listitem"><p>Updated to FreeType 2.7.1, including a new TrueType engine. The new engine replaces the Infinality engine which was the default in NixOS. The default font rendering settings are now provided by fontconfig-penultimate, replacing fontconfig-ultimate; the new defaults are less invasive and provide rendering that is more consistent with other systems and hopefully with each font designer’s intent. Some system-wide configuration has been removed from the Fontconfig NixOS module where user Fontconfig settings are available.</p></li><li class="listitem"><p>ZFS/SPL have been updated to 0.7.0, <code class="literal">zfsUnstable, splUnstable</code> have therefore been removed.</p></li><li class="listitem"><p>The <code class="literal">time.timeZone</code> option now allows the value <code class="literal">null</code> in addition to timezone strings. This value allows changing the timezone of a system imperatively using <code class="literal">timedatectl set-timezone</code>. The default timezone is still UTC.</p></li><li class="listitem"><p>Nixpkgs overlays may now be specified with a file as well as a directory. The value of <code class="literal">&lt;nixpkgs-overlays&gt;</code> may be a file, and <code class="literal">~/.config/nixpkgs/overlays.nix</code> can be used instead of the <code class="literal">~/.config/nixpkgs/overlays</code> directory.</p><p>See the overlays chapter of the Nixpkgs manual for more details.</p></li><li class="listitem"><p>Definitions for <code class="literal">/etc/hosts</code> can now be specified declaratively with <code class="literal">networking.hosts</code>.</p></li><li class="listitem"><p>Two new options have been added to the installer loader, in addition to the default having changed. The kernel log verbosity has been lowered to the upstream default for the default options, in order to not spam the console when e.g. joining a network.</p><p>This therefore leads to adding a new <code class="literal">debug</code> option to set the log level to the previous verbose mode, to make debugging easier, but still accessible easily.</p><p>Additionally a <code class="literal">copytoram</code> option has been added, which makes it possible to remove the install medium after booting. This allows tethering from your phone after booting from it.</p></li><li class="listitem"><p><code class="literal">services.gitlab-runner.configOptions</code> has been added to specify the configuration of gitlab-runners declaratively.</p></li><li class="listitem"><p><code class="literal">services.jenkins.plugins</code> has been added to install plugins easily, this can be generated with jenkinsPlugins2nix.</p></li><li class="listitem"><p><code class="literal">services.postfix.config</code> has been added to specify the main.cf with NixOS options. Additionally other options have been added to the postfix module and has been improved further.</p></li><li class="listitem"><p>The GitLab package and module have been updated to the latest 10.0 release.</p></li><li class="listitem"><p>The <code class="literal">systemd-boot</code> boot loader now lists the NixOS version, kernel version and build date of all bootable generations.</p></li><li class="listitem"><p>The dnscrypt-proxy service now defaults to using a random upstream resolver, selected from the list of public non-logging resolvers with DNSSEC support. Existing configurations can be migrated to this mode of operation by omitting the <code class="literal">services.dnscrypt-proxy.resolverName</code> option or setting it to <code class="literal">&quot;random&quot;</code>.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-17.03" class="title" style="clear: both">Release 17.03 (“Gorilla”, 2017/03/31)   </h2>  </div> </div></div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-17.03-highlights" class="title" >Highlights   </h3>  </div> </div></div><p>In addition to numerous new and upgraded packages, this release has the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Nixpkgs is now extensible through overlays. See the <a class="link" href="https://nixos.org/nixpkgs/manual/#sec-overlays-install"  target="_top">Nixpkgs manual</a> for more information.</p></li><li class="listitem"><p>This release is based on Glibc 2.25, GCC 5.4.0 and systemd 232. The default Linux kernel is 4.9 and Nix is at 1.11.8.</p></li><li class="listitem"><p>The default desktop environment now is KDE’s Plasma 5. KDE 4 has been removed</p></li><li class="listitem"><p>The setuid wrapper functionality now supports setting capabilities.</p></li><li class="listitem"><p>X.org server uses branch 1.19. Due to ABI incompatibilities, <code class="literal">ati_unfree</code> keeps forcing 1.17 and <code class="literal">amdgpu-pro</code> starts forcing 1.18.</p></li><li class="listitem"><p>Cross compilation has been rewritten. See the nixpkgs manual for details. The most obvious breaking change is that in derivations there is no <code class="literal">.nativeDrv</code> nor <code class="literal">.crossDrv</code> are now cross by default, not native.</p></li><li class="listitem"><p>The <code class="literal">overridePackages</code> function has been rewritten to be replaced by <a class="link" href="https://nixos.org/nixpkgs/manual/#sec-overlays-install"  target="_top"> overlays</a></p></li><li class="listitem"><p>Packages in nixpkgs can be marked as insecure through listed vulnerabilities. See the <a class="link" href="https://nixos.org/nixpkgs/manual/#sec-allow-insecure"  target="_top">Nixpkgs manual</a> for more information.</p></li><li class="listitem"><p>PHP now defaults to PHP 7.1</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-17.03-new-services" class="title" >New Services   </h3>  </div> </div></div><p>The following new services were added since the last release:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">hardware/ckb.nix</code></p></li><li class="listitem"><p><code class="literal">hardware/mcelog.nix</code></p></li><li class="listitem"><p><code class="literal">hardware/usb-wwan.nix</code></p></li><li class="listitem"><p><code class="literal">hardware/video/capture/mwprocapture.nix</code></p></li><li class="listitem"><p><code class="literal">programs/adb.nix</code></p></li><li class="listitem"><p><code class="literal">programs/chromium.nix</code></p></li><li class="listitem"><p><code class="literal">programs/gphoto2.nix</code></p></li><li class="listitem"><p><code class="literal">programs/java.nix</code></p></li><li class="listitem"><p><code class="literal">programs/mtr.nix</code></p></li><li class="listitem"><p><code class="literal">programs/oblogout.nix</code></p></li><li class="listitem"><p><code class="literal">programs/vim.nix</code></p></li><li class="listitem"><p><code class="literal">programs/wireshark.nix</code></p></li><li class="listitem"><p><code class="literal">security/dhparams.nix</code></p></li><li class="listitem"><p><code class="literal">services/audio/ympd.nix</code></p></li><li class="listitem"><p><code class="literal">services/computing/boinc/client.nix</code></p></li><li class="listitem"><p><code class="literal">services/continuous-integration/buildbot/master.nix</code></p></li><li class="listitem"><p><code class="literal">services/continuous-integration/buildbot/worker.nix</code></p></li><li class="listitem"><p><code class="literal">services/continuous-integration/gitlab-runner.nix</code></p></li><li class="listitem"><p><code class="literal">services/databases/riak-cs.nix</code></p></li><li class="listitem"><p><code class="literal">services/databases/stanchion.nix</code></p></li><li class="listitem"><p><code class="literal">services/desktops/gnome3/gnome-terminal-server.nix</code></p></li><li class="listitem"><p><code class="literal">services/editors/infinoted.nix</code></p></li><li class="listitem"><p><code class="literal">services/hardware/illum.nix</code></p></li><li class="listitem"><p><code class="literal">services/hardware/trezord.nix</code></p></li><li class="listitem"><p><code class="literal">services/logging/journalbeat.nix</code></p></li><li class="listitem"><p><code class="literal">services/mail/offlineimap.nix</code></p></li><li class="listitem"><p><code class="literal">services/mail/postgrey.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/couchpotato.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/docker-registry.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/errbot.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/geoip-updater.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/gogs.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/leaps.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/nix-optimise.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/ssm-agent.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/sssd.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/arbtt.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/netdata.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/prometheus/default.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/prometheus/alertmanager.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/prometheus/blackbox-exporter.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/prometheus/json-exporter.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/prometheus/nginx-exporter.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/prometheus/node-exporter.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/prometheus/snmp-exporter.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/prometheus/unifi-exporter.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/prometheus/varnish-exporter.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/sysstat.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/telegraf.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/vnstat.nix</code></p></li><li class="listitem"><p><code class="literal">services/network-filesystems/cachefilesd.nix</code></p></li><li class="listitem"><p><code class="literal">services/network-filesystems/glusterfs.nix</code></p></li><li class="listitem"><p><code class="literal">services/network-filesystems/ipfs.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/dante.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/dnscrypt-wrapper.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/fakeroute.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/flannel.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/htpdate.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/miredo.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/nftables.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/powerdns.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/pdns-recursor.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/quagga.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/redsocks.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/wireguard.nix</code></p></li><li class="listitem"><p><code class="literal">services/system/cgmanager.nix</code></p></li><li class="listitem"><p><code class="literal">services/torrent/opentracker.nix</code></p></li><li class="listitem"><p><code class="literal">services/web-apps/atlassian/confluence.nix</code></p></li><li class="listitem"><p><code class="literal">services/web-apps/atlassian/crowd.nix</code></p></li><li class="listitem"><p><code class="literal">services/web-apps/atlassian/jira.nix</code></p></li><li class="listitem"><p><code class="literal">services/web-apps/frab.nix</code></p></li><li class="listitem"><p><code class="literal">services/web-apps/nixbot.nix</code></p></li><li class="listitem"><p><code class="literal">services/web-apps/selfoss.nix</code></p></li><li class="listitem"><p><code class="literal">services/web-apps/quassel-webserver.nix</code></p></li><li class="listitem"><p><code class="literal">services/x11/unclutter-xfixes.nix</code></p></li><li class="listitem"><p><code class="literal">services/x11/urxvtd.nix</code></p></li><li class="listitem"><p><code class="literal">system/boot/systemd-nspawn.nix</code></p></li><li class="listitem"><p><code class="literal">virtualisation/ecs-agent.nix</code></p></li><li class="listitem"><p><code class="literal">virtualisation/lxcfs.nix</code></p></li><li class="listitem"><p><code class="literal">virtualisation/openstack/keystone.nix</code></p></li><li class="listitem"><p><code class="literal">virtualisation/openstack/glance.nix</code></p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-17.03-incompatibilities" class="title" >Backward Incompatibilities   </h3>  </div> </div></div><p>When upgrading from a previous release, please be aware of the following incompatible changes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Derivations have no <code class="literal">.nativeDrv</code> nor <code class="literal">.crossDrv</code> and are now cross by default, not native.</p></li><li class="listitem"><p><code class="literal">stdenv.overrides</code> is now expected to take <code class="literal">self</code> and <code class="literal">super</code> arguments. See <code class="literal">lib.trivial.extends</code> for what those parameters represent.</p></li><li class="listitem"><p><code class="literal">ansible</code> now defaults to ansible version 2 as version 1 has been removed due to a serious <a class="link" href="https://www.computest.nl/advisories/CT-2017-0109_Ansible.txt"  target="_top"> vulnerability</a> unpatched by upstream.</p></li><li class="listitem"><p><code class="literal">gnome</code> alias has been removed along with <code class="literal">gtk</code>, <code class="literal">gtkmm</code> and several others. Now you need to use versioned attributes, like <code class="literal">gnome3</code>.</p></li><li class="listitem"><p>The attribute name of the Radicale daemon has been changed from <code class="literal">pythonPackages.radicale</code> to <code class="literal">radicale</code>.</p></li><li class="listitem"><p>The <code class="literal">stripHash</code> bash function in <code class="literal">stdenv</code> changed according to its documentation; it now outputs the stripped name to <code class="literal">stdout</code> instead of putting it in the variable <code class="literal">strippedName</code>.</p></li><li class="listitem"><p>PHP now scans for extra configuration .ini files in /etc/php.d instead of /etc. This prevents accidentally loading non-PHP .ini files that may be in /etc.</p></li><li class="listitem"><p>Two lone top-level dict dbs moved into <code class="literal">dictdDBs</code>. This affects: <code class="literal">dictdWordnet</code> which is now at <code class="literal">dictdDBs.wordnet</code> and <code class="literal">dictdWiktionary</code> which is now at <code class="literal">dictdDBs.wiktionary</code></p></li><li class="listitem"><p>Parsoid service now uses YAML configuration format. <code class="literal">service.parsoid.interwikis</code> is now called <code class="literal">service.parsoid.wikis</code> and is a list of either API URLs or attribute sets as specified in parsoid’s documentation.</p></li><li class="listitem"><p><code class="literal">Ntpd</code> was replaced by <code class="literal">systemd-timesyncd</code> as the default service to synchronize system time with a remote NTP server. The old behavior can be restored by setting <code class="literal">services.ntp.enable</code> to <code class="literal">true</code>. Upstream time servers for all NTP implementations are now configured using <code class="literal">networking.timeServers</code>.</p></li><li class="listitem"><p><code class="literal">service.nylon</code> is now declared using named instances. As an example:</p><pre><code class="programlisting nix">{
  services.nylon = {
    enable = true;
    acceptInterface = &quot;br0&quot;;
    bindInterface = &quot;tun1&quot;;
    port = 5912;
  };
}
</code></pre><p>should be replaced with:</p><pre><code class="programlisting nix">{
  services.nylon.myvpn = {
    enable = true;
    acceptInterface = &quot;br0&quot;;
    bindInterface = &quot;tun1&quot;;
    port = 5912;
  };
}
</code></pre><p>this enables you to declare a SOCKS proxy for each uplink.</p></li><li class="listitem"><p><code class="literal">overridePackages</code> function no longer exists. It is replaced by <a class="link" href="https://nixos.org/nixpkgs/manual/#sec-overlays-install"  target="_top"> overlays</a>. For example, the following code:</p><pre><code class="programlisting nix">let
  pkgs = import &lt;nixpkgs&gt; {};
in
  pkgs.overridePackages (self: super: { /* ... */ })
</code></pre><p>should be replaced by:</p><pre><code class="programlisting nix">let
  pkgs = import &lt;nixpkgs&gt; {};
in
  import pkgs.path { overlays = [(self: super: { /* ... */ })]; }
</code></pre></li><li class="listitem"><p>Autoloading connection tracking helpers is now disabled by default. This default was also changed in the Linux kernel and is considered insecure if not configured properly in your firewall. If you need connection tracking helpers (i.e. for active FTP) please enable <code class="literal">networking.firewall.autoLoadConntrackHelpers</code> and tune <code class="literal">networking.firewall.connectionTrackingModules</code> to suit your needs.</p></li><li class="listitem"><p><code class="literal">local_recipient_maps</code> is not set to empty value by Postfix service. It’s an insecure default as stated by Postfix documentation. Those who want to retain this setting need to set it via <code class="literal">services.postfix.extraConfig</code>.</p></li><li class="listitem"><p>Iputils no longer provide ping6 and traceroute6. The functionality of these tools has been integrated into ping and traceroute respectively. To enforce an address family the new flags <code class="literal">-4</code> and <code class="literal">-6</code> have been added. One notable incompatibility is that specifying an interface (for link-local IPv6 for instance) is no longer done with the <code class="literal">-I</code> flag, but by encoding the interface into the address (<code class="literal">ping fe80::1%eth0</code>).</p></li><li class="listitem"><p>The socket handling of the <code class="literal">services.rmilter</code> module has been fixed and refactored. As rmilter doesn’t support binding to more than one socket, the options <code class="literal">bindUnixSockets</code> and <code class="literal">bindInetSockets</code> have been replaced by <code class="literal">services.rmilter.bindSocket.*</code>. The default is still a unix socket in <code class="literal">/run/rmilter/rmilter.sock</code>. Refer to the options documentation for more information.</p></li><li class="listitem"><p>The <code class="literal">fetch*</code> functions no longer support md5, please use sha256 instead.</p></li><li class="listitem"><p>The dnscrypt-proxy module interface has been streamlined around the <code class="literal">extraArgs</code> option. Where possible, legacy option declarations are mapped to <code class="literal">extraArgs</code> but will emit warnings. The <code class="literal">resolverList</code> has been outright removed: to use an unlisted resolver, use the <code class="literal">customResolver</code> option.</p></li><li class="listitem"><p>torbrowser now stores local state under <code class="literal">~/.local/share/tor-browser</code> by default. Any browser profile data from the old location, <code class="literal">~/.torbrowser4</code>, must be migrated manually.</p></li><li class="listitem"><p>The ihaskell, monetdb, offlineimap and sitecopy services have been removed.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h3 id="sec-release-17.03-notable-changes" class="title" >Other Notable Changes   </h3>  </div> </div></div><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Module type system have a new extensible option types feature that allow to extend certain types, such as enum, through multiple option declarations of the same option across multiple modules.</p></li><li class="listitem"><p><code class="literal">jre</code> now defaults to GTK UI by default. This improves visual consistency and makes Java follow system font style, improving the situation on HighDPI displays. This has a cost of increased closure size; for server and other headless workloads it’s recommended to use <code class="literal">jre_headless</code>.</p></li><li class="listitem"><p>Python 2.6 interpreter and package set have been removed.</p></li><li class="listitem"><p>The Python 2.7 interpreter does not use modules anymore. Instead, all CPython interpreters now include the whole standard library except for `tkinter`, which is available in the Python package set.</p></li><li class="listitem"><p>Python 2.7, 3.5 and 3.6 are now built deterministically and 3.4 mostly. Minor modifications had to be made to the interpreters in order to generate deterministic bytecode. This has security implications and is relevant for those using Python in a <code class="literal">nix-shell</code>. See the Nixpkgs manual for details.</p></li><li class="listitem"><p>The Python package sets now use a fixed-point combinator and the sets are available as attributes of the interpreters.</p></li><li class="listitem"><p>The Python function <code class="literal">buildPythonPackage</code> has been improved and can be used to build from Setuptools source, Flit source, and precompiled Wheels.</p></li><li class="listitem"><p>When adding new or updating current Python libraries, the expressions should be put in separate files in <code class="literal">pkgs/development/python-modules</code> and called from <code class="literal">python-packages.nix</code>.</p></li><li class="listitem"><p>The dnscrypt-proxy service supports synchronizing the list of public resolvers without working DNS resolution. This fixes issues caused by the resolver list becoming outdated. It also improves the viability of DNSCrypt only configurations.</p></li><li class="listitem"><p>Containers using bridged networking no longer lose their connection after changes to the host networking.</p></li><li class="listitem"><p>ZFS supports pool auto scrubbing.</p></li><li class="listitem"><p>The bind DNS utilities (e.g. dig) have been split into their own output and are now also available in <code class="literal">pkgs.dnsutils</code> and it is no longer necessary to pull in all of <code class="literal">bind</code> to use them.</p></li><li class="listitem"><p>Per-user configuration was moved from <code class="literal">~/.nixpkgs</code> to <code class="literal">~/.config/nixpkgs</code>. The former is still valid for <code class="literal">config.nix</code> for backwards compatibility.</p></li></ul></div>
</div>

</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-16.09" class="title" style="clear: both">Release 16.09 (“Flounder”, 2016/09/30)   </h2>  </div> </div></div><p>In addition to numerous new and upgraded packages, this release has the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Many NixOS configurations and Nix packages now use significantly less disk space, thanks to the <a class="link" href="https://github.com/NixOS/nixpkgs/issues/7117"  target="_top">extensive work on closure size reduction</a>. For example, the closure size of a minimal NixOS container went down from ~424 MiB in 16.03 to ~212 MiB in 16.09, while the closure size of Firefox went from ~651 MiB to ~259 MiB.</p></li><li class="listitem"><p>To improve security, packages are now <a class="link" href="https://github.com/NixOS/nixpkgs/pull/12895"  target="_top">built using various hardening features</a>. See the Nixpkgs manual for more information.</p></li><li class="listitem"><p>Support for PXE netboot. See <a class="xref" href="index.html#sec-booting-from-pxe" title="Booting from the “netboot” media (PXE)" >the section called “Booting from the “netboot” media (PXE)”</a> for documentation.</p></li><li class="listitem"><p>X.org server 1.18. If you use the <code class="literal">ati_unfree</code> driver, 1.17 is still used due to an ABI incompatibility.</p></li><li class="listitem"><p>This release is based on Glibc 2.24, GCC 5.4.0 and systemd 231. The default Linux kernel remains 4.4.</p></li></ul></div><p>The following new services were added since the last release:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">(this will get automatically generated at release time)</code></p></li></ul></div><p>When upgrading from a previous release, please be aware of the following incompatible changes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>A large number of packages have been converted to use the multiple outputs feature of Nix to greatly reduce the amount of required disk space, as mentioned above. This may require changes to any custom packages to make them build again; see the relevant chapter in the Nixpkgs manual for more information. (Additional caveat to packagers: some packaging conventions related to multiple-output packages <a class="link" href="https://github.com/NixOS/nixpkgs/pull/14766"  target="_top">were changed</a> late (August 2016) in the release cycle and differ from the initial introduction of multiple outputs.)</p></li><li class="listitem"><p>Previous versions of Nixpkgs had support for all versions of the LTS Haskell package set. That support has been dropped. The previously provided <code class="literal">haskell.packages.lts-x_y</code> package sets still exist in name to avoid breaking user code, but these package sets don’t actually contain the versions mandated by the corresponding LTS release. Instead, our package set it loosely based on the latest available LTS release, i.e. LTS 7.x at the time of this writing. New releases of NixOS and Nixpkgs will drop those old names entirely. <a class="link" href="https://nixos.org/nix-dev/2016-June/020585.html"  target="_top">The motivation for this change</a> has been discussed at length on the <code class="literal">nix-dev</code> mailing list and in <a class="link" href="https://github.com/NixOS/nixpkgs/issues/14897"  target="_top">Github issue #14897</a>. Development strategies for Haskell hackers who want to rely on Nix and NixOS have been described in <a class="link" href="https://nixos.org/nix-dev/2016-June/020642.html"  target="_top">another nix-dev article</a>.</p></li><li class="listitem"><p>Shell aliases for systemd sub-commands <a class="link" href="https://github.com/NixOS/nixpkgs/pull/15598"  target="_top">were dropped</a>: <code class="literal">start</code>, <code class="literal">stop</code>, <code class="literal">restart</code>, <code class="literal">status</code>.</p></li><li class="listitem"><p>Redis now binds to 127.0.0.1 only instead of listening to all network interfaces. This is the default behavior of Redis 3.2</p></li><li class="listitem"><p><code class="literal">/var/empty</code> is now immutable. Activation script runs <code class="literal">chattr +i</code> to forbid any modifications inside the folder. See <a class="link" href="https://github.com/NixOS/nixpkgs/pull/18365"  target="_top"> the pull request</a> for what bugs this caused.</p></li><li class="listitem"><p>Gitlab’s maintenance script <code class="literal">gitlab-runner</code> was removed and split up into the more clearer <code class="literal">gitlab-run</code> and <code class="literal">gitlab-rake</code> scripts, because <code class="literal">gitlab-runner</code> is a component of Gitlab CI.</p></li><li class="listitem"><p><code class="literal">services.xserver.libinput.accelProfile</code> default changed from <code class="literal">flat</code> to <code class="literal">adaptive</code>, as per <a class="link" href="https://wayland.freedesktop.org/libinput/doc/latest/group__config.html#gad63796972347f318b180e322e35cee79"  target="_top"> official documentation</a>.</p></li><li class="listitem"><p><code class="literal">fonts.fontconfig.ultimate.rendering</code> was removed because our presets were obsolete for some time. New presets are hardcoded into FreeType; you can select a preset via <code class="literal">fonts.fontconfig.ultimate.preset</code>. You can customize those presets via ordinary environment variables, using <code class="literal">environment.variables</code>.</p></li><li class="listitem"><p>The <code class="literal">audit</code> service is no longer enabled by default. Use <code class="literal">security.audit.enable = true</code> to explicitly enable it.</p></li><li class="listitem"><p><code class="literal">pkgs.linuxPackages.virtualbox</code> now contains only the kernel modules instead of the VirtualBox user space binaries. If you want to reference the user space binaries, you have to use the new <code class="literal">pkgs.virtualbox</code> instead.</p></li><li class="listitem"><p><code class="literal">goPackages</code> was replaced with separated Go applications in appropriate <code class="literal">nixpkgs</code> categories. Each Go package uses its own dependency set. There’s also a new <code class="literal">go2nix</code> tool introduced to generate a Go package definition from its Go source automatically.</p></li><li class="listitem"><p><code class="literal">services.mongodb.extraConfig</code> configuration format was changed to YAML.</p></li><li class="listitem"><p>PHP has been upgraded to 7.0</p></li></ul></div><p>Other notable improvements:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Revamped grsecurity/PaX support. There is now only a single general-purpose distribution kernel and the configuration interface has been streamlined. Desktop users should be able to set</p><pre><code class="programlisting nix">{
  security.grsecurity.enable = true;
}
</code></pre><p>to get a reasonably secure system without having to sacrifice too much functionality.</p></li><li class="listitem"><p>Special filesystems, like <code class="literal">/proc</code>, <code class="literal">/run</code> and others, now have the same mount options as recommended by systemd and are unified across different places in NixOS. Mount options are updated during <code class="literal">nixos-rebuild switch</code> if possible. One benefit from this is improved security — most such filesystems are now mounted with <code class="literal">noexec</code>, <code class="literal">nodev</code> and/or <code class="literal">nosuid</code> options.</p></li><li class="listitem"><p>The reverse path filter was interfering with DHCPv4 server operation in the past. An exception for DHCPv4 and a new option to log packets that were dropped due to the reverse path filter was added (<code class="literal">networking.firewall.logReversePathDrops</code>) for easier debugging.</p></li><li class="listitem"><p>Containers configuration within <code class="literal">containers.&lt;name&gt;.config</code> is <a class="link" href="https://github.com/NixOS/nixpkgs/pull/17365"  target="_top">now properly typed and checked</a>. In particular, partial configurations are merged correctly.</p></li><li class="listitem"><p>The directory container setuid wrapper programs, <code class="literal">/var/setuid-wrappers</code>, <a class="link" href="https://github.com/NixOS/nixpkgs/pull/18124"  target="_top">is now updated atomically to prevent failures if the switch to a new configuration is interrupted.</a></p></li><li class="listitem"><p><code class="literal">services.xserver.startGnuPGAgent</code> has been removed due to GnuPG 2.1.x bump. See <a class="link" href="https://github.com/NixOS/nixpkgs/commit/5391882ebd781149e213e8817fba6ac3c503740c"  target="_top"> how to achieve similar behavior</a>. You might need to <code class="literal">pkill gpg-agent</code> after the upgrade to prevent a stale agent being in the way.</p></li><li class="listitem"><p><a class="link" href="https://github.com/NixOS/nixpkgs/commit/e561edc322d275c3687fec431935095cfc717147"  target="_top"> Declarative users could share the uid due to the bug in the script handling conflict resolution. </a></p></li><li class="listitem"><p>Gummi boot has been replaced using systemd-boot.</p></li><li class="listitem"><p>Hydra package and NixOS module were added for convenience.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-16.03" class="title" style="clear: both">Release 16.03 (“Emu”, 2016/03/31)   </h2>  </div> </div></div><p>In addition to numerous new and upgraded packages, this release has the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Systemd 229, bringing <a class="link" href="https://github.com/systemd/systemd/blob/v229/NEWS"  target="_top">numerous improvements</a> over 217.</p></li><li class="listitem"><p>Linux 4.4 (was 3.18).</p></li><li class="listitem"><p>GCC 5.3 (was 4.9). Note that GCC 5 <a class="link" href="https://gcc.gnu.org/onlinedocs/libstdc++/manual/using_dual_abi.html"  target="_top">changes the C++ ABI in an incompatible way</a>; this may cause problems if you try to link objects compiled with different versions of GCC.</p></li><li class="listitem"><p>Glibc 2.23 (was 2.21).</p></li><li class="listitem"><p>Binutils 2.26 (was 2.23.1). See #909</p></li><li class="listitem"><p>Improved support for ensuring <a class="link" href="https://reproducible-builds.org/"  target="_top">bitwise reproducible builds</a>. For example, <code class="literal">stdenv</code> now sets the environment variable <code class="literal">SOURCE_DATE_EPOCH</code> to a deterministic value, and Nix has <a class="link" href="https://nixos.org/nix/manual/#ssec-relnotes-1.11"  target="_top">gained an option</a> to repeat a build a number of times to test determinism. An ongoing project, the goal of exact reproducibility is to allow binaries to be verified independently (e.g., a user might only trust binaries that appear in three independent binary caches).</p></li><li class="listitem"><p>Perl 5.22.</p></li></ul></div><p>The following new services were added since the last release:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">services/monitoring/longview.nix</code></p></li><li class="listitem"><p><code class="literal">hardware/video/webcam/facetimehd.nix</code></p></li><li class="listitem"><p><code class="literal">i18n/input-method/default.nix</code></p></li><li class="listitem"><p><code class="literal">i18n/input-method/fcitx.nix</code></p></li><li class="listitem"><p><code class="literal">i18n/input-method/ibus.nix</code></p></li><li class="listitem"><p><code class="literal">i18n/input-method/nabi.nix</code></p></li><li class="listitem"><p><code class="literal">i18n/input-method/uim.nix</code></p></li><li class="listitem"><p><code class="literal">programs/fish.nix</code></p></li><li class="listitem"><p><code class="literal">security/acme.nix</code></p></li><li class="listitem"><p><code class="literal">security/audit.nix</code></p></li><li class="listitem"><p><code class="literal">security/oath.nix</code></p></li><li class="listitem"><p><code class="literal">services/hardware/irqbalance.nix</code></p></li><li class="listitem"><p><code class="literal">services/mail/dspam.nix</code></p></li><li class="listitem"><p><code class="literal">services/mail/opendkim.nix</code></p></li><li class="listitem"><p><code class="literal">services/mail/postsrsd.nix</code></p></li><li class="listitem"><p><code class="literal">services/mail/rspamd.nix</code></p></li><li class="listitem"><p><code class="literal">services/mail/rmilter.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/autofs.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/bepasty.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/calibre-server.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/cfdyndns.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/gammu-smsd.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/mathics.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/matrix-synapse.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/octoprint.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/hdaps.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/heapster.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/longview.nix</code></p></li><li class="listitem"><p><code class="literal">services/network-filesystems/netatalk.nix</code></p></li><li class="listitem"><p><code class="literal">services/network-filesystems/xtreemfs.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/autossh.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/dnschain.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/gale.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/miniupnpd.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/namecoind.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/ostinato.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/pdnsd.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/shairport-sync.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/supplicant.nix</code></p></li><li class="listitem"><p><code class="literal">services/search/kibana.nix</code></p></li><li class="listitem"><p><code class="literal">services/security/haka.nix</code></p></li><li class="listitem"><p><code class="literal">services/security/physlock.nix</code></p></li><li class="listitem"><p><code class="literal">services/web-apps/pump.io.nix</code></p></li><li class="listitem"><p><code class="literal">services/x11/hardware/libinput.nix</code></p></li><li class="listitem"><p><code class="literal">services/x11/window-managers/windowlab.nix</code></p></li><li class="listitem"><p><code class="literal">system/boot/initrd-network.nix</code></p></li><li class="listitem"><p><code class="literal">system/boot/initrd-ssh.nix</code></p></li><li class="listitem"><p><code class="literal">system/boot/loader/loader.nix</code></p></li><li class="listitem"><p><code class="literal">system/boot/networkd.nix</code></p></li><li class="listitem"><p><code class="literal">system/boot/resolved.nix</code></p></li><li class="listitem"><p><code class="literal">virtualisation/lxd.nix</code></p></li><li class="listitem"><p><code class="literal">virtualisation/rkt.nix</code></p></li></ul></div><p>When upgrading from a previous release, please be aware of the following incompatible changes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>We no longer produce graphical ISO images and VirtualBox images for <code class="literal">i686-linux</code>. A minimal ISO image is still provided.</p></li><li class="listitem"><p>Firefox and similar browsers are now <span class="emphasis"><em>wrapped by default</em></span>. The package and attribute names are plain <code class="literal">firefox</code> or <code class="literal">midori</code>, etc. Backward-compatibility attributes were set up, but note that <code class="literal">nix-env -u</code> will <span class="emphasis"><em>not</em></span> update your current <code class="literal">firefox-with-plugins</code>; you have to uninstall it and install <code class="literal">firefox</code> instead.</p></li><li class="listitem"><p><code class="literal">wmiiSnap</code> has been replaced with <code class="literal">wmii_hg</code>, but <code class="literal">services.xserver.windowManager.wmii.enable</code> has been updated respectively so this only affects you if you have explicitly installed <code class="literal">wmiiSnap</code>.</p></li><li class="listitem"><p><code class="literal">jobs</code> NixOS option has been removed. It served as compatibility layer between Upstart jobs and SystemD services. All services have been rewritten to use <code class="literal">systemd.services</code></p></li><li class="listitem"><p><code class="literal">wmiimenu</code> is removed, as it has been removed by the developers upstream. Use <code class="literal">wimenu</code> from the <code class="literal">wmii-hg</code> package.</p></li><li class="listitem"><p>Gitit is no longer automatically added to the module list in NixOS and as such there will not be any manual entries for it. You will need to add an import statement to your NixOS configuration in order to use it, e.g.</p><pre><code class="programlisting nix">{
  imports = [ &lt;nixpkgs/nixos/modules/services/misc/gitit.nix&gt; ];
}
</code></pre><p>will include the Gitit service configuration options.</p></li><li class="listitem"><p><code class="literal">nginx</code> does not accept flags for enabling and disabling modules anymore. Instead it accepts <code class="literal">modules</code> argument, which is a list of modules to be built in. All modules now reside in <code class="literal">nginxModules</code> set. Example configuration:</p><pre><code class="programlisting nix">nginx.override {
  modules = [ nginxModules.rtmp nginxModules.dav nginxModules.moreheaders ];
}
</code></pre></li><li class="listitem"><p><code class="literal">s3sync</code> is removed, as it hasn’t been developed by upstream for 4 years and only runs with ruby 1.8. For an actively-developer alternative look at <code class="literal">tarsnap</code> and others.</p></li><li class="listitem"><p><code class="literal">ruby_1_8</code> has been removed as it’s not supported from upstream anymore and probably contains security issues.</p></li><li class="listitem"><p><code class="literal">tidy-html5</code> package is removed. Upstream only provided <code class="literal">(lib)tidy5</code> during development, and now they went back to <code class="literal">(lib)tidy</code> to work as a drop-in replacement of the original package that has been unmaintained for years. You can (still) use the <code class="literal">html-tidy</code> package, which got updated to a stable release from this new upstream.</p></li><li class="listitem"><p><code class="literal">extraDeviceOptions</code> argument is removed from <code class="literal">bumblebee</code> package. Instead there are now two separate arguments: <code class="literal">extraNvidiaDeviceOptions</code> and <code class="literal">extraNouveauDeviceOptions</code> for setting extra X11 options for nvidia and nouveau drivers, respectively.</p></li><li class="listitem"><p>The <code class="literal">Ctrl+Alt+Backspace</code> key combination no longer kills the X server by default. There’s a new option <code class="literal">services.xserver.enableCtrlAltBackspace</code> allowing to enable the combination again.</p></li><li class="listitem"><p><code class="literal">emacsPackagesNg</code> now contains all packages from the ELPA, MELPA, and MELPA Stable repositories.</p></li><li class="listitem"><p>Data directory for Postfix MTA server is moved from <code class="literal">/var/postfix</code> to <code class="literal">/var/lib/postfix</code>. Old configurations are migrated automatically. <code class="literal">service.postfix</code> module has also received many improvements, such as correct directories’ access rights, new <code class="literal">aliasFiles</code> and <code class="literal">mapFiles</code> options and more.</p></li><li class="listitem"><p>Filesystem options should now be configured as a list of strings, not a comma-separated string. The old style will continue to work, but print a warning, until the 16.09 release. An example of the new style:</p><pre><code class="programlisting nix">{
  fileSystems.&quot;/example&quot; = {
    device = &quot;/dev/sdc&quot;;
    fsType = &quot;btrfs&quot;;
    options = [ &quot;noatime&quot; &quot;compress=lzo&quot; &quot;space_cache&quot; &quot;autodefrag&quot; ];
  };
}
</code></pre></li><li class="listitem"><p>CUPS, installed by <code class="literal">services.printing</code> module, now has its data directory in <code class="literal">/var/lib/cups</code>. Old configurations from <code class="literal">/etc/cups</code> are moved there automatically, but there might be problems. Also configuration options <code class="literal">services.printing.cupsdConf</code> and <code class="literal">services.printing.cupsdFilesConf</code> were removed because they had been allowing one to override configuration variables required for CUPS to work at all on NixOS. For most use cases, <code class="literal">services.printing.extraConf</code> and new option <code class="literal">services.printing.extraFilesConf</code> should be enough; if you encounter a situation when they are not, please file a bug.</p><p>There are also Gutenprint improvements; in particular, a new option <code class="literal">services.printing.gutenprint</code> is added to enable automatic updating of Gutenprint PPMs; it’s greatly recommended to enable it instead of adding <code class="literal">gutenprint</code> to the <code class="literal">drivers</code> list.</p></li><li class="listitem"><p><code class="literal">services.xserver.vaapiDrivers</code> has been removed. Use <code class="literal">hardware.opengl.extraPackages{,32}</code> instead. You can also specify VDPAU drivers there.</p></li><li class="listitem"><p><code class="literal">programs.ibus</code> moved to <code class="literal">i18n.inputMethod.ibus</code>. The option <code class="literal">programs.ibus.plugins</code> changed to <code class="literal">i18n.inputMethod.ibus.engines</code> and the option to enable ibus changed from <code class="literal">programs.ibus.enable</code> to <code class="literal">i18n.inputMethod.enabled</code>. <code class="literal">i18n.inputMethod.enabled</code> should be set to the used input method name, <code class="literal">&quot;ibus&quot;</code> for ibus. An example of the new style:</p><pre><code class="programlisting nix">{
  i18n.inputMethod.enabled = &quot;ibus&quot;;
  i18n.inputMethod.ibus.engines = with pkgs.ibus-engines; [ anthy mozc ];
}
</code></pre><p>That is equivalent to the old version:</p><pre><code class="programlisting nix">{
  programs.ibus.enable = true;
  programs.ibus.plugins = with pkgs; [ ibus-anthy mozc ];
}
</code></pre></li><li class="listitem"><p><code class="literal">services.udev.extraRules</code> option now writes rules to <code class="literal">99-local.rules</code> instead of <code class="literal">10-local.rules</code>. This makes all the user rules apply after others, so their results wouldn’t be overridden by anything else.</p></li><li class="listitem"><p>Large parts of the <code class="literal">services.gitlab</code> module has been been rewritten. There are new configuration options available. The <code class="literal">stateDir</code> option was renamned to <code class="literal">statePath</code> and the <code class="literal">satellitesDir</code> option was removed. Please review the currently available options.</p></li><li class="listitem"><p>The option <code class="literal">services.nsd.zones.&lt;name&gt;.data</code> no longer interpret the dollar sign ($) as a shell variable, as such it should not be escaped anymore. Thus the following zone data:</p><pre><code class="programlisting dns-zone">$ORIGIN example.com.
$TTL 1800
@       IN      SOA     ns1.vpn.nbp.name.      admin.example.com. (

</code></pre><p>Should modified to look like the actual file expected by nsd:</p><pre><code class="programlisting dns-zone">$ORIGIN example.com.
$TTL 1800
@       IN      SOA     ns1.vpn.nbp.name.      admin.example.com. (

</code></pre></li><li class="listitem"><p><code class="literal">service.syncthing.dataDir</code> options now has to point to exact folder where syncthing is writing to. Example configuration should look something like:</p><pre><code class="programlisting nix">{
  services.syncthing = {
      enable = true;
      dataDir = &quot;/home/somebody/.syncthing&quot;;
      user = &quot;somebody&quot;;
  };
}
</code></pre></li><li class="listitem"><p><code class="literal">networking.firewall.allowPing</code> is now enabled by default. Users are encouraged to configure an appropriate rate limit for their machines using the Kernel interface at <code class="literal">/proc/sys/net/ipv4/icmp_ratelimit</code> and <code class="literal">/proc/sys/net/ipv6/icmp/ratelimit</code> or using the firewall itself, i.e. by setting the NixOS option <code class="literal">networking.firewall.pingLimit</code>.</p></li><li class="listitem"><p>Systems with some broadcom cards used to result into a generated config that is no longer accepted. If you get errors like</p><pre><code class="programlisting ShellSession">error: path ‘/nix/store/*-broadcom-sta-*’ does not exist and cannot be created
</code></pre><p>you should either re-run <code class="literal">nixos-generate-config</code> or manually replace <code class="literal">&quot;${config.boot.kernelPackages.broadcom_sta}&quot;</code> by <code class="literal">config.boot.kernelPackages.broadcom_sta</code> in your <code class="literal">/etc/nixos/hardware-configuration.nix</code>. More discussion is on <a class="link" href="https://github.com/NixOS/nixpkgs/pull/12595"  target="_top"> the github issue</a>.</p></li><li class="listitem"><p>The <code class="literal">services.xserver.startGnuPGAgent</code> option has been removed. GnuPG 2.1.x changed the way the gpg-agent works, and that new approach no longer requires (or even supports) the “start everything as a child of the agent” scheme we’ve implemented in NixOS for older versions. To configure the gpg-agent for your X session, add the following code to <code class="literal">~/.bashrc</code> or some file that’s sourced when your shell is started:</p><pre><code class="programlisting shell">GPG_TTY=$(tty)
export GPG_TTY
</code></pre><p>If you want to use gpg-agent for SSH, too, add the following to your session initialization (e.g. <code class="literal">displayManager.sessionCommands</code>)</p><pre><code class="programlisting shell">    gpg-connect-agent /bye
    unset SSH_AGENT_PID
    export SSH_AUTH_SOCK=&quot;&#x27;&#x27;${HOME}/.gnupg/S.gpg-agent.ssh&quot;
</code></pre><p>and make sure that</p><pre><code class="programlisting conf">    enable-ssh-support
</code></pre><p>is included in your <code class="literal">~/.gnupg/gpg-agent.conf</code>. You will need to use <code class="literal">ssh-add</code> to re-add your ssh keys. If gpg’s automatic transformation of the private keys to the new format fails, you will need to re-import your private keyring as well:</p><pre><code class="programlisting ShellSession">    gpg --import ~/.gnupg/secring.gpg
</code></pre><p>The <code class="literal">gpg-agent(1)</code> man page has more details about this subject, i.e. in the “EXAMPLES” section.</p></li></ul></div><p>Other notable improvements:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">ejabberd</code> module is brought back and now works on NixOS.</p></li><li class="listitem"><p>Input method support was improved. New NixOS modules (fcitx, nabi and uim), fcitx engines (chewing, hangul, m17n, mozc and table-other) and ibus engines (hangul and m17n) have been added.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-15.09" class="title" style="clear: both">Release 15.09 (“Dingo”, 2015/09/30)   </h2>  </div> </div></div><p>In addition to numerous new and upgraded packages, this release has the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The <a class="link" href="http://haskell.org/"  target="_top">Haskell</a> packages infrastructure has been re-designed from the ground up (“Haskell NG”). NixOS now distributes the latest version of every single package registered on <a class="link" href="http://hackage.haskell.org/"  target="_top">Hackage</a> – well in excess of 8,000 Haskell packages. Detailed instructions on how to use that infrastructure can be found in the <a class="link" href="https://nixos.org/nixpkgs/manual/#users-guide-to-the-haskell-infrastructure"  target="_top">User’s Guide to the Haskell Infrastructure</a>. Users migrating from an earlier release may find helpful information below, in the list of backwards-incompatible changes. Furthermore, we distribute 51(!) additional Haskell package sets that provide every single <a class="link" href="http://www.stackage.org/"  target="_top">LTS Haskell</a> release since version 0.0 as well as the most recent <a class="link" href="http://www.stackage.org/"  target="_top">Stackage Nightly</a> snapshot. The announcement <a class="link" href="https://nixos.org/nix-dev/2015-September/018138.html"  target="_top">“Full Stackage Support in Nixpkgs”</a> gives additional details.</p></li><li class="listitem"><p>Nix has been updated to version 1.10, which among other improvements enables cryptographic signatures on binary caches for improved security.</p></li><li class="listitem"><p>You can now keep your NixOS system up to date automatically by setting</p></li></ul></div><pre><code class="programlisting nix">{
  system.autoUpgrade.enable = true;
}
</code></pre><p>This will cause the system to periodically check for updates in your current channel and run <code class="literal">nixos-rebuild</code>.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>This release is based on Glibc 2.21, GCC 4.9 and Linux 3.18.</p></li><li class="listitem"><p>GNOME has been upgraded to 3.16.</p></li><li class="listitem"><p>Xfce has been upgraded to 4.12.</p></li><li class="listitem"><p>KDE 5 has been upgraded to KDE Frameworks 5.10, Plasma 5.3.2 and Applications 15.04.3. KDE 4 has been updated to kdelibs-4.14.10.</p></li><li class="listitem"><p>E19 has been upgraded to 0.16.8.15.</p></li></ul></div><p>The following new services were added since the last release:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">services/mail/exim.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/apache-kafka.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/canto-daemon.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/confd.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/devmon.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/gitit.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/ihaskell.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/mbpfan.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/mediatomb.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/mwlib.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/parsoid.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/plex.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/ripple-rest.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/ripple-data-api.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/subsonic.nix</code></p></li><li class="listitem"><p><code class="literal">services/misc/sundtek.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/cadvisor.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/das_watchdog.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/grafana.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/riemann-tools.nix</code></p></li><li class="listitem"><p><code class="literal">services/monitoring/teamviewer.nix</code></p></li><li class="listitem"><p><code class="literal">services/network-filesystems/u9fs.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/aiccu.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/asterisk.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/bird.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/charybdis.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/docker-registry-server.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/fan.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/firefox/sync-server.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/gateone.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/heyefi.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/i2p.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/lambdabot.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/mstpd.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/nix-serve.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/nylon.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/racoon.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/skydns.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/shout.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/softether.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/sslh.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/tinc.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/tlsdated.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/tox-bootstrapd.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/tvheadend.nix</code></p></li><li class="listitem"><p><code class="literal">services/networking/zerotierone.nix</code></p></li><li class="listitem"><p><code class="literal">services/scheduling/marathon.nix</code></p></li><li class="listitem"><p><code class="literal">services/security/fprintd.nix</code></p></li><li class="listitem"><p><code class="literal">services/security/hologram.nix</code></p></li><li class="listitem"><p><code class="literal">services/security/munge.nix</code></p></li><li class="listitem"><p><code class="literal">services/system/cloud-init.nix</code></p></li><li class="listitem"><p><code class="literal">services/web-servers/shellinabox.nix</code></p></li><li class="listitem"><p><code class="literal">services/web-servers/uwsgi.nix</code></p></li><li class="listitem"><p><code class="literal">services/x11/unclutter.nix</code></p></li><li class="listitem"><p><code class="literal">services/x11/display-managers/sddm.nix</code></p></li><li class="listitem"><p><code class="literal">system/boot/coredump.nix</code></p></li><li class="listitem"><p><code class="literal">system/boot/loader/loader.nix</code></p></li><li class="listitem"><p><code class="literal">system/boot/loader/generic-extlinux-compatible</code></p></li><li class="listitem"><p><code class="literal">system/boot/networkd.nix</code></p></li><li class="listitem"><p><code class="literal">system/boot/resolved.nix</code></p></li><li class="listitem"><p><code class="literal">system/boot/timesyncd.nix</code></p></li><li class="listitem"><p><code class="literal">tasks/filesystems/exfat.nix</code></p></li><li class="listitem"><p><code class="literal">tasks/filesystems/ntfs.nix</code></p></li><li class="listitem"><p><code class="literal">tasks/filesystems/vboxsf.nix</code></p></li><li class="listitem"><p><code class="literal">virtualisation/virtualbox-host.nix</code></p></li><li class="listitem"><p><code class="literal">virtualisation/vmware-guest.nix</code></p></li><li class="listitem"><p><code class="literal">virtualisation/xen-dom0.nix</code></p></li></ul></div><p>When upgrading from a previous release, please be aware of the following incompatible changes:</p><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p><code class="literal">sshd</code> no longer supports DSA and ECDSA host keys by default. If you have existing systems with such host keys and want to continue to use them, please set</p></li></ul></div><pre><code class="programlisting nix">{
  system.stateVersion = &quot;14.12&quot;;
}
</code></pre><p>The new option <code class="literal">system.stateVersion</code> ensures that certain configuration changes that could break existing systems (such as the <code class="literal">sshd</code> host key setting) will maintain compatibility with the specified NixOS release. NixOps sets the state version of existing deployments automatically.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">cron</code> is no longer enabled by default, unless you have a non-empty <code class="literal">services.cron.systemCronJobs</code>. To force <code class="literal">cron</code> to be enabled, set <code class="literal">services.cron.enable = true</code>.</p></li><li class="listitem"><p>Nix now requires binary caches to be cryptographically signed. If you have unsigned binary caches that you want to continue to use, you should set <code class="literal">nix.requireSignedBinaryCaches = false</code>.</p></li><li class="listitem"><p>Steam now doesn’t need root rights to work. Instead of using <code class="literal">*-steam-chrootenv</code>, you should now just run <code class="literal">steam</code>. <code class="literal">steamChrootEnv</code> package was renamed to <code class="literal">steam</code>, and old <code class="literal">steam</code> package – to <code class="literal">steamOriginal</code>.</p></li><li class="listitem"><p>CMPlayer has been renamed to bomi upstream. Package <code class="literal">cmplayer</code> was accordingly renamed to <code class="literal">bomi</code></p></li><li class="listitem"><p>Atom Shell has been renamed to Electron upstream. Package <code class="literal">atom-shell</code> was accordingly renamed to <code class="literal">electron</code></p></li><li class="listitem"><p>Elm is not released on Hackage anymore. You should now use <code class="literal">elmPackages.elm</code> which contains the latest Elm platform.</p></li><li class="listitem"><p>The CUPS printing service has been updated to version <code class="literal">2.0.2</code>. Furthermore its systemd service has been renamed to <code class="literal">cups.service</code>.</p><p>Local printers are no longer shared or advertised by default. This behavior can be changed by enabling <code class="literal">services.printing.defaultShared</code> or <code class="literal">services.printing.browsing</code> respectively.</p></li><li class="listitem"><p>The VirtualBox host and guest options have been named more consistently. They can now found in <code class="literal">virtualisation.virtualbox.host.*</code> instead of <code class="literal">services.virtualboxHost.*</code> and <code class="literal">virtualisation.virtualbox.guest.*</code> instead of <code class="literal">services.virtualboxGuest.*</code>.</p><p>Also, there now is support for the <code class="literal">vboxsf</code> file system using the <code class="literal">fileSystems</code> configuration attribute. An example of how this can be used in a configuration:</p></li></ul></div><pre><code class="programlisting nix">{
  fileSystems.&quot;/shiny&quot; = {
    device = &quot;myshinysharedfolder&quot;;
    fsType = &quot;vboxsf&quot;;
  };
}
</code></pre><div class="itemizedlist"><ul class="itemizedlist compact" style="list-style-type: disc;"><li class="listitem"><p>“<code class="literal">nix-env -qa</code>” no longer discovers Haskell packages by name. The only packages visible in the global scope are <code class="literal">ghc</code>, <code class="literal">cabal-install</code>, and <code class="literal">stack</code>, but all other packages are hidden. The reason for this inconvenience is the sheer size of the Haskell package set. Name-based lookups are expensive, and most <code class="literal">nix-env -qa</code> operations would become much slower if we’d add the entire Hackage database into the top level attribute set. Instead, the list of Haskell packages can be displayed by running:</p></li></ul></div><pre><code class="programlisting ShellSession">nix-env -f &quot;&lt;nixpkgs&gt;&quot; -qaP -A haskellPackages
</code></pre><p>Executable programs written in Haskell can be installed with:</p><pre><code class="programlisting ShellSession">nix-env -f &quot;&lt;nixpkgs&gt;&quot; -iA haskellPackages.pandoc
</code></pre><p>Installing Haskell <span class="emphasis"><em>libraries</em></span> this way, however, is no longer supported. See the next item for more details.</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Previous versions of NixOS came with a feature called <code class="literal">ghc-wrapper</code>, a small script that allowed GHC to transparently pick up on libraries installed in the user’s profile. This feature has been deprecated; <code class="literal">ghc-wrapper</code> was removed from the distribution. The proper way to register Haskell libraries with the compiler now is the <code class="literal">haskellPackages.ghcWithPackages</code> function. The <a class="link" href="https://nixos.org/nixpkgs/manual/#users-guide-to-the-haskell-infrastructure"  target="_top">User’s Guide to the Haskell Infrastructure</a> provides more information about this subject.</p></li><li class="listitem"><p>All Haskell builds that have been generated with version 1.x of the <code class="literal">cabal2nix</code> utility are now invalid and need to be re-generated with a current version of <code class="literal">cabal2nix</code> to function. The most recent version of this tool can be installed by running <code class="literal">nix-env -i cabal2nix</code>.</p></li><li class="listitem"><p>The <code class="literal">haskellPackages</code> set in Nixpkgs used to have a function attribute called <code class="literal">extension</code> that users could override in their <code class="literal">~/.nixpkgs/config.nix</code> files to configure additional attributes, etc. That function still exists, but it’s now called <code class="literal">overrides</code>.</p></li><li class="listitem"><p>The OpenBLAS library has been updated to version <code class="literal">0.2.14</code>. Support for the <code class="literal">x86_64-darwin</code> platform was added. Dynamic architecture detection was enabled; OpenBLAS now selects microarchitecture-optimized routines at runtime, so optimal performance is achieved without the need to rebuild OpenBLAS locally. OpenBLAS has replaced ATLAS in most packages which use an optimized BLAS or LAPACK implementation.</p></li><li class="listitem"><p>The <code class="literal">phpfpm</code> is now using the default PHP version (<code class="literal">pkgs.php</code>) instead of PHP 5.4 (<code class="literal">pkgs.php54</code>).</p></li><li class="listitem"><p>The <code class="literal">locate</code> service no longer indexes the Nix store by default, preventing packages with potentially numerous versions from cluttering the output. Indexing the store can be activated by setting <code class="literal">services.locate.includeStore = true</code>.</p></li><li class="listitem"><p>The Nix expression search path (<code class="literal">NIX_PATH</code>) no longer contains <code class="literal">/etc/nixos/nixpkgs</code> by default. You can override <code class="literal">NIX_PATH</code> by setting <code class="literal">nix.nixPath</code>.</p></li><li class="listitem"><p>Python 2.6 has been marked as broken (as it no longer receives security updates from upstream).</p></li><li class="listitem"><p>Any use of module arguments such as <code class="literal">pkgs</code> to access library functions, or to define <code class="literal">imports</code> attributes will now lead to an infinite loop at the time of the evaluation.</p><p>In case of an infinite loop, use the <code class="literal">--show-trace</code> command line argument and read the line just above the error message.</p><pre><code class="programlisting ShellSession">$ nixos-rebuild build --show-trace
…
while evaluating the module argument `pkgs&#x27; in &quot;/etc/nixos/my-module.nix&quot;:
infinite recursion encountered
</code></pre><p>Any use of <code class="literal">pkgs.lib</code>, should be replaced by <code class="literal">lib</code>, after adding it as argument of the module. The following module</p><pre><code class="programlisting nix">{ config, pkgs, ... }:

with pkgs.lib;

{
  options = {
    foo = mkOption { /* … */ };
  };
  config = mkIf config.foo { /* … */ };
}
</code></pre><p>should be modified to look like:</p><pre><code class="programlisting nix">{ config, pkgs, lib, ... }:

with lib;

{
  options = {
    foo = mkOption { /* option declaration */ };
  };
  config = mkIf config.foo { /* option definition */ };
}
</code></pre><p>When <code class="literal">pkgs</code> is used to download other projects to import their modules, and only in such cases, it should be replaced by <code class="literal">(import &lt;nixpkgs&gt; {})</code>. The following module</p><pre><code class="programlisting nix">{ config, pkgs, ... }:

let
  myProject = pkgs.fetchurl {
    src = url;
    sha256 = hash;
  };
in

{
  imports = [ &quot;${myProject}/module.nix&quot; ];
}
</code></pre><p>should be modified to look like:</p><pre><code class="programlisting nix">{ config, pkgs, ... }:

let
  myProject = (import &lt;nixpkgs&gt; {}).fetchurl {
    src = url;
    sha256 = hash;
  };
in

{
  imports = [ &quot;${myProject}/module.nix&quot; ];
}
</code></pre></li></ul></div><p>Other notable improvements:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The nixos and nixpkgs channels were unified, so one <span class="emphasis"><em>can</em></span> use <code class="literal">nix-env -iA nixos.bash</code> instead of <code class="literal">nix-env -iA nixos.pkgs.bash</code>. See <a class="link" href="https://github.com/NixOS/nixpkgs/commit/2cd7c1f198"  target="_top">the commit</a> for details.</p></li><li class="listitem"><p>Users running an SSH server who worry about the quality of their <code class="literal">/etc/ssh/moduli</code> file with respect to the <a class="link" href="https://stribika.github.io/2015/01/04/secure-secure-shell.html"  target="_top">vulnerabilities discovered in the Diffie-Hellman key exchange</a> can now replace OpenSSH’s default version with one they generated themselves using the new <code class="literal">services.openssh.moduliFile</code> option.</p></li><li class="listitem"><p>A newly packaged TeX Live 2015 is provided in <code class="literal">pkgs.texlive</code>, split into 6500 nix packages. For basic user documentation see <a class="link" href="https://github.com/NixOS/nixpkgs/blob/release-15.09/pkgs/tools/typesetting/tex/texlive/default.nix#L1"  target="_top">the source</a>. Beware of <a class="link" href="https://github.com/NixOS/nixpkgs/issues/9757"  target="_top">an issue</a> when installing a too large package set. The plan is to deprecate and maybe delete the original TeX packages until the next release.</p></li><li class="listitem"><p><code class="literal">buildEnv.env</code> on all Python interpreters is now available for nix-shell interoperability.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-14.12" class="title" style="clear: both">Release 14.12 (“Caterpillar”, 2014/12/30)   </h2>  </div> </div></div><p>In addition to numerous new and upgraded packages, this release has the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Systemd has been updated to version 217, which has numerous <a class="link" href="http://lists.freedesktop.org/archives/systemd-devel/2014-October/024662.html"  target="_top">improvements.</a></p></li><li class="listitem"><p><a class="link" href="https://www.mail-archive.com/nix-dev@lists.science.uu.nl/msg13957.html"  target="_top">Nix has been updated to 1.8.</a></p></li><li class="listitem"><p>NixOS is now based on Glibc 2.20.</p></li><li class="listitem"><p>KDE has been updated to 4.14.</p></li><li class="listitem"><p>The default Linux kernel has been updated to 3.14.</p></li><li class="listitem"><p>If <code class="literal">users.mutableUsers</code> is enabled (the default), changes made to the declaration of a user or group will be correctly realised when running <code class="literal">nixos-rebuild</code>. For instance, removing a user specification from <code class="literal">configuration.nix</code> will cause the actual user account to be deleted. If <code class="literal">users.mutableUsers</code> is disabled, it is no longer necessary to specify UIDs or GIDs; if omitted, they are allocated dynamically.</p></li></ul></div><p>Following new services were added since the last release:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p><code class="literal">atftpd</code></p></li><li class="listitem"><p><code class="literal">bosun</code></p></li><li class="listitem"><p><code class="literal">bspwm</code></p></li><li class="listitem"><p><code class="literal">chronos</code></p></li><li class="listitem"><p><code class="literal">collectd</code></p></li><li class="listitem"><p><code class="literal">consul</code></p></li><li class="listitem"><p><code class="literal">cpuminer-cryptonight</code></p></li><li class="listitem"><p><code class="literal">crashplan</code></p></li><li class="listitem"><p><code class="literal">dnscrypt-proxy</code></p></li><li class="listitem"><p><code class="literal">docker-registry</code></p></li><li class="listitem"><p><code class="literal">docker</code></p></li><li class="listitem"><p><code class="literal">etcd</code></p></li><li class="listitem"><p><code class="literal">fail2ban</code></p></li><li class="listitem"><p><code class="literal">fcgiwrap</code></p></li><li class="listitem"><p><code class="literal">fleet</code></p></li><li class="listitem"><p><code class="literal">fluxbox</code></p></li><li class="listitem"><p><code class="literal">gdm</code></p></li><li class="listitem"><p><code class="literal">geoclue2</code></p></li><li class="listitem"><p><code class="literal">gitlab</code></p></li><li class="listitem"><p><code class="literal">gitolite</code></p></li><li class="listitem"><p><code class="literal">gnome3.gnome-documents</code></p></li><li class="listitem"><p><code class="literal">gnome3.gnome-online-miners</code></p></li><li class="listitem"><p><code class="literal">gnome3.gvfs</code></p></li><li class="listitem"><p><code class="literal">gnome3.seahorse</code></p></li><li class="listitem"><p><code class="literal">hbase</code></p></li><li class="listitem"><p><code class="literal">i2pd</code></p></li><li class="listitem"><p><code class="literal">influxdb</code></p></li><li class="listitem"><p><code class="literal">kubernetes</code></p></li><li class="listitem"><p><code class="literal">liquidsoap</code></p></li><li class="listitem"><p><code class="literal">lxc</code></p></li><li class="listitem"><p><code class="literal">mailpile</code></p></li><li class="listitem"><p><code class="literal">mesos</code></p></li><li class="listitem"><p><code class="literal">mlmmj</code></p></li><li class="listitem"><p><code class="literal">monetdb</code></p></li><li class="listitem"><p><code class="literal">mopidy</code></p></li><li class="listitem"><p><code class="literal">neo4j</code></p></li><li class="listitem"><p><code class="literal">nsd</code></p></li><li class="listitem"><p><code class="literal">openntpd</code></p></li><li class="listitem"><p><code class="literal">opentsdb</code></p></li><li class="listitem"><p><code class="literal">openvswitch</code></p></li><li class="listitem"><p><code class="literal">parallels-guest</code></p></li><li class="listitem"><p><code class="literal">peerflix</code></p></li><li class="listitem"><p><code class="literal">phd</code></p></li><li class="listitem"><p><code class="literal">polipo</code></p></li><li class="listitem"><p><code class="literal">prosody</code></p></li><li class="listitem"><p><code class="literal">radicale</code></p></li><li class="listitem"><p><code class="literal">redmine</code></p></li><li class="listitem"><p><code class="literal">riemann</code></p></li><li class="listitem"><p><code class="literal">scollector</code></p></li><li class="listitem"><p><code class="literal">seeks</code></p></li><li class="listitem"><p><code class="literal">siproxd</code></p></li><li class="listitem"><p><code class="literal">strongswan</code></p></li><li class="listitem"><p><code class="literal">tcsd</code></p></li><li class="listitem"><p><code class="literal">teamspeak3</code></p></li><li class="listitem"><p><code class="literal">thermald</code></p></li><li class="listitem"><p><code class="literal">torque/mrom</code></p></li><li class="listitem"><p><code class="literal">torque/server</code></p></li><li class="listitem"><p><code class="literal">uhub</code></p></li><li class="listitem"><p><code class="literal">unifi</code></p></li><li class="listitem"><p><code class="literal">znc</code></p></li><li class="listitem"><p><code class="literal">zookeeper</code></p></li></ul></div><p>When upgrading from a previous release, please be aware of the following incompatible changes:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>The default version of Apache httpd is now 2.4. If you use the <code class="literal">extraConfig</code> option to pass literal Apache configuration text, you may need to update it — see <a class="link" href="http://httpd.apache.org/docs/2.4/upgrading.html"  target="_top">Apache’s documentation</a> for details. If you wish to continue to use httpd 2.2, add the following line to your NixOS configuration:</p><pre><code class="programlisting nix">{
  services.httpd.package = pkgs.apacheHttpd_2_2;
}
</code></pre></li><li class="listitem"><p>PHP 5.3 has been removed because it is no longer supported by the PHP project. A <a class="link" href="http://php.net/migration54"  target="_top">migration guide</a> is available.</p></li><li class="listitem"><p>The host side of a container virtual Ethernet pair is now called <code class="literal">ve-container-name</code> rather than <code class="literal">c-container-name</code>.</p></li><li class="listitem"><p>GNOME 3.10 support has been dropped. The default GNOME version is now 3.12.</p></li><li class="listitem"><p>VirtualBox has been upgraded to 4.3.20 release. Users may be required to run <code class="literal">rm -rf /tmp/.vbox*</code>. The line <code class="literal">imports = [ &lt;nixpkgs/nixos/modules/programs/virtualbox.nix&gt; ]</code> is no longer necessary, use <code class="literal">services.virtualboxHost.enable = true</code> instead.</p><p>Also, hardening mode is now enabled by default, which means that unless you want to use USB support, you no longer need to be a member of the <code class="literal">vboxusers</code> group.</p></li><li class="listitem"><p>Chromium has been updated to 39.0.2171.65. <code class="literal">enablePepperPDF</code> is now enabled by default. <code class="literal">chromium*Wrapper</code> packages no longer exist, because upstream removed NSAPI support. <code class="literal">chromium-stable</code> has been renamed to <code class="literal">chromium</code>.</p></li><li class="listitem"><p>Python packaging documentation is now part of nixpkgs manual. To override the python packages available to a custom python you now use <code class="literal">pkgs.pythonFull.buildEnv.override</code> instead of <code class="literal">pkgs.pythonFull.override</code>.</p></li><li class="listitem"><p><code class="literal">boot.resumeDevice = &quot;8:6&quot;</code> is no longer supported. Most users will want to leave it undefined, which takes the swap partitions automatically. There is an evaluation assertion to ensure that the string starts with a slash.</p></li><li class="listitem"><p>The system-wide default timezone for NixOS installations changed from <code class="literal">CET</code> to <code class="literal">UTC</code>. To choose a different timezone for your system, configure <code class="literal">time.timeZone</code> in <code class="literal">configuration.nix</code>. A fairly complete list of possible values for that setting is available at <a class="link" href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones"  target="_top">https://en.wikipedia.org/wiki/List_of_tz_database_time_zones</a>.</p></li><li class="listitem"><p>GNU screen has been updated to 4.2.1, which breaks the ability to connect to sessions created by older versions of screen.</p></li><li class="listitem"><p>The Intel GPU driver was updated to the 3.x prerelease version (used by most distributions) and supports DRI3 now.</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-14.04" class="title" style="clear: both">Release 14.04 (“Baboon”, 2014/04/30)   </h2>  </div> </div></div><p>This is the second stable release branch of NixOS. In addition to numerous new and upgraded packages and modules, this release has the following highlights:</p><div class="itemizedlist"><ul class="itemizedlist " style="list-style-type: disc;"><li class="listitem"><p>Installation on UEFI systems is now supported. See <a class="xref" href="index.html#sec-installation" title="Installing NixOS" ><em>Installing NixOS</em></a> for details.</p></li><li class="listitem"><p>Systemd has been updated to version 212, which has <a class="link" href="http://cgit.freedesktop.org/systemd/systemd/plain/NEWS?id=v212"  target="_top">numerous improvements</a>. NixOS now automatically starts systemd user instances when you log in. You can define global user units through the <code class="literal">systemd.unit.*</code> options.</p></li><li class="listitem"><p>NixOS is now based on Glibc 2.19 and GCC 4.8.</p></li><li class="listitem"><p>The default Linux kernel has been updated to 3.12.</p></li><li class="listitem"><p>KDE has been updated to 4.12.</p></li><li class="listitem"><p>GNOME 3.10 experimental support has been added.</p></li><li class="listitem"><p>Nix has been updated to 1.7 (<a class="link" href="https://nixos.org/nix/manual/#ssec-relnotes-1.7"  target="_top">details</a>).</p></li><li class="listitem"><p>NixOS now supports fully declarative management of users and groups. If you set <code class="literal">users.mutableUsers</code> to <code class="literal">false</code>, then the contents of <code class="literal">/etc/passwd</code> and <code class="literal">/etc/group</code> will be <a class="link" href="https://www.usenix.org/legacy/event/lisa02/tech/full_papers/traugott/traugott_html/"  target="_top">congruent</a> to your NixOS configuration. For instance, if you remove a user from <code class="literal">users.extraUsers</code> and run <code class="literal">nixos-rebuild</code>, the user account will cease to exist. Also, imperative commands for managing users and groups, such as <code class="literal">useradd</code>, are no longer available. If <code class="literal">users.mutableUsers</code> is <code class="literal">true</code> (the default), then behaviour is unchanged from NixOS 13.10.</p></li><li class="listitem"><p>NixOS now has basic container support, meaning you can easily run a NixOS instance as a container in a NixOS host system. These containers are suitable for testing and experimentation but not production use, since they’re not fully isolated from the host. See <a class="xref" href="index.html#ch-containers" title="Container Management" ><em>Container Management</em></a> for details.</p></li><li class="listitem"><p>Systemd units provided by packages can now be overridden from the NixOS configuration. For instance, if a package <code class="literal">foo</code> provides systemd units, you can say:</p><pre><code class="programlisting nix">{
  systemd.packages = [ pkgs.foo ];
}
</code></pre><p>to enable those units. You can then set or override unit options in the usual way, e.g.</p><pre><code class="programlisting nix">{
  systemd.services.foo.wantedBy = [ &quot;multi-user.target&quot; ];
  systemd.services.foo.serviceConfig.MemoryLimit = &quot;512M&quot;;
}
</code></pre><p>When upgrading from a previous release, please be aware of the following incompatible changes:</p></li><li class="listitem"><p>Nixpkgs no longer exposes unfree packages by default. If your NixOS configuration requires unfree packages from Nixpkgs, you need to enable support for them explicitly by setting:</p><pre><code class="programlisting nix">{
  nixpkgs.config.allowUnfree = true;
}
</code></pre><p>Otherwise, you get an error message such as:</p><pre><code class="programlisting ShellSession">    error: package ‘nvidia-x11-331.49-3.12.17’ in ‘…/nvidia-x11/default.nix:56’
      has an unfree license, refusing to evaluate
</code></pre></li><li class="listitem"><p>The Adobe Flash player is no longer enabled by default in the Firefox and Chromium wrappers. To enable it, you must set:</p><pre><code class="programlisting nix">{
  nixpkgs.config.allowUnfree = true;
  nixpkgs.config.firefox.enableAdobeFlash = true; # for Firefox
  nixpkgs.config.chromium.enableAdobeFlash = true; # for Chromium
}
</code></pre></li><li class="listitem"><p>The firewall is now enabled by default. If you don’t want this, you need to disable it explicitly:</p><pre><code class="programlisting nix">{
  networking.firewall.enable = false;
}
</code></pre></li><li class="listitem"><p>The option <code class="literal">boot.loader.grub.memtest86</code> has been renamed to <code class="literal">boot.loader.grub.memtest86.enable</code>.</p></li><li class="listitem"><p>The <code class="literal">mysql55</code> service has been merged into the <code class="literal">mysql</code> service, which no longer sets a default for the option <code class="literal">services.mysql.package</code>.</p></li><li class="listitem"><p>Package variants are now differentiated by suffixing the name, rather than the version. For instance, <code class="literal">sqlite-3.8.4.3-interactive</code> is now called <code class="literal">sqlite-interactive-3.8.4.3</code>. This ensures that <code class="literal">nix-env -i sqlite</code> is unambiguous, and that <code class="literal">nix-env -u</code> won’t “upgrade” <code class="literal">sqlite</code> to <code class="literal">sqlite-interactive</code> or vice versa. Notably, this change affects the Firefox wrapper (which provides plugins), as it is now called <code class="literal">firefox-wrapper</code>. So when using <code class="literal">nix-env</code>, you should do <code class="literal">nix-env -e firefox; nix-env -i firefox-wrapper</code> if you want to keep using the wrapper. This change does not affect declarative package management, since attribute names like <code class="literal">pkgs.firefoxWrapper</code> were already unambiguous.</p></li><li class="listitem"><p>The symlink <code class="literal">/etc/ca-bundle.crt</code> is gone. Programs should instead use the environment variable <code class="literal">OPENSSL_X509_CERT_FILE</code> (which points to <code class="literal">/etc/ssl/certs/ca-bundle.crt</code>).</p></li></ul></div>
</div><div class="section"> <div class="titlepage">  <div>   <div>    <h2 id="sec-release-13.10" class="title" style="clear: both">Release 13.10 (“Aardvark”, 2013/10/31)   </h2>  </div> </div></div><p>This is the first stable release branch of NixOS.</p>
</div>
</div>  <div class="navfooter">
   <hr />
   <table width="100%" summary="Navigation footer">
    <tr>
    <td width="40%" align="left"><a accesskey="p" href="options.html">Prev</a>&nbsp;</td>
    <td width="20%" align="center">&nbsp;</td>
    <td width="40%" align="right">&nbsp;</td>
    </tr>
    <tr>
     <td width="40%" align="left" valign="top">Appendix A. Configuration Options&nbsp;</td>
     <td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
     <td width="40%" align="right" valign="top">&nbsp;</td>
    </tr>
   </table>
  </div>
 </body>
</html>